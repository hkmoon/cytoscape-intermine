!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.cymine=f()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){module.exports=[{selector:"node",style:{content:"data(label)","border-width":"2px","background-color":"#dedede","border-style":"solid","border-color":"#999"}},{selector:":selected",style:{"text-outline-color":"black","background-color":"gold","border-color":"gold","border-width":"5px","border-style":"solid"}},{selector:"edge",style:{width:"2px"}},{selector:'edge[interactionType@^="genetic"]',style:{"line-color":"#2c79be"}},{selector:'edge[interactionType@^="physical"]',style:{"line-color":"#c00"}},{selector:".genetic",style:{"border-color":"#225f95"}},{selector:".physical",style:{"border-color":"#c00"}},{selector:".both",style:{"border-color":"#77304B"}}]},{}],2:[function(require,module,exports){var _=require("underscore"),Cymine=function(records){function toNodesAndEdges(records,parentNode){var d={nodes:[],edges:[]};for(var i in records){var thisNode,row=records[i];thisNode=recordToNode(row),row.interactions?d=_.extend(d,toNodesAndEdges(row.interactions,thisNode)):d.edges=d.edges.concat(interactionToEdges(parentNode,thisNode)),d.nodes.push(thisNode)}return d}this.records=records;var recordToNode=function(obj){var ret,interactions;return ret=obj.participant2?obj.participant2:obj,interactions=getInteractions(obj),label=nameNode(obj),{classes:getClasses(interactions),data:{title:ret["class"]+" "+label,"interaction details":collapseArrays(obj.details)||{},label:label,"class":ret["class"],interactionTypes:interactions,symbol:ret.symbol,id:ret.primaryIdentifier}}},getClasses=function(arrOfClasses){var ret=_.uniq(arrOfClasses);return ret.length>1&&ret.push("both"),ret.join(" ")},collapseArrays=function(obj){var ret={};return _.each(obj,function(theProp,i){Array.isArray(obj)?("object"==typeof theProp&&(theProp=collapseArrays(theProp)),ret[theProp.name]=1===theProp.length?theProp[0]:theProp):Array.isArray(theProp)?ret[i]=1===theProp.length?theProp[0]:theProp:"object"==typeof theProp?(theProp=collapseArrays(theProp),ret[theProp.name||theProp["class"]]=1===theProp.length?theProp[0]:theProp):ret[i]=theProp}),ret},getInteractions=function(obj){var ret=[];if(obj.details)for(var i=0;i<obj.details.length;i++)ret.indexOf(obj.details[i].type)<0&&ret.push(obj.details[i].type);else ret.push("master");return ret},nameNode=function(obj){return obj.participant2&&obj.participant2.symbol?obj.participant2.symbol:obj.symbol?obj.symbol:obj.details?obj.details[0].name:"NAME MISSING"},interactionToEdges=function(node,node2){for(var interactions=node2.data.interactionTypes,ret=[],i=0;i<interactions.length;i++)ret.push({id:node2.data["interaction details"].objectId,classes:interactions[i],data:{title:"Interaction between "+node.data.label+" and "+node2.data.label,source:node.data.id,target:node2.data.id,interactionType:interactions[i]}});return ret};return toNodesAndEdges(records)};module.exports=Cymine},{underscore:77}],3:[function(require,module,exports){var svDataFormatter=(require("./../util"),require("./svDataFormatter")()),exporter=function(){var sv=function(separator,data){var svContent=svDataFormatter.format(separator,data),mimeType="text/"+separator;download(svContent,"results-table."+separator,mimeType,!0)},prepDownloadString=function(encode,mimeType,content){var imgSrc;return encode?(imgSrc="data:"+mimeType+",",imgSrc+=encodeURIComponent(content)):imgSrc=content,imgSrc},download=function(content,fileName,mimeType,encode){var a=document.createElement("a"),imgSrc=prepDownloadString(encode,mimeType,content);if(mimeType=mimeType||"application/octet-stream",navigator.msSaveBlob)return navigator.msSaveBlob(new Blob([content],{type:mimeType}),fileName);if("download"in a)return a.href+=imgSrc,a.setAttribute("download",fileName),document.body.appendChild(a),setTimeout(function(){a.click(),document.body.removeChild(a)},66),!0;var f=document.createElement("iframe");return document.body.appendChild(f),f.src=imgSrc,setTimeout(function(){document.body.removeChild(f)},333),!0};return{sv:sv,download:download,prepDownloadString:prepDownloadString}};module.exports=exporter},{"./../util":13,"./svDataFormatter":5}],4:[function(require,module,exports){var util=require("./../util"),helpers=require("./exportHelpers")();exporter=function(){var rawData,cy,elems={},exportFunction=function(){var jpg=function(){helpers.download(cy.jpg(),"network.jpg")},png=function(){helpers.download(cy.png(),"network.png")},csv=function(){helpers.sv("csv",rawData)},tsv=function(){helpers.sv("tsv",rawData)};return{jpg:jpg,png:png,csv:csv,tsv:tsv}},listen=function(){var e=elems;e.exportElem=e.parentElem.querySelector(".export"),e.formatChooser=e.exportElem.querySelector("select"),e.exportButton=e.exportElem.querySelector("button");var exportFile=exportFunction();e.exportElem.addEventListener("click",function(){util.addClass(e.exportElem,"active")}),e.exportButton.addEventListener("click",function(){var format=getFormat();try{exportFile[format]()}catch(error){console.error("Invalid file format: '"+format+"'. ",error)}util.removeClass(e.exportElem,"active")})},init=function(graph){elems.parentElem=graph.parentElem,rawData=graph.rawData,cy=graph.cy,listen()},getFormat=function(){return elems.formatChooser.value};return{init:init}},module.exports=exporter},{"./../util":13,"./exportHelpers":3}],5:[function(require,module,exports){var sv=function(){var makeHeaders=function(separator,data){var headers=["Gene > Symbol","Gene > DB identifier","Gene > Interactions > Details > Type","Gene > Interactions > Gene 2 . Symbol","Gene > Interactions > Gene 2 > DB identifier","Gene > Interactions > Details > Data Sets > Data Source > Name"];return headers.join(separator)},makeData=function(rawData){var temp,row,data=[];rawData=rawData[0];for(var i=0;i<rawData.interactions.length;i++)row=rawData.interactions[i],temp=[rawData.symbol,rawData.primaryIdentifier,row.participant2.symbol,row.participant2.primaryIdentifier],data=data.concat(makeRowsWithDetails(temp,row.details));return data},makeRowsWithDetails=function(rowArray,details){for(var temp,rows=[],i=0;i<details.length;i++)detail=details[i],temp=rowArray.slice(0),temp.splice(2,0,detail.type),rows=rows.concat(makeRowsWithDataSets(temp,detail.dataSets));return rows},makeRowsWithDataSets=function(rowArray,dataSets){for(var temp,rows=[],i=0;i<dataSets.length;i++)ds=dataSets[i],temp=rowArray.slice(0),temp.push(ds.name),rows.push(temp);return rows},format=function(separator,data){var separators={csv:",",tsv:"	"},svContent=makeHeaders(separators[separator],data)+"\n",dataArray=makeData(data);return dataArray.forEach(function(infoArray,index){dataString=infoArray.join(separators[separator]),svContent+=dataString+"\n"}),svContent};return{format:format}};module.exports=sv},{}],6:[function(require,module,exports){function Cymine(args){function validateParent(){if(!graph.parentElem){var defaultElem=document.getElementById("cymine");if(!defaultElem)return console.error(strings.dev.noParent.noDefault),!1;graph.parentElem=defaultElem,console.info(strings.dev.noParent.usingDefault)}return!0}function validateServiceRoot(){if(graph.service)return new imjs.Service({token:graph.service.token,root:graph.service.root,errorHandler:badServiceError});throw new initError("noServiceUrl")}function prepQuery(){if(graph.queryOn)return _.extend(query.where[0],graph.queryOn),graph.query=query,graph.nodeType===strings.CONST.PROTEIN&&prepProteinQuery(),!0;throw new initError("noQueryData")}function prepProteinQuery(){graph.query.where[0].path=strings.CONST.LOOKUP_PROTEIN,"="===graph.query.where[0].op&&(graph.query.where[0].path+=".id"),graph.query.where.length<=1&&graph.query.where.push(proteinConstraint)}function init(){if(validateParent()&&(ui=new cymineDisplay(graph),ui.init(),mine=validateServiceRoot(),prepQuery()&&mine))var q=mine.records(query).then(function(response){if(response.length>0){graph.rawData=response,graph.data=new cymineDataFormatter(response),graph.cy=ui.attachResults();try{exporter.init(graph)}catch(e){console.error(e)}try{tableDisplayer.init(graph)}catch(e){console.error(e)}return console.debug("response:",response,"graphdata:",graph),q}return ui.attachResults(strings.user.noResults),Promise.reject()})["catch"](function(error){return console.error("Possible CORS error?",error),ui.attachResults(strings.user.pleaseClearCache),Promise.reject()});return Promise.reject()}function initError(devMessage,userMessage){var um=userMessage?userMessage:"noQueryData";ui.init(strings.user[um]),console.error(strings.dev[devMessage])}var ui,graph=_.extend({},args),exporter=exportFile();return cym=init(),cym}function badServiceError(){throw new initError("badServiceUrl")}var cymineDataFormatter=require("./dataFormatter"),imjs=require("imjs"),_=(require("cytoscape"),require("underscore")),strings=require("./strings"),query=require("./query/query"),proteinConstraint=require("./query/proteinPhysicalConstraint"),exportFile=require("./exporter/exporter"),tableDisplayer=require("./showInTable")(),cymineDisplay=require("./ui");module.exports=Cymine},{"./dataFormatter":2,"./exporter/exporter":4,"./query/proteinPhysicalConstraint":8,"./query/query":9,"./showInTable":10,"./strings":11,"./ui":12,cytoscape:55,imjs:64,underscore:77}],7:[function(require,module,exports){var metaFields=["label","objectId","title","interactionTypes","class"];module.exports=metaFields},{}],8:[function(require,module,exports){module.exports={path:"interactions.details.type",op:"=",value:"physical",code:"B"}},{}],9:[function(require,module,exports){module.exports={name:"Gene_Interactions",title:"Gene --> Interactions",description:"Show all interactions for a given gene.",constraintLogic:"A and B",from:"Gene",select:["primaryIdentifier","symbol","interactions.participant2.symbol","interactions.participant2.primaryIdentifier","interactions.details.name","interactions.details.role1","interactions.details.role2","interactions.details.type","interactions.details.dataSets.name"],orderBy:[{path:"symbol",direction:"ASC"}],where:[{path:"Gene",op:"LOOKUP",code:"A",editable:!0,switched:"LOCKED",switchable:!1}]}},{}],10:[function(require,module,exports){var util=require("./util"),strings=require("./strings").showTable,table=function(){var settings,imtablesSettings,elems={},init=function(graph){timeoutID=setTimeout(function(){imtables&&(settings=graph,showTableButton()),imtablesSettings={query:settings.query,service:{root:settings.service.root}}},500)},showTableButton=function(){elems.showTable=settings.parentElem.querySelector(".showTable"),util.addClass(elems.showTable,"enabled"),elems.showTable.innerHTML=strings.showInTableFormat,listen()},showTable=function(){elems.theTable=settings.parentElem.querySelector(".tableView"),elems.showTable.innerHTML=strings.hideTableFormat,util.removeClass(elems.theTable,"disabled"),util.hasClass(elems.theTable,"firstRun")&&(imtables.loadTable(elems.theTable,{start:0,size:25},{query:settings.query,service:{root:settings.service.root}}).then(function(table){console.log("Table loaded",table)},function(error){console.error("Could not load table",error)}),util.removeClass(elems.theTable,"firstRun"))},hideTable=function(){util.addClass(elems.theTable,"disabled"),elems.showTable.innerHTML=strings.showInTableFormat},listen=function(){elems.showTable.addEventListener("click",function(){!elems.theTable||util.hasClass(elems.theTable,"disabled")?showTable():hideTable()})};return{showTable:showTable,init:init}};module.exports=table},{"./strings":11,"./util":13}],11:[function(require,module,exports){module.exports={user:{noResults:"No interaction results for this query",pleaseClearCache:"Error loading results. Please clear your cache and try again.",noQueryData:"Problem loading query results"},dev:{noParent:{usingDefault:"Cymine: No parent element specified for Cymine. Using default '#cymine",noDefault:"Cymine: No parent element specified, and default '#cymine' not available."},noQueryData:"Cymine: No queryOn values supplied!",noServiceUrl:"Cymine: No serviceUrl defined, unable to query for interactions.",badServiceUrl:"Cymine: bad serviceUrl. Please check for typos and check this host is up."},showTable:{showInTableFormat:"Show in table format",hideTableFormat:"Hide table"},CONST:{PROTEIN:"Protein",LOOKUP_PROTEIN:"proteins"}}},{}],12:[function(require,module,exports){var metaFields=require("./metaFields"),util=require("./util"),_=require("underscore"),cyStyle=require("./cytoscapeStyle");ui=function(graph){_.templateSettings={evaluate:/\{\{(.+?)\}\}/g,interpolate:/\{\{=(.+?)\}\}/g,escape:/\{\{-(.+?)\}\}/g},this.graph=graph;var cy,cyLayout={name:"cose"},templates={cymineHtml:{html:require("./../template/cytomine.html"),type:"html"},InteractionDetail:{html:require("./../template/interaction.html"),type:"_",additionalFunction:function(args){return splitRoleTypes(args)}}},display=function(node){targetElem=graph.parentElem.querySelector("nodeDetails"),setTitle(node),listProperties(node)},setTitle=function(elem){var title=graph.parentElem.querySelector(".nodeTitle");title.innerHTML=elem.title},listProperties=function(node){try{var display=expandPropertyVals(node),oldNodeInfo=graph.parentElem.querySelector(".nodeInfo");display.setAttribute("class","nodeInfo"),oldNodeInfo.parentElement.replaceChild(display,oldNodeInfo)}catch(e){console.error("Whoopsie",e)}},getTemplate=function(chosenTemplate){var template=templates[chosenTemplate];return"html"===template.type?template.html:"_"===template.type?_.template(template.html):void 0},hasTemplate=function(chosenTemplate){return templates[chosenTemplate]&&!0},expandPropertyVals=function(obj){var dtTemp,ddTemp,display=document.createElement("dl");for(var prop in obj)metaFields.indexOf(prop)<0&&("undefined"===prop&&console.log(obj,prop,obj[prop]),dtTemp=document.createElement("dt"),dtTemp.appendChild(document.createTextNode(prop)),ddTemp=document.createElement("dd"),util.addClass(ddTemp,"cym-"+prop),"object"==typeof obj[prop]?hasTemplate(obj[prop]["class"])?ddTemp.appendChild(expandToTemplate(obj[prop],obj)):(util.addClass(ddTemp,"child"),ddTemp.appendChild(expandPropertyVals(obj[prop]))):ddTemp.appendChild(document.createTextNode(obj[prop])),insertAtStart([dtTemp,ddTemp],display));return display},expandToTemplate=function(obj){var myObj=_.clone(obj),template=getTemplate(obj["class"]);return templates[obj["class"]].additionalFunction&&(myObj=templates[obj["class"]].additionalFunction(myObj)),temp=document.createElement("div"),temp.innerHTML=template(myObj),temp},splitRoleTypes=function(obj){var interactionName=obj.name,roleArray=[];return interactionName&&(roleArray=interactionName.indexOf("FlyBase:")>-1?interactionName.split(":")[1].split("_"):interactionName.split("-")),obj.roles=roleArray,obj},insertAtStart=function(elems,parentContainer){for(var firstOriginalElem=parentContainer.firstChild,i=0;i<elems.length;i++)parentContainer.insertBefore(elems[i],firstOriginalElem)},attachResults=function(errorMessage){return errorMessage?noResults(errorMessage):initGraph(),cy},controls=function(){var hiddenElems,getControls=function(){return graph.parentElem.querySelector(".interactionFilter")},getReset=function(){return graph.parentElem.querySelector(".reset")},selectInteractionType=function(e){var elem=e.target;if(elem!==e.currentTarget&&"button"===elem.nodeName.toLowerCase()){removeAllButtonSelections();var elemClass=elem.className;util.addClass(elem,"selected"),hiddenElems&&hiddenElems.restore(),hiddenElems=cy.elements().filterFn(function(ele){return"default"===elemClass?!ele:!ele.hasClass(elemClass)&&!ele.hasClass("both")&&!ele.hasClass("master")}).remove()}},resetGraph=function(){cy.makeLayout(cyLayout).run(),getControls().querySelector(".default").click()},listen=function(){getControls().addEventListener("click",selectInteractionType,!1),getReset().addEventListener("click",resetGraph,!1)},removeAllButtonSelections=function(){for(var theButtons=getControls().querySelectorAll("button"),i=0;i<theButtons.length;i++)util.removeClass(theButtons[i]," selected"),util.removeClass(theButtons[i],"selected")};return{listen:listen}},init=function(){graph.parentElem.innerHTML=getTemplate("cymineHtml"),util.addClass(graph.parentElem,"cymine"),graph.statusBar=graph.parentElem.querySelector(".status"),graph.targetElem=graph.parentElem.querySelector(".cy"),graph.targetElem.style.width=graph.parentElem.querySelector(".graph").clientWidth+"px"},initGraph=function(){try{var interactionControls=controls();interactionControls.listen()}catch(e){console.error(e)}cy=cytoscape({container:graph.targetElem,layout:cyLayout,elements:graph.data,style:cyStyle,ready:function(){graph.statusBar.remove()}}),cy.on("tap","node",function(){display(this.data())}),cy.on("tap","edge",function(){display(this.data())})},noResults=function(message){graph.statusBar.className="status no-results",graph.statusBar.innerHTML=message};return{init:init,attachResults:attachResults,noResults:noResults}},module.exports=ui},{"./../template/cytomine.html":78,"./../template/interaction.html":79,"./cytoscapeStyle":1,"./metaFields":7,"./util":13,underscore:77}],13:[function(require,module,exports){var util={addClass:function(elem,classToAdd){util.hasClass(elem,classToAdd)||(elem.className+=" "+classToAdd)},removeClass:function(elem,classToRemove){elem.className=elem.className.replace(classToRemove,"")},hasClass:function(elem,classToCheckFor){var classes=elem.className.split(" ");return classes.indexOf(classToCheckFor)>=0}};module.exports=util},{}],14:[function(require,module,exports){},{}],15:[function(require,module,exports){function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function Buffer(arg){return this instanceof Buffer?(this.length=0,this.parent=void 0,"number"==typeof arg?fromNumber(this,arg):"string"==typeof arg?fromString(this,arg,arguments.length>1?arguments[1]:"utf8"):fromObject(this,arg)):arguments.length>1?new Buffer(arg,arguments[1]):new Buffer(arg)}function fromNumber(that,length){if(that=allocate(that,0>length?0:0|checked(length)),!Buffer.TYPED_ARRAY_SUPPORT)for(var i=0;length>i;i++)that[i]=0;return that}function fromString(that,string,encoding){("string"!=typeof encoding||""===encoding)&&(encoding="utf8");var length=0|byteLength(string,encoding);return that=allocate(that,length),that.write(string,encoding),that}function fromObject(that,object){if(Buffer.isBuffer(object))return fromBuffer(that,object);if(isArray(object))return fromArray(that,object);if(null==object)throw new TypeError("must start with number, buffer, array or string");return"undefined"!=typeof ArrayBuffer&&object.buffer instanceof ArrayBuffer?fromTypedArray(that,object):object.length?fromArrayLike(that,object):fromJsonObject(that,object)}function fromBuffer(that,buffer){var length=0|checked(buffer.length);return that=allocate(that,length),buffer.copy(that,0,0,length),that}function fromArray(that,array){var length=0|checked(array.length);that=allocate(that,length);for(var i=0;length>i;i+=1)that[i]=255&array[i];return that}function fromTypedArray(that,array){var length=0|checked(array.length);that=allocate(that,length);for(var i=0;length>i;i+=1)that[i]=255&array[i];return that}function fromArrayLike(that,array){var length=0|checked(array.length);that=allocate(that,length);for(var i=0;length>i;i+=1)that[i]=255&array[i];return that}function fromJsonObject(that,object){var array,length=0;"Buffer"===object.type&&isArray(object.data)&&(array=object.data,length=0|checked(array.length)),that=allocate(that,length);for(var i=0;length>i;i+=1)that[i]=255&array[i];return that}function allocate(that,length){Buffer.TYPED_ARRAY_SUPPORT?that=Buffer._augment(new Uint8Array(length)):(that.length=length,that._isBuffer=!0);var fromPool=0!==length&&length<=Buffer.poolSize>>>1;return fromPool&&(that.parent=rootParent),that}function checked(length){if(length>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|length}function SlowBuffer(subject,encoding){if(!(this instanceof SlowBuffer))return new SlowBuffer(subject,encoding);var buf=new Buffer(subject,encoding);return delete buf.parent,buf}function byteLength(string,encoding){"string"!=typeof string&&(string=""+string);var len=string.length;if(0===len)return 0;for(var loweredCase=!1;;)switch(encoding){case"ascii":case"binary":case"raw":case"raws":return len;case"utf8":case"utf-8":return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*len;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase(),loweredCase=!0}}function slowToString(encoding,start,end){var loweredCase=!1;if(start=0|start,end=void 0===end||end===1/0?this.length:0|end,encoding||(encoding="utf8"),0>start&&(start=0),end>this.length&&(end=this.length),start>=end)return"";for(;;)switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"binary":return binarySlice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase(),loweredCase=!0}}function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;length?(length=Number(length),length>remaining&&(length=remaining)):length=remaining;var strLen=string.length;if(strLen%2!==0)throw new Error("Invalid hex string");length>strLen/2&&(length=strLen/2);for(var i=0;length>i;i++){var parsed=parseInt(string.substr(2*i,2),16);if(isNaN(parsed))throw new Error("Invalid hex string");buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function binaryWrite(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}function base64Slice(buf,start,end){return base64.fromByteArray(0===start&&end===buf.length?buf:buf.slice(start,end))}function utf8Slice(buf,start,end){var res="",tmp="";end=Math.min(buf.length,end);for(var i=start;end>i;i++)buf[i]<=127?(res+=decodeUtf8Char(tmp)+String.fromCharCode(buf[i]),tmp=""):tmp+="%"+buf[i].toString(16);return res+decodeUtf8Char(tmp)}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;end>i;i++)ret+=String.fromCharCode(127&buf[i]);return ret}function binarySlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;end>i;i++)ret+=String.fromCharCode(buf[i]);return ret}function hexSlice(buf,start,end){var len=buf.length;(!start||0>start)&&(start=0),(!end||0>end||end>len)&&(end=len);for(var out="",i=start;end>i;i++)out+=toHex(buf[i]);return out}function utf16leSlice(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}function checkOffset(offset,ext,length){if(offset%1!==0||0>offset)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError("buffer must be a Buffer instance");if(value>max||min>value)throw new RangeError("value is out of bounds");if(offset+ext>buf.length)throw new RangeError("index out of range")}function objectWriteUInt16(buf,value,offset,littleEndian){0>value&&(value=65535+value+1);for(var i=0,j=Math.min(buf.length-offset,2);j>i;i++)buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>8*(littleEndian?i:1-i)}function objectWriteUInt32(buf,value,offset,littleEndian){0>value&&(value=4294967295+value+1);for(var i=0,j=Math.min(buf.length-offset,4);j>i;i++)buf[offset+i]=value>>>8*(littleEndian?i:3-i)&255}function checkIEEE754(buf,value,offset,ext,max,min){if(value>max||min>value)throw new RangeError("value is out of bounds");if(offset+ext>buf.length)throw new RangeError("index out of range");if(0>offset)throw new RangeError("index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38),ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308),ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}function base64clean(str){if(str=stringtrim(str).replace(INVALID_BASE64_RE,""),str.length<2)return"";for(;str.length%4!==0;)str+="=";return str}function stringtrim(str){return str.trim?str.trim():str.replace(/^\s+|\s+$/g,"")}function toHex(n){return 16>n?"0"+n.toString(16):n.toString(16)}function utf8ToBytes(string,units){units=units||1/0;for(var codePoint,length=string.length,leadSurrogate=null,bytes=[],i=0;length>i;i++){if(codePoint=string.charCodeAt(i),codePoint>55295&&57344>codePoint){if(!leadSurrogate){if(codePoint>56319){(units-=3)>-1&&bytes.push(239,191,189);continue}if(i+1===length){(units-=3)>-1&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(56320>codePoint){(units-=3)>-1&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=leadSurrogate-55296<<10|codePoint-56320|65536,leadSurrogate=null}else leadSurrogate&&((units-=3)>-1&&bytes.push(239,191,189),leadSurrogate=null);if(128>codePoint){if((units-=1)<0)break;bytes.push(codePoint)}else if(2048>codePoint){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(65536>codePoint){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(2097152>codePoint))throw new Error("Invalid code point");if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function asciiToBytes(str){for(var byteArray=[],i=0;i<str.length;i++)byteArray.push(255&str.charCodeAt(i));return byteArray}function utf16leToBytes(str,units){for(var c,hi,lo,byteArray=[],i=0;i<str.length&&!((units-=2)<0);i++)c=str.charCodeAt(i),hi=c>>8,lo=c%256,byteArray.push(lo),byteArray.push(hi);return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;length>i&&!(i+offset>=dst.length||i>=src.length);i++)dst[i+offset]=src[i];return i}function decodeUtf8Char(str){try{return decodeURIComponent(str)}catch(err){return String.fromCharCode(65533)}}var base64=require("base64-js"),ieee754=require("ieee754"),isArray=require("is-array");exports.Buffer=Buffer,exports.SlowBuffer=SlowBuffer,exports.INSPECT_MAX_BYTES=50,Buffer.poolSize=8192;var rootParent={};Buffer.TYPED_ARRAY_SUPPORT=function(){function Foo(){}try{var buf=new ArrayBuffer(0),arr=new Uint8Array(buf);return arr.foo=function(){return 42},arr.constructor=Foo,42===arr.foo()&&arr.constructor===Foo&&"function"==typeof arr.subarray&&0===new Uint8Array(1).subarray(1,1).byteLength}catch(e){return!1}}(),Buffer.isBuffer=function(b){return!(null==b||!b._isBuffer)},Buffer.compare=function(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError("Arguments must be Buffers");if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);len>i&&a[i]===b[i];)++i;return i!==len&&(x=a[i],y=b[i]),y>x?-1:x>y?1:0},Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(list,length){if(!isArray(list))throw new TypeError("list argument must be an Array of Buffers.");if(0===list.length)return new Buffer(0);if(1===list.length)return list[0];var i;if(void 0===length)for(length=0,i=0;i<list.length;i++)length+=list[i].length;var buf=new Buffer(length),pos=0;for(i=0;i<list.length;i++){var item=list[i];item.copy(buf,pos),pos+=item.length}return buf},Buffer.byteLength=byteLength,Buffer.prototype.length=void 0,Buffer.prototype.parent=void 0,Buffer.prototype.toString=function(){var length=0|this.length;return 0===length?"":0===arguments.length?utf8Slice(this,0,length):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b?!0:0===Buffer.compare(this,b)},Buffer.prototype.inspect=function(){var str="",max=exports.INSPECT_MAX_BYTES;return this.length>0&&(str=this.toString("hex",0,max).match(/.{2}/g).join(" "),this.length>max&&(str+=" ... ")),"<Buffer "+str+">"},Buffer.prototype.compare=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b?0:Buffer.compare(this,b)},Buffer.prototype.indexOf=function(val,byteOffset){function arrayIndexOf(arr,val,byteOffset){for(var foundIndex=-1,i=0;byteOffset+i<arr.length;i++)if(arr[byteOffset+i]===val[-1===foundIndex?0:i-foundIndex]){if(-1===foundIndex&&(foundIndex=i),i-foundIndex+1===val.length)return byteOffset+foundIndex}else foundIndex=-1;return-1}if(byteOffset>2147483647?byteOffset=2147483647:-2147483648>byteOffset&&(byteOffset=-2147483648),byteOffset>>=0,0===this.length)return-1;if(byteOffset>=this.length)return-1;if(0>byteOffset&&(byteOffset=Math.max(this.length+byteOffset,0)),"string"==typeof val)return 0===val.length?-1:String.prototype.indexOf.call(this,val,byteOffset);if(Buffer.isBuffer(val))return arrayIndexOf(this,val,byteOffset);if("number"==typeof val)return Buffer.TYPED_ARRAY_SUPPORT&&"function"===Uint8Array.prototype.indexOf?Uint8Array.prototype.indexOf.call(this,val,byteOffset):arrayIndexOf(this,[val],byteOffset);throw new TypeError("val must be string, number or Buffer")},Buffer.prototype.get=function(offset){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(offset)},Buffer.prototype.set=function(v,offset){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(v,offset)},Buffer.prototype.write=function(string,offset,length,encoding){if(void 0===offset)encoding="utf8",length=this.length,offset=0;else if(void 0===length&&"string"==typeof offset)encoding=offset,length=this.length,offset=0;else if(isFinite(offset))offset=0|offset,isFinite(length)?(length=0|length,void 0===encoding&&(encoding="utf8")):(encoding=length,length=void 0);else{var swap=encoding;encoding=offset,offset=0|length,length=swap}var remaining=this.length-offset;if((void 0===length||length>remaining)&&(length=remaining),string.length>0&&(0>length||0>offset)||offset>this.length)throw new RangeError("attempt to write outside buffer bounds");encoding||(encoding="utf8");for(var loweredCase=!1;;)switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);

case"binary":return binaryWrite(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase(),loweredCase=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},Buffer.prototype.slice=function(start,end){var len=this.length;start=~~start,end=void 0===end?len:~~end,0>start?(start+=len,0>start&&(start=0)):start>len&&(start=len),0>end?(end+=len,0>end&&(end=0)):end>len&&(end=len),start>end&&(end=start);var newBuf;if(Buffer.TYPED_ARRAY_SUPPORT)newBuf=Buffer._augment(this.subarray(start,end));else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,void 0);for(var i=0;sliceLen>i;i++)newBuf[i]=this[i+start]}return newBuf.length&&(newBuf.parent=this.parent||this),newBuf},Buffer.prototype.readUIntLE=function(offset,byteLength,noAssert){offset=0|offset,byteLength=0|byteLength,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val},Buffer.prototype.readUIntBE=function(offset,byteLength,noAssert){offset=0|offset,byteLength=0|byteLength,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset+--byteLength],mul=1;byteLength>0&&(mul*=256);)val+=this[offset+--byteLength]*mul;return val},Buffer.prototype.readUInt8=function(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer.prototype.readUInt16LE=function(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer.prototype.readUInt16BE=function(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer.prototype.readUInt32LE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer.prototype.readUInt32BE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer.prototype.readIntLE=function(offset,byteLength,noAssert){offset=0|offset,byteLength=0|byteLength,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return mul*=128,val>=mul&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readIntBE=function(offset,byteLength,noAssert){offset=0|offset,byteLength=0|byteLength,noAssert||checkOffset(offset,byteLength,this.length);for(var i=byteLength,mul=1,val=this[offset+--i];i>0&&(mul*=256);)val+=this[offset+--i]*mul;return mul*=128,val>=mul&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readInt8=function(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),128&this[offset]?-1*(255-this[offset]+1):this[offset]},Buffer.prototype.readInt16LE=function(offset,noAssert){noAssert||checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt16BE=function(offset,noAssert){noAssert||checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt32LE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer.prototype.readInt32BE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer.prototype.readFloatLE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!0,23,4)},Buffer.prototype.readFloatBE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!1,23,4)},Buffer.prototype.readDoubleLE=function(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!0,52,8)},Buffer.prototype.readDoubleBE=function(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!1,52,8)},Buffer.prototype.writeUIntLE=function(value,offset,byteLength,noAssert){value=+value,offset=0|offset,byteLength=0|byteLength,noAssert||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength),0);var mul=1,i=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUIntBE=function(value,offset,byteLength,noAssert){value=+value,offset=0|offset,byteLength=0|byteLength,noAssert||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength),0);var i=byteLength-1,mul=1;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUInt8=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),this[offset]=value,offset+1},Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=value):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer.prototype.writeIntLE=function(value,offset,byteLength,noAssert){if(value=+value,offset=0|offset,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0,mul=1,sub=0>value?1:0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeIntBE=function(value,offset,byteLength,noAssert){if(value=+value,offset=0|offset,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1,mul=1,sub=0>value?1:0;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeInt8=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),0>value&&(value=255+value+1),this[offset]=value,offset+1},Buffer.prototype.writeInt16LE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer.prototype.writeInt16BE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer.prototype.writeInt32LE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer.prototype.writeInt32BE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),0>value&&(value=4294967295+value+1),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.copy=function(target,targetStart,start,end){if(start||(start=0),end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),targetStart||(targetStart=0),end>0&&start>end&&(end=start),end===start)return 0;if(0===target.length||0===this.length)return 0;if(0>targetStart)throw new RangeError("targetStart out of bounds");if(0>start||start>=this.length)throw new RangeError("sourceStart out of bounds");if(0>end)throw new RangeError("sourceEnd out of bounds");end>this.length&&(end=this.length),target.length-targetStart<end-start&&(end=target.length-targetStart+start);var len=end-start;if(1e3>len||!Buffer.TYPED_ARRAY_SUPPORT)for(var i=0;len>i;i++)target[i+targetStart]=this[i+start];else target._set(this.subarray(start,start+len),targetStart);return len},Buffer.prototype.fill=function(value,start,end){if(value||(value=0),start||(start=0),end||(end=this.length),start>end)throw new RangeError("end < start");if(end!==start&&0!==this.length){if(0>start||start>=this.length)throw new RangeError("start out of bounds");if(0>end||end>this.length)throw new RangeError("end out of bounds");var i;if("number"==typeof value)for(i=start;end>i;i++)this[i]=value;else{var bytes=utf8ToBytes(value.toString()),len=bytes.length;for(i=start;end>i;i++)this[i]=bytes[i%len]}return this}},Buffer.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(Buffer.TYPED_ARRAY_SUPPORT)return new Buffer(this).buffer;for(var buf=new Uint8Array(this.length),i=0,len=buf.length;len>i;i+=1)buf[i]=this[i];return buf.buffer}throw new TypeError("Buffer.toArrayBuffer not supported in this browser")};var BP=Buffer.prototype;Buffer._augment=function(arr){return arr.constructor=Buffer,arr._isBuffer=!0,arr._set=arr.set,arr.get=BP.get,arr.set=BP.set,arr.write=BP.write,arr.toString=BP.toString,arr.toLocaleString=BP.toString,arr.toJSON=BP.toJSON,arr.equals=BP.equals,arr.compare=BP.compare,arr.indexOf=BP.indexOf,arr.copy=BP.copy,arr.slice=BP.slice,arr.readUIntLE=BP.readUIntLE,arr.readUIntBE=BP.readUIntBE,arr.readUInt8=BP.readUInt8,arr.readUInt16LE=BP.readUInt16LE,arr.readUInt16BE=BP.readUInt16BE,arr.readUInt32LE=BP.readUInt32LE,arr.readUInt32BE=BP.readUInt32BE,arr.readIntLE=BP.readIntLE,arr.readIntBE=BP.readIntBE,arr.readInt8=BP.readInt8,arr.readInt16LE=BP.readInt16LE,arr.readInt16BE=BP.readInt16BE,arr.readInt32LE=BP.readInt32LE,arr.readInt32BE=BP.readInt32BE,arr.readFloatLE=BP.readFloatLE,arr.readFloatBE=BP.readFloatBE,arr.readDoubleLE=BP.readDoubleLE,arr.readDoubleBE=BP.readDoubleBE,arr.writeUInt8=BP.writeUInt8,arr.writeUIntLE=BP.writeUIntLE,arr.writeUIntBE=BP.writeUIntBE,arr.writeUInt16LE=BP.writeUInt16LE,arr.writeUInt16BE=BP.writeUInt16BE,arr.writeUInt32LE=BP.writeUInt32LE,arr.writeUInt32BE=BP.writeUInt32BE,arr.writeIntLE=BP.writeIntLE,arr.writeIntBE=BP.writeIntBE,arr.writeInt8=BP.writeInt8,arr.writeInt16LE=BP.writeInt16LE,arr.writeInt16BE=BP.writeInt16BE,arr.writeInt32LE=BP.writeInt32LE,arr.writeInt32BE=BP.writeInt32BE,arr.writeFloatLE=BP.writeFloatLE,arr.writeFloatBE=BP.writeFloatBE,arr.writeDoubleLE=BP.writeDoubleLE,arr.writeDoubleBE=BP.writeDoubleBE,arr.fill=BP.fill,arr.inspect=BP.inspect,arr.toArrayBuffer=BP.toArrayBuffer,arr};var INVALID_BASE64_RE=/[^+\/0-9A-z\-]/g},{"base64-js":16,ieee754:17,"is-array":18}],16:[function(require,module,exports){var lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(exports){"use strict";function decode(elt){var code=elt.charCodeAt(0);return code===PLUS||code===PLUS_URL_SAFE?62:code===SLASH||code===SLASH_URL_SAFE?63:NUMBER>code?-1:NUMBER+10>code?code-NUMBER+26+26:UPPER+26>code?code-UPPER:LOWER+26>code?code-LOWER+26:void 0}function b64ToByteArray(b64){function push(v){arr[L++]=v}var i,j,l,tmp,placeHolders,arr;if(b64.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var len=b64.length;placeHolders="="===b64.charAt(len-2)?2:"="===b64.charAt(len-1)?1:0,arr=new Arr(3*b64.length/4-placeHolders),l=placeHolders>0?b64.length-4:b64.length;var L=0;for(i=0,j=0;l>i;i+=4,j+=3)tmp=decode(b64.charAt(i))<<18|decode(b64.charAt(i+1))<<12|decode(b64.charAt(i+2))<<6|decode(b64.charAt(i+3)),push((16711680&tmp)>>16),push((65280&tmp)>>8),push(255&tmp);return 2===placeHolders?(tmp=decode(b64.charAt(i))<<2|decode(b64.charAt(i+1))>>4,push(255&tmp)):1===placeHolders&&(tmp=decode(b64.charAt(i))<<10|decode(b64.charAt(i+1))<<4|decode(b64.charAt(i+2))>>2,push(tmp>>8&255),push(255&tmp)),arr}function uint8ToBase64(uint8){function encode(num){return lookup.charAt(num)}function tripletToBase64(num){return encode(num>>18&63)+encode(num>>12&63)+encode(num>>6&63)+encode(63&num)}var i,temp,length,extraBytes=uint8.length%3,output="";for(i=0,length=uint8.length-extraBytes;length>i;i+=3)temp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2],output+=tripletToBase64(temp);switch(extraBytes){case 1:temp=uint8[uint8.length-1],output+=encode(temp>>2),output+=encode(temp<<4&63),output+="==";break;case 2:temp=(uint8[uint8.length-2]<<8)+uint8[uint8.length-1],output+=encode(temp>>10),output+=encode(temp>>4&63),output+=encode(temp<<2&63),output+="="}return output}var Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,PLUS="+".charCodeAt(0),SLASH="/".charCodeAt(0),NUMBER="0".charCodeAt(0),LOWER="a".charCodeAt(0),UPPER="A".charCodeAt(0),PLUS_URL_SAFE="-".charCodeAt(0),SLASH_URL_SAFE="_".charCodeAt(0);exports.toByteArray=b64ToByteArray,exports.fromByteArray=uint8ToBase64}("undefined"==typeof exports?this.base64js={}:exports)},{}],17:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?0/0:(s?-1:1)*(1/0);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=0>value||0===value&&0>1/value?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias),value*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}},{}],18:[function(require,module,exports){var isArray=Array.isArray,str=Object.prototype.toString;module.exports=isArray||function(val){return!!val&&"[object Array]"==str.call(val)}},{}],19:[function(require,module,exports){function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(arg){return"function"==typeof arg}function isNumber(arg){return"number"==typeof arg}function isObject(arg){return"object"==typeof arg&&null!==arg}function isUndefined(arg){return void 0===arg}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||0>n||isNaN(n))throw TypeError("n must be a positive number");return this._maxListeners=n,this},EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(this._events||(this._events={}),"error"===type&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(er=arguments[1],er instanceof Error)throw er;throw TypeError('Uncaught, unspecified "error" event.')}if(handler=this._events[type],isUndefined(handler))return!1;if(isFunction(handler))switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:for(len=arguments.length,args=new Array(len-1),i=1;len>i;i++)args[i-1]=arguments[i];handler.apply(this,args)}else if(isObject(handler)){for(len=arguments.length,args=new Array(len-1),i=1;len>i;i++)args[i-1]=arguments[i];for(listeners=handler.slice(),len=listeners.length,i=0;len>i;i++)listeners[i].apply(this,args)}return!0},EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener),this._events[type]?isObject(this._events[type])?this._events[type].push(listener):this._events[type]=[this._events[type],listener]:this._events[type]=listener,isObject(this._events[type])&&!this._events[type].warned){var m;m=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,m&&m>0&&this._events[type].length>m&&(this._events[type].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[type].length),"function"==typeof console.trace&&console.trace())}return this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(type,listener){function g(){this.removeListener(type,g),fired||(fired=!0,listener.apply(this,arguments))}if(!isFunction(listener))throw TypeError("listener must be a function");var fired=!1;return g.listener=listener,this.on(type,g),this},EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;if(list=this._events[type],length=list.length,position=-1,list===listener||isFunction(list.listener)&&list.listener===listener)delete this._events[type],this._events.removeListener&&this.emit("removeListener",type,listener);else if(isObject(list)){for(i=length;i-->0;)if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}if(0>position)return this;1===list.length?(list.length=0,delete this._events[type]):list.splice(position,1),this._events.removeListener&&this.emit("removeListener",type,listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[type]&&delete this._events[type],this;if(0===arguments.length){for(key in this._events)"removeListener"!==key&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events={},this}if(listeners=this._events[type],isFunction(listeners))this.removeListener(type,listeners);else for(;listeners.length;)this.removeListener(type,listeners[listeners.length-1]);return delete this._events[type],this},EventEmitter.prototype.listeners=function(type){var ret;return ret=this._events&&this._events[type]?isFunction(this._events[type])?[this._events[type]]:this._events[type].slice():[]},EventEmitter.listenerCount=function(emitter,type){var ret;return ret=emitter._events&&emitter._events[type]?isFunction(emitter._events[type])?1:emitter._events[type].length:0}},{}],20:[function(require,module,exports){module.exports="function"==typeof Object.create?function(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}:function(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}},{}],21:[function(require,module,exports){module.exports=Array.isArray||function(arr){return"[object Array]"==Object.prototype.toString.call(arr)}},{}],22:[function(require,module,exports){exports.endianness=function(){return"LE"},exports.hostname=function(){return"undefined"!=typeof location?location.hostname:""},exports.loadavg=function(){return[]},exports.uptime=function(){return 0},exports.freemem=function(){return Number.MAX_VALUE},exports.totalmem=function(){return Number.MAX_VALUE},exports.cpus=function(){return[]},exports.type=function(){return"Browser"},exports.release=function(){return"undefined"!=typeof navigator?navigator.appVersion:""},exports.networkInterfaces=exports.getNetworkInterfaces=function(){return{}},exports.arch=function(){return"javascript"},exports.platform=function(){return"browser"},exports.tmpdir=exports.tmpDir=function(){return"/tmp"},exports.EOL="\n"},{}],23:[function(require,module,exports){(function(process){function normalizeArray(parts,allowAboveRoot){for(var up=0,i=parts.length-1;i>=0;i--){var last=parts[i];"."===last?parts.splice(i,1):".."===last?(parts.splice(i,1),up++):up&&(parts.splice(i,1),up--)}if(allowAboveRoot)for(;up--;up)parts.unshift("..");return parts}function filter(xs,f){if(xs.filter)return xs.filter(f);for(var res=[],i=0;i<xs.length;i++)f(xs[i],i,xs)&&res.push(xs[i]);return res}var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,splitPath=function(filename){return splitPathRe.exec(filename).slice(1)};exports.resolve=function(){for(var resolvedPath="",resolvedAbsolute=!1,i=arguments.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();if("string"!=typeof path)throw new TypeError("Arguments to path.resolve must be strings");path&&(resolvedPath=path+"/"+resolvedPath,resolvedAbsolute="/"===path.charAt(0))}return resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/"),(resolvedAbsolute?"/":"")+resolvedPath||"."},exports.normalize=function(path){var isAbsolute=exports.isAbsolute(path),trailingSlash="/"===substr(path,-1);return path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/"),path||isAbsolute||(path="."),path&&trailingSlash&&(path+="/"),(isAbsolute?"/":"")+path},exports.isAbsolute=function(path){return"/"===path.charAt(0)},exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p,index){if("string"!=typeof p)throw new TypeError("Arguments to path.join must be strings");return p}).join("/"))},exports.relative=function(from,to){function trim(arr){for(var start=0;start<arr.length&&""===arr[start];start++);for(var end=arr.length-1;end>=0&&""===arr[end];end--);return start>end?[]:arr.slice(start,end-start+1)}from=exports.resolve(from).substr(1),to=exports.resolve(to).substr(1);for(var fromParts=trim(from.split("/")),toParts=trim(to.split("/")),length=Math.min(fromParts.length,toParts.length),samePartsLength=length,i=0;length>i;i++)if(fromParts[i]!==toParts[i]){samePartsLength=i;break}for(var outputParts=[],i=samePartsLength;i<fromParts.length;i++)outputParts.push("..");return outputParts=outputParts.concat(toParts.slice(samePartsLength)),outputParts.join("/")},exports.sep="/",exports.delimiter=":",exports.dirname=function(path){var result=splitPath(path),root=result[0],dir=result[1];return root||dir?(dir&&(dir=dir.substr(0,dir.length-1)),root+dir):"."},exports.basename=function(path,ext){var f=splitPath(path)[2];return ext&&f.substr(-1*ext.length)===ext&&(f=f.substr(0,f.length-ext.length)),f},exports.extname=function(path){return splitPath(path)[3]};var substr="b"==="ab".substr(-1)?function(str,start,len){return str.substr(start,len)}:function(str,start,len){return 0>start&&(start=str.length+start),str.substr(start,len)}}).call(this,require("_process"))},{_process:24}],24:[function(require,module,exports){function cleanUpNextTick(){draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue()}function drainQueue(){if(!draining){var timeout=setTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,clearTimeout(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}var currentQueue,process=module.exports={},queue=[],draining=!1,queueIndex=-1;process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||setTimeout(drainQueue,0)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],25:[function(require,module,exports){(function(global){!function(root){function error(type){throw RangeError(errors[type])}function map(array,fn){for(var length=array.length,result=[];length--;)result[length]=fn(array[length]);return result}function mapDomain(string,fn){var parts=string.split("@"),result="";parts.length>1&&(result=parts[0]+"@",string=parts[1]),string=string.replace(regexSeparators,".");var labels=string.split("."),encoded=map(labels,fn).join(".");return result+encoded}function ucs2decode(string){for(var value,extra,output=[],counter=0,length=string.length;length>counter;)value=string.charCodeAt(counter++),value>=55296&&56319>=value&&length>counter?(extra=string.charCodeAt(counter++),56320==(64512&extra)?output.push(((1023&value)<<10)+(1023&extra)+65536):(output.push(value),counter--)):output.push(value);return output}function ucs2encode(array){return map(array,function(value){var output="";return value>65535&&(value-=65536,output+=stringFromCharCode(value>>>10&1023|55296),value=56320|1023&value),output+=stringFromCharCode(value)}).join("")}function basicToDigit(codePoint){return 10>codePoint-48?codePoint-22:26>codePoint-65?codePoint-65:26>codePoint-97?codePoint-97:base}function digitToBasic(digit,flag){return digit+22+75*(26>digit)-((0!=flag)<<5)}function adapt(delta,numPoints,firstTime){var k=0;for(delta=firstTime?floor(delta/damp):delta>>1,delta+=floor(delta/numPoints);delta>baseMinusTMin*tMax>>1;k+=base)delta=floor(delta/baseMinusTMin);return floor(k+(baseMinusTMin+1)*delta/(delta+skew))}function decode(input){var out,basic,j,index,oldi,w,k,digit,t,baseMinusT,output=[],inputLength=input.length,i=0,n=initialN,bias=initialBias;for(basic=input.lastIndexOf(delimiter),0>basic&&(basic=0),j=0;basic>j;++j)input.charCodeAt(j)>=128&&error("not-basic"),output.push(input.charCodeAt(j));for(index=basic>0?basic+1:0;inputLength>index;){for(oldi=i,w=1,k=base;index>=inputLength&&error("invalid-input"),digit=basicToDigit(input.charCodeAt(index++)),(digit>=base||digit>floor((maxInt-i)/w))&&error("overflow"),i+=digit*w,t=bias>=k?tMin:k>=bias+tMax?tMax:k-bias,!(t>digit);k+=base)baseMinusT=base-t,w>floor(maxInt/baseMinusT)&&error("overflow"),w*=baseMinusT;out=output.length+1,bias=adapt(i-oldi,out,0==oldi),floor(i/out)>maxInt-n&&error("overflow"),n+=floor(i/out),i%=out,output.splice(i++,0,n)}return ucs2encode(output)}function encode(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,inputLength,handledCPCountPlusOne,baseMinusT,qMinusT,output=[];for(input=ucs2decode(input),inputLength=input.length,n=initialN,delta=0,bias=initialBias,j=0;inputLength>j;++j)currentValue=input[j],128>currentValue&&output.push(stringFromCharCode(currentValue));for(handledCPCount=basicLength=output.length,basicLength&&output.push(delimiter);inputLength>handledCPCount;){for(m=maxInt,j=0;inputLength>j;++j)currentValue=input[j],currentValue>=n&&m>currentValue&&(m=currentValue);for(handledCPCountPlusOne=handledCPCount+1,m-n>floor((maxInt-delta)/handledCPCountPlusOne)&&error("overflow"),delta+=(m-n)*handledCPCountPlusOne,n=m,j=0;inputLength>j;++j)if(currentValue=input[j],n>currentValue&&++delta>maxInt&&error("overflow"),currentValue==n){for(q=delta,k=base;t=bias>=k?tMin:k>=bias+tMax?tMax:k-bias,!(t>q);k+=base)qMinusT=q-t,baseMinusT=base-t,output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0))),q=floor(qMinusT/baseMinusT);output.push(stringFromCharCode(digitToBasic(q,0))),bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength),delta=0,++handledCPCount}++delta,++n}return output.join("")}function toUnicode(input){return mapDomain(input,function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string})}function toASCII(input){return mapDomain(input,function(string){return regexNonASCII.test(string)?"xn--"+encode(string):string})}var freeExports="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule="object"==typeof module&&module&&!module.nodeType&&module,freeGlobal="object"==typeof global&&global;(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal||freeGlobal.self===freeGlobal)&&(root=freeGlobal);var punycode,key,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode;if(punycode={version:"1.3.2",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode,encode:encode,toASCII:toASCII,toUnicode:toUnicode},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define("punycode",function(){return punycode});else if(freeExports&&freeModule)if(module.exports==freeExports)freeModule.exports=punycode;else for(key in punycode)punycode.hasOwnProperty(key)&&(freeExports[key]=punycode[key]);else root.punycode=punycode}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],26:[function(require,module,exports){"use strict";function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}module.exports=function(qs,sep,eq,options){sep=sep||"&",eq=eq||"=";var obj={};if("string"!=typeof qs||0===qs.length)return obj;var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;options&&"number"==typeof options.maxKeys&&(maxKeys=options.maxKeys);var len=qs.length;maxKeys>0&&len>maxKeys&&(len=maxKeys);for(var i=0;len>i;++i){var kstr,vstr,k,v,x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq);idx>=0?(kstr=x.substr(0,idx),
vstr=x.substr(idx+1)):(kstr=x,vstr=""),k=decodeURIComponent(kstr),v=decodeURIComponent(vstr),hasOwnProperty(obj,k)?isArray(obj[k])?obj[k].push(v):obj[k]=[obj[k],v]:obj[k]=v}return obj};var isArray=Array.isArray||function(xs){return"[object Array]"===Object.prototype.toString.call(xs)}},{}],27:[function(require,module,exports){"use strict";function map(xs,f){if(xs.map)return xs.map(f);for(var res=[],i=0;i<xs.length;i++)res.push(f(xs[i],i));return res}var stringifyPrimitive=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}};module.exports=function(obj,sep,eq,name){return sep=sep||"&",eq=eq||"=",null===obj&&(obj=void 0),"object"==typeof obj?map(objectKeys(obj),function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;return isArray(obj[k])?map(obj[k],function(v){return ks+encodeURIComponent(stringifyPrimitive(v))}).join(sep):ks+encodeURIComponent(stringifyPrimitive(obj[k]))}).join(sep):name?encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj)):""};var isArray=Array.isArray||function(xs){return"[object Array]"===Object.prototype.toString.call(xs)},objectKeys=Object.keys||function(obj){var res=[];for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&res.push(key);return res}},{}],28:[function(require,module,exports){"use strict";exports.decode=exports.parse=require("./decode"),exports.encode=exports.stringify=require("./encode")},{"./decode":26,"./encode":27}],29:[function(require,module,exports){module.exports=require("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":30}],30:[function(require,module,exports){"use strict";function Duplex(options){return this instanceof Duplex?(Readable.call(this,options),Writable.call(this,options),options&&options.readable===!1&&(this.readable=!1),options&&options.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,options&&options.allowHalfOpen===!1&&(this.allowHalfOpen=!1),void this.once("end",onend)):new Duplex(options)}function onend(){this.allowHalfOpen||this._writableState.ended||processNextTick(onEndNT,this)}function onEndNT(self){self.end()}var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)keys.push(key);return keys};module.exports=Duplex;var processNextTick=require("process-nextick-args"),util=require("core-util-is");util.inherits=require("inherits");var Readable=require("./_stream_readable"),Writable=require("./_stream_writable");util.inherits(Duplex,Readable);for(var keys=objectKeys(Writable.prototype),v=0;v<keys.length;v++){var method=keys[v];Duplex.prototype[method]||(Duplex.prototype[method]=Writable.prototype[method])}},{"./_stream_readable":32,"./_stream_writable":34,"core-util-is":35,inherits:20,"process-nextick-args":36}],31:[function(require,module,exports){"use strict";function PassThrough(options){return this instanceof PassThrough?void Transform.call(this,options):new PassThrough(options)}module.exports=PassThrough;var Transform=require("./_stream_transform"),util=require("core-util-is");util.inherits=require("inherits"),util.inherits(PassThrough,Transform),PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{"./_stream_transform":33,"core-util-is":35,inherits:20}],32:[function(require,module,exports){(function(process){"use strict";function ReadableState(options,stream){var Duplex=require("./_stream_duplex");options=options||{},this.objectMode=!!options.objectMode,stream instanceof Duplex&&(this.objectMode=this.objectMode||!!options.readableObjectMode);var hwm=options.highWaterMark,defaultHwm=this.objectMode?16:16384;this.highWaterMark=hwm||0===hwm?hwm:defaultHwm,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.defaultEncoding=options.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,options.encoding&&(StringDecoder||(StringDecoder=require("string_decoder/").StringDecoder),this.decoder=new StringDecoder(options.encoding),this.encoding=options.encoding)}function Readable(options){require("./_stream_duplex");return this instanceof Readable?(this._readableState=new ReadableState(options,this),this.readable=!0,options&&"function"==typeof options.read&&(this._read=options.read),void Stream.call(this)):new Readable(options)}function readableAddChunk(stream,state,chunk,encoding,addToFront){var er=chunkInvalid(state,chunk);if(er)stream.emit("error",er);else if(null===chunk)state.reading=!1,onEofChunk(stream,state);else if(state.objectMode||chunk&&chunk.length>0)if(state.ended&&!addToFront){var e=new Error("stream.push() after EOF");stream.emit("error",e)}else if(state.endEmitted&&addToFront){var e=new Error("stream.unshift() after end event");stream.emit("error",e)}else!state.decoder||addToFront||encoding||(chunk=state.decoder.write(chunk)),addToFront||(state.reading=!1),state.flowing&&0===state.length&&!state.sync?(stream.emit("data",chunk),stream.read(0)):(state.length+=state.objectMode?1:chunk.length,addToFront?state.buffer.unshift(chunk):state.buffer.push(chunk),state.needReadable&&emitReadable(stream)),maybeReadMore(stream,state);else addToFront||(state.reading=!1);return needMoreData(state)}function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||0===state.length)}function roundUpToNextPowerOf2(n){if(n>=MAX_HWM)n=MAX_HWM;else{n--;for(var p=1;32>p;p<<=1)n|=n>>p;n++}return n}function howMuchToRead(n,state){return 0===state.length&&state.ended?0:state.objectMode?0===n?0:1:null===n||isNaN(n)?state.flowing&&state.buffer.length?state.buffer[0].length:state.length:0>=n?0:(n>state.highWaterMark&&(state.highWaterMark=roundUpToNextPowerOf2(n)),n>state.length?state.ended?state.length:(state.needReadable=!0,0):n)}function chunkInvalid(state,chunk){var er=null;return Buffer.isBuffer(chunk)||"string"==typeof chunk||null===chunk||void 0===chunk||state.objectMode||(er=new TypeError("Invalid non-string/buffer chunk")),er}function onEofChunk(stream,state){if(!state.ended){if(state.decoder){var chunk=state.decoder.end();chunk&&chunk.length&&(state.buffer.push(chunk),state.length+=state.objectMode?1:chunk.length)}state.ended=!0,emitReadable(stream)}}function emitReadable(stream){var state=stream._readableState;state.needReadable=!1,state.emittedReadable||(debug("emitReadable",state.flowing),state.emittedReadable=!0,state.sync?processNextTick(emitReadable_,stream):emitReadable_(stream))}function emitReadable_(stream){debug("emit readable"),stream.emit("readable"),flow(stream)}function maybeReadMore(stream,state){state.readingMore||(state.readingMore=!0,processNextTick(maybeReadMore_,stream,state))}function maybeReadMore_(stream,state){for(var len=state.length;!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark&&(debug("maybeReadMore read 0"),stream.read(0),len!==state.length);)len=state.length;state.readingMore=!1}function pipeOnDrain(src){return function(){var state=src._readableState;debug("pipeOnDrain",state.awaitDrain),state.awaitDrain&&state.awaitDrain--,0===state.awaitDrain&&EE.listenerCount(src,"data")&&(state.flowing=!0,flow(src))}}function nReadingNextTick(self){debug("readable nexttick read 0"),self.read(0)}function resume(stream,state){state.resumeScheduled||(state.resumeScheduled=!0,processNextTick(resume_,stream,state))}function resume_(stream,state){state.reading||(debug("resume read 0"),stream.read(0)),state.resumeScheduled=!1,stream.emit("resume"),flow(stream),state.flowing&&!state.reading&&stream.read(0)}function flow(stream){var state=stream._readableState;if(debug("flow",state.flowing),state.flowing)do var chunk=stream.read();while(null!==chunk&&state.flowing)}function fromList(n,state){var ret,list=state.buffer,length=state.length,stringMode=!!state.decoder,objectMode=!!state.objectMode;if(0===list.length)return null;if(0===length)ret=null;else if(objectMode)ret=list.shift();else if(!n||n>=length)ret=stringMode?list.join(""):Buffer.concat(list,length),list.length=0;else if(n<list[0].length){var buf=list[0];ret=buf.slice(0,n),list[0]=buf.slice(n)}else if(n===list[0].length)ret=list.shift();else{ret=stringMode?"":new Buffer(n);for(var c=0,i=0,l=list.length;l>i&&n>c;i++){var buf=list[0],cpy=Math.min(n-c,buf.length);stringMode?ret+=buf.slice(0,cpy):buf.copy(ret,c,0,cpy),cpy<buf.length?list[0]=buf.slice(cpy):list.shift(),c+=cpy}}return ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error("endReadable called on non-empty stream");state.endEmitted||(state.ended=!0,processNextTick(endReadableNT,state,stream))}function endReadableNT(state,stream){state.endEmitted||0!==state.length||(state.endEmitted=!0,stream.readable=!1,stream.emit("end"))}function forEach(xs,f){for(var i=0,l=xs.length;l>i;i++)f(xs[i],i)}function indexOf(xs,x){for(var i=0,l=xs.length;l>i;i++)if(xs[i]===x)return i;return-1}module.exports=Readable;var processNextTick=require("process-nextick-args"),isArray=require("isarray"),Buffer=require("buffer").Buffer;Readable.ReadableState=ReadableState;var EE=require("events").EventEmitter;EE.listenerCount||(EE.listenerCount=function(emitter,type){return emitter.listeners(type).length});var Stream;!function(){try{Stream=require("stream")}catch(_){}finally{Stream||(Stream=require("events").EventEmitter)}}();var Buffer=require("buffer").Buffer,util=require("core-util-is");util.inherits=require("inherits");var debug=require("util");debug=debug&&debug.debuglog?debug.debuglog("stream"):function(){};var StringDecoder;util.inherits(Readable,Stream),Readable.prototype.push=function(chunk,encoding){var state=this._readableState;return state.objectMode||"string"!=typeof chunk||(encoding=encoding||state.defaultEncoding,encoding!==state.encoding&&(chunk=new Buffer(chunk,encoding),encoding="")),readableAddChunk(this,state,chunk,encoding,!1)},Readable.prototype.unshift=function(chunk){var state=this._readableState;return readableAddChunk(this,state,chunk,"",!0)},Readable.prototype.isPaused=function(){return this._readableState.flowing===!1},Readable.prototype.setEncoding=function(enc){return StringDecoder||(StringDecoder=require("string_decoder/").StringDecoder),this._readableState.decoder=new StringDecoder(enc),this._readableState.encoding=enc,this};var MAX_HWM=8388608;Readable.prototype.read=function(n){debug("read",n);var state=this._readableState,nOrig=n;if(("number"!=typeof n||n>0)&&(state.emittedReadable=!1),0===n&&state.needReadable&&(state.length>=state.highWaterMark||state.ended))return debug("read: emitReadable",state.length,state.ended),0===state.length&&state.ended?endReadable(this):emitReadable(this),null;if(n=howMuchToRead(n,state),0===n&&state.ended)return 0===state.length&&endReadable(this),null;var doRead=state.needReadable;debug("need readable",doRead),(0===state.length||state.length-n<state.highWaterMark)&&(doRead=!0,debug("length less than watermark",doRead)),(state.ended||state.reading)&&(doRead=!1,debug("reading or ended",doRead)),doRead&&(debug("do read"),state.reading=!0,state.sync=!0,0===state.length&&(state.needReadable=!0),this._read(state.highWaterMark),state.sync=!1),doRead&&!state.reading&&(n=howMuchToRead(nOrig,state));var ret;return ret=n>0?fromList(n,state):null,null===ret&&(state.needReadable=!0,n=0),state.length-=n,0!==state.length||state.ended||(state.needReadable=!0),nOrig!==n&&state.ended&&0===state.length&&endReadable(this),null!==ret&&this.emit("data",ret),ret},Readable.prototype._read=function(n){this.emit("error",new Error("not implemented"))},Readable.prototype.pipe=function(dest,pipeOpts){function onunpipe(readable){debug("onunpipe"),readable===src&&cleanup()}function onend(){debug("onend"),dest.end()}function cleanup(){debug("cleanup"),dest.removeListener("close",onclose),dest.removeListener("finish",onfinish),dest.removeListener("drain",ondrain),dest.removeListener("error",onerror),dest.removeListener("unpipe",onunpipe),src.removeListener("end",onend),src.removeListener("end",cleanup),src.removeListener("data",ondata),!state.awaitDrain||dest._writableState&&!dest._writableState.needDrain||ondrain()}function ondata(chunk){debug("ondata");var ret=dest.write(chunk);!1===ret&&(debug("false write response, pause",src._readableState.awaitDrain),src._readableState.awaitDrain++,src.pause())}function onerror(er){debug("onerror",er),unpipe(),dest.removeListener("error",onerror),0===EE.listenerCount(dest,"error")&&dest.emit("error",er)}function onclose(){dest.removeListener("finish",onfinish),unpipe()}function onfinish(){debug("onfinish"),dest.removeListener("close",onclose),unpipe()}function unpipe(){debug("unpipe"),src.unpipe(dest)}var src=this,state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest)}state.pipesCount+=1,debug("pipe count=%d opts=%j",state.pipesCount,pipeOpts);var doEnd=(!pipeOpts||pipeOpts.end!==!1)&&dest!==process.stdout&&dest!==process.stderr,endFn=doEnd?onend:cleanup;state.endEmitted?processNextTick(endFn):src.once("end",endFn),dest.on("unpipe",onunpipe);var ondrain=pipeOnDrain(src);return dest.on("drain",ondrain),src.on("data",ondata),dest._events&&dest._events.error?isArray(dest._events.error)?dest._events.error.unshift(onerror):dest._events.error=[onerror,dest._events.error]:dest.on("error",onerror),dest.once("close",onclose),dest.once("finish",onfinish),dest.emit("pipe",src),state.flowing||(debug("pipe resume"),src.resume()),dest},Readable.prototype.unpipe=function(dest){var state=this._readableState;if(0===state.pipesCount)return this;if(1===state.pipesCount)return dest&&dest!==state.pipes?this:(dest||(dest=state.pipes),state.pipes=null,state.pipesCount=0,state.flowing=!1,dest&&dest.emit("unpipe",this),this);if(!dest){var dests=state.pipes,len=state.pipesCount;state.pipes=null,state.pipesCount=0,state.flowing=!1;for(var i=0;len>i;i++)dests[i].emit("unpipe",this);return this}var i=indexOf(state.pipes,dest);return-1===i?this:(state.pipes.splice(i,1),state.pipesCount-=1,1===state.pipesCount&&(state.pipes=state.pipes[0]),dest.emit("unpipe",this),this)},Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if("data"===ev&&!1!==this._readableState.flowing&&this.resume(),"readable"===ev&&this.readable){var state=this._readableState;state.readableListening||(state.readableListening=!0,state.emittedReadable=!1,state.needReadable=!0,state.reading?state.length&&emitReadable(this,state):processNextTick(nReadingNextTick,this))}return res},Readable.prototype.addListener=Readable.prototype.on,Readable.prototype.resume=function(){var state=this._readableState;return state.flowing||(debug("resume"),state.flowing=!0,resume(this,state)),this},Readable.prototype.pause=function(){return debug("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(debug("pause"),this._readableState.flowing=!1,this.emit("pause")),this},Readable.prototype.wrap=function(stream){var state=this._readableState,paused=!1,self=this;stream.on("end",function(){if(debug("wrapped end"),state.decoder&&!state.ended){var chunk=state.decoder.end();chunk&&chunk.length&&self.push(chunk)}self.push(null)}),stream.on("data",function(chunk){if(debug("wrapped data"),state.decoder&&(chunk=state.decoder.write(chunk)),(!state.objectMode||null!==chunk&&void 0!==chunk)&&(state.objectMode||chunk&&chunk.length)){var ret=self.push(chunk);ret||(paused=!0,stream.pause())}});for(var i in stream)void 0===this[i]&&"function"==typeof stream[i]&&(this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i));var events=["error","close","destroy","pause","resume"];return forEach(events,function(ev){stream.on(ev,self.emit.bind(self,ev))}),self._read=function(n){debug("wrapped _read",n),paused&&(paused=!1,stream.resume())},self},Readable._fromList=fromList}).call(this,require("_process"))},{"./_stream_duplex":30,_process:24,buffer:15,"core-util-is":35,events:19,inherits:20,isarray:21,"process-nextick-args":36,"string_decoder/":52,util:14}],33:[function(require,module,exports){"use strict";function TransformState(stream){this.afterTransform=function(er,data){return afterTransform(stream,er,data)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}function afterTransform(stream,er,data){var ts=stream._transformState;ts.transforming=!1;var cb=ts.writecb;if(!cb)return stream.emit("error",new Error("no writecb in Transform class"));ts.writechunk=null,ts.writecb=null,null!==data&&void 0!==data&&stream.push(data),cb&&cb(er);var rs=stream._readableState;rs.reading=!1,(rs.needReadable||rs.length<rs.highWaterMark)&&stream._read(rs.highWaterMark)}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options),this._transformState=new TransformState(this);var stream=this;this._readableState.needReadable=!0,this._readableState.sync=!1,options&&("function"==typeof options.transform&&(this._transform=options.transform),"function"==typeof options.flush&&(this._flush=options.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(er){done(stream,er)}):done(stream)})}function done(stream,er){if(er)return stream.emit("error",er);var ws=stream._writableState,ts=stream._transformState;if(ws.length)throw new Error("calling transform done when ws.length != 0");if(ts.transforming)throw new Error("calling transform done when still transforming");return stream.push(null)}module.exports=Transform;var Duplex=require("./_stream_duplex"),util=require("core-util-is");util.inherits=require("inherits"),util.inherits(Transform,Duplex),Transform.prototype.push=function(chunk,encoding){return this._transformState.needTransform=!1,Duplex.prototype.push.call(this,chunk,encoding)},Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("not implemented")},Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;if(ts.writecb=cb,ts.writechunk=chunk,ts.writeencoding=encoding,!ts.transforming){var rs=this._readableState;(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)&&this._read(rs.highWaterMark)}},Transform.prototype._read=function(n){var ts=this._transformState;null!==ts.writechunk&&ts.writecb&&!ts.transforming?(ts.transforming=!0,this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)):ts.needTransform=!0}},{"./_stream_duplex":30,"core-util-is":35,inherits:20}],34:[function(require,module,exports){"use strict";function nop(){}function WriteReq(chunk,encoding,cb){this.chunk=chunk,this.encoding=encoding,this.callback=cb,this.next=null}function WritableState(options,stream){var Duplex=require("./_stream_duplex");options=options||{},this.objectMode=!!options.objectMode,stream instanceof Duplex&&(this.objectMode=this.objectMode||!!options.writableObjectMode);var hwm=options.highWaterMark,defaultHwm=this.objectMode?16:16384;this.highWaterMark=hwm||0===hwm?hwm:defaultHwm,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var noDecode=options.decodeStrings===!1;this.decodeStrings=!noDecode,this.defaultEncoding=options.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(er){onwrite(stream,er)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1}function Writable(options){var Duplex=require("./_stream_duplex");return this instanceof Writable||this instanceof Duplex?(this._writableState=new WritableState(options,this),this.writable=!0,options&&("function"==typeof options.write&&(this._write=options.write),"function"==typeof options.writev&&(this._writev=options.writev)),void Stream.call(this)):new Writable(options)}function writeAfterEnd(stream,cb){var er=new Error("write after end");stream.emit("error",er),processNextTick(cb,er)}function validChunk(stream,state,chunk,cb){var valid=!0;if(!Buffer.isBuffer(chunk)&&"string"!=typeof chunk&&null!==chunk&&void 0!==chunk&&!state.objectMode){var er=new TypeError("Invalid non-string/buffer chunk");stream.emit("error",er),processNextTick(cb,er),valid=!1}return valid}function decodeChunk(state,chunk,encoding){return state.objectMode||state.decodeStrings===!1||"string"!=typeof chunk||(chunk=new Buffer(chunk,encoding)),chunk}function writeOrBuffer(stream,state,chunk,encoding,cb){chunk=decodeChunk(state,chunk,encoding),Buffer.isBuffer(chunk)&&(encoding="buffer");var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;if(ret||(state.needDrain=!0),state.writing||state.corked){var last=state.lastBufferedRequest;state.lastBufferedRequest=new WriteReq(chunk,encoding,cb),last?last.next=state.lastBufferedRequest:state.bufferedRequest=state.lastBufferedRequest}else doWrite(stream,state,!1,len,chunk,encoding,cb);return ret}function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len,state.writecb=cb,state.writing=!0,state.sync=!0,writev?stream._writev(chunk,state.onwrite):stream._write(chunk,encoding,state.onwrite),state.sync=!1}function onwriteError(stream,state,sync,er,cb){--state.pendingcb,sync?processNextTick(cb,er):cb(er),stream._writableState.errorEmitted=!0,stream.emit("error",er)}function onwriteStateUpdate(state){state.writing=!1,state.writecb=null,state.length-=state.writelen,state.writelen=0}function onwrite(stream,er){var state=stream._writableState,sync=state.sync,cb=state.writecb;if(onwriteStateUpdate(state),er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(state);finished||state.corked||state.bufferProcessing||!state.bufferedRequest||clearBuffer(stream,state),sync?processNextTick(afterWrite,stream,state,finished,cb):afterWrite(stream,state,finished,cb)}}function afterWrite(stream,state,finished,cb){finished||onwriteDrain(stream,state),state.pendingcb--,cb(),finishMaybe(stream,state)}function onwriteDrain(stream,state){0===state.length&&state.needDrain&&(state.needDrain=!1,stream.emit("drain"))}function clearBuffer(stream,state){state.bufferProcessing=!0;var entry=state.bufferedRequest;if(stream._writev&&entry&&entry.next){for(var buffer=[],cbs=[];entry;)cbs.push(entry.callback),buffer.push(entry),entry=entry.next;state.pendingcb++,state.lastBufferedRequest=null,doWrite(stream,state,!0,state.length,buffer,"",function(err){for(var i=0;i<cbs.length;i++)state.pendingcb--,cbs[i](err)})}else{for(;entry;){var chunk=entry.chunk,encoding=entry.encoding,cb=entry.callback,len=state.objectMode?1:chunk.length;if(doWrite(stream,state,!1,len,chunk,encoding,cb),entry=entry.next,state.writing)break}null===entry&&(state.lastBufferedRequest=null)}state.bufferedRequest=entry,state.bufferProcessing=!1}function needFinish(state){return state.ending&&0===state.length&&null===state.bufferedRequest&&!state.finished&&!state.writing}function prefinish(stream,state){state.prefinished||(state.prefinished=!0,stream.emit("prefinish"))}function finishMaybe(stream,state){var need=needFinish(state);return need&&(0===state.pendingcb?(prefinish(stream,state),state.finished=!0,stream.emit("finish")):prefinish(stream,state)),need}function endWritable(stream,state,cb){state.ending=!0,finishMaybe(stream,state),cb&&(state.finished?processNextTick(cb):stream.once("finish",cb)),state.ended=!0}module.exports=Writable;var processNextTick=require("process-nextick-args"),Buffer=require("buffer").Buffer;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var Stream;!function(){try{Stream=require("stream")}catch(_){}finally{Stream||(Stream=require("events").EventEmitter)}}();var Buffer=require("buffer").Buffer;util.inherits(Writable,Stream),WritableState.prototype.getBuffer=function(){for(var current=this.bufferedRequest,out=[];current;)out.push(current),current=current.next;return out},function(){try{Object.defineProperty(WritableState.prototype,"buffer",{get:require("util-deprecate")(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer() instead.")})}catch(_){}}(),Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState,ret=!1;return"function"==typeof encoding&&(cb=encoding,encoding=null),Buffer.isBuffer(chunk)?encoding="buffer":encoding||(encoding=state.defaultEncoding),"function"!=typeof cb&&(cb=nop),state.ended?writeAfterEnd(this,cb):validChunk(this,state,chunk,cb)&&(state.pendingcb++,ret=writeOrBuffer(this,state,chunk,encoding,cb)),ret},Writable.prototype.cork=function(){var state=this._writableState;state.corked++},Writable.prototype.uncork=function(){var state=this._writableState;state.corked&&(state.corked--,state.writing||state.corked||state.finished||state.bufferProcessing||!state.bufferedRequest||clearBuffer(this,state))},Writable.prototype.setDefaultEncoding=function(encoding){if("string"==typeof encoding&&(encoding=encoding.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((encoding+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+encoding);this._writableState.defaultEncoding=encoding},Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("not implemented"))},Writable.prototype._writev=null,Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;"function"==typeof chunk?(cb=chunk,chunk=null,encoding=null):"function"==typeof encoding&&(cb=encoding,encoding=null),null!==chunk&&void 0!==chunk&&this.write(chunk,encoding),state.corked&&(state.corked=1,this.uncork()),state.ending||state.finished||endWritable(this,state,cb)}},{"./_stream_duplex":30,buffer:15,"core-util-is":35,events:19,inherits:20,"process-nextick-args":36,"util-deprecate":37}],35:[function(require,module,exports){(function(Buffer){function isArray(ar){return Array.isArray(ar)}function isBoolean(arg){return"boolean"==typeof arg}function isNull(arg){return null===arg}function isNullOrUndefined(arg){return null==arg}function isNumber(arg){return"number"==typeof arg}function isString(arg){return"string"==typeof arg}function isSymbol(arg){return"symbol"==typeof arg}function isUndefined(arg){return void 0===arg}function isRegExp(re){return isObject(re)&&"[object RegExp]"===objectToString(re)}function isObject(arg){return"object"==typeof arg&&null!==arg}function isDate(d){return isObject(d)&&"[object Date]"===objectToString(d)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(arg){return"function"==typeof arg}function isPrimitive(arg){return null===arg||"boolean"==typeof arg||"number"==typeof arg||"string"==typeof arg||"symbol"==typeof arg||"undefined"==typeof arg}function isBuffer(arg){return Buffer.isBuffer(arg)}function objectToString(o){return Object.prototype.toString.call(o)}exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=isBuffer}).call(this,require("buffer").Buffer)},{buffer:15}],36:[function(require,module,exports){(function(process){"use strict";function nextTick(fn){for(var args=new Array(arguments.length-1),i=0;i<arguments.length;)args[i++]=arguments[i];process.nextTick(function(){fn.apply(null,args)})}module.exports=nextTick}).call(this,require("_process"))},{_process:24}],37:[function(require,module,exports){(function(global){function deprecate(fn,msg){function deprecated(){if(!warned){if(config("throwDeprecation"))throw new Error(msg);config("traceDeprecation")?console.trace(msg):console.warn(msg),warned=!0}return fn.apply(this,arguments)}if(config("noDeprecation"))return fn;var warned=!1;return deprecated}function config(name){if(!global.localStorage)return!1;var val=global.localStorage[name];return null==val?!1:"true"===String(val).toLowerCase()}module.exports=deprecate}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],38:[function(require,module,exports){module.exports=require("./lib/_stream_passthrough.js")},{"./lib/_stream_passthrough.js":31}],39:[function(require,module,exports){var Stream=function(){try{return require("stream")}catch(_){}}();exports=module.exports=require("./lib/_stream_readable.js"),exports.Stream=Stream||exports,exports.Readable=exports,exports.Writable=require("./lib/_stream_writable.js"),exports.Duplex=require("./lib/_stream_duplex.js"),exports.Transform=require("./lib/_stream_transform.js"),exports.PassThrough=require("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":30,"./lib/_stream_passthrough.js":31,"./lib/_stream_readable.js":32,"./lib/_stream_transform.js":33,"./lib/_stream_writable.js":34}],40:[function(require,module,exports){module.exports=require("./lib/_stream_transform.js")},{"./lib/_stream_transform.js":33}],41:[function(require,module,exports){module.exports=require("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":34}],42:[function(require,module,exports){function Stream(){EE.call(this)}module.exports=Stream;var EE=require("events").EventEmitter,inherits=require("inherits");inherits(Stream,EE),Stream.Readable=require("readable-stream/readable.js"),Stream.Writable=require("readable-stream/writable.js"),Stream.Duplex=require("readable-stream/duplex.js"),Stream.Transform=require("readable-stream/transform.js"),Stream.PassThrough=require("readable-stream/passthrough.js"),Stream.Stream=Stream,Stream.prototype.pipe=function(dest,options){function ondata(chunk){dest.writable&&!1===dest.write(chunk)&&source.pause&&source.pause()}function ondrain(){source.readable&&source.resume&&source.resume()}function onend(){didOnEnd||(didOnEnd=!0,dest.end())}function onclose(){didOnEnd||(didOnEnd=!0,"function"==typeof dest.destroy&&dest.destroy())}function onerror(er){if(cleanup(),0===EE.listenerCount(this,"error"))throw er}function cleanup(){source.removeListener("data",ondata),dest.removeListener("drain",ondrain),source.removeListener("end",onend),source.removeListener("close",onclose),source.removeListener("error",onerror),dest.removeListener("error",onerror),source.removeListener("end",cleanup),source.removeListener("close",cleanup),dest.removeListener("close",cleanup)}var source=this;source.on("data",ondata),dest.on("drain",ondrain),dest._isStdio||options&&options.end===!1||(source.on("end",onend),source.on("close",onclose));var didOnEnd=!1;return source.on("error",onerror),dest.on("error",onerror),source.on("end",cleanup),source.on("close",cleanup),dest.on("close",cleanup),dest.emit("pipe",source),dest}},{events:19,inherits:20,"readable-stream/duplex.js":29,"readable-stream/passthrough.js":38,"readable-stream/readable.js":39,"readable-stream/transform.js":40,"readable-stream/writable.js":41}],43:[function(require,module,exports){var ClientRequest=require("./lib/request"),extend=require("xtend"),statusCodes=require("builtin-status-codes"),url=require("url"),http=exports;http.request=function(opts,cb){opts="string"==typeof opts?url.parse(opts):extend(opts);var hostHostname=opts.host?opts.host.split(":")[0]:null,hostPort=opts.host?parseInt(opts.host.split(":")[1],10):null;opts.method=opts.method||"GET",opts.headers=opts.headers||{},opts.path=opts.path||"/",opts.protocol=opts.protocol||window.location.protocol;var defaultPort=opts.hostname||hostHostname?"https:"===opts.protocol?443:80:window.location.port;
opts.hostname=opts.hostname||hostHostname||window.location.hostname,opts.port=opts.port||hostPort||defaultPort;var req=new ClientRequest(opts);return cb&&req.on("response",cb),req},http.get=function(opts,cb){var req=http.request(opts,cb);return req.end(),req},http.Agent=function(){},http.Agent.defaultMaxSockets=4,http.STATUS_CODES=statusCodes,http.METHODS=["GET","POST","PUT","DELETE"]},{"./lib/request":45,"builtin-status-codes":47,url:53,xtend:54}],44:[function(require,module,exports){function checkTypeSupport(type){try{return xhr.responseType=type,xhr.responseType===type}catch(e){}return!1}function isFunction(value){return"function"==typeof value}exports.fetch=isFunction(window.fetch)&&isFunction(window.ReadableByteStream),exports.blobConstructor=!1;try{new Blob([new ArrayBuffer(1)]),exports.blobConstructor=!0}catch(e){}var xhr=new window.XMLHttpRequest;xhr.open("GET","/");var haveArrayBuffer=isFunction(window.ArrayBuffer),haveSlice=haveArrayBuffer&&isFunction(window.ArrayBuffer.prototype.slice);exports.arraybuffer=haveArrayBuffer&&checkTypeSupport("arraybuffer"),exports.msstream=haveSlice&&checkTypeSupport("ms-stream"),exports.mozchunkedarraybuffer=haveArrayBuffer&&checkTypeSupport("moz-chunked-arraybuffer"),exports.overrideMimeType=isFunction(xhr.overrideMimeType),exports.vbArray=isFunction(window.VBArray),xhr=null},{}],45:[function(require,module,exports){(function(process,Buffer){function decideMode(preferBinary){return capability.fetch?"fetch":capability.mozchunkedarraybuffer?"moz-chunked-arraybuffer":capability.msstream?"ms-stream":capability.arraybuffer&&preferBinary?"arraybuffer":capability.vbArray&&preferBinary?"text:vbarray":"text"}function statusValid(xhr){try{return null!==xhr.status}catch(e){return!1}}var capability=require("./capability"),foreach=require("foreach"),indexOf=require("indexof"),inherits=require("inherits"),keys=require("object-keys"),response=require("./response"),stream=require("stream"),IncomingMessage=response.IncomingMessage,rStates=response.readyStates,ClientRequest=module.exports=function(opts){var self=this;stream.Writable.call(self),self._opts=opts,self._url=opts.protocol+"//"+opts.hostname+":"+opts.port+opts.path,self._body=[],self._headers={},opts.auth&&self.setHeader("Authorization","Basic "+new Buffer(opts.auth).toString("base64")),foreach(keys(opts.headers),function(name){self.setHeader(name,opts.headers[name])});var preferBinary;if("prefer-streaming"===opts.mode)preferBinary=!1;else if("prefer-fast"===opts.mode)preferBinary=!0;else{if(opts.mode&&"default"!==opts.mode)throw new Error("Invalid value for opts.mode");preferBinary=!capability.overrideMimeType}self._mode=decideMode(preferBinary),self.on("finish",function(){self._onFinish()})};inherits(ClientRequest,stream.Writable),ClientRequest.prototype.setHeader=function(name,value){var self=this,lowerName=name.toLowerCase();-1===indexOf(unsafeHeaders,lowerName)&&(self._headers[lowerName]={name:name,value:value})},ClientRequest.prototype.getHeader=function(name){var self=this;return self._headers[name.toLowerCase()].value},ClientRequest.prototype.removeHeader=function(name){var self=this;delete self._headers[name.toLowerCase()]},ClientRequest.prototype._onFinish=function(){var self=this;if(!self._destroyed){var body,opts=self._opts,headersObj=self._headers;if(("POST"===opts.method||"PUT"===opts.method)&&(body=capability.blobConstructor?new window.Blob(self._body.map(function(buffer){return buffer.toArrayBuffer()}),{type:(headersObj["content-type"]||{}).value||""}):Buffer.concat(self._body).toString()),"fetch"===self._mode){var headers=keys(headersObj).map(function(name){return[headersObj[name].name,headersObj[name].value]});window.fetch(self._url,{method:self._opts.method,headers:headers,body:body,mode:"cors",credentials:opts.withCredentials?"include":"same-origin"}).then(function(response){self._fetchResponse=response,self._connect()}).then(void 0,function(reason){self.emit("error",reason)})}else{var xhr=self._xhr=new window.XMLHttpRequest;try{xhr.open(self._opts.method,self._url,!0)}catch(err){return void process.nextTick(function(){self.emit("error",err)})}"responseType"in xhr&&(xhr.responseType=self._mode.split(":")[0]),"withCredentials"in xhr&&(xhr.withCredentials=!!opts.withCredentials),"text"===self._mode&&"overrideMimeType"in xhr&&xhr.overrideMimeType("text/plain; charset=x-user-defined"),foreach(keys(headersObj),function(name){xhr.setRequestHeader(headersObj[name].name,headersObj[name].value)}),self._response=null,xhr.onreadystatechange=function(){switch(xhr.readyState){case rStates.LOADING:case rStates.DONE:self._onXHRProgress()}},"moz-chunked-arraybuffer"===self._mode&&(xhr.onprogress=function(){self._onXHRProgress()}),xhr.onerror=function(){self._destroyed||self.emit("error",new Error("XHR error"))};try{xhr.send(body)}catch(err){return void process.nextTick(function(){self.emit("error",err)})}}}},ClientRequest.prototype._onXHRProgress=function(){var self=this;statusValid(self._xhr)&&!self._destroyed&&(self._response||self._connect(),self._response._onXHRProgress())},ClientRequest.prototype._connect=function(){var self=this;self._destroyed||(self._response=new IncomingMessage(self._xhr,self._fetchResponse,self._mode),self.emit("response",self._response))},ClientRequest.prototype._write=function(chunk,encoding,cb){var self=this;self._body.push(chunk),cb()},ClientRequest.prototype.abort=ClientRequest.prototype.destroy=function(){var self=this;self._destroyed=!0,self._response&&(self._response._destroyed=!0),self._xhr&&self._xhr.abort()},ClientRequest.prototype.end=function(data,encoding,cb){var self=this;"function"==typeof data&&(cb=data,data=void 0),data&&stream.Writable.push.call(self,data,encoding),stream.Writable.prototype.end.call(self,cb)},ClientRequest.prototype.flushHeaders=function(){},ClientRequest.prototype.setTimeout=function(){},ClientRequest.prototype.setNoDelay=function(){},ClientRequest.prototype.setSocketKeepAlive=function(){};var unsafeHeaders=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","date","dnt","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"]}).call(this,require("_process"),require("buffer").Buffer)},{"./capability":44,"./response":46,_process:24,buffer:15,foreach:48,indexof:49,inherits:20,"object-keys":50,stream:42}],46:[function(require,module,exports){(function(process,Buffer){var capability=require("./capability"),foreach=require("foreach"),inherits=require("inherits"),stream=require("stream"),rStates=exports.readyStates={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4},IncomingMessage=exports.IncomingMessage=function(xhr,response,mode){function read(){reader.read().then(function(result){if(!self._destroyed){if(result.done)return void self.push(null);self.push(new Buffer(result.value)),read()}})}var self=this;if(stream.Readable.call(self),self._mode=mode,self.headers={},self.rawHeaders=[],self.trailers={},self.rawTrailers=[],self.on("end",function(){process.nextTick(function(){self.emit("close")})}),"fetch"===mode){self._fetchResponse=response,self.statusCode=response.status,self.statusMessage=response.statusText;for(var header,_i,_it=response.headers[Symbol.iterator]();header=(_i=_it.next()).value,!_i.done;)self.headers[header[0].toLowerCase()]=header[1],self.rawHeaders.push(header[0],header[1]);var reader=response.body.getReader();read()}else{self._xhr=xhr,self._pos=0,self.statusCode=xhr.status,self.statusMessage=xhr.statusText;var headers=xhr.getAllResponseHeaders().split(/\r?\n/);if(foreach(headers,function(header){var matches=header.match(/^([^:]+):\s*(.*)/);if(matches){var key=matches[1].toLowerCase();void 0!==self.headers[key]?self.headers[key]+=", "+matches[2]:self.headers[key]=matches[2],self.rawHeaders.push(matches[1],matches[2])}}),self._charset="x-user-defined",!capability.overrideMimeType){var mimeType=self.rawHeaders["mime-type"];if(mimeType){var charsetMatch=mimeType.match(/;\s*charset=([^;])(;|$)/);charsetMatch&&(self._charset=charsetMatch[1].toLowerCase())}self._charset||(self._charset="utf-8")}}};inherits(IncomingMessage,stream.Readable),IncomingMessage.prototype._read=function(){},IncomingMessage.prototype._onXHRProgress=function(){var self=this,xhr=self._xhr,response=null;switch(self._mode){case"text:vbarray":if(xhr.readyState!==rStates.DONE)break;try{response=new window.VBArray(xhr.responseBody).toArray()}catch(e){}if(null!==response){self.push(new Buffer(response));break}case"text":try{response=xhr.responseText}catch(e){self._mode="text:vbarray";break}if(response.length>self._pos){var newData=response.substr(self._pos);if("x-user-defined"===self._charset){for(var buffer=new Buffer(newData.length),i=0;i<newData.length;i++)buffer[i]=255&newData.charCodeAt(i);self.push(buffer)}else self.push(newData,self._charset);self._pos=response.length}break;case"arraybuffer":if(xhr.readyState!==rStates.DONE)break;response=xhr.response,self.push(new Buffer(new Uint8Array(response)));break;case"moz-chunked-arraybuffer":if(response=xhr.response,xhr.readyState!==rStates.LOADING||!response)break;self.push(new Buffer(new Uint8Array(response)));break;case"ms-stream":if(response=xhr.response,xhr.readyState!==rStates.LOADING)break;var reader=new window.MSStreamReader;reader.onprogress=function(){reader.result.byteLength>self._pos&&(self.push(new Buffer(new Uint8Array(reader.result.slice(self._pos)))),self._pos=reader.result.byteLength)},reader.onload=function(){self.push(null)},reader.readAsArrayBuffer(response)}self._xhr.readyState===rStates.DONE&&"ms-stream"!==self._mode&&self.push(null)}}).call(this,require("_process"),require("buffer").Buffer)},{"./capability":44,_process:24,buffer:15,foreach:48,inherits:20,stream:42}],47:[function(require,module,exports){module.exports={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Time-out",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Large",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Time-out",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"}},{}],48:[function(require,module,exports){var hasOwn=Object.prototype.hasOwnProperty,toString=Object.prototype.toString;module.exports=function(obj,fn,ctx){if("[object Function]"!==toString.call(fn))throw new TypeError("iterator must be a function");var l=obj.length;if(l===+l)for(var i=0;l>i;i++)fn.call(ctx,obj[i],i,obj);else for(var k in obj)hasOwn.call(obj,k)&&fn.call(ctx,obj[k],k,obj)}},{}],49:[function(require,module,exports){var indexOf=[].indexOf;module.exports=function(arr,obj){if(indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i)if(arr[i]===obj)return i;return-1}},{}],50:[function(require,module,exports){"use strict";var has=Object.prototype.hasOwnProperty,toStr=Object.prototype.toString,slice=Array.prototype.slice,isArgs=require("./isArguments"),hasDontEnumBug=!{toString:null}.propertyIsEnumerable("toString"),hasProtoEnumBug=function(){}.propertyIsEnumerable("prototype"),dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],keysShim=function(object){var isObject=null!==object&&"object"==typeof object,isFunction="[object Function]"===toStr.call(object),isArguments=isArgs(object),isString=isObject&&"[object String]"===toStr.call(object),theKeys=[];if(!isObject&&!isFunction&&!isArguments)throw new TypeError("Object.keys called on a non-object");var skipProto=hasProtoEnumBug&&isFunction;if(isString&&object.length>0&&!has.call(object,0))for(var i=0;i<object.length;++i)theKeys.push(String(i));if(isArguments&&object.length>0)for(var j=0;j<object.length;++j)theKeys.push(String(j));else for(var name in object)skipProto&&"prototype"===name||!has.call(object,name)||theKeys.push(String(name));if(hasDontEnumBug)for(var ctor=object.constructor,skipConstructor=ctor&&ctor.prototype===object,k=0;k<dontEnums.length;++k)skipConstructor&&"constructor"===dontEnums[k]||!has.call(object,dontEnums[k])||theKeys.push(dontEnums[k]);return theKeys};keysShim.shim=function(){if(Object.keys){var keysWorksWithArguments=function(){return 2===(Object.keys(arguments)||"").length}(1,2);if(!keysWorksWithArguments){var originalKeys=Object.keys;Object.keys=function(object){return originalKeys(isArgs(object)?slice.call(object):object)}}}else Object.keys=keysShim;return Object.keys||keysShim},module.exports=keysShim},{"./isArguments":51}],51:[function(require,module,exports){"use strict";var toStr=Object.prototype.toString;module.exports=function(value){var str=toStr.call(value),isArgs="[object Arguments]"===str;return isArgs||(isArgs="[object Array]"!==str&&null!==value&&"object"==typeof value&&"number"==typeof value.length&&value.length>=0&&"[object Function]"===toStr.call(value.callee)),isArgs}},{}],52:[function(require,module,exports){function assertEncoding(encoding){if(encoding&&!isBufferEncoding(encoding))throw new Error("Unknown encoding: "+encoding)}function passThroughWrite(buffer){return buffer.toString(this.encoding)}function utf16DetectIncompleteChar(buffer){this.charReceived=buffer.length%2,this.charLength=this.charReceived?2:0}function base64DetectIncompleteChar(buffer){this.charReceived=buffer.length%3,this.charLength=this.charReceived?3:0}var Buffer=require("buffer").Buffer,isBufferEncoding=Buffer.isEncoding||function(encoding){switch(encoding&&encoding.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},StringDecoder=exports.StringDecoder=function(encoding){switch(this.encoding=(encoding||"utf8").toLowerCase().replace(/[-_]/,""),assertEncoding(encoding),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=utf16DetectIncompleteChar;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=base64DetectIncompleteChar;break;default:return void(this.write=passThroughWrite)}this.charBuffer=new Buffer(6),this.charReceived=0,this.charLength=0};StringDecoder.prototype.write=function(buffer){for(var charStr="";this.charLength;){var available=buffer.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:buffer.length;if(buffer.copy(this.charBuffer,this.charReceived,0,available),this.charReceived+=available,this.charReceived<this.charLength)return"";buffer=buffer.slice(available,buffer.length),charStr=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var charCode=charStr.charCodeAt(charStr.length-1);if(!(charCode>=55296&&56319>=charCode)){if(this.charReceived=this.charLength=0,0===buffer.length)return charStr;break}this.charLength+=this.surrogateSize,charStr=""}this.detectIncompleteChar(buffer);var end=buffer.length;this.charLength&&(buffer.copy(this.charBuffer,0,buffer.length-this.charReceived,end),end-=this.charReceived),charStr+=buffer.toString(this.encoding,0,end);var end=charStr.length-1,charCode=charStr.charCodeAt(end);if(charCode>=55296&&56319>=charCode){var size=this.surrogateSize;return this.charLength+=size,this.charReceived+=size,this.charBuffer.copy(this.charBuffer,size,0,size),buffer.copy(this.charBuffer,0,0,size),charStr.substring(0,end)}return charStr},StringDecoder.prototype.detectIncompleteChar=function(buffer){for(var i=buffer.length>=3?3:buffer.length;i>0;i--){var c=buffer[buffer.length-i];if(1==i&&c>>5==6){this.charLength=2;break}if(2>=i&&c>>4==14){this.charLength=3;break}if(3>=i&&c>>3==30){this.charLength=4;break}}this.charReceived=i},StringDecoder.prototype.end=function(buffer){var res="";if(buffer&&buffer.length&&(res=this.write(buffer)),this.charReceived){var cr=this.charReceived,buf=this.charBuffer,enc=this.encoding;res+=buf.slice(0,cr).toString(enc)}return res}},{buffer:15}],53:[function(require,module,exports){function Url(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function urlParse(url,parseQueryString,slashesDenoteHost){if(url&&isObject(url)&&url instanceof Url)return url;var u=new Url;return u.parse(url,parseQueryString,slashesDenoteHost),u}function urlFormat(obj){return isString(obj)&&(obj=urlParse(obj)),obj instanceof Url?obj.format():Url.prototype.format.call(obj)}function urlResolve(source,relative){return urlParse(source,!1,!0).resolve(relative)}function urlResolveObject(source,relative){return source?urlParse(source,!1,!0).resolveObject(relative):relative}function isString(arg){return"string"==typeof arg}function isObject(arg){return"object"==typeof arg&&null!==arg}function isNull(arg){return null===arg}function isNullOrUndefined(arg){return null==arg}var punycode=require("punycode");exports.parse=urlParse,exports.resolve=urlResolve,exports.resolveObject=urlResolveObject,exports.format=urlFormat,exports.Url=Url;var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,delims=["<",">",'"',"`"," ","\r","\n","	"],unwise=["{","}","|","\\","^","`"].concat(delims),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnameMaxLen=255,hostnamePartPattern=/^[a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:!0,"javascript:":!0},hostlessProtocol={javascript:!0,"javascript:":!0},slashedProtocol={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},querystring=require("querystring");Url.prototype.parse=function(url,parseQueryString,slashesDenoteHost){if(!isString(url))throw new TypeError("Parameter 'url' must be a string, not "+typeof url);var rest=url;rest=rest.trim();var proto=protocolPattern.exec(rest);if(proto){proto=proto[0];var lowerProto=proto.toLowerCase();this.protocol=lowerProto,rest=rest.substr(proto.length)}if(slashesDenoteHost||proto||rest.match(/^\/\/[^@\/]+@[^@\/]+/)){var slashes="//"===rest.substr(0,2);!slashes||proto&&hostlessProtocol[proto]||(rest=rest.substr(2),this.slashes=!0)}if(!hostlessProtocol[proto]&&(slashes||proto&&!slashedProtocol[proto])){for(var hostEnd=-1,i=0;i<hostEndingChars.length;i++){var hec=rest.indexOf(hostEndingChars[i]);-1!==hec&&(-1===hostEnd||hostEnd>hec)&&(hostEnd=hec)}var auth,atSign;atSign=-1===hostEnd?rest.lastIndexOf("@"):rest.lastIndexOf("@",hostEnd),-1!==atSign&&(auth=rest.slice(0,atSign),rest=rest.slice(atSign+1),this.auth=decodeURIComponent(auth)),hostEnd=-1;for(var i=0;i<nonHostChars.length;i++){var hec=rest.indexOf(nonHostChars[i]);-1!==hec&&(-1===hostEnd||hostEnd>hec)&&(hostEnd=hec)}-1===hostEnd&&(hostEnd=rest.length),this.host=rest.slice(0,hostEnd),rest=rest.slice(hostEnd),this.parseHost(),this.hostname=this.hostname||"";var ipv6Hostname="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!ipv6Hostname)for(var hostparts=this.hostname.split(/\./),i=0,l=hostparts.length;l>i;i++){var part=hostparts[i];if(part&&!part.match(hostnamePartPattern)){for(var newpart="",j=0,k=part.length;k>j;j++)newpart+=part.charCodeAt(j)>127?"x":part[j];if(!newpart.match(hostnamePartPattern)){var validParts=hostparts.slice(0,i),notHost=hostparts.slice(i+1),bit=part.match(hostnamePartStart);bit&&(validParts.push(bit[1]),notHost.unshift(bit[2])),notHost.length&&(rest="/"+notHost.join(".")+rest),this.hostname=validParts.join(".");break}}}if(this.hostname=this.hostname.length>hostnameMaxLen?"":this.hostname.toLowerCase(),!ipv6Hostname){for(var domainArray=this.hostname.split("."),newOut=[],i=0;i<domainArray.length;++i){var s=domainArray[i];newOut.push(s.match(/[^A-Za-z0-9_-]/)?"xn--"+punycode.encode(s):s)}this.hostname=newOut.join(".")}var p=this.port?":"+this.port:"",h=this.hostname||"";this.host=h+p,this.href+=this.host,ipv6Hostname&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==rest[0]&&(rest="/"+rest))}if(!unsafeProtocol[lowerProto])for(var i=0,l=autoEscape.length;l>i;i++){var ae=autoEscape[i],esc=encodeURIComponent(ae);esc===ae&&(esc=escape(ae)),rest=rest.split(ae).join(esc)}var hash=rest.indexOf("#");-1!==hash&&(this.hash=rest.substr(hash),rest=rest.slice(0,hash));var qm=rest.indexOf("?");if(-1!==qm?(this.search=rest.substr(qm),this.query=rest.substr(qm+1),parseQueryString&&(this.query=querystring.parse(this.query)),rest=rest.slice(0,qm)):parseQueryString&&(this.search="",this.query={}),rest&&(this.pathname=rest),slashedProtocol[lowerProto]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var p=this.pathname||"",s=this.search||"";this.path=p+s}return this.href=this.format(),this},Url.prototype.format=function(){var auth=this.auth||"";auth&&(auth=encodeURIComponent(auth),auth=auth.replace(/%3A/i,":"),auth+="@");var protocol=this.protocol||"",pathname=this.pathname||"",hash=this.hash||"",host=!1,query="";this.host?host=auth+this.host:this.hostname&&(host=auth+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(host+=":"+this.port)),this.query&&isObject(this.query)&&Object.keys(this.query).length&&(query=querystring.stringify(this.query));var search=this.search||query&&"?"+query||"";return protocol&&":"!==protocol.substr(-1)&&(protocol+=":"),this.slashes||(!protocol||slashedProtocol[protocol])&&host!==!1?(host="//"+(host||""),pathname&&"/"!==pathname.charAt(0)&&(pathname="/"+pathname)):host||(host=""),hash&&"#"!==hash.charAt(0)&&(hash="#"+hash),search&&"?"!==search.charAt(0)&&(search="?"+search),pathname=pathname.replace(/[?#]/g,function(match){return encodeURIComponent(match)}),search=search.replace("#","%23"),protocol+host+pathname+search+hash},Url.prototype.resolve=function(relative){return this.resolveObject(urlParse(relative,!1,!0)).format()},Url.prototype.resolveObject=function(relative){if(isString(relative)){var rel=new Url;rel.parse(relative,!1,!0),relative=rel}var result=new Url;if(Object.keys(this).forEach(function(k){result[k]=this[k]},this),result.hash=relative.hash,""===relative.href)return result.href=result.format(),result;if(relative.slashes&&!relative.protocol)return Object.keys(relative).forEach(function(k){"protocol"!==k&&(result[k]=relative[k])}),slashedProtocol[result.protocol]&&result.hostname&&!result.pathname&&(result.path=result.pathname="/"),result.href=result.format(),result;if(relative.protocol&&relative.protocol!==result.protocol){if(!slashedProtocol[relative.protocol])return Object.keys(relative).forEach(function(k){result[k]=relative[k]}),result.href=result.format(),result;if(result.protocol=relative.protocol,relative.host||hostlessProtocol[relative.protocol])result.pathname=relative.pathname;else{for(var relPath=(relative.pathname||"").split("/");relPath.length&&!(relative.host=relPath.shift()););relative.host||(relative.host=""),relative.hostname||(relative.hostname=""),""!==relPath[0]&&relPath.unshift(""),relPath.length<2&&relPath.unshift(""),result.pathname=relPath.join("/")}if(result.search=relative.search,result.query=relative.query,result.host=relative.host||"",result.auth=relative.auth,result.hostname=relative.hostname||relative.host,result.port=relative.port,result.pathname||result.search){var p=result.pathname||"",s=result.search||"";result.path=p+s}return result.slashes=result.slashes||relative.slashes,result.href=result.format(),result}var isSourceAbs=result.pathname&&"/"===result.pathname.charAt(0),isRelAbs=relative.host||relative.pathname&&"/"===relative.pathname.charAt(0),mustEndAbs=isRelAbs||isSourceAbs||result.host&&relative.pathname,removeAllDots=mustEndAbs,srcPath=result.pathname&&result.pathname.split("/")||[],relPath=relative.pathname&&relative.pathname.split("/")||[],psychotic=result.protocol&&!slashedProtocol[result.protocol];if(psychotic&&(result.hostname="",result.port=null,result.host&&(""===srcPath[0]?srcPath[0]=result.host:srcPath.unshift(result.host)),result.host="",relative.protocol&&(relative.hostname=null,relative.port=null,relative.host&&(""===relPath[0]?relPath[0]=relative.host:relPath.unshift(relative.host)),relative.host=null),mustEndAbs=mustEndAbs&&(""===relPath[0]||""===srcPath[0])),isRelAbs)result.host=relative.host||""===relative.host?relative.host:result.host,result.hostname=relative.hostname||""===relative.hostname?relative.hostname:result.hostname,result.search=relative.search,result.query=relative.query,srcPath=relPath;else if(relPath.length)srcPath||(srcPath=[]),srcPath.pop(),srcPath=srcPath.concat(relPath),result.search=relative.search,result.query=relative.query;else if(!isNullOrUndefined(relative.search)){if(psychotic){result.hostname=result.host=srcPath.shift();var authInHost=result.host&&result.host.indexOf("@")>0?result.host.split("@"):!1;authInHost&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift())}return result.search=relative.search,result.query=relative.query,isNull(result.pathname)&&isNull(result.search)||(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.href=result.format(),result}if(!srcPath.length)return result.pathname=null,result.path=result.search?"/"+result.search:null,result.href=result.format(),result;for(var last=srcPath.slice(-1)[0],hasTrailingSlash=(result.host||relative.host)&&("."===last||".."===last)||""===last,up=0,i=srcPath.length;i>=0;i--)last=srcPath[i],"."==last?srcPath.splice(i,1):".."===last?(srcPath.splice(i,1),up++):up&&(srcPath.splice(i,1),up--);if(!mustEndAbs&&!removeAllDots)for(;up--;up)srcPath.unshift("..");!mustEndAbs||""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0)||srcPath.unshift(""),hasTrailingSlash&&"/"!==srcPath.join("/").substr(-1)&&srcPath.push("");var isAbsolute=""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0);if(psychotic){result.hostname=result.host=isAbsolute?"":srcPath.length?srcPath.shift():"";var authInHost=result.host&&result.host.indexOf("@")>0?result.host.split("@"):!1;authInHost&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift())}return mustEndAbs=mustEndAbs||result.host&&srcPath.length,mustEndAbs&&!isAbsolute&&srcPath.unshift(""),srcPath.length?result.pathname=srcPath.join("/"):(result.pathname=null,result.path=null),isNull(result.pathname)&&isNull(result.search)||(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.auth=relative.auth||result.auth,result.slashes=result.slashes||relative.slashes,result.href=result.format(),result},Url.prototype.parseHost=function(){var host=this.host,port=portPattern.exec(host);port&&(port=port[0],":"!==port&&(this.port=port.substr(1)),host=host.substr(0,host.length-port.length)),host&&(this.hostname=host)}},{punycode:25,querystring:28}],54:[function(require,module,exports){function extend(){for(var target={},i=0;i<arguments.length;i++){var source=arguments[i];for(var key in source)source.hasOwnProperty(key)&&(target[key]=source[key])}return target}module.exports=extend},{}],55:[function(require,module,exports){(function(process,__dirname){var cytoscape;!function(window){"use strict";var $$=cytoscape=function(){return cytoscape.init.apply(cytoscape,arguments)};$$.version="2.4.5",$$.init=function(options){return void 0===options&&(options={}),$$.is.plainObject(options)?new $$.Core(options):$$.is.string(options)?$$.extension.apply($$.extension,arguments):void 0},$$.fn={},"undefined"!=typeof module&&module.exports&&(module.exports=cytoscape),"undefined"!=typeof define&&define.amd&&define("cytoscape",function(){return cytoscape}),window&&(window.cytoscape=cytoscape)}("undefined"==typeof window?null:window),this.cytoscape=cytoscape,function($$){"use strict";var STATE_PENDING=0,STATE_FULFILLED=1,STATE_REJECTED=2,api=function(executor){return this instanceof api?(this.id="Thenable/1.0.7",this.state=STATE_PENDING,this.fulfillValue=void 0,this.rejectReason=void 0,this.onFulfilled=[],this.onRejected=[],this.proxy={then:this.then.bind(this)},void("function"==typeof executor&&executor.call(this,this.fulfill.bind(this),this.reject.bind(this)))):new api(executor)};api.prototype={fulfill:function(value){return deliver(this,STATE_FULFILLED,"fulfillValue",value)},reject:function(value){return deliver(this,STATE_REJECTED,"rejectReason",value)},then:function(onFulfilled,onRejected){var curr=this,next=new api;return curr.onFulfilled.push(resolver(onFulfilled,next,"fulfill")),curr.onRejected.push(resolver(onRejected,next,"reject")),execute(curr),next.proxy}};var deliver=function(curr,state,name,value){return curr.state===STATE_PENDING&&(curr.state=state,curr[name]=value,execute(curr)),curr},execute=function(curr){curr.state===STATE_FULFILLED?execute_handlers(curr,"onFulfilled",curr.fulfillValue):curr.state===STATE_REJECTED&&execute_handlers(curr,"onRejected",curr.rejectReason)},execute_handlers=function(curr,name,value){if(0!==curr[name].length){var handlers=curr[name];curr[name]=[];var func=function(){for(var i=0;i<handlers.length;i++)handlers[i](value)};"object"==typeof process&&"function"==typeof process.nextTick?process.nextTick(func):"function"==typeof setImmediate?setImmediate(func):setTimeout(func,0)}},resolver=function(cb,next,method){return function(value){if("function"!=typeof cb)next[method].call(next,value);else{var result;try{result=cb(value)}catch(e){return void next.reject(e)}resolve(next,result)}}},resolve=function(promise,x){if(promise===x||promise.proxy===x)return void promise.reject(new TypeError("cannot resolve promise with itself"));var then;if("object"==typeof x&&null!==x||"function"==typeof x)try{then=x.then}catch(e){return void promise.reject(e)}if("function"!=typeof then)promise.fulfill(x);else{var resolved=!1;try{then.call(x,function(y){resolved||(resolved=!0,y===x?promise.reject(new TypeError("circular thenable chain")):resolve(promise,y))},function(r){resolved||(resolved=!0,promise.reject(r))})}catch(e){resolved||promise.reject(e)}}};$$.Promise="undefined"==typeof Promise?api:Promise,$$.Promise.all=$$.Promise.all||function(ps){return new $$.Promise(function(resolveAll,rejectAll){for(var vals=new Array(ps.length),doneCount=0,fulfill=function(i,val){vals[i]=val,doneCount++,doneCount===ps.length&&resolveAll(vals)},i=0;i<ps.length;i++)!function(i){var p=ps[i],isPromise=null!=p.then;if(isPromise)p.then(function(val){fulfill(i,val)},function(err){rejectAll(err)});else{var val=p;fulfill(i,val)}}(i)})}}(cytoscape),function($$,window){"use strict";var typeofstr="string",typeofobj=typeof{},typeoffn="function";$$.is={defined:function(obj){return null!=obj},string:function(obj){return null!=obj&&typeof obj==typeofstr},fn:function(obj){return null!=obj&&typeof obj===typeoffn},array:function(obj){return Array.isArray?Array.isArray(obj):null!=obj&&obj instanceof Array},plainObject:function(obj){return null!=obj&&typeof obj===typeofobj&&!$$.is.array(obj)&&obj.constructor===Object},object:function(obj){return null!=obj&&typeof obj===typeofobj},number:function(obj){return null!=obj&&"number"==typeof obj&&!isNaN(obj)},integer:function(obj){return $$.is.number(obj)&&Math.floor(obj)===obj;

},color:function(obj){return null!=obj&&"string"==typeof obj&&""!==$.Color(obj).toString()},bool:function(obj){return null!=obj&&typeof obj==typeof!0},elementOrCollection:function(obj){return $$.is.element(obj)||$$.is.collection(obj)},element:function(obj){return obj instanceof $$.Element&&obj._private.single},collection:function(obj){return obj instanceof $$.Collection&&!obj._private.single},core:function(obj){return obj instanceof $$.Core},style:function(obj){return obj instanceof $$.Style},stylesheet:function(obj){return obj instanceof $$.Stylesheet},event:function(obj){return obj instanceof $$.Event},thread:function(obj){return obj instanceof $$.Thread},fabric:function(obj){return obj instanceof $$.Fabric},emptyString:function(obj){return obj?$$.is.string(obj)&&(""===obj||obj.match(/^\s+$/))?!0:!1:!0},nonemptyString:function(obj){return obj&&$$.is.string(obj)&&""!==obj&&!obj.match(/^\s+$/)?!0:!1},domElement:function(obj){return"undefined"==typeof HTMLElement?!1:obj instanceof HTMLElement},boundingBox:function(obj){return $$.is.plainObject(obj)&&$$.is.number(obj.x1)&&$$.is.number(obj.x2)&&$$.is.number(obj.y1)&&$$.is.number(obj.y2)},promise:function(obj){return $$.is.object(obj)&&$$.is.fn(obj.then)},touch:function(){return window&&("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)},gecko:function(){return"undefined"!=typeof InstallTrigger||"MozAppearance"in document.documentElement.style},webkit:function(){return"undefined"!=typeof webkitURL||"WebkitAppearance"in document.documentElement.style},chromium:function(){return"undefined"!=typeof chrome},khtml:function(){return navigator.vendor.match(/kde/i)},khtmlEtc:function(){return $$.is.khtml()||$$.is.webkit()||$$.is.chromium()},trident:function(){return"undefined"!=typeof ActiveXObject||!1},windows:function(){return"undefined"!=typeof navigator&&navigator.appVersion.match(/Win/i)},mac:function(){return"undefined"!=typeof navigator&&navigator.appVersion.match(/Mac/i)},linux:function(){return"undefined"!=typeof navigator&&navigator.appVersion.match(/Linux/i)},unix:function(){return"undefined"!=typeof navigator&&navigator.appVersion.match(/X11/i)}}}(cytoscape,"undefined"==typeof window?null:window),function($$,window){"use strict";$$.util={extend:function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=!1;for("boolean"==typeof target&&(deep=target,target=arguments[1]||{},i=2),"object"==typeof target||$$.is.fn(target)||(target={}),length===i&&(target=this,--i);length>i;i++)if(null!=(options=arguments[i]))for(name in options)src=target[name],copy=options[name],target!==copy&&(deep&&copy&&($$.is.plainObject(copy)||(copyIsArray=$$.is.array(copy)))?(copyIsArray?(copyIsArray=!1,clone=src&&$$.is.array(src)?src:[]):clone=src&&$$.is.plainObject(src)?src:{},target[name]=$$.util.extend(deep,clone,copy)):void 0!==copy&&(target[name]=copy));return target},require:function(name,callback,options){var ret;options=$$.util.extend({msgIfNotFound:!0},options);var done=!1,fulfil=function(ret){done=!0,callback(ret)},checkWindow=function(next){window&&(ret=window[name]),void 0!==ret&&fulfil(ret),next&&next()},onCheckWindowDone=function(){done||checkCommonJs(onCheckCommonJsDone)},checkCommonJs=function(next){"undefined"!=typeof module&&module.exports&&require&&(ret=require(name)),void 0!==ret&&fulfil(ret),next&&next()},onCheckCommonJsDone=function(){done||checkAmd(onCheckAmdDone)},checkAmd=function(next){"undefined"!=typeof define&&define.amd&&require&&require([name],function(nameImpl){ret=nameImpl,void 0!==ret&&fulfil(ret),next&&next()})},onCheckAmdDone=function(){!done&&options.msgIfNotFound&&$$.util.error("Cytoscape.js tried to pull in dependency `"+name+"` but no module (i.e. CommonJS, AMD, or window) was found")};checkWindow(onCheckWindowDone)},requires:function(names,callback){for(var impls=[],gotImpl=[],checkDone=function(){for(var i=0;i<names.length;i++)if(!gotImpl[i])return;callback.apply(callback,impls)},i=0;i<names.length;i++)!function(){var name=names[i],index=i;$$.util.require(name,function(impl){impls[index]=impl,gotImpl[index]=!0,checkDone()})}()},throttle:function(func,wait,options){var leading=!0,trailing=!0;return options===!1?leading=!1:$$.is.plainObject(options)&&(leading="leading"in options?options.leading:leading,trailing="trailing"in options?options.trailing:trailing),options=options||{},options.leading=leading,options.maxWait=wait,options.trailing=trailing,$$.util.debounce(func,wait,options)},now:function(){return+new Date},debounce:function(func,wait,options){var args,maxTimeoutId,result,stamp,thisArg,timeoutId,trailingCall,lastCalled=0,maxWait=!1,trailing=!0;if($$.is.fn(func)){if(wait=Math.max(0,wait)||0,options===!0){var leading=!0;trailing=!1}else $$.is.plainObject(options)&&(leading=options.leading,maxWait="maxWait"in options&&(Math.max(wait,options.maxWait)||0),trailing="trailing"in options?options.trailing:trailing);var delayed=function(){var remaining=wait-($$.util.now()-stamp);if(0>=remaining){maxTimeoutId&&clearTimeout(maxTimeoutId);var isCalled=trailingCall;maxTimeoutId=timeoutId=trailingCall=void 0,isCalled&&(lastCalled=$$.util.now(),result=func.apply(thisArg,args),timeoutId||maxTimeoutId||(args=thisArg=null))}else timeoutId=setTimeout(delayed,remaining)},maxDelayed=function(){timeoutId&&clearTimeout(timeoutId),maxTimeoutId=timeoutId=trailingCall=void 0,(trailing||maxWait!==wait)&&(lastCalled=$$.util.now(),result=func.apply(thisArg,args),timeoutId||maxTimeoutId||(args=thisArg=null))};return function(){if(args=arguments,stamp=$$.util.now(),thisArg=this,trailingCall=trailing&&(timeoutId||!leading),maxWait===!1)var leadingCall=leading&&!timeoutId;else{maxTimeoutId||leading||(lastCalled=stamp);var remaining=maxWait-(stamp-lastCalled),isCalled=0>=remaining;isCalled?(maxTimeoutId&&(maxTimeoutId=clearTimeout(maxTimeoutId)),lastCalled=stamp,result=func.apply(thisArg,args)):maxTimeoutId||(maxTimeoutId=setTimeout(maxDelayed,remaining))}return isCalled&&timeoutId?timeoutId=clearTimeout(timeoutId):timeoutId||wait===maxWait||(timeoutId=setTimeout(delayed,wait)),leadingCall&&(isCalled=!0,result=func.apply(thisArg,args)),!isCalled||timeoutId||maxTimeoutId||(args=thisArg=null),result}}},error:function(msg){if(!console)throw msg;if(console.error)console.error.apply(console,arguments);else{if(!console.log)throw msg;console.log.apply(console,arguments)}},clone:function(obj){var target={};for(var i in obj)obj.hasOwnProperty(i)&&(target[i]=obj[i]);return target},copy:function(obj){return null==obj?obj:$$.is.array(obj)?obj.slice():$$.is.plainObject(obj)?$$.util.clone(obj):obj},makeBoundingBox:function(bb){if(null!=bb.x1&&null!=bb.y1){if(null!=bb.x2&&null!=bb.y2&&bb.x2>=bb.x1&&bb.y2>=bb.y1)return{x1:bb.x1,y1:bb.y1,x2:bb.x2,y2:bb.y2,w:bb.x2-bb.x1,h:bb.y2-bb.y1};if(null!=bb.w&&null!=bb.h&&bb.w>=0&&bb.h>=0)return{x1:bb.x1,y1:bb.y1,x2:bb.x1+bb.w,y2:bb.y1+bb.h,w:bb.w,h:bb.h}}},mapEmpty:function(map){var empty=!0;if(null!=map)for(var i in map){empty=!1;break}return empty},pushMap:function(options){var array=$$.util.getMap(options);null==array?$$.util.setMap($.extend({},options,{value:[options.value]})):array.push(options.value)},setMap:function(options){for(var key,obj=options.map,keys=options.keys,l=keys.length,i=0;l>i;i++){var key=keys[i];$$.is.plainObject(key)&&$$.util.error("Tried to set map with object key"),i<keys.length-1?(null==obj[key]&&(obj[key]={}),obj=obj[key]):obj[key]=options.value}},getMap:function(options){for(var obj=options.map,keys=options.keys,l=keys.length,i=0;l>i;i++){var key=keys[i];if($$.is.plainObject(key)&&$$.util.error("Tried to get map with object key"),obj=obj[key],null==obj)return obj}return obj},deleteMap:function(options){for(var obj=options.map,keys=options.keys,l=keys.length,keepChildren=options.keepChildren,i=0;l>i;i++){var key=keys[i];$$.is.plainObject(key)&&$$.util.error("Tried to delete map with object key");var lastKey=i===options.keys.length-1;if(lastKey)if(keepChildren)for(var child in obj)keepChildren[child]||(obj[child]=void 0);else obj[key]=void 0;else obj=obj[key]}},capitalize:function(str){return $$.is.emptyString(str)?str:str.charAt(0).toUpperCase()+str.substring(1)},camel2dash:function(str){for(var ret=[],i=0;i<str.length;i++){var ch=str[i],chLowerCase=ch.toLowerCase(),isUpperCase=ch!==chLowerCase;isUpperCase?(ret.push("-"),ret.push(chLowerCase)):ret.push(ch)}var noUpperCases=ret.length===str.length;return noUpperCases?str:ret.join("")},dash2camel:function(str){for(var ret=[],nextIsUpper=!1,i=0;i<str.length;i++){var ch=str[i],isDash="-"===ch;isDash?nextIsUpper=!0:(ret.push(nextIsUpper?ch.toUpperCase():ch),nextIsUpper=!1)}return ret.join("")},trim:function(str){var first,last;for(first=0;first<str.length&&" "===str[first];first++);for(last=str.length-1;last>first&&" "===str[last];last--);return str.substring(first,last+1)},hex2tuple:function(hex){if((4===hex.length||7===hex.length)&&"#"===hex[0]){var r,g,b,shortHex=4===hex.length,base=16;return shortHex?(r=parseInt(hex[1]+hex[1],base),g=parseInt(hex[2]+hex[2],base),b=parseInt(hex[3]+hex[3],base)):(r=parseInt(hex[1]+hex[2],base),g=parseInt(hex[3]+hex[4],base),b=parseInt(hex[5]+hex[6],base)),[r,g,b]}},hsl2tuple:function(hsl){function hue2rgb(p,q,t){return 0>t&&(t+=1),t>1&&(t-=1),1/6>t?p+6*(q-p)*t:.5>t?q:2/3>t?p+(q-p)*(2/3-t)*6:p}var ret,h,s,l,a,r,g,b,m=new RegExp("^"+$$.util.regex.hsla+"$").exec(hsl);if(m){if(h=parseInt(m[1]),0>h?h=(360- -1*h%360)%360:h>360&&(h%=360),h/=360,s=parseFloat(m[2]),0>s||s>100)return;if(s/=100,l=parseFloat(m[3]),0>l||l>100)return;if(l/=100,a=m[4],void 0!==a&&(a=parseFloat(a),0>a||a>1))return;if(0===s)r=g=b=Math.round(255*l);else{var q=.5>l?l*(1+s):l+s-l*s,p=2*l-q;r=Math.round(255*hue2rgb(p,q,h+1/3)),g=Math.round(255*hue2rgb(p,q,h)),b=Math.round(255*hue2rgb(p,q,h-1/3))}ret=[r,g,b,a]}return ret},rgb2tuple:function(rgb){var ret,m=new RegExp("^"+$$.util.regex.rgba+"$").exec(rgb);if(m){ret=[];for(var isPct=[],i=1;3>=i;i++){var channel=m[i];if("%"===channel[channel.length-1]&&(isPct[i]=!0),channel=parseFloat(channel),isPct[i]&&(channel=channel/100*255),0>channel||channel>255)return;ret.push(Math.floor(channel))}var atLeastOneIsPct=isPct[1]||isPct[2]||isPct[3],allArePct=isPct[1]&&isPct[2]&&isPct[3];if(atLeastOneIsPct&&!allArePct)return;var alpha=m[4];if(void 0!==alpha){if(alpha=parseFloat(alpha),0>alpha||alpha>1)return;ret.push(alpha)}}return ret},colorname2tuple:function(color){return $$.util.colors[color.toLowerCase()]},color2tuple:function(color){return($$.is.array(color)?color:null)||$$.util.colorname2tuple(color)||$$.util.hex2tuple(color)||$$.util.rgb2tuple(color)||$$.util.hsl2tuple(color)},tuple2hex:function(tuple){function ch2hex(ch){var hex=ch.toString(16);return 1===hex.length&&(hex="0"+hex),hex}var r=tuple[0],g=tuple[1],b=tuple[2];return"#"+ch2hex(r)+ch2hex(g)+ch2hex(b)},colors:{transparent:[0,0,0,0],aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],grey:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},$$.util.regex={},$$.util.regex.number="(?:[-]?\\d*\\.\\d+|[-]?\\d+|[-]?\\d*\\.\\d+[eE]\\d+)",$$.util.regex.rgba="rgb[a]?\\(("+$$.util.regex.number+"[%]?)\\s*,\\s*("+$$.util.regex.number+"[%]?)\\s*,\\s*("+$$.util.regex.number+"[%]?)(?:\\s*,\\s*("+$$.util.regex.number+"))?\\)",$$.util.regex.rgbaNoBackRefs="rgb[a]?\\((?:"+$$.util.regex.number+"[%]?)\\s*,\\s*(?:"+$$.util.regex.number+"[%]?)\\s*,\\s*(?:"+$$.util.regex.number+"[%]?)(?:\\s*,\\s*(?:"+$$.util.regex.number+"))?\\)",$$.util.regex.hsla="hsl[a]?\\(("+$$.util.regex.number+")\\s*,\\s*("+$$.util.regex.number+"[%])\\s*,\\s*("+$$.util.regex.number+"[%])(?:\\s*,\\s*("+$$.util.regex.number+"))?\\)",$$.util.regex.hslaNoBackRefs="hsl[a]?\\((?:"+$$.util.regex.number+")\\s*,\\s*(?:"+$$.util.regex.number+"[%])\\s*,\\s*(?:"+$$.util.regex.number+"[%])(?:\\s*,\\s*(?:"+$$.util.regex.number+"))?\\)",$$.util.regex.hex3="\\#[0-9a-fA-F]{3}",$$.util.regex.hex6="\\#[0-9a-fA-F]{6}";var raf=window?window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame:null;raf=raf||function(fn){fn&&setTimeout(fn,1e3/60)},$$.util.requestAnimationFrame=function(fn){raf(fn)}}(cytoscape,"undefined"==typeof window?null:window),function($$){"use strict";$$.math={},$$.math.signum=function(x){return x>0?1:0>x?-1:0},$$.math.distance=function(p1,p2){var dx=p2.x-p1.x,dy=p2.y-p1.y;return Math.sqrt(dx*dx+dy*dy)},$$.math.qbezierAt=function(p0,p1,p2,t){return(1-t)*(1-t)*p0+2*(1-t)*t*p1+t*t*p2},$$.math.qbezierPtAt=function(p0,p1,p2,t){return{x:$$.math.qbezierAt(p0.x,p1.x,p2.x,t),y:$$.math.qbezierAt(p0.y,p1.y,p2.y,t)}},$$.math.boundingBoxesIntersect=function(bb1,bb2){return bb1.x1>bb2.x2?!1:bb2.x1>bb1.x2?!1:bb1.x2<bb2.x1?!1:bb2.x2<bb1.x1?!1:bb1.y2<bb2.y1?!1:bb2.y2<bb1.y1?!1:bb1.y1>bb2.y2?!1:bb2.y1>bb1.y2?!1:!0},$$.math.inBoundingBox=function(bb,x,y){return bb.x1<=x&&x<=bb.x2&&bb.y1<=y&&y<=bb.y2},$$.math.pointInBoundingBox=function(bb,pt){return this.inBoundingBox(bb,pt.x,pt.y)},$$.math.roundRectangleIntersectLine=function(x,y,nodeX,nodeY,width,height,padding){var straightLineIntersections,cornerRadius=this.getRoundRectangleRadius(width,height),halfWidth=width/2,halfHeight=height/2,topStartX=nodeX-halfWidth+cornerRadius-padding,topStartY=nodeY-halfHeight-padding,topEndX=nodeX+halfWidth-cornerRadius+padding,topEndY=topStartY;if(straightLineIntersections=this.finiteLinesIntersect(x,y,nodeX,nodeY,topStartX,topStartY,topEndX,topEndY,!1),straightLineIntersections.length>0)return straightLineIntersections;var rightStartX=nodeX+halfWidth+padding,rightStartY=nodeY-halfHeight+cornerRadius-padding,rightEndX=rightStartX,rightEndY=nodeY+halfHeight-cornerRadius+padding;if(straightLineIntersections=this.finiteLinesIntersect(x,y,nodeX,nodeY,rightStartX,rightStartY,rightEndX,rightEndY,!1),straightLineIntersections.length>0)return straightLineIntersections;var bottomStartX=nodeX-halfWidth+cornerRadius-padding,bottomStartY=nodeY+halfHeight+padding,bottomEndX=nodeX+halfWidth-cornerRadius+padding,bottomEndY=bottomStartY;if(straightLineIntersections=this.finiteLinesIntersect(x,y,nodeX,nodeY,bottomStartX,bottomStartY,bottomEndX,bottomEndY,!1),straightLineIntersections.length>0)return straightLineIntersections;var leftStartX=nodeX-halfWidth-padding,leftStartY=nodeY-halfHeight+cornerRadius-padding,leftEndX=leftStartX,leftEndY=nodeY+halfHeight-cornerRadius+padding;if(straightLineIntersections=this.finiteLinesIntersect(x,y,nodeX,nodeY,leftStartX,leftStartY,leftEndX,leftEndY,!1),straightLineIntersections.length>0)return straightLineIntersections;var arcIntersections,topLeftCenterX=nodeX-halfWidth+cornerRadius,topLeftCenterY=nodeY-halfHeight+cornerRadius;if(arcIntersections=this.intersectLineCircle(x,y,nodeX,nodeY,topLeftCenterX,topLeftCenterY,cornerRadius+padding),arcIntersections.length>0&&arcIntersections[0]<=topLeftCenterX&&arcIntersections[1]<=topLeftCenterY)return[arcIntersections[0],arcIntersections[1]];var topRightCenterX=nodeX+halfWidth-cornerRadius,topRightCenterY=nodeY-halfHeight+cornerRadius;if(arcIntersections=this.intersectLineCircle(x,y,nodeX,nodeY,topRightCenterX,topRightCenterY,cornerRadius+padding),arcIntersections.length>0&&arcIntersections[0]>=topRightCenterX&&arcIntersections[1]<=topRightCenterY)return[arcIntersections[0],arcIntersections[1]];var bottomRightCenterX=nodeX+halfWidth-cornerRadius,bottomRightCenterY=nodeY+halfHeight-cornerRadius;if(arcIntersections=this.intersectLineCircle(x,y,nodeX,nodeY,bottomRightCenterX,bottomRightCenterY,cornerRadius+padding),arcIntersections.length>0&&arcIntersections[0]>=bottomRightCenterX&&arcIntersections[1]>=bottomRightCenterY)return[arcIntersections[0],arcIntersections[1]];var bottomLeftCenterX=nodeX-halfWidth+cornerRadius,bottomLeftCenterY=nodeY+halfHeight-cornerRadius;return arcIntersections=this.intersectLineCircle(x,y,nodeX,nodeY,bottomLeftCenterX,bottomLeftCenterY,cornerRadius+padding),arcIntersections.length>0&&arcIntersections[0]<=bottomLeftCenterX&&arcIntersections[1]>=bottomLeftCenterY?[arcIntersections[0],arcIntersections[1]]:[]},$$.math.roundRectangleIntersectBox=function(boxX1,boxY1,boxX2,boxY2,width,height,centerX,centerY,padding){var cornerRadius=this.getRoundRectangleRadius(width,height),hBoxTopLeftX=centerX-width/2-padding,hBoxTopLeftY=centerY-height/2+cornerRadius-padding,hBoxBottomRightX=centerX+width/2+padding,hBoxBottomRightY=centerY+height/2-cornerRadius+padding,vBoxTopLeftX=centerX-width/2+cornerRadius-padding,vBoxTopLeftY=centerY-height/2-padding,vBoxBottomRightX=centerX+width/2-cornerRadius+padding,vBoxBottomRightY=centerY+height/2+padding,boxMinX=Math.min(boxX1,boxX2),boxMaxX=Math.max(boxX1,boxX2),boxMinY=Math.min(boxY1,boxY2),boxMaxY=Math.max(boxY1,boxY2);return hBoxTopLeftX>boxMaxX?!1:boxMinX>hBoxBottomRightX?!1:vBoxTopLeftY>boxMaxY?!1:boxMinY>vBoxBottomRightY?!1:hBoxTopLeftX>=boxMinX&&boxMaxX>=hBoxTopLeftX&&hBoxTopLeftY>=boxMinY&&boxMaxY>=hBoxTopLeftY?!0:hBoxBottomRightX>=boxMinX&&boxMaxX>=hBoxBottomRightX&&hBoxTopLeftY>=boxMinY&&boxMaxY>=hBoxTopLeftY?!0:hBoxBottomRightX>=boxMinX&&boxMaxX>=hBoxBottomRightX&&hBoxBottomRightY>=boxMinY&&boxMaxY>=hBoxBottomRightY?!0:hBoxTopLeftX>=boxMinX&&boxMaxX>=hBoxTopLeftX&&hBoxBottomRightY>=boxMinY&&boxMaxY>=hBoxBottomRightY?!0:boxMinX>=hBoxTopLeftX&&hBoxBottomRightX>=boxMinX&&boxMinY>=hBoxTopLeftY&&hBoxBottomRightY>=boxMinY?!0:boxMaxX>=hBoxTopLeftX&&hBoxBottomRightX>=boxMaxX&&boxMinY>=hBoxTopLeftY&&hBoxBottomRightY>=boxMinY?!0:boxMaxX>=hBoxTopLeftX&&hBoxBottomRightX>=boxMaxX&&boxMaxY>=hBoxTopLeftY&&hBoxBottomRightY>=boxMaxY?!0:boxMinX>=hBoxTopLeftX&&hBoxBottomRightX>=boxMinX&&boxMaxY>=hBoxTopLeftY&&hBoxBottomRightY>=boxMaxY?!0:vBoxTopLeftX>=boxMinX&&boxMaxX>=vBoxTopLeftX&&vBoxTopLeftY>=boxMinY&&boxMaxY>=vBoxTopLeftY?!0:vBoxBottomRightX>=boxMinX&&boxMaxX>=vBoxBottomRightX&&vBoxTopLeftY>=boxMinY&&boxMaxY>=vBoxTopLeftY?!0:vBoxBottomRightX>=boxMinX&&boxMaxX>=vBoxBottomRightX&&vBoxBottomRightY>=boxMinY&&boxMaxY>=vBoxBottomRightY?!0:vBoxTopLeftX>=boxMinX&&boxMaxX>=vBoxTopLeftX&&vBoxBottomRightY>=boxMinY&&boxMaxY>=vBoxBottomRightY?!0:boxMinX>=vBoxTopLeftX&&vBoxBottomRightX>=boxMinX&&boxMinY>=vBoxTopLeftY&&vBoxBottomRightY>=boxMinY?!0:boxMaxX>=vBoxTopLeftX&&vBoxBottomRightX>=boxMaxX&&boxMinY>=vBoxTopLeftY&&vBoxBottomRightY>=boxMinY?!0:boxMaxX>=vBoxTopLeftX&&vBoxBottomRightX>=boxMaxX&&boxMaxY>=vBoxTopLeftY&&vBoxBottomRightY>=boxMaxY?!0:boxMinX>=vBoxTopLeftX&&vBoxBottomRightX>=boxMinX&&boxMaxY>=vBoxTopLeftY&&vBoxBottomRightY>=boxMaxY?!0:this.boxIntersectEllipse(boxMinX,boxMinY,boxMaxX,boxMaxY,padding,2*cornerRadius,2*cornerRadius,vBoxTopLeftX+padding,hBoxTopLeftY+padding)?!0:this.boxIntersectEllipse(boxMinX,boxMinY,boxMaxX,boxMaxY,padding,2*cornerRadius,2*cornerRadius,vBoxBottomRightX-padding,hBoxTopLeftY+padding)?!0:this.boxIntersectEllipse(boxMinX,boxMinY,boxMaxX,boxMaxY,padding,2*cornerRadius,2*cornerRadius,vBoxBottomRightX-padding,hBoxBottomRightY-padding)?!0:this.boxIntersectEllipse(boxMinX,boxMinY,boxMaxX,boxMaxY,padding,2*cornerRadius,2*cornerRadius,vBoxTopLeftX+padding,hBoxBottomRightY-padding)?!0:!1},$$.math.checkInBoundingCircle=function(x,y,farthestPointSqDistance,padding,width,height,centerX,centerY){return x=(x-centerX)/(width+padding),y=(y-centerY)/(height+padding),farthestPointSqDistance>=x*x+y*y},$$.math.boxInBezierVicinity=function(x1box,y1box,x2box,y2box,x1,y1,x2,y2,x3,y3,tolerance){var midX=.25*x1+.5*x2+.25*x3,midY=.25*y1+.5*y2+.25*y3,boxMinX=Math.min(x1box,x2box)-tolerance,boxMinY=Math.min(y1box,y2box)-tolerance,boxMaxX=Math.max(x1box,x2box)+tolerance,boxMaxY=Math.max(y1box,y2box)+tolerance;if(x1>=boxMinX&&boxMaxX>=x1&&y1>=boxMinY&&boxMaxY>=y1)return 1;if(x3>=boxMinX&&boxMaxX>=x3&&y3>=boxMinY&&boxMaxY>=y3)return 1;if(midX>=boxMinX&&boxMaxX>=midX&&midY>=boxMinY&&boxMaxY>=midY)return 1;if(x2>=boxMinX&&boxMaxX>=x2&&y2>=boxMinY&&boxMaxY>=y2)return 1;var curveMinX=Math.min(x1,midX,x3),curveMinY=Math.min(y1,midY,y3),curveMaxX=Math.max(x1,midX,x3),curveMaxY=Math.max(y1,midY,y3);return curveMinX>boxMaxX||boxMinX>curveMaxX||curveMinY>boxMaxY||boxMinY>curveMaxY?0:1},$$.math.checkBezierInBox=function(x1box,y1box,x2box,y2box,x1,y1,x2,y2,x3,y3,tolerance){function sampleInBox(t){var x=$$.math.qbezierAt(x1,x2,x3,t),y=$$.math.qbezierAt(y1,y2,y3,t);return x>=x1box&&x2box>=x&&y>=y1box&&y2box>=y}for(var t=0;1>=t;t+=.25)if(!sampleInBox(t))return!1;return!0},$$.math.checkStraightEdgeInBox=function(x1box,y1box,x2box,y2box,x1,y1,x2,y2,tolerance){return x1>=x1box&&x2box>=x1&&x2>=x1box&&x2box>=x2&&y1>=y1box&&y2box>=y1&&y2>=y1box&&y2box>=y2},$$.math.checkStraightEdgeCrossesBox=function(x1box,y1box,x2box,y2box,x1,y1,x2,y2,tolerance){var yValue,xValue,boxMinX=Math.min(x1box,x2box)-tolerance,boxMinY=Math.min(y1box,y2box)-tolerance,boxMaxX=Math.max(x1box,x2box)+tolerance,boxMaxY=Math.max(y1box,y2box)+tolerance,aX=x2-x1,bX=x1,aY=y2-y1,bY=y1;if(Math.abs(aX)<1e-4)return x1>=boxMinX&&boxMaxX>=x1&&Math.min(y1,y2)<=boxMinY&&Math.max(y1,y2)>=boxMaxY;var tLeft=(boxMinX-bX)/aX;if(tLeft>0&&1>=tLeft&&(yValue=aY*tLeft+bY,yValue>=boxMinY&&boxMaxY>=yValue))return!0;var tRight=(boxMaxX-bX)/aX;if(tRight>0&&1>=tRight&&(yValue=aY*tRight+bY,yValue>=boxMinY&&boxMaxY>=yValue))return!0;var tTop=(boxMinY-bY)/aY;if(tTop>0&&1>=tTop&&(xValue=aX*tTop+bX,xValue>=boxMinX&&boxMaxX>=xValue))return!0;var tBottom=(boxMaxY-bY)/aY;return tBottom>0&&1>=tBottom&&(xValue=aX*tBottom+bX,xValue>=boxMinX&&boxMaxX>=xValue)?!0:!1},$$.math.checkBezierCrossesBox=function(x1box,y1box,x2box,y2box,x1,y1,x2,y2,x3,y3,tolerance){var boxMinX=Math.min(x1box,x2box)-tolerance,boxMinY=Math.min(y1box,y2box)-tolerance,boxMaxX=Math.max(x1box,x2box)+tolerance,boxMaxY=Math.max(y1box,y2box)+tolerance;if(x1>=boxMinX&&boxMaxX>=x1&&y1>=boxMinY&&boxMaxY>=y1)return!0;if(x3>=boxMinX&&boxMaxX>=x3&&y3>=boxMinY&&boxMaxY>=y3)return!0;var aX=x1-2*x2+x3,bX=-2*x1+2*x2,cX=x1,xIntervals=[];if(Math.abs(aX)<1e-4){var leftParam=(boxMinX-x1)/bX,rightParam=(boxMaxX-x1)/bX;xIntervals.push(leftParam,rightParam)}else{var tX1,tX2,discriminantX1=bX*bX-4*aX*(cX-boxMinX);if(discriminantX1>0){var sqrt=Math.sqrt(discriminantX1);tX1=(-bX+sqrt)/(2*aX),tX2=(-bX-sqrt)/(2*aX),xIntervals.push(tX1,tX2)}var tX3,tX4,discriminantX2=bX*bX-4*aX*(cX-boxMaxX);if(discriminantX2>0){var sqrt=Math.sqrt(discriminantX2);tX3=(-bX+sqrt)/(2*aX),tX4=(-bX-sqrt)/(2*aX),xIntervals.push(tX3,tX4)}}xIntervals.sort(function(a,b){return a-b});var aY=y1-2*y2+y3,bY=-2*y1+2*y2,cY=y1,yIntervals=[];if(Math.abs(aY)<1e-4){var topParam=(boxMinY-y1)/bY,bottomParam=(boxMaxY-y1)/bY;yIntervals.push(topParam,bottomParam)}else{var tY1,tY2,discriminantY1=bY*bY-4*aY*(cY-boxMinY);if(discriminantY1>0){var sqrt=Math.sqrt(discriminantY1);tY1=(-bY+sqrt)/(2*aY),tY2=(-bY-sqrt)/(2*aY),yIntervals.push(tY1,tY2)}var tY3,tY4,discriminantY2=bY*bY-4*aY*(cY-boxMaxY);if(discriminantY2>0){var sqrt=Math.sqrt(discriminantY2);tY3=(-bY+sqrt)/(2*aY),tY4=(-bY-sqrt)/(2*aY),yIntervals.push(tY3,tY4)}}yIntervals.sort(function(a,b){return a-b});for(var index=0;index<xIntervals.length;index+=2)for(var yIndex=1;yIndex<yIntervals.length;yIndex+=2)if(xIntervals[index]<yIntervals[yIndex]&&yIntervals[yIndex]>=0&&xIntervals[index]<=1&&xIntervals[index+1]>yIntervals[yIndex-1]&&yIntervals[yIndex-1]<=1&&xIntervals[index+1]>=0)return!0;return!1},$$.math.inLineVicinity=function(x,y,lx1,ly1,lx2,ly2,tolerance){var t=tolerance,x1=Math.min(lx1,lx2),x2=Math.max(lx1,lx2),y1=Math.min(ly1,ly2),y2=Math.max(ly1,ly2);return x>=x1-t&&x2+t>=x&&y>=y1-t&&y2+t>=y},$$.math.inBezierVicinity=function(x,y,x1,y1,x2,y2,x3,y3,toleranceSquared){var bb={x1:Math.min(x1,x3,x2),x2:Math.max(x1,x3,x2),y1:Math.min(y1,y3,y2),y2:Math.max(y1,y3,y2)};return x<bb.x1||x>bb.x2||y<bb.y1||y>bb.y2?!1:!0},$$.math.solveCubic=function(a,b,c,d,result){b/=a,c/=a,d/=a;var discriminant,q,r,dum1,s,t,term1,r13;return q=(3*c-b*b)/9,r=-(27*d)+b*(9*c-2*b*b),r/=54,discriminant=q*q*q+r*r,result[1]=0,term1=b/3,discriminant>0?(s=r+Math.sqrt(discriminant),s=0>s?-Math.pow(-s,1/3):Math.pow(s,1/3),t=r-Math.sqrt(discriminant),t=0>t?-Math.pow(-t,1/3):Math.pow(t,1/3),result[0]=-term1+s+t,term1+=(s+t)/2,result[4]=result[2]=-term1,term1=Math.sqrt(3)*(-t+s)/2,result[3]=term1,void(result[5]=-term1)):(result[5]=result[3]=0,0===discriminant?(r13=0>r?-Math.pow(-r,1/3):Math.pow(r,1/3),result[0]=-term1+2*r13,void(result[4]=result[2]=-(r13+term1))):(q=-q,dum1=q*q*q,dum1=Math.acos(r/Math.sqrt(dum1)),r13=2*Math.sqrt(q),result[0]=-term1+r13*Math.cos(dum1/3),result[2]=-term1+r13*Math.cos((dum1+2*Math.PI)/3),void(result[4]=-term1+r13*Math.cos((dum1+4*Math.PI)/3))))},$$.math.sqDistanceToQuadraticBezier=function(x,y,x1,y1,x2,y2,x3,y3){var a=1*x1*x1-4*x1*x2+2*x1*x3+4*x2*x2-4*x2*x3+x3*x3+y1*y1-4*y1*y2+2*y1*y3+4*y2*y2-4*y2*y3+y3*y3,b=9*x1*x2-3*x1*x1-3*x1*x3-6*x2*x2+3*x2*x3+9*y1*y2-3*y1*y1-3*y1*y3-6*y2*y2+3*y2*y3,c=3*x1*x1-6*x1*x2+x1*x3-x1*x+2*x2*x2+2*x2*x-x3*x+3*y1*y1-6*y1*y2+y1*y3-y1*y+2*y2*y2+2*y2*y-y3*y,d=1*x1*x2-x1*x1+x1*x-x2*x+y1*y2-y1*y1+y1*y-y2*y,roots=[];this.solveCubic(a,b,c,d,roots);for(var zeroThreshold=1e-7,params=[],index=0;6>index;index+=2)Math.abs(roots[index+1])<zeroThreshold&&roots[index]>=0&&roots[index]<=1&&params.push(roots[index]);params.push(1),params.push(0);for(var closestParam,curX,curY,distSquared,minDistanceSquared=-1,i=0;i<params.length;i++)curX=Math.pow(1-params[i],2)*x1+2*(1-params[i])*params[i]*x2+params[i]*params[i]*x3,curY=Math.pow(1-params[i],2)*y1+2*(1-params[i])*params[i]*y2+params[i]*params[i]*y3,distSquared=Math.pow(curX-x,2)+Math.pow(curY-y,2),minDistanceSquared>=0?minDistanceSquared>distSquared&&(minDistanceSquared=distSquared,closestParam=params[i]):(minDistanceSquared=distSquared,closestParam=params[i]);return minDistanceSquared},$$.math.sqDistanceToFiniteLine=function(x,y,x1,y1,x2,y2){var offset=[x-x1,y-y1],line=[x2-x1,y2-y1],lineSq=line[0]*line[0]+line[1]*line[1],hypSq=offset[0]*offset[0]+offset[1]*offset[1],dotProduct=offset[0]*line[0]+offset[1]*line[1],adjSq=dotProduct*dotProduct/lineSq;return 0>dotProduct?hypSq:adjSq>lineSq?(x-x2)*(x-x2)+(y-y2)*(y-y2):hypSq-adjSq},$$.math.pointInsidePolygon=function(x,y,basePoints,centerX,centerY,width,height,direction,padding){var transformedPoints=new Array(basePoints.length),angle=Math.asin(direction[1]/Math.sqrt(direction[0]*direction[0]+direction[1]*direction[1]));direction[0]<0?angle+=Math.PI/2:angle=-angle-Math.PI/2;for(var cos=Math.cos(-angle),sin=Math.sin(-angle),i=0;i<transformedPoints.length/2;i++)transformedPoints[2*i]=width/2*(basePoints[2*i]*cos-basePoints[2*i+1]*sin),transformedPoints[2*i+1]=height/2*(basePoints[2*i+1]*cos+basePoints[2*i]*sin),transformedPoints[2*i]+=centerX,transformedPoints[2*i+1]+=centerY;var points;if(padding>0){var expandedLineSet=this.expandPolygon(transformedPoints,-padding);points=this.joinLines(expandedLineSet)}else points=transformedPoints;for(var x1,y1,x2,y2,y3,up=0,down=0,i=0;i<points.length/2;i++)if(x1=points[2*i],y1=points[2*i+1],i+1<points.length/2?(x2=points[2*(i+1)],y2=points[2*(i+1)+1]):(x2=points[2*(i+1-points.length/2)],y2=points[2*(i+1-points.length/2)+1]),x1==x&&x2==x);else{if(!(x1>=x&&x>=x2||x>=x1&&x2>=x))continue;y3=(x-x1)/(x2-x1)*(y2-y1)+y1,y3>y&&up++,y>y3&&down++}return up%2===0?!1:!0},$$.math.joinLines=function(lineSet){for(var currentLineStartX,currentLineStartY,currentLineEndX,currentLineEndY,nextLineStartX,nextLineStartY,nextLineEndX,nextLineEndY,vertices=new Array(lineSet.length/2),i=0;i<lineSet.length/4;i++){currentLineStartX=lineSet[4*i],currentLineStartY=lineSet[4*i+1],currentLineEndX=lineSet[4*i+2],currentLineEndY=lineSet[4*i+3],i<lineSet.length/4-1?(nextLineStartX=lineSet[4*(i+1)],nextLineStartY=lineSet[4*(i+1)+1],nextLineEndX=lineSet[4*(i+1)+2],nextLineEndY=lineSet[4*(i+1)+3]):(nextLineStartX=lineSet[0],nextLineStartY=lineSet[1],nextLineEndX=lineSet[2],nextLineEndY=lineSet[3]);var intersection=this.finiteLinesIntersect(currentLineStartX,currentLineStartY,currentLineEndX,currentLineEndY,nextLineStartX,nextLineStartY,nextLineEndX,nextLineEndY,!0);vertices[2*i]=intersection[0],vertices[2*i+1]=intersection[1]}return vertices},$$.math.expandPolygon=function(points,pad){for(var currentPointX,currentPointY,nextPointX,nextPointY,expandedLineSet=new Array(2*points.length),i=0;i<points.length/2;i++){currentPointX=points[2*i],currentPointY=points[2*i+1],i<points.length/2-1?(nextPointX=points[2*(i+1)],nextPointY=points[2*(i+1)+1]):(nextPointX=points[0],nextPointY=points[1]);var offsetX=nextPointY-currentPointY,offsetY=-(nextPointX-currentPointX),offsetLength=Math.sqrt(offsetX*offsetX+offsetY*offsetY),normalizedOffsetX=offsetX/offsetLength,normalizedOffsetY=offsetY/offsetLength;expandedLineSet[4*i]=currentPointX+normalizedOffsetX*pad,expandedLineSet[4*i+1]=currentPointY+normalizedOffsetY*pad,expandedLineSet[4*i+2]=nextPointX+normalizedOffsetX*pad,expandedLineSet[4*i+3]=nextPointY+normalizedOffsetY*pad}return expandedLineSet},$$.math.intersectLineEllipse=function(x,y,centerX,centerY,ellipseWradius,ellipseHradius){var dispX=centerX-x,dispY=centerY-y;

dispX/=ellipseWradius,dispY/=ellipseHradius;var len=Math.sqrt(dispX*dispX+dispY*dispY),newLength=len-1;if(0>newLength)return[];var lenProportion=newLength/len;return[(centerX-x)*lenProportion+x,(centerY-y)*lenProportion+y]},$$.math.dotProduct=function(vec1,vec2){if(2!=vec1.length||2!=vec2.length)throw"dot product: arguments are not vectors";return vec1[0]*vec2[0]+vec1[1]*vec2[1]},$$.math.intersectLineCircle=function(x1,y1,x2,y2,centerX,centerY,radius){var d=[x2-x1,y2-y1],c=[centerX,centerY],f=[x1-centerX,y1-centerY],a=d[0]*d[0]+d[1]*d[1],b=2*(f[0]*d[0]+f[1]*d[1]),c=f[0]*f[0]+f[1]*f[1]-radius*radius,discriminant=b*b-4*a*c;if(0>discriminant)return[];var t1=(-b+Math.sqrt(discriminant))/(2*a),t2=(-b-Math.sqrt(discriminant))/(2*a),tMin=Math.min(t1,t2),tMax=Math.max(t1,t2),inRangeParams=[];if(tMin>=0&&1>=tMin&&inRangeParams.push(tMin),tMax>=0&&1>=tMax&&inRangeParams.push(tMax),0===inRangeParams.length)return[];var nearIntersectionX=inRangeParams[0]*d[0]+x1,nearIntersectionY=inRangeParams[0]*d[1]+y1;if(inRangeParams.length>1){if(inRangeParams[0]==inRangeParams[1])return[nearIntersectionX,nearIntersectionY];var farIntersectionX=inRangeParams[1]*d[0]+x1,farIntersectionY=inRangeParams[1]*d[1]+y1;return[nearIntersectionX,nearIntersectionY,farIntersectionX,farIntersectionY]}return[nearIntersectionX,nearIntersectionY]},$$.math.findCircleNearPoint=function(centerX,centerY,radius,farX,farY){var displacementX=farX-centerX,displacementY=farY-centerY,distance=Math.sqrt(displacementX*displacementX+displacementY*displacementY),unitDisplacementX=displacementX/distance,unitDisplacementY=displacementY/distance;return[centerX+unitDisplacementX*radius,centerY+unitDisplacementY*radius]},$$.math.findMaxSqDistanceToOrigin=function(points){for(var sqDistance,maxSqDistance=1e-6,i=0;i<points.length/2;i++)sqDistance=points[2*i]*points[2*i]+points[2*i+1]*points[2*i+1],sqDistance>maxSqDistance&&(maxSqDistance=sqDistance);return maxSqDistance},$$.math.finiteLinesIntersect=function(x1,y1,x2,y2,x3,y3,x4,y4,infiniteLines){var ua_t=(x4-x3)*(y1-y3)-(y4-y3)*(x1-x3),ub_t=(x2-x1)*(y1-y3)-(y2-y1)*(x1-x3),u_b=(y4-y3)*(x2-x1)-(x4-x3)*(y2-y1);if(0!==u_b){var ua=ua_t/u_b,ub=ub_t/u_b;return ua>=0&&1>=ua&&ub>=0&&1>=ub?[x1+ua*(x2-x1),y1+ua*(y2-y1)]:infiniteLines?[x1+ua*(x2-x1),y1+ua*(y2-y1)]:[]}return 0===ua_t||0===ub_t?[x1,x2,x4].sort()[1]===x4?[x4,y4]:[x1,x2,x3].sort()[1]===x3?[x3,y3]:[x3,x4,x2].sort()[1]===x2?[x2,y2]:[]:[]},$$.math.boxIntersectEllipse=function(x1,y1,x2,y2,padding,width,height,centerX,centerY){if(x1>x2){var oldX1=x1;x1=x2,x2=oldX1}if(y1>y2){var oldY1=y1;y1=y2,y2=oldY1}var west=[centerX-width/2-padding,centerY],east=[centerX+width/2+padding,centerY],north=[centerX,centerY-height/2-padding],south=[centerX,centerY+height/2+padding];return x2<west[0]?!1:x1>east[0]?!1:y1>south[1]?!1:y2<north[1]?!1:x1<=east[0]&&east[0]<=x2&&y1<=east[1]&&east[1]<=y2?!0:x1<=west[0]&&west[0]<=x2&&y1<=west[1]&&west[1]<=y2?!0:x1<=north[0]&&north[0]<=x2&&y1<=north[1]&&north[1]<=y2?!0:x1<=south[0]&&south[0]<=x2&&y1<=south[1]&&south[1]<=y2?!0:(x1=(x1-centerX)/(width/2+padding),x2=(x2-centerX)/(width/2+padding),y1=(y1-centerY)/(height/2+padding),y2=(y2-centerY)/(height/2+padding),1>=x1*x1+y1*y1?!0:1>=x2*x2+y1*y1?!0:1>=x2*x2+y2*y2?!0:1>=x1*x1+y2*y2?!0:!1)},$$.math.boxIntersectPolygon=function(x1,y1,x2,y2,basePoints,width,height,centerX,centerY,direction,padding){if(x1>x2){var oldX1=x1;x1=x2,x2=oldX1}if(y1>y2){var oldY1=y1;y1=y2,y2=oldY1}var transformedPoints=new Array(basePoints.length),angle=Math.asin(direction[1]/Math.sqrt(direction[0]*direction[0]+direction[1]*direction[1]));direction[0]<0?angle+=Math.PI/2:angle=-angle-Math.PI/2;for(var cos=Math.cos(-angle),sin=Math.sin(-angle),i=0;i<transformedPoints.length/2;i++)transformedPoints[2*i]=width/2*(basePoints[2*i]*cos-basePoints[2*i+1]*sin),transformedPoints[2*i+1]=height/2*(basePoints[2*i+1]*cos+basePoints[2*i]*sin),transformedPoints[2*i]+=centerX,transformedPoints[2*i+1]+=centerY;for(var minTransformedX=transformedPoints[0],maxTransformedX=transformedPoints[0],minTransformedY=transformedPoints[1],maxTransformedY=transformedPoints[1],i=1;i<transformedPoints.length/2;i++)transformedPoints[2*i]>maxTransformedX&&(maxTransformedX=transformedPoints[2*i]),transformedPoints[2*i]<minTransformedX&&(minTransformedX=transformedPoints[2*i]),transformedPoints[2*i+1]>maxTransformedY&&(maxTransformedY=transformedPoints[2*i+1]),transformedPoints[2*i+1]<minTransformedY&&(minTransformedY=transformedPoints[2*i+1]);if(minTransformedX-padding>x2)return!1;if(x1>maxTransformedX+padding)return!1;if(minTransformedY-padding>y2)return!1;if(y1>maxTransformedY+padding)return!1;var points;if(padding>0){var expandedLineSet=$$.math.expandPolygon(transformedPoints,-padding);points=$$.math.joinLines(expandedLineSet)}else points=transformedPoints;for(var i=0;i<transformedPoints.length/2;i++)if(x1<=transformedPoints[2*i]&&transformedPoints[2*i]<=x2&&y1<=transformedPoints[2*i+1]&&transformedPoints[2*i+1]<=y2)return!0;for(var i=0;i<points.length/2;i++){var nextX,nextY,currentX=points[2*i],currentY=points[2*i+1];if(i<points.length/2-1?(nextX=points[2*(i+1)],nextY=points[2*(i+1)+1]):(nextX=points[0],nextY=points[1]),$$.math.finiteLinesIntersect(currentX,currentY,nextX,nextY,x1,y1,x2,y1,!1).length>0)return!0;if($$.math.finiteLinesIntersect(currentX,currentY,nextX,nextY,x1,y2,x2,y2,!1).length>0)return!0;if($$.math.finiteLinesIntersect(currentX,currentY,nextX,nextY,x1,y1,x1,y2,!1).length>0)return!0;if($$.math.finiteLinesIntersect(currentX,currentY,nextX,nextY,x2,y1,x2,y2,!1).length>0)return!0}return!1},$$.math.polygonIntersectLine=function(x,y,basePoints,centerX,centerY,width,height,padding){for(var intersection,intersections=[],transformedPoints=new Array(basePoints.length),i=0;i<transformedPoints.length/2;i++)transformedPoints[2*i]=basePoints[2*i]*width+centerX,transformedPoints[2*i+1]=basePoints[2*i+1]*height+centerY;var points;if(padding>0){var expandedLineSet=$$.math.expandPolygon(transformedPoints,-padding);points=$$.math.joinLines(expandedLineSet)}else points=transformedPoints;for(var currentX,currentY,nextX,nextY,i=0;i<points.length/2;i++)currentX=points[2*i],currentY=points[2*i+1],i<points.length/2-1?(nextX=points[2*(i+1)],nextY=points[2*(i+1)+1]):(nextX=points[0],nextY=points[1]),intersection=this.finiteLinesIntersect(x,y,centerX,centerY,currentX,currentY,nextX,nextY),0!==intersection.length&&intersections.push(intersection[0],intersection[1]);return intersections},$$.math.shortenIntersection=function(intersection,offset,amount){var disp=[intersection[0]-offset[0],intersection[1]-offset[1]],length=Math.sqrt(disp[0]*disp[0]+disp[1]*disp[1]),lenRatio=(length-amount)/length;return 0>lenRatio&&(lenRatio=1e-5),[offset[0]+lenRatio*disp[0],offset[1]+lenRatio*disp[1]]},$$.math.generateUnitNgonPointsFitToSquare=function(sides,rotationRadians){var points=$$.math.generateUnitNgonPoints(sides,rotationRadians);return points=$$.math.fitPolygonToSquare(points)},$$.math.fitPolygonToSquare=function(points){for(var x,y,sides=points.length/2,minX=1/0,minY=1/0,maxX=-(1/0),maxY=-(1/0),i=0;sides>i;i++)x=points[2*i],y=points[2*i+1],minX=Math.min(minX,x),maxX=Math.max(maxX,x),minY=Math.min(minY,y),maxY=Math.max(maxY,y);for(var sx=2/(maxX-minX),sy=2/(maxY-minY),i=0;sides>i;i++)x=points[2*i]=points[2*i]*sx,y=points[2*i+1]=points[2*i+1]*sy,minX=Math.min(minX,x),maxX=Math.max(maxX,x),minY=Math.min(minY,y),maxY=Math.max(maxY,y);if(-1>minY)for(var i=0;sides>i;i++)y=points[2*i+1]=points[2*i+1]+(-1-minY);return points},$$.math.generateUnitNgonPoints=function(sides,rotationRadians){var increment=1/sides*2*Math.PI,startAngle=sides%2===0?Math.PI/2+increment/2:Math.PI/2;startAngle+=rotationRadians;for(var currentAngle,x,y,points=new Array(2*sides),i=0;sides>i;i++)currentAngle=i*increment+startAngle,x=points[2*i]=Math.cos(currentAngle),y=points[2*i+1]=Math.sin(-currentAngle);return points},$$.math.getRoundRectangleRadius=function(width,height){return Math.min(width/4,height/4,8)}}(cytoscape),function($$){"use strict";function setExtension(type,name,registrant){var impl={};switch(impl[name]=registrant,type){case"core":case"collection":$$.fn[type](impl)}if("layout"===type){for(var layoutProto=registrant.prototype,optLayoutFns=[],i=0;i<optLayoutFns.length;i++){var fnName=optLayoutFns[i];layoutProto[fnName]=layoutProto[fnName]||function(){return this}}layoutProto.start&&!layoutProto.run?layoutProto.run=function(){return this.start(),this}:!layoutProto.start&&layoutProto.run&&(layoutProto.start=function(){return this.run(),this}),layoutProto.stop||(layoutProto.stop=function(){var opts=this.options;return opts&&opts.animate&&opts.eles.stop(),this}),layoutProto.on=$$.define.on({layout:!0}),layoutProto.one=$$.define.on({layout:!0,unbindSelfOnTrigger:!0}),layoutProto.once=$$.define.on({layout:!0,unbindAllBindersOnTrigger:!0}),layoutProto.off=$$.define.off({layout:!0}),layoutProto.trigger=$$.define.trigger({layout:!0}),$$.define.eventAliasesOn(layoutProto)}return $$.util.setMap({map:extensions,keys:[type,name],value:registrant})}function getExtension(type,name){return $$.util.getMap({map:extensions,keys:[type,name]})}function setModule(type,name,moduleType,moduleName,registrant){return $$.util.setMap({map:modules,keys:[type,name,moduleType,moduleName],value:registrant})}function getModule(type,name,moduleType,moduleName){return $$.util.getMap({map:modules,keys:[type,name,moduleType,moduleName]})}var extensions={};$$.extensions=extensions;var modules={};$$.modules=modules,$$.extension=function(){return 2==arguments.length?getExtension.apply(this,arguments):3==arguments.length?setExtension.apply(this,arguments):4==arguments.length?getModule.apply(this,arguments):5==arguments.length?setModule.apply(this,arguments):void $$.util.error("Invalid extension access syntax")}}(cytoscape),function($,$$){"use strict";if($){var cyReg=function($ele){var d=$ele[0]._cyreg=$ele[0]._cyreg||{};return d};$.fn.cytoscape=function(opts){var $this=$(this);if("get"===opts)return cyReg($this).cy;if($$.is.fn(opts)){var ready=opts,cy=cyReg($this).cy;if(cy&&cy.isReady())cy.trigger("ready",[],ready);else{var data=cyReg($this),readies=data.readies=data.readies||[];readies.push(ready)}}else if($$.is.plainObject(opts))return $this.each(function(){var options=$.extend({},opts,{container:$(this)[0]});cytoscape(options)})},$.cytoscape=cytoscape,null==$.fn.cy&&null==$.cy&&($.fn.cy=$.fn.cytoscape,$.cy=$.cytoscape)}}("undefined"!=typeof jQuery?jQuery:null,cytoscape),function($$){"use strict";function returnFalse(){return!1}function returnTrue(){return!0}$$.Event=function(src,props){return this instanceof $$.Event?(src&&src.type?(this.originalEvent=src,this.type=src.type,this.isDefaultPrevented=src.defaultPrevented?returnTrue:returnFalse):this.type=src,props&&(this.type=void 0!==props.type?props.type:this.type,this.cy=props.cy,this.cyTarget=props.cyTarget,this.cyPosition=props.cyPosition,this.cyRenderedPosition=props.cyRenderedPosition,this.namespace=props.namespace,this.layout=props.layout,this.data=props.data,this.message=props.message),void(this.timeStamp=src&&src.timeStamp||+new Date)):new $$.Event(src,props)},$$.Event.prototype={preventDefault:function(){this.isDefaultPrevented=returnTrue;var e=this.originalEvent;e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){this.isPropagationStopped=returnTrue;var e=this.originalEvent;e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue,this.stopPropagation()},isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse}}(cytoscape),function($$){"use strict";$$.define={data:function(params){var defaults={field:"data",bindingEvent:"data",allowBinding:!1,allowSetting:!1,allowGetting:!1,settingEvent:"data",settingTriggersEvent:!1,triggerFnName:"trigger",immutableKeys:{},updateStyle:!1,onSet:function(self){},canSet:function(self){return!0}};return params=$$.util.extend({},defaults,params),function(name,value){var p=params,self=this,selfIsArrayLike=void 0!==self.length,all=selfIsArrayLike?self:[self],single=selfIsArrayLike?self[0]:self;if($$.is.string(name)){if(p.allowGetting&&void 0===value){var ret;return single&&(ret=single._private[p.field][name]),ret}if(p.allowSetting&&void 0!==value){var valid=!p.immutableKeys[name];if(valid){for(var i=0,l=all.length;l>i;i++)p.canSet(all[i])&&(all[i]._private[p.field][name]=value);p.updateStyle&&self.updateStyle(),p.onSet(self),p.settingTriggersEvent&&self[p.triggerFnName](p.settingEvent)}}}else if(p.allowSetting&&$$.is.plainObject(name)){var k,v,obj=name;for(k in obj){v=obj[k];var valid=!p.immutableKeys[k];if(valid)for(var i=0,l=all.length;l>i;i++)p.canSet(all[i])&&(all[i]._private[p.field][k]=v)}p.updateStyle&&self.updateStyle(),p.onSet(self),p.settingTriggersEvent&&self[p.triggerFnName](p.settingEvent)}else if(p.allowBinding&&$$.is.fn(name)){var fn=name;self.bind(p.bindingEvent,fn)}else if(p.allowGetting&&void 0===name){var ret;return single&&(ret=single._private[p.field]),ret}return self}},removeData:function(params){var defaults={field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!1,immutableKeys:{}};return params=$$.util.extend({},defaults,params),function(names){var p=params,self=this,selfIsArrayLike=void 0!==self.length,all=selfIsArrayLike?self:[self];if($$.is.string(names)){for(var keys=names.split(/\s+/),l=keys.length,i=0;l>i;i++){var key=keys[i];if(!$$.is.emptyString(key)){var valid=!p.immutableKeys[key];if(valid)for(var i_a=0,l_a=all.length;l_a>i_a;i_a++)all[i_a]._private[p.field][key]=void 0}}p.triggerEvent&&self[p.triggerFnName](p.event)}else if(void 0===names){for(var i_a=0,l_a=all.length;l_a>i_a;i_a++){var _privateFields=all[i_a]._private[p.field];for(var key in _privateFields){var validKeyToDelete=!p.immutableKeys[key];validKeyToDelete&&(_privateFields[key]=void 0)}}p.triggerEvent&&self[p.triggerFnName](p.event)}return self}},event:{regex:/(\w+)(\.\w+)?/,optionalTypeRegex:/(\w+)?(\.\w+)?/,falseCallback:function(){return!1}},on:function(params){var defaults={unbindSelfOnTrigger:!1,unbindAllBindersOnTrigger:!1};return params=$$.util.extend({},defaults,params),function(events,selector,data,callback){var self=this,selfIsArrayLike=void 0!==self.length,all=selfIsArrayLike?self:[self],eventsIsString=$$.is.string(events),p=params;if($$.is.plainObject(selector)?(callback=data,data=selector,selector=void 0):($$.is.fn(selector)||selector===!1)&&(callback=selector,data=void 0,selector=void 0),($$.is.fn(data)||data===!1)&&(callback=data,data=void 0),!$$.is.fn(callback)&&callback!==!1&&eventsIsString)return self;if(eventsIsString){var map={};map[events]=callback,events=map}for(var evts in events)if(callback=events[evts],callback===!1&&(callback=$$.define.event.falseCallback),$$.is.fn(callback)){evts=evts.split(/\s+/);for(var i=0;i<evts.length;i++){var evt=evts[i];if(!$$.is.emptyString(evt)){var match=evt.match($$.define.event.regex);if(match)for(var type=match[1],namespace=match[2]?match[2]:void 0,listener={callback:callback,data:data,delegated:selector?!0:!1,selector:selector,selObj:new $$.Selector(selector),type:type,namespace:namespace,unbindSelfOnTrigger:p.unbindSelfOnTrigger,unbindAllBindersOnTrigger:p.unbindAllBindersOnTrigger,binders:all},j=0;j<all.length;j++){var _p=all[j]._private;_p.listeners=_p.listeners||[],_p.listeners.push(listener)}}}}return self}},eventAliasesOn:function(proto){var p=proto;p.addListener=p.listen=p.bind=p.on,p.removeListener=p.unlisten=p.unbind=p.off,p.emit=p.trigger,p.pon=p.promiseOn=function(events,selector){var self=this,args=Array.prototype.slice.call(arguments,0);return new $$.Promise(function(resolve,reject){var callback=function(e){self.off.apply(self,offArgs),resolve(e)},onArgs=args.concat([callback]),offArgs=onArgs.concat([]);self.on.apply(self,onArgs)})}},off:function(params){var defaults={};return params=$$.util.extend({},defaults,params),function(events,selector,callback){var self=this,selfIsArrayLike=void 0!==self.length,all=selfIsArrayLike?self:[self],eventsIsString=$$.is.string(events);if(0===arguments.length){for(var i=0;i<all.length;i++)all[i]._private.listeners=[];return self}if(($$.is.fn(selector)||selector===!1)&&(callback=selector,selector=void 0),eventsIsString){var map={};map[events]=callback,events=map}for(var evts in events){callback=events[evts],callback===!1&&(callback=$$.define.event.falseCallback),evts=evts.split(/\s+/);for(var h=0;h<evts.length;h++){var evt=evts[h];if(!$$.is.emptyString(evt)){var match=evt.match($$.define.event.optionalTypeRegex);if(match)for(var type=match[1]?match[1]:void 0,namespace=match[2]?match[2]:void 0,i=0;i<all.length;i++)for(var listeners=all[i]._private.listeners=all[i]._private.listeners||[],j=0;j<listeners.length;j++){var listener=listeners[j],nsMatches=!namespace||namespace===listener.namespace,typeMatches=!type||listener.type===type,cbMatches=!callback||callback===listener.callback,listenerMatches=nsMatches&&typeMatches&&cbMatches;listenerMatches&&(listeners.splice(j,1),j--)}}}}return self}},trigger:function(params){var defaults={};return params=$$.util.extend({},defaults,params),function(events,extraParams,fnToTrigger){var self=this,selfIsArrayLike=void 0!==self.length,all=selfIsArrayLike?self:[self],eventsIsString=$$.is.string(events),eventsIsObject=$$.is.plainObject(events),eventsIsEvent=$$.is.event(events),cy=this._private.cy||($$.is.core(this)?this:null),hasCompounds=cy?cy.hasCompoundNodes():!1;if(eventsIsString){var evts=events.split(/\s+/);events=[];for(var i=0;i<evts.length;i++){var evt=evts[i];if(!$$.is.emptyString(evt)){var match=evt.match($$.define.event.regex),type=match[1],namespace=match[2]?match[2]:void 0;events.push({type:type,namespace:namespace})}}}else if(eventsIsObject){var eventArgObj=events;events=[eventArgObj]}extraParams?$$.is.array(extraParams)||(extraParams=[extraParams]):extraParams=[];for(var i=0;i<events.length;i++)for(var evtObj=events[i],j=0;j<all.length;j++){var evt,triggerer=all[j],listeners=triggerer._private.listeners=triggerer._private.listeners||[],triggererIsElement=$$.is.element(triggerer),bubbleUp=triggererIsElement||params.layout;if(eventsIsEvent?(evt=evtObj,evt.cyTarget=evt.cyTarget||triggerer,evt.cy=evt.cy||cy):evt=new $$.Event(evtObj,{cyTarget:triggerer,cy:cy,namespace:evtObj.namespace}),evtObj.layout&&(evt.layout=evtObj.layout),params.layout&&(evt.layout=triggerer),evt.cyPosition){var pos=evt.cyPosition,zoom=cy.zoom(),pan=cy.pan();evt.cyRenderedPosition={x:pos.x*zoom+pan.x,y:pos.y*zoom+pan.y}}fnToTrigger&&(listeners=[{namespace:evt.namespace,type:evt.type,callback:fnToTrigger}]);for(var k=0;k<listeners.length;k++){var lis=listeners[k],nsMatches=!lis.namespace||lis.namespace===evt.namespace,typeMatches=lis.type===evt.type,targetMatches=lis.delegated?triggerer!==evt.cyTarget&&$$.is.element(evt.cyTarget)&&lis.selObj.matches(evt.cyTarget):!0,listenerMatches=nsMatches&&typeMatches&&targetMatches;if(listenerMatches){var args=[evt];if(args=args.concat(extraParams),evt.data=lis.data?lis.data:void 0,(lis.unbindSelfOnTrigger||lis.unbindAllBindersOnTrigger)&&(listeners.splice(k,1),k--),lis.unbindAllBindersOnTrigger)for(var binders=lis.binders,l=0;l<binders.length;l++){var binder=binders[l];if(binder&&binder!==triggerer)for(var binderListeners=binder._private.listeners,m=0;m<binderListeners.length;m++){var binderListener=binderListeners[m];binderListener===lis&&(binderListeners.splice(m,1),m--)}}var context=lis.delegated?evt.cyTarget:triggerer,ret=lis.callback.apply(context,args);(ret===!1||evt.isPropagationStopped())&&(bubbleUp=!1,ret===!1&&(evt.stopPropagation(),evt.preventDefault()))}}if(bubbleUp){var parent=hasCompounds?triggerer._private.parent:null,hasParent=null!=parent&&0!==parent.length;hasParent?(parent=parent[0],parent.trigger(evt)):cy.trigger(evt)}}return self}},animated:function(fnParams){var defaults={};return fnParams=$$.util.extend({},defaults,fnParams),function(){var self=this,selfIsArrayLike=void 0!==self.length,all=selfIsArrayLike?self:[self],cy=this._private.cy||this;if(!cy.styleEnabled())return!1;var ele=all[0];return ele?ele._private.animation.current.length>0:void 0}},clearQueue:function(fnParams){var defaults={};return fnParams=$$.util.extend({},defaults,fnParams),function(){var self=this,selfIsArrayLike=void 0!==self.length,all=selfIsArrayLike?self:[self],cy=this._private.cy||this;if(!cy.styleEnabled())return this;for(var i=0;i<all.length;i++){var ele=all[i];ele._private.animation.queue=[]}return this}},delay:function(fnParams){var defaults={};return fnParams=$$.util.extend({},defaults,fnParams),function(time,complete){var cy=this._private.cy||this;return cy.styleEnabled()?(this.animate({delay:time},{duration:time,complete:complete}),this):this}},animate:function(fnParams){var defaults={};return fnParams=$$.util.extend({},defaults,fnParams),function(properties,params){var self=this,selfIsArrayLike=void 0!==self.length,all=selfIsArrayLike?self:[self],cy=this._private.cy||this,isCore=!selfIsArrayLike,isEles=!isCore;if(!cy.styleEnabled())return this;var q,callTime=+new Date,style=cy.style();switch(void 0===params&&(params={}),void 0===params.duration&&(params.duration=400),params.duration){case"slow":params.duration=600;break;case"fast":params.duration=200}var propertiesEmpty=!0;if(properties)for(var i in properties){propertiesEmpty=!1;break}if(propertiesEmpty)return this;if(properties.css&&isEles&&(properties.css=style.getValueStyle(properties.css,{array:!0})),properties.renderedPosition&&isEles){var rpos=properties.renderedPosition,pan=cy.pan(),zoom=cy.zoom();properties.position={x:(rpos.x-pan.x)/zoom,y:(rpos.y-pan.y)/zoom}}if(properties.panBy&&isCore){var panBy=properties.panBy,cyPan=cy.pan();properties.pan={x:cyPan.x+panBy.x,y:cyPan.y+panBy.y}}var center=properties.center||properties.centre;if(center&&isCore){var centerPan=cy.getCenterPan(center.eles,properties.zoom);centerPan&&(properties.pan=centerPan)}if(properties.fit&&isCore){var fit=properties.fit,fitVp=cy.getFitViewport(fit.eles||fit.boundingBox,fit.padding);fitVp&&(properties.pan=fitVp.pan,properties.zoom=fitVp.zoom)}for(var i=0;i<all.length;i++){var ele=all[i];q=ele.animated()&&(void 0===params.queue||params.queue)?ele._private.animation.queue:ele._private.animation.current,q.push({properties:properties,duration:params.duration,params:params,callTime:callTime})}return isEles&&cy.addToAnimationPool(this),this}},stop:function(fnParams){var defaults={};return fnParams=$$.util.extend({},defaults,fnParams),function(clearQueue,jumpToEnd){var self=this,selfIsArrayLike=void 0!==self.length,all=selfIsArrayLike?self:[self],cy=this._private.cy||this;if(!cy.styleEnabled())return this;for(var i=0;i<all.length;i++){for(var ele=all[i],anis=ele._private.animation.current,j=0;j<anis.length;j++){var animation=anis[j];jumpToEnd&&(animation.duration=0)}clearQueue&&(ele._private.animation.queue=[]),jumpToEnd||(ele._private.animation.current=[])}return cy.notify({collection:this,type:"draw"}),this}}}}(cytoscape),function($$){"use strict";$$.fn.selector=function(map,options){for(var name in map){var fn=map[name];$$.Selector.prototype[name]=fn}},$$.Selector=function(onlyThisGroup,selector){if(!(this instanceof $$.Selector))return new $$.Selector(onlyThisGroup,selector);void 0===selector&&void 0!==onlyThisGroup&&(selector=onlyThisGroup,onlyThisGroup=void 0);var self=this;if(self._private={selectorText:null,invalid:!0},!selector||$$.is.string(selector)&&selector.match(/^\s*$/))null==onlyThisGroup?self.length=0:(self[0]=newQuery(),self[0].group=onlyThisGroup,self.length=1);else if($$.is.element(selector)){var collection=new $$.Collection(self.cy(),[selector]);self[0]=newQuery(),self[0].collection=collection,self.length=1}else if($$.is.collection(selector))self[0]=newQuery(),self[0].collection=selector,self.length=1;else if($$.is.fn(selector))self[0]=newQuery(),self[0].filter=selector,self.length=1;else{if(!$$.is.string(selector))return void $$.util.error("A selector must be created from a string; found "+selector);var currentSubject=null,newQuery=function(){return{classes:[],colonSelectors:[],data:[],group:null,ids:[],meta:[],collection:null,filter:null,parent:null,ancestor:null,subject:null,child:null,descendant:null}},tokens={metaChar:"[\\!\\\"\\#\\$\\%\\&\\'\\(\\)\\*\\+\\,\\.\\/\\:\\;\\<\\=\\>\\?\\@\\[\\]\\^\\`\\{\\|\\}\\~]",comparatorOp:"=|\\!=|>|>=|<|<=|\\$=|\\^=|\\*=",boolOp:"\\?|\\!|\\^",string:'"(?:\\\\"|[^"])+"|'+"'(?:\\\\'|[^'])+'",number:$$.util.regex.number,meta:"degree|indegree|outdegree",separator:"\\s*,\\s*",descendant:"\\s+",child:"\\s+>\\s+",subject:"\\$"};tokens.variable="(?:[\\w-]|(?:\\\\"+tokens.metaChar+"))+",tokens.value=tokens.string+"|"+tokens.number,tokens.className=tokens.variable,tokens.id=tokens.variable;for(var cleanMetaChars=function(str){return str.replace(new RegExp("\\\\("+tokens.metaChar+")","g"),function(match,$1,offset,original){return $1})},ops=tokens.comparatorOp.split("|"),i=0;i<ops.length;i++){var op=ops[i];tokens.comparatorOp+="|@"+op}for(var ops=tokens.comparatorOp.split("|"),i=0;i<ops.length;i++){var op=ops[i];op.indexOf("!")>=0||"="!==op&&(tokens.comparatorOp+="|\\!"+op)}var exprs={group:{query:!0,regex:"(node|edge|\\*)",populate:function(group){this.group="*"==group?group:group+"s"}},state:{query:!0,regex:"(:selected|:unselected|:locked|:unlocked|:visible|:hidden|:transparent|:grabbed|:free|:removed|:inside|:grabbable|:ungrabbable|:animated|:unanimated|:selectable|:unselectable|:orphan|:nonorphan|:parent|:child|:loop|:simple|:active|:inactive|:touch|:backgrounding|:nonbackgrounding)",populate:function(state){this.colonSelectors.push(state)}},id:{query:!0,regex:"\\#("+tokens.id+")",populate:function(id){this.ids.push(cleanMetaChars(id))}},className:{query:!0,regex:"\\.("+tokens.className+")",populate:function(className){this.classes.push(cleanMetaChars(className))}},dataExists:{query:!0,regex:"\\[\\s*("+tokens.variable+")\\s*\\]",populate:function(variable){this.data.push({field:cleanMetaChars(variable)})}},dataCompare:{query:!0,regex:"\\[\\s*("+tokens.variable+")\\s*("+tokens.comparatorOp+")\\s*("+tokens.value+")\\s*\\]",populate:function(variable,comparatorOp,value){var valueIsString=null!=new RegExp("^"+tokens.string+"$").exec(value);value=valueIsString?value.substring(1,value.length-1):parseFloat(value),this.data.push({field:cleanMetaChars(variable),operator:comparatorOp,value:value})}},dataBool:{query:!0,regex:"\\[\\s*("+tokens.boolOp+")\\s*("+tokens.variable+")\\s*\\]",populate:function(boolOp,variable){this.data.push({field:cleanMetaChars(variable),operator:boolOp})}},metaCompare:{query:!0,regex:"\\[\\[\\s*("+tokens.meta+")\\s*("+tokens.comparatorOp+")\\s*("+tokens.number+")\\s*\\]\\]",populate:function(meta,comparatorOp,number){this.meta.push({field:cleanMetaChars(meta),operator:comparatorOp,value:parseFloat(number)})}},nextQuery:{separator:!0,regex:tokens.separator,populate:function(){self[++i]=newQuery(),currentSubject=null}},child:{separator:!0,regex:tokens.child,populate:function(){var childQuery=newQuery();childQuery.parent=this,childQuery.subject=currentSubject,self[i]=childQuery}},descendant:{separator:!0,regex:tokens.descendant,populate:function(){var descendantQuery=newQuery();descendantQuery.ancestor=this,descendantQuery.subject=currentSubject,self[i]=descendantQuery}},subject:{modifier:!0,regex:tokens.subject,populate:function(){return null!=currentSubject&&this.subject!=this?($$.util.error("Redefinition of subject in selector `"+selector+"`"),!1):(currentSubject=this,void(this.subject=this))}}},j=0;for(var name in exprs)exprs[j]=exprs[name],exprs[j].name=name,j++;exprs.length=j,self._private.selectorText=selector;var remaining=selector,i=0,consumeExpr=function(expectation){for(var expr,match,name,j=0;j<exprs.length;j++){var e=exprs[j],n=e.name;if(!$$.is.fn(expectation)||expectation(n,e)){var m=remaining.match(new RegExp("^"+e.regex));if(null!=m){match=m,expr=e,name=n;var consumed=m[0];remaining=remaining.substring(consumed.length);break}}}return{expr:expr,match:match,name:name}},consumeWhitespace=function(){var match=remaining.match(/^\s+/);if(match){var consumed=match[0];remaining=remaining.substring(consumed.length)}};for(self[0]=newQuery(),consumeWhitespace();;){var check=consumeExpr();if(null==check.expr)return void $$.util.error("The selector `"+selector+"`is invalid");for(var args=[],j=1;j<check.match.length;j++)args.push(check.match[j]);var ret=check.expr.populate.apply(self[i],args);if(ret===!1)return;if(remaining.match(/^\s*$/))break}for(self.length=i+1,j=0;j<self.length;j++){var query=self[j];if(null!=query.subject){for(;query.subject!=query;)if(null!=query.parent){var parent=query.parent,child=query;child.parent=null,parent.child=child,query=parent}else{if(null==query.ancestor){$$.util.error("When adjusting references for the selector `"+query+"`, neither parent nor ancestor was found");break}var ancestor=query.ancestor,descendant=query;descendant.ancestor=null,ancestor.descendant=descendant,query=ancestor}self[j]=query.subject}}if(null!=onlyThisGroup)for(var j=0;j<self.length;j++){if(null!=self[j].group&&self[j].group!=onlyThisGroup)return void $$.util.error("Group `"+self[j].group+"` conflicts with implicit group `"+onlyThisGroup+"` in selector `"+selector+"`");self[j].group=onlyThisGroup}}self._private.invalid=!1},$$.selfn=$$.Selector.prototype,$$.selfn.size=function(){return this.length},$$.selfn.eq=function(i){return this[i]},$$.selfn.find=function(){};var queryMatches=function(query,element){if(null!=query.group&&"*"!=query.group&&query.group!=element._private.group)return!1;for(var cy=element.cy(),allColonSelectorsMatch=!0,k=0;k<query.colonSelectors.length;k++){var sel=query.colonSelectors[k];switch(sel){case":selected":allColonSelectorsMatch=element.selected();break;case":unselected":allColonSelectorsMatch=!element.selected();break;case":selectable":allColonSelectorsMatch=element.selectable();break;case":unselectable":allColonSelectorsMatch=!element.selectable();break;case":locked":allColonSelectorsMatch=element.locked();break;case":unlocked":allColonSelectorsMatch=!element.locked();break;case":visible":allColonSelectorsMatch=element.visible();break;case":hidden":allColonSelectorsMatch=!element.visible();break;case":transparent":allColonSelectorsMatch=element.transparent();break;case":grabbed":allColonSelectorsMatch=element.grabbed();break;case":free":allColonSelectorsMatch=!element.grabbed();break;case":removed":allColonSelectorsMatch=element.removed();break;case":inside":allColonSelectorsMatch=!element.removed();break;case":grabbable":allColonSelectorsMatch=element.grabbable();break;case":ungrabbable":allColonSelectorsMatch=!element.grabbable();break;case":animated":allColonSelectorsMatch=element.animated();break;case":unanimated":allColonSelectorsMatch=!element.animated();break;case":parent":allColonSelectorsMatch=element.isNode()&&element.children().nonempty();break;case":child":case":nonorphan":allColonSelectorsMatch=element.isNode()&&element.parent().nonempty();break;case":orphan":allColonSelectorsMatch=element.isNode()&&element.parent().empty();break;case":loop":allColonSelectorsMatch=element.isEdge()&&element.data("source")===element.data("target");break;case":simple":allColonSelectorsMatch=element.isEdge()&&element.data("source")!==element.data("target");break;case":active":allColonSelectorsMatch=element.active();break;case":inactive":allColonSelectorsMatch=!element.active();break;case":touch":allColonSelectorsMatch=$$.is.touch();break;case":backgrounding":allColonSelectorsMatch=element.backgrounding();break;case":nonbackgrounding":allColonSelectorsMatch=!element.backgrounding()}if(!allColonSelectorsMatch)break}if(!allColonSelectorsMatch)return!1;for(var allIdsMatch=!0,k=0;k<query.ids.length;k++){var id=query.ids[k],actualId=element._private.data.id;if(allIdsMatch=allIdsMatch&&id==actualId,!allIdsMatch)break}if(!allIdsMatch)return!1;for(var allClassesMatch=!0,k=0;k<query.classes.length;k++){var cls=query.classes[k];if(allClassesMatch=allClassesMatch&&element.hasClass(cls),!allClassesMatch)break}if(!allClassesMatch)return!1;

var operandsMatch=function(params){for(var allDataMatches=!0,k=0;k<query[params.name].length;k++){var matches,data=query[params.name][k],operator=data.operator,value=data.value,field=data.field;if(null!=operator&&null!=value){var fieldVal=params.fieldValue(field),fieldStr=$$.is.string(fieldVal)||$$.is.number(fieldVal)?""+fieldVal:"",valStr=""+value,caseInsensitive=!1;operator.indexOf("@")>=0&&(fieldStr=fieldStr.toLowerCase(),valStr=valStr.toLowerCase(),operator=operator.replace("@",""),caseInsensitive=!0);var notExpr=!1,handledNotExpr=!1;switch(operator.indexOf("!")>=0&&(operator=operator.replace("!",""),notExpr=!0),caseInsensitive&&(value=valStr.toLowerCase(),fieldVal=fieldStr.toLowerCase()),operator){case"*=":matches=fieldStr.search(valStr)>=0;break;case"$=":matches=null!=new RegExp(valStr+"$").exec(fieldStr);break;case"^=":matches=null!=new RegExp("^"+valStr).exec(fieldStr);break;case"=":matches=fieldVal===value;break;case"!=":matches=fieldVal!==value;break;case">":matches=notExpr?value>=fieldVal:fieldVal>value,handledNotExpr=!0;break;case">=":matches=notExpr?value>fieldVal:fieldVal>=value,handledNotExpr=!0;break;case"<":matches=notExpr?fieldVal>=value:value>fieldVal,handledNotExpr=!0;break;case"<=":matches=notExpr?fieldVal>value:value>=fieldVal,handledNotExpr=!0;break;default:matches=!1}}else if(null!=operator)switch(operator){case"?":matches=params.fieldTruthy(field);break;case"!":matches=!params.fieldTruthy(field);break;case"^":matches=params.fieldUndefined(field)}else matches=!params.fieldUndefined(field);if(notExpr&&!handledNotExpr&&(matches=!matches,handledNotExpr=!0),!matches){allDataMatches=!1;break}}return allDataMatches},allDataMatches=operandsMatch({name:"data",fieldValue:function(field){return element._private.data[field]},fieldRef:function(field){return"element._private.data."+field},fieldUndefined:function(field){return void 0===element._private.data[field]},fieldTruthy:function(field){return element._private.data[field]?!0:!1}});if(!allDataMatches)return!1;var allMetaMatches=operandsMatch({name:"meta",fieldValue:function(field){return element[field]()},fieldRef:function(field){return"element."+field+"()"},fieldUndefined:function(field){return null==element[field]()},fieldTruthy:function(field){return element[field]()?!0:!1}});if(!allMetaMatches)return!1;if(null!=query.collection){var matchesAny=null!=query.collection._private.ids[element.id()];if(!matchesAny)return!1}if(null!=query.filter&&0===element.collection().filter(query.filter).size())return!1;var confirmRelations=function(query,elements){if(null!=query){var matches=!1;if(!cy.hasCompoundNodes())return!1;elements=elements();for(var i=0;i<elements.length;i++)if(queryMatches(query,elements[i])){matches=!0;break}return matches}return!0};return confirmRelations(query.parent,function(){return element.parent()})&&confirmRelations(query.ancestor,function(){return element.parents()})&&confirmRelations(query.child,function(){return element.children()})&&confirmRelations(query.descendant,function(){return element.descendants()})?!0:!1};$$.selfn.filter=function(collection){var self=this,cy=collection.cy();if(self._private.invalid)return new $$.Collection(cy);var selectorFunction=function(i,element){for(var j=0;j<self.length;j++){var query=self[j];if(queryMatches(query,element))return!0}return!1};null==self._private.selectorText&&(selectorFunction=function(){return!0});var filteredCollection=collection.filter(selectorFunction);return filteredCollection},$$.selfn.matches=function(ele){var self=this;if(self._private.invalid)return!1;for(var j=0;j<self.length;j++){var query=self[j];if(queryMatches(query,ele))return!0}return!1},$$.selfn.toString=$$.selfn.selector=function(){for(var str="",clean=function(obj,isValue){return $$.is.string(obj)?isValue?'"'+obj+'"':obj:""},queryToString=function(query){var str="";query.subject===query&&(str+="$");var group=clean(query.group);str+=group.substring(0,group.length-1);for(var j=0;j<query.data.length;j++){var data=query.data[j];str+=data.value?"["+data.field+clean(data.operator)+clean(data.value,!0)+"]":"["+clean(data.operator)+data.field+"]"}for(var j=0;j<query.meta.length;j++){var meta=query.meta[j];str+="[["+meta.field+clean(meta.operator)+clean(meta.value,!0)+"]]"}for(var j=0;j<query.colonSelectors.length;j++){var sel=query.colonSelectors[i];str+=sel}for(var j=0;j<query.ids.length;j++){var sel="#"+query.ids[i];str+=sel}for(var j=0;j<query.classes.length;j++){var sel="."+query.classes[i];str+=sel}return null!=query.parent&&(str=queryToString(query.parent)+" > "+str),null!=query.ancestor&&(str=queryToString(query.ancestor)+" "+str),null!=query.child&&(str+=" > "+queryToString(query.child)),null!=query.descendant&&(str+=" "+queryToString(query.descendant)),str},i=0;i<this.length;i++){var query=this[i];str+=queryToString(query),this.length>1&&i<this.length-1&&(str+=", ")}return str}}(cytoscape),function($$){"use strict";$$.Style=function(cy){return this instanceof $$.Style?$$.is.core(cy)?(this._private={cy:cy,coreStyle:{},newStyle:!0},this.length=0,void this.addDefaultStylesheet()):void $$.util.error("A style must have a core reference"):new $$.Style(cy)},$$.style=$$.Style,$$.styfn=$$.Style.prototype,$$.fn.style=function(fnMap,options){for(var fnName in fnMap){var fn=fnMap[fnName];$$.Style.prototype=fn}},function(){var number=$$.util.regex.number,rgba=$$.util.regex.rgbaNoBackRefs,hsla=$$.util.regex.hslaNoBackRefs,hex3=$$.util.regex.hex3,hex6=$$.util.regex.hex6,data=function(prefix){return"^"+prefix+"\\s*\\(\\s*([\\w\\.]+)\\s*\\)$"},mapData=function(prefix){return"^"+prefix+"\\s*\\(([\\w\\.]+)\\s*\\,\\s*("+number+")\\s*\\,\\s*("+number+")\\s*,\\s*("+number+"|\\w+|"+rgba+"|"+hsla+"|"+hex3+"|"+hex6+")\\s*\\,\\s*("+number+"|\\w+|"+rgba+"|"+hsla+"|"+hex3+"|"+hex6+")\\)$"};$$.style.types={time:{number:!0,min:0,units:"s|ms",implicitUnits:"ms"},percent:{number:!0,min:0,max:100,units:"%"},zeroOneNumber:{number:!0,min:0,max:1,unitless:!0},nOneOneNumber:{number:!0,min:-1,max:1,unitless:!0},nonNegativeInt:{number:!0,min:0,integer:!0,unitless:!0},position:{enums:["parent","origin"]},autoSize:{number:!0,min:0,enums:["auto"]},number:{number:!0},size:{number:!0,min:0},bgSize:{number:!0,min:0,allowPercent:!0},bgWH:{number:!0,min:0,allowPercent:!0,enums:["auto"]},bgPos:{number:!0,allowPercent:!0},bgRepeat:{enums:["repeat","repeat-x","repeat-y","no-repeat"]},bgFit:{enums:["none","contain","cover"]},bgClip:{enums:["none","node"]},color:{color:!0},lineStyle:{enums:["solid","dotted","dashed"]},borderStyle:{enums:["solid","dotted","dashed","double"]},curveStyle:{enums:["bezier","unbundled-bezier","haystack"]},fontFamily:{regex:'^([\\w- \\"]+(?:\\s*,\\s*[\\w- \\"]+)*)$'},fontVariant:{enums:["small-caps","normal"]},fontStyle:{enums:["italic","normal","oblique"]},fontWeight:{enums:["normal","bold","bolder","lighter","100","200","300","400","500","600","800","900",100,200,300,400,500,600,700,800,900]},textDecoration:{enums:["none","underline","overline","line-through"]},textTransform:{enums:["none","uppercase","lowercase"]},textWrap:{enums:["none","wrap"]},textBackgroundShape:{enums:["rectangle","roundrectangle"]},nodeShape:{enums:["rectangle","roundrectangle","ellipse","triangle","square","pentagon","hexagon","heptagon","octagon","star","diamond","vee","rhomboid"]},compoundIncludeLabels:{enums:["include","exclude"]},arrowShape:{enums:["tee","triangle","triangle-tee","triangle-backcurve","half-triangle-overshot","square","circle","diamond","none"]},arrowFill:{enums:["filled","hollow"]},display:{enums:["element","none"]},visibility:{enums:["hidden","visible"]},valign:{enums:["top","center","bottom"]},halign:{enums:["left","center","right"]},text:{string:!0},data:{mapping:!0,regex:data("data")},layoutData:{mapping:!0,regex:data("layoutData")},scratch:{mapping:!0,regex:data("scratch")},mapData:{mapping:!0,regex:mapData("mapData")},mapLayoutData:{mapping:!0,regex:mapData("mapLayoutData")},mapScratch:{mapping:!0,regex:mapData("mapScratch")},fn:{mapping:!0,fn:!0},url:{regex:"^url\\s*\\(\\s*([^\\s]+)\\s*\\s*\\)|none|(.+)$"},propList:{propList:!0},angle:{number:!0,units:"deg|rad"},textRotation:{enums:["none","autorotate"]}};var t=$$.style.types,props=$$.style.properties=[{name:"text-valign",type:t.valign},{name:"text-halign",type:t.halign},{name:"color",type:t.color},{name:"content",type:t.text},{name:"text-outline-color",type:t.color},{name:"text-outline-width",type:t.size},{name:"text-outline-opacity",type:t.zeroOneNumber},{name:"text-opacity",type:t.zeroOneNumber},{name:"text-background-color",type:t.color},{name:"text-background-opacity",type:t.zeroOneNumber},{name:"text-border-opacity",type:t.zeroOneNumber},{name:"text-border-color",type:t.color},{name:"text-border-width",type:t.size},{name:"text-border-style",type:t.borderStyle},{name:"text-background-shape",type:t.textBackgroundShape},{name:"text-transform",type:t.textTransform},{name:"text-wrap",type:t.textWrap},{name:"text-max-width",type:t.size},{name:"font-family",type:t.fontFamily},{name:"font-style",type:t.fontStyle},{name:"font-weight",type:t.fontWeight},{name:"font-size",type:t.size},{name:"min-zoomed-font-size",type:t.size},{name:"edge-text-rotation",type:t.textRotation},{name:"display",type:t.display},{name:"visibility",type:t.visibility},{name:"opacity",type:t.zeroOneNumber},{name:"z-index",type:t.nonNegativeInt},{name:"overlay-padding",type:t.size},{name:"overlay-color",type:t.color},{name:"overlay-opacity",type:t.zeroOneNumber},{name:"shadow-blur",type:t.size},{name:"shadow-color",type:t.color},{name:"shadow-opacity",type:t.zeroOneNumber},{name:"shadow-offset-x",type:t.number},{name:"shadow-offset-y",type:t.number},{name:"text-shadow-blur",type:t.size},{name:"text-shadow-color",type:t.color},{name:"text-shadow-opacity",type:t.zeroOneNumber},{name:"text-shadow-offset-x",type:t.number},{name:"text-shadow-offset-y",type:t.number},{name:"transition-property",type:t.propList},{name:"transition-duration",type:t.time},{name:"transition-delay",type:t.time},{name:"height",type:t.autoSize},{name:"width",type:t.autoSize},{name:"shape",type:t.nodeShape},{name:"background-color",type:t.color},{name:"background-opacity",type:t.zeroOneNumber},{name:"background-blacken",type:t.nOneOneNumber},{name:"border-color",type:t.color},{name:"border-opacity",type:t.zeroOneNumber},{name:"border-width",type:t.size},{name:"border-style",type:t.borderStyle},{name:"background-image",type:t.url},{name:"background-image-opacity",type:t.zeroOneNumber},{name:"background-position-x",type:t.bgPos},{name:"background-position-y",type:t.bgPos},{name:"background-repeat",type:t.bgRepeat},{name:"background-fit",type:t.bgFit},{name:"background-clip",type:t.bgClip},{name:"background-width",type:t.bgWH},{name:"background-height",type:t.bgWH},{name:"padding-left",type:t.size},{name:"padding-right",type:t.size},{name:"padding-top",type:t.size},{name:"padding-bottom",type:t.size},{name:"position",type:t.position},{name:"compound-sizing-wrt-labels",type:t.compoundIncludeLabels},{name:"line-style",type:t.lineStyle},{name:"line-color",type:t.color},{name:"control-point-step-size",type:t.size},{name:"control-point-distance",type:t.number},{name:"control-point-weight",type:t.zeroOneNumber},{name:"curve-style",type:t.curveStyle},{name:"haystack-radius",type:t.zeroOneNumber},{name:"source-arrow-shape",type:t.arrowShape},{name:"target-arrow-shape",type:t.arrowShape},{name:"mid-source-arrow-shape",type:t.arrowShape},{name:"mid-target-arrow-shape",type:t.arrowShape},{name:"source-arrow-color",type:t.color},{name:"target-arrow-color",type:t.color},{name:"mid-source-arrow-color",type:t.color},{name:"mid-target-arrow-color",type:t.color},{name:"source-arrow-fill",type:t.arrowFill},{name:"target-arrow-fill",type:t.arrowFill},{name:"mid-source-arrow-fill",type:t.arrowFill},{name:"mid-target-arrow-fill",type:t.arrowFill},{name:"selection-box-color",type:t.color},{name:"selection-box-opacity",type:t.zeroOneNumber},{name:"selection-box-border-color",type:t.color},{name:"selection-box-border-width",type:t.size},{name:"active-bg-color",type:t.color},{name:"active-bg-opacity",type:t.zeroOneNumber},{name:"active-bg-size",type:t.size},{name:"outside-texture-bg-color",type:t.color},{name:"outside-texture-bg-opacity",type:t.zeroOneNumber}];$$.style.pieBackgroundN=16,props.push({name:"pie-size",type:t.bgSize});for(var i=1;i<=$$.style.pieBackgroundN;i++)props.push({name:"pie-"+i+"-background-color",type:t.color}),props.push({name:"pie-"+i+"-background-size",type:t.percent}),props.push({name:"pie-"+i+"-background-opacity",type:t.zeroOneNumber});for(var i=0;i<props.length;i++){var prop=props[i];props[prop.name]=prop}}(),$$.styfn.addDefaultStylesheet=function(){var fontFamily="Helvetica",fontStyle="normal",fontWeight="normal",color="#000",textTransform="none",fontSize=16,textMaxWidth=9999;this.selector("node, edge").css({"text-valign":"top","text-halign":"center",color:color,"text-outline-color":"#000","text-outline-width":0,"text-outline-opacity":1,"text-opacity":1,"text-decoration":"none","text-transform":textTransform,"text-wrap":"none","text-max-width":textMaxWidth,"text-background-color":"#000","text-background-opacity":0,"text-border-opacity":0,"text-border-width":0,"text-border-style":"solid","text-border-color":"#000","text-background-shape":"rectangle","font-family":fontFamily,"font-style":fontStyle,"font-weight":fontWeight,"font-size":fontSize,"min-zoomed-font-size":0,"edge-text-rotation":"none",visibility:"visible",display:"element",opacity:1,"z-index":0,content:"","overlay-opacity":0,"overlay-color":"#000","overlay-padding":10,"shadow-opacity":0,"shadow-color":"#000","shadow-blur":10,"shadow-offset-x":0,"shadow-offset-y":0,"text-shadow-opacity":0,"text-shadow-color":"#000","text-shadow-blur":5,"text-shadow-offset-x":0,"text-shadow-offset-y":0,"transition-property":"none","transition-duration":0,"transition-delay":0,"background-blacken":0,"background-color":"#888","background-opacity":1,"background-image":"none","background-image-opacity":1,"background-position-x":"50%","background-position-y":"50%","background-repeat":"no-repeat","background-fit":"none","background-clip":"node","background-width":"auto","background-height":"auto","border-color":"#000","border-opacity":1,"border-width":0,"border-style":"solid",height:30,width:30,shape:"ellipse","padding-top":0,"padding-bottom":0,"padding-left":0,"padding-right":0,position:"origin","compound-sizing-wrt-labels":"include","pie-size":"100%","pie-1-background-color":"black","pie-2-background-color":"black","pie-3-background-color":"black","pie-4-background-color":"black","pie-5-background-color":"black","pie-6-background-color":"black","pie-7-background-color":"black","pie-8-background-color":"black","pie-9-background-color":"black","pie-10-background-color":"black","pie-11-background-color":"black","pie-12-background-color":"black","pie-13-background-color":"black","pie-14-background-color":"black","pie-15-background-color":"black","pie-16-background-color":"black","pie-1-background-size":"0%","pie-2-background-size":"0%","pie-3-background-size":"0%","pie-4-background-size":"0%","pie-5-background-size":"0%","pie-6-background-size":"0%","pie-7-background-size":"0%","pie-8-background-size":"0%","pie-9-background-size":"0%","pie-10-background-size":"0%","pie-11-background-size":"0%","pie-12-background-size":"0%","pie-13-background-size":"0%","pie-14-background-size":"0%","pie-15-background-size":"0%","pie-16-background-size":"0%","pie-1-background-opacity":1,"pie-2-background-opacity":1,"pie-3-background-opacity":1,"pie-4-background-opacity":1,"pie-5-background-opacity":1,"pie-6-background-opacity":1,"pie-7-background-opacity":1,"pie-8-background-opacity":1,"pie-9-background-opacity":1,"pie-10-background-opacity":1,"pie-11-background-opacity":1,"pie-12-background-opacity":1,"pie-13-background-opacity":1,"pie-14-background-opacity":1,"pie-15-background-opacity":1,"pie-16-background-opacity":1,"source-arrow-shape":"none","mid-source-arrow-shape":"none","target-arrow-shape":"none","mid-target-arrow-shape":"none","source-arrow-color":"#ddd","mid-source-arrow-color":"#ddd","target-arrow-color":"#ddd","mid-target-arrow-color":"#ddd","source-arrow-fill":"filled","mid-source-arrow-fill":"filled","target-arrow-fill":"filled","mid-target-arrow-fill":"filled","line-style":"solid","line-color":"#ddd","control-point-step-size":40,"control-point-weight":.5,"curve-style":"bezier","haystack-radius":.8}).selector("$node > node").css({width:"auto",height:"auto",shape:"rectangle","background-opacity":.5,"padding-top":10,"padding-right":10,"padding-left":10,"padding-bottom":10}).selector("edge").css({width:1}).selector(":active").css({"overlay-color":"black","overlay-padding":10,"overlay-opacity":.25}).selector("core").css({"selection-box-color":"#ddd","selection-box-opacity":.65,"selection-box-border-color":"#aaa","selection-box-border-width":1,"active-bg-color":"black","active-bg-opacity":.15,"active-bg-size":30,"outside-texture-bg-color":"#000","outside-texture-bg-opacity":.125}),this.defaultLength=this.length},$$.styfn.clear=function(){for(var i=0;i<this.length;i++)this[i]=void 0;return this.length=0,this._private.newStyle=!0,this},$$.styfn.resetToDefault=function(){return this.clear(),this.addDefaultStylesheet(),this},$$.styfn.core=function(){return this._private.coreStyle},$$.styfn.parse=function(name,value,propIsBypass,propIsFlat){name=$$.util.camel2dash(name);var property=$$.style.properties[name],passedValue=value,types=$$.style.types;if(!property)return null;if(void 0===value||null===value)return null;var valueIsString=$$.is.string(value);valueIsString&&(value=$$.util.trim(value));var type=property.type;if(!type)return null;if(propIsBypass&&(""===value||null===value))return{name:name,value:value,bypass:!0,deleteBypass:!0};var hasPie=name.match(/pie-(\d+)-background-size/);if($$.is.fn(value))return{name:name,value:value,strValue:"fn",mapped:types.fn,bypass:propIsBypass,hasPie:hasPie};var data,mapData,layoutData,mapLayoutData,scratch,mapScratch;if(!valueIsString||propIsFlat);else{if((data=new RegExp(types.data.regex).exec(value))||(layoutData=new RegExp(types.layoutData.regex).exec(value))||(scratch=new RegExp(types.scratch.regex).exec(value))){if(propIsBypass)return!1;var mapped;return mapped=data?types.data:layoutData?types.layoutData:types.scratch,data=data||layoutData||scratch,{name:name,value:data,strValue:""+value,mapped:mapped,field:data[1],bypass:propIsBypass,hasPie:hasPie}}if((mapData=new RegExp(types.mapData.regex).exec(value))||(mapLayoutData=new RegExp(types.mapLayoutData.regex).exec(value))||(mapScratch=new RegExp(types.mapScratch.regex).exec(value))){if(propIsBypass)return!1;var mapped;if(mapped=mapData?types.mapData:mapLayoutData?types.mapLayoutData:types.mapScratch,mapData=mapData||mapLayoutData||mapScratch,!type.color&&!type.number)return!1;var valueMin=this.parse(name,mapData[4]);if(!valueMin||valueMin.mapped)return!1;var valueMax=this.parse(name,mapData[5]);if(!valueMax||valueMax.mapped)return!1;if(valueMin.value===valueMax.value)return!1;if(type.color){var c1=valueMin.value,c2=valueMax.value,same=!(c1[0]!==c2[0]||c1[1]!==c2[1]||c1[2]!==c2[2]||c1[3]!==c2[3]&&(null!=c1[3]&&1!==c1[3]||null!=c2[3]&&1!==c2[3]));if(same)return!1}return{name:name,value:mapData,strValue:""+value,mapped:mapped,field:mapData[1],fieldMin:parseFloat(mapData[2]),fieldMax:parseFloat(mapData[3]),valueMin:valueMin.value,valueMax:valueMax.value,bypass:propIsBypass,hasPie:hasPie}}}if(type.number){var units,implicitUnits="px";if(type.units&&(units=type.units),type.implicitUnits&&(implicitUnits=type.implicitUnits),!type.unitless)if(valueIsString){var unitsRegex="px|em"+(type.allowPercent?"|\\%":"");units&&(unitsRegex=units);var match=value.match("^("+$$.util.regex.number+")("+unitsRegex+")?$");match&&(value=match[1],units=match[2]||implicitUnits)}else(!units||type.implicitUnits)&&(units=implicitUnits);if(value=parseFloat(value),isNaN(value)&&void 0===type.enums)return null;if(isNaN(value)&&void 0!==type.enums){value=passedValue;for(var i=0;i<type.enums.length;i++){var en=type.enums[i];if(en===value)return{name:name,value:value,strValue:""+value,bypass:propIsBypass}}return null}if(type.integer&&!$$.is.integer(value))return null;if(void 0!==type.min&&value<type.min||void 0!==type.max&&value>type.max)return null;var ret={name:name,value:value,strValue:""+value+(units?units:""),units:units,bypass:propIsBypass,hasPie:hasPie&&null!=value&&0!==value&&""!==value};return type.unitless||"px"!==units&&"em"!==units||(ret.pxValue="px"!==units&&units?this.getEmSizeInPixels()*value:value),("ms"===units||"s"===units)&&(ret.msValue="ms"===units?value:1e3*value),ret}if(type.propList){var props=[],propsStr=""+value;if("none"===propsStr);else{for(var propsSplit=propsStr.split(","),i=0;i<propsSplit.length;i++){var propName=$$.util.trim(propsSplit[i]);$$.style.properties[propName]&&props.push(propName)}if(0===props.length)return null}return{name:name,value:props,strValue:0===props.length?"none":props.join(", "),bypass:propIsBypass}}if(type.color){var tuple=$$.util.color2tuple(value);return tuple?{name:name,value:tuple,strValue:""+value,bypass:propIsBypass}:null}if(type.enums){for(var i=0;i<type.enums.length;i++){var en=type.enums[i];if(en===value)return{name:name,value:value,strValue:""+value,bypass:propIsBypass}}return null}if(type.regex){var regex=new RegExp(type.regex),m=regex.exec(value);return m?{name:name,value:m,strValue:""+value,bypass:propIsBypass}:null}return type.string?{name:name,value:value,strValue:""+value,bypass:propIsBypass}:null},$$.styfn.selector=function(selectorStr){var selector="core"===selectorStr?null:new $$.Selector(selectorStr),i=this.length++;return this[i]={selector:selector,properties:[],mappedProperties:[],index:i},this},$$.styfn.css=function(){var args=arguments;switch(args.length){case 1:for(var map=args[0],i=0;i<$$.style.properties.length;i++){var prop=$$.style.properties[i],mapVal=map[prop.name];void 0===mapVal&&(mapVal=map[$$.util.dash2camel(prop.name)]),void 0!==mapVal&&this.cssRule(prop.name,mapVal)}break;case 2:this.cssRule(args[0],args[1])}return this},$$.styfn.style=$$.styfn.css,$$.styfn.cssRule=function(name,value){var property=this.parse(name,value);if(property){var i=this.length-1;this[i].properties.push(property),this[i].properties[property.name]=property,property.hasPie&&(this._private.hasPie=!0),property.mapped&&this[i].mappedProperties.push(property);var currentSelectorIsCore=!this[i].selector;currentSelectorIsCore&&(this._private.coreStyle[property.name]=property)}return this}}(cytoscape),function($$){"use strict";$$.styfn.apply=function(eles){var self=this;self._private.newStyle&&(this._private.contextStyles={},this._private.propDiffs={});for(var ie=0;ie<eles.length;ie++){var ele=eles[ie],cxtMeta=self.getContextMeta(ele),cxtStyle=self.getContextStyle(cxtMeta),app=self.applyContextStyle(cxtMeta,cxtStyle,ele);self.updateTransitions(ele,app.diffProps),self.updateStyleHints(ele)}self._private.newStyle=!1},$$.styfn.getPropertiesDiff=function(oldCxtKey,newCxtKey){var self=this,cache=self._private.propDiffs=self._private.propDiffs||{},dualCxtKey=oldCxtKey+"-"+newCxtKey,cachedVal=cache[dualCxtKey];if(cachedVal)return cachedVal;for(var diffProps=[],addedProp={},i=0;i<self.length;i++){var cxt=self[i],oldHasCxt="t"===oldCxtKey[i],newHasCxt="t"===newCxtKey[i],cxtHasDiffed=oldHasCxt!==newHasCxt,cxtHasMappedProps=cxt.mappedProperties.length>0;if(cxtHasDiffed||cxtHasMappedProps){var props;cxtHasDiffed&&cxtHasMappedProps?props=cxt.properties:cxtHasDiffed?props=cxt.properties:cxtHasMappedProps&&(props=cxt.mappedProperties);for(var j=0;j<props.length;j++){for(var prop=props[j],name=prop.name,laterCxtOverrides=!1,k=i+1;k<self.length;k++){var laterCxt=self[k],hasLaterCxt="t"===newCxtKey[k];if(hasLaterCxt&&(laterCxtOverrides=null!=laterCxt.properties[prop.name]))break}addedProp[name]||laterCxtOverrides||(addedProp[name]=!0,diffProps.push(name))}}}return cache[dualCxtKey]=diffProps,diffProps},$$.styfn.getContextMeta=function(ele){var diffProps,self=this,cxtKey="",prevKey=ele._private.styleCxtKey||"";self._private.newStyle&&(prevKey="");for(var i=0;i<self.length;i++){var context=self[i],contextSelectorMatches=context.selector&&context.selector.matches(ele);cxtKey+=contextSelectorMatches?"t":"f"}return diffProps=self.getPropertiesDiff(prevKey,cxtKey),ele._private.styleCxtKey=cxtKey,{key:cxtKey,diffPropNames:diffProps}},$$.styfn.getContextStyle=function(cxtMeta){var cxtKey=cxtMeta.key,self=this,cxtStyles=this._private.contextStyles=this._private.contextStyles||{};if(cxtStyles[cxtKey])return cxtStyles[cxtKey];for(var style={_private:{key:cxtKey}},i=0;i<self.length;i++){var cxt=self[i],hasCxt="t"===cxtKey[i];if(hasCxt)for(var j=0;j<cxt.properties.length;j++){var prop=cxt.properties[j],styProp=style[prop.name]=prop;styProp.context=cxt}}return cxtStyles[cxtKey]=style,style},$$.styfn.applyContextStyle=function(cxtMeta,cxtStyle,ele){for(var self=this,diffProps=cxtMeta.diffPropNames,retDiffProps={},i=0;i<diffProps.length;i++){var diffPropName=diffProps[i],cxtProp=cxtStyle[diffPropName],eleProp=ele._private.style[diffPropName];if(cxtProp&&eleProp!==cxtProp){var retDiffProp=retDiffProps[diffPropName]={prev:eleProp};self.applyParsedProperty(ele,cxtProp),retDiffProp.next=ele._private.style[diffPropName],retDiffProp.next&&retDiffProp.next.bypass&&(retDiffProp.next=retDiffProp.next.bypassed)}}return{diffProps:retDiffProps}},$$.styfn.updateStyleHints=function(ele){var _p=ele._private,self=this,style=_p.style,hasPie=!1;if("nodes"===_p.group&&self._private.hasPie)for(var i=1;i<=$$.style.pieBackgroundN;i++){var size=_p.style["pie-"+i+"-background-size"].value;if(size>0){hasPie=!0;break}}_p.hasPie=hasPie;var transform=style["text-transform"].strValue,content=style.content.strValue,fStyle=style["font-style"].strValue,size=style["font-size"].pxValue+"px",family=style["font-family"].strValue,weight=style["font-weight"].strValue,valign=style["text-valign"].strValue,halign=style["text-valign"].strValue,oWidth=style["text-outline-width"].pxValue,wrap=style["text-wrap"].strValue,wrapW=style["text-max-width"].pxValue;_p.labelKey=fStyle+"$"+size+"$"+family+"$"+weight+"$"+content+"$"+transform+"$"+valign+"$"+halign+"$"+oWidth+"$"+wrap+"$"+wrapW,_p.fontKey=fStyle+"$"+weight+"$"+size+"$"+family;var width=style.width.pxValue,height=style.height.pxValue,borderW=style["border-width"].pxValue;if(_p.boundingBoxKey=width+"$"+height+"$"+borderW,"edges"===ele._private.group){var cpss=style["control-point-step-size"].pxValue,cpd=style["control-point-distance"]?style["control-point-distance"].pxValue:void 0,cpw=style["control-point-weight"].value,curve=style["curve-style"].strValue;_p.boundingBoxKey+="$"+cpss+"$"+cpd+"$"+cpw+"$"+curve}_p.styleKey=Date.now()},$$.styfn.applyParsedProperty=function(ele,parsedProp){var fieldVal,flatProp,prop=parsedProp,style=ele._private.style,types=$$.style.types,type=$$.style.properties[prop.name].type,propIsBypass=prop.bypass,origProp=style[prop.name],origPropIsBypass=origProp&&origProp.bypass,_p=ele._private;if(("height"===parsedProp.name||"width"===parsedProp.name)&&ele.isNode()){if("auto"===parsedProp.value&&!ele.isParent())return!1;"auto"!==parsedProp.value&&ele.isParent()&&(prop=parsedProp=this.parse(parsedProp.name,"auto",propIsBypass))}if(propIsBypass&&prop.deleteBypass){var currentProp=style[prop.name];return currentProp?currentProp.bypass&&currentProp.bypassed?(style[prop.name]=currentProp.bypassed,!0):!1:!0}var printMappingErr=function(){$$.util.error("Do not assign mappings to elements without corresponding data (e.g. ele `"+ele.id()+"` for property `"+prop.name+"` with data field `"+prop.field+"`); try a `["+prop.field+"]` selector to limit scope to elements with `"+prop.field+"` defined")};switch(prop.mapped){case types.mapData:case types.mapLayoutData:case types.mapScratch:var fieldVal,isLayout=prop.mapped===types.mapLayoutData,isScratch=prop.mapped===types.mapScratch,fields=prop.field.split(".");fieldVal=isScratch||isLayout?_p.scratch:_p.data;for(var i=0;i<fields.length&&fieldVal;i++){var field=fields[i];fieldVal=fieldVal[field]}var percent;if(percent=$$.is.number(fieldVal)?(fieldVal-prop.fieldMin)/(prop.fieldMax-prop.fieldMin):0,0>percent?percent=0:percent>1&&(percent=1),type.color){var r1=prop.valueMin[0],r2=prop.valueMax[0],g1=prop.valueMin[1],g2=prop.valueMax[1],b1=prop.valueMin[2],b2=prop.valueMax[2],a1=null==prop.valueMin[3]?1:prop.valueMin[3],a2=null==prop.valueMax[3]?1:prop.valueMax[3],clr=[Math.round(r1+(r2-r1)*percent),Math.round(g1+(g2-g1)*percent),Math.round(b1+(b2-b1)*percent),Math.round(a1+(a2-a1)*percent)];flatProp={bypass:prop.bypass,name:prop.name,value:clr,strValue:"rgb("+clr[0]+", "+clr[1]+", "+clr[2]+")"}}else{if(!type.number)return!1;var calcValue=prop.valueMin+(prop.valueMax-prop.valueMin)*percent;flatProp=this.parse(prop.name,calcValue,prop.bypass,!0)}flatProp||(flatProp=this.parse(prop.name,origProp.strValue,prop.bypass,!0)),flatProp||printMappingErr(),flatProp.mapping=prop,prop=flatProp;break;case types.data:case types.layoutData:case types.scratch:var fieldVal,isLayout=prop.mapped===types.layoutData,isScratch=prop.mapped===types.scratch,fields=prop.field.split(".");if(fieldVal=isScratch||isLayout?_p.scratch:_p.data)for(var i=0;i<fields.length;i++){var field=fields[i];fieldVal=fieldVal[field]}if(flatProp=this.parse(prop.name,fieldVal,prop.bypass,!0),!flatProp){var flatPropVal=origProp?origProp.strValue:"";flatProp=this.parse(prop.name,flatPropVal,prop.bypass,!0)}flatProp||printMappingErr(),flatProp.mapping=prop,prop=flatProp;break;case types.fn:var fn=prop.value,fnRetVal=fn(ele);flatProp=this.parse(prop.name,fnRetVal,prop.bypass,!0),flatProp.mapping=prop,prop=flatProp;break;case void 0:break;default:return!1}return propIsBypass?(prop.bypassed=origPropIsBypass?origProp.bypassed:origProp,style[prop.name]=prop):origPropIsBypass?origProp.bypassed=prop:style[prop.name]=prop,!0},$$.styfn.update=function(){var cy=this._private.cy,eles=cy.elements();eles.updateStyle()},$$.styfn.updateMappers=function(eles){for(var i=0;i<eles.length;i++){for(var ele=eles[i],style=ele._private.style,j=0;j<$$.style.properties.length;j++){var prop=$$.style.properties[j],propInStyle=style[prop.name];if(propInStyle&&propInStyle.mapping){var mapping=propInStyle.mapping;this.applyParsedProperty(ele,mapping)}}this.updateStyleHints(ele)}},$$.styfn.updateTransitions=function(ele,diffProps,isBypass){var self=this,style=ele._private.style,props=style["transition-property"].value,duration=style["transition-duration"].msValue,delay=style["transition-delay"].msValue,css={};if(props.length>0&&duration>0){for(var anyPrev=!1,i=0;i<props.length;i++){var prop=props[i],styProp=style[prop],diffProp=diffProps[prop];if(diffProp){var prevProp=diffProp.prev,fromProp=prevProp,toProp=null!=diffProp.next?diffProp.next:styProp,diff=!1;fromProp&&($$.is.number(fromProp.pxValue)&&$$.is.number(toProp.pxValue)?diff=fromProp.pxValue!==toProp.pxValue:$$.is.number(fromProp.value)&&$$.is.number(toProp.value)?diff=fromProp.value!==toProp.value:$$.is.array(fromProp.value)&&$$.is.array(toProp.value)&&(diff=fromProp.value[0]!==toProp.value[0]||fromProp.value[1]!==toProp.value[1]||fromProp.value[2]!==toProp.value[2]),diff&&(css[prop]=toProp.strValue,this.applyBypass(ele,prop,fromProp.strValue),anyPrev=!0))}}if(!anyPrev)return;ele._private.transitioning=!0,ele.stop(),delay>0&&ele.delay(delay),ele.animate({css:css},{duration:duration,queue:!1,complete:function(){isBypass||self.removeBypasses(ele,props),ele._private.transitioning=!1}})}else ele._private.transitioning&&(ele.stop(),this.removeBypasses(ele,props),ele._private.transitioning=!1)}}(cytoscape),function($$){"use strict";$$.styfn.applyBypass=function(eles,name,value,updateTransitions){var props=[],isBypass=!0;if("*"===name||"**"===name){if(void 0!==value)for(var i=0;i<$$.style.properties.length;i++){var prop=$$.style.properties[i],name=prop.name,parsedProp=this.parse(name,value,!0);parsedProp&&props.push(parsedProp)}}else if($$.is.string(name)){var parsedProp=this.parse(name,value,!0);

parsedProp&&props.push(parsedProp)}else{if(!$$.is.plainObject(name))return!1;var specifiedProps=name;updateTransitions=value;for(var i=0;i<$$.style.properties.length;i++){var prop=$$.style.properties[i],name=prop.name,value=specifiedProps[name];if(void 0===value&&(value=specifiedProps[$$.util.dash2camel(name)]),void 0!==value){var parsedProp=this.parse(name,value,!0);parsedProp&&props.push(parsedProp)}}}if(0===props.length)return!1;for(var ret=!1,i=0;i<eles.length;i++){for(var diffProp,ele=eles[i],style=ele._private.style,diffProps={},j=0;j<props.length;j++){var prop=props[j];if(updateTransitions){var prevProp=style[prop.name];diffProp=diffProps[prop.name]={prev:prevProp}}ret=this.applyParsedProperty(ele,prop)||ret,updateTransitions&&(diffProp.next=style[prop.name])}updateTransitions&&this.updateTransitions(ele,diffProps,isBypass)}return ret},$$.styfn.overrideBypass=function(eles,name,value){for(var i=0;i<eles.length;i++){var ele=eles[i],prop=ele._private.style[$$.util.camel2dash(name)];prop.bypass?(prop.value=value,prop.pxValue=value):this.applyBypass(ele,name,value)}},$$.styfn.removeAllBypasses=function(eles,updateTransitions){for(var isBypass=!0,j=0;j<eles.length;j++){for(var ele=eles[j],diffProps={},style=ele._private.style,i=0;i<$$.style.properties.length;i++){var prop=$$.style.properties[i],name=prop.name,value="",parsedProp=this.parse(name,value,!0),prevProp=style[prop.name],diffProp=diffProps[prop.name]={prev:prevProp};this.applyParsedProperty(ele,parsedProp),diffProp.next=style[prop.name]}updateTransitions&&this.updateTransitions(ele,diffProps,isBypass)}},$$.styfn.removeBypasses=function(eles,props,updateTransitions){for(var isBypass=!0,j=0;j<eles.length;j++){for(var ele=eles[j],diffProps={},style=ele._private.style,i=0;i<props.length;i++){var name=props[i],prop=$$.style.properties[name],value="",parsedProp=this.parse(name,value,!0),prevProp=style[prop.name],diffProp=diffProps[prop.name]={prev:prevProp};this.applyParsedProperty(ele,parsedProp),diffProp.next=style[prop.name]}updateTransitions&&this.updateTransitions(ele,diffProps,isBypass)}}}(cytoscape),function($$,window){"use strict";$$.styfn.getEmSizeInPixels=function(){var cy=this._private.cy,domElement=cy.container();if(window&&domElement&&window.getComputedStyle){var pxAsStr=window.getComputedStyle(domElement).getPropertyValue("font-size"),px=parseFloat(pxAsStr);return px}return 1},$$.styfn.containerCss=function(propName){var cy=this._private.cy,domElement=cy.container();return window&&domElement&&window.getComputedStyle?window.getComputedStyle(domElement).getPropertyValue(propName):void 0},$$.styfn.containerProperty=function(propName){var propStr=this.containerCss(propName),prop=this.parse(propName,propStr);return prop},$$.styfn.containerPropertyAsString=function(propName){var prop=this.containerProperty(propName);return prop?prop.strValue:void 0}}(cytoscape,"undefined"==typeof window?null:window),function($$){"use strict";$$.styfn.getRenderedStyle=function(ele){var ele=ele[0];if(ele){for(var rstyle={},style=ele._private.style,cy=this._private.cy,zoom=cy.zoom(),i=0;i<$$.style.properties.length;i++){var prop=$$.style.properties[i],styleProp=style[prop.name];if(styleProp){var val=styleProp.unitless?styleProp.strValue:styleProp.pxValue*zoom+"px";rstyle[prop.name]=val,rstyle[$$.util.dash2camel(prop.name)]=val}}return rstyle}},$$.styfn.getRawStyle=function(ele){var ele=ele[0];if(ele){for(var rstyle={},style=ele._private.style,i=0;i<$$.style.properties.length;i++){var prop=$$.style.properties[i],styleProp=style[prop.name];styleProp&&(rstyle[prop.name]=styleProp.strValue,rstyle[$$.util.dash2camel(prop.name)]=styleProp.strValue)}return rstyle}},$$.styfn.getValueStyle=function(ele,opts){opts=opts||{};var style,rstyle=opts.array?[]:{};if(style=$$.is.element(ele)?ele._private.style:ele)for(var i=0;i<$$.style.properties.length;i++){var prop=$$.style.properties[i],styleProp=style[prop.name]||style[$$.util.dash2camel(prop.name)];void 0===styleProp||$$.is.plainObject(styleProp)||(styleProp=this.parse(prop.name,styleProp)),styleProp&&(opts.array?rstyle.push(styleProp):(rstyle[prop.name]=styleProp,rstyle[$$.util.dash2camel(prop.name)]=styleProp))}return rstyle}}(cytoscape),function($$){"use strict";$$.style.applyFromJson=function(style,json){for(var i=0;i<json.length;i++){var context=json[i],selector=context.selector,props=context.style||context.css;style.selector(selector);for(var name in props){var value=props[name];style.css(name,value)}}return style},$$.style.fromJson=function(cy,json){var style=new $$.Style(cy);return $$.style.applyFromJson(style,json),style},$$.styfn.fromJson=function(json){var style=this;return style.resetToDefault(),$$.style.applyFromJson(style,json),style},$$.styfn.json=function(){for(var json=[],i=this.defaultLength;i<this.length;i++){for(var cxt=this[i],selector=cxt.selector,props=cxt.properties,css={},j=0;j<props.length;j++){var prop=props[j];css[prop.name]=prop.strValue}json.push({selector:selector?selector.toString():"core",style:css})}return json}}(cytoscape),function($$){"use strict";$$.style.applyFromString=function(style,string){function removeSelAndBlockFromRemaining(){remaining=remaining.length>selAndBlockStr.length?remaining.substr(selAndBlockStr.length):""}function removePropAndValFromRem(){blockRem=blockRem.length>propAndValStr.length?blockRem.substr(propAndValStr.length):""}var selAndBlockStr,blockRem,propAndValStr,remaining=""+string;for(remaining=remaining.replace(/[/][*](\s|.)+?[*][/]/g,"");;){var nothingLeftToParse=remaining.match(/^\s*$/);if(nothingLeftToParse)break;var selAndBlock=remaining.match(/^\s*((?:.|\s)+?)\s*\{((?:.|\s)+?)\}/);if(!selAndBlock){$$.util.error("Halting stylesheet parsing: String stylesheet contains more to parse but no selector and block found in: "+remaining);break}selAndBlockStr=selAndBlock[0];var selectorStr=selAndBlock[1];if("core"!==selectorStr){var selector=new $$.Selector(selectorStr);if(selector._private.invalid){$$.util.error("Skipping parsing of block: Invalid selector found in string stylesheet: "+selectorStr),removeSelAndBlockFromRemaining();continue}}var blockStr=selAndBlock[2],invalidBlock=!1;blockRem=blockStr;for(var props=[];;){var nothingLeftToParse=blockRem.match(/^\s*$/);if(nothingLeftToParse)break;var propAndVal=blockRem.match(/^\s*(.+?)\s*:\s*(.+?)\s*;/);if(!propAndVal){$$.util.error("Skipping parsing of block: Invalid formatting of style property and value definitions found in:"+blockStr),invalidBlock=!0;break}propAndValStr=propAndVal[0];var propStr=propAndVal[1],valStr=propAndVal[2],prop=$$.style.properties[propStr];if(prop){var parsedProp=style.parse(propStr,valStr);parsedProp?(props.push({name:propStr,val:valStr}),removePropAndValFromRem()):($$.util.error("Skipping property: Invalid property definition in: "+propAndValStr),removePropAndValFromRem())}else $$.util.error("Skipping property: Invalid property name in: "+propAndValStr),removePropAndValFromRem()}if(invalidBlock){removeSelAndBlockFromRemaining();break}style.selector(selectorStr);for(var i=0;i<props.length;i++){var prop=props[i];style.css(prop.name,prop.val)}removeSelAndBlockFromRemaining()}return style},$$.style.fromString=function(cy,string){var style=new $$.Style(cy);return $$.style.applyFromString(style,string),style},$$.styfn.fromString=function(string){var style=this;return style.resetToDefault(),$$.style.applyFromString(style,string),style}}(cytoscape),function($$){"use strict";$$.stylesheet=$$.Stylesheet=function(){return this instanceof $$.Stylesheet?void(this.length=0):new $$.Stylesheet},$$.sheetfn=$$.Stylesheet.prototype,$$.sheetfn.selector=function(selector){var i=this.length++;return this[i]={selector:selector,properties:[]},this},$$.sheetfn.css=function(name,value){var i=this.length-1;if($$.is.string(name))this[i].properties.push({name:name,value:value});else if($$.is.plainObject(name))for(var map=name,j=0;j<$$.style.properties.length;j++){var prop=$$.style.properties[j],mapVal=map[prop.name];if(void 0===mapVal&&(mapVal=map[$$.util.dash2camel(prop.name)]),void 0!==mapVal){var name=prop.name,value=mapVal;this[i].properties.push({name:name,value:value})}}return this},$$.sheetfn.style=$$.sheetfn.css,$$.sheetfn.generateStyle=function(cy){for(var style=new $$.Style(cy),i=0;i<this.length;i++){var context=this[i],selector=context.selector,props=context.properties;style.selector(selector);for(var j=0;j<props.length;j++){var prop=props[j];style.css(prop.name,prop.value)}}return style}}(cytoscape),function($$,window){"use strict";$$.Thread=function(fn){return this instanceof $$.Thread?(this._private={requires:[],files:[],queue:null,pass:[]},void(fn&&this.run(fn))):new $$.Thread(fn)},$$.thread=$$.Thread,$$.thdfn=$$.Thread.prototype,$$.fn.thread=function(fnMap,options){for(var name in fnMap){var fn=fnMap[name];$$.Thread.prototype[name]=fn}};var stringifyFieldVal=function(val){var valStr=$$.is.fn(val)?val.toString():'JSON.parse("'+JSON.stringify(val)+'")';return valStr},fnAsRequire=function(fn){var req,fnName;$$.is.object(fn)&&fn.fn?(req=fnAs(fn.fn,fn.name),fnName=fn.name,fn=fn.fn):$$.is.fn(fn)?(req=fn.toString(),fnName=fn.name):$$.is.string(fn)?req=fn:$$.is.object(fn)&&(req=fn.proto?"":fn.name+" = {};",fnName=fn.name,fn=fn.obj),req+="\n";var protoreq=function(val,subname){if(val.prototype){var protoNonempty=!1;for(var prop in val.prototype){protoNonempty=!0;break}protoNonempty&&(req+=fnAsRequire({name:subname,obj:val,proto:!0},val))}};if(fn.prototype&&null!=fnName)for(var name in fn.prototype){var protoStr="",val=fn.prototype[name],valStr=stringifyFieldVal(val),subname=fnName+".prototype."+name;protoStr+=subname+" = "+valStr+";\n",protoStr&&(req+=protoStr),protoreq(val,subname)}if(!$$.is.string(fn))for(var name in fn){var propsStr="";if(fn.hasOwnProperty(name)){var val=fn[name],valStr=stringifyFieldVal(val),subname=fnName+'["'+name+'"]';propsStr+=subname+" = "+valStr+";\n"}propsStr&&(req+=propsStr),protoreq(val,subname)}return req},isPathStr=function(str){return $$.is.string(str)&&str.match(/\.js$/)};$$.fn.thread({require:function(fn,as){return isPathStr(fn)?(this._private.files.push(fn),this):(as&&($$.is.fn(fn)?(as=as||fn.name,fn={name:as,fn:fn}):fn={name:as,obj:fn}),this._private.requires.push(fn),this)},pass:function(data){return this._private.pass.push(data),this},run:function(fn,pass){var self=this,_p=this._private;if(pass=pass||_p.pass.shift(),_p.stopped)return void $$.util.error("Attempted to run a stopped thread!  Start a new thread or do not stop the existing thread and reuse it.");if(_p.running)return _p.queue=_p.queue.then(function(){return self.run(fn,pass)});var useWW=null!=window,useNode="undefined"!=typeof module;self.trigger("run");var runP=new $$.Promise(function(resolve,reject){_p.running=!0;var threadTechAlreadyExists=_p.ran,fnImplStr=$$.is.string(fn)?fn:fn.toString(),fnStr="\n"+_p.requires.map(function(r){return fnAsRequire(r)}).concat(_p.files.map(function(f){if(useWW){var wwifyFile=function(file){return file.match(/^\.\//)||file.match(/^\.\./)?window.location.origin+window.location.pathname+file:file.match(/^\//)?window.location.origin+"/"+file:file};return'importScripts("'+wwifyFile(f)+'");'}return useNode?'eval( require("fs").readFileSync("'+f+'", { encoding: "utf8" }) );':void 0})).concat(["( function(){","var ret = ("+fnImplStr+")("+JSON.stringify(pass)+");","if( ret !== undefined ){ resolve(ret); }","} )()\n"]).join("\n");if(_p.requires=[],_p.files=[],useWW){var fnBlob,fnUrl;if(!threadTechAlreadyExists){var fnPre=fnStr+"";fnStr=["function broadcast(m){ return message(m); };","function message(m){ postMessage(m); };","function listen(fn){",'  self.addEventListener("message", function(m){ ','    if( typeof m === "object" && (m.data.$$eval || m.data === "$$start") ){',"    } else { ","      fn( m.data );","    }","  });","};",'self.addEventListener("message", function(m){  if( m.data.$$eval ){ eval( m.data.$$eval ); }  });',"function resolve(v){ postMessage({ $$resolve: v }); };","function reject(v){ postMessage({ $$reject: v }); };"].join("\n"),fnStr+=fnPre,fnBlob=new Blob([fnStr],{type:"application/javascript"}),fnUrl=window.URL.createObjectURL(fnBlob)}var ww=_p.webworker=_p.webworker||new Worker(fnUrl);threadTechAlreadyExists&&ww.postMessage({$$eval:fnStr});var cb;ww.addEventListener("message",cb=function(m){var isObject=$$.is.object(m)&&$$.is.object(m.data);isObject&&"$$resolve"in m.data?(ww.removeEventListener("message",cb),resolve(m.data.$$resolve)):isObject&&"$$reject"in m.data?(ww.removeEventListener("message",cb),reject(m.data.$$reject)):self.trigger(new $$.Event(m,{type:"message",message:m.data}))},!1),threadTechAlreadyExists||ww.postMessage("$$start")}else if(useNode){var cb,path=require("path"),child_process=require("child_process"),child=_p.child=_p.child||child_process.fork(path.join(__dirname,"thread-node-fork"));child.on("message",cb=function(m){$$.is.object(m)&&"$$resolve"in m?(child.removeListener("message",cb),resolve(m.$$resolve)):$$.is.object(m)&&"$$reject"in m?(child.removeListener("message",cb),reject(m.$$reject)):self.trigger(new $$.Event({},{type:"message",message:m}))}),child.send({$$eval:fnStr})}else $$.error("Tried to create thread but no underlying tech found!")}).then(function(v){return _p.running=!1,_p.ran=!0,self.trigger("ran"),v});return null==_p.queue&&(_p.queue=runP),runP},message:function(m){var _p=this._private;return _p.webworker&&_p.webworker.postMessage(m),_p.child&&_p.child.send(m),this},stop:function(){var _p=this._private;return _p.webworker&&_p.webworker.terminate(),_p.child&&_p.child.kill(),_p.stopped=!0,this.trigger("stop")},stopped:function(){return this._private.stopped}});var fnAs=function(fn,name){var fnStr=fn.toString();return fnStr=fnStr.replace(/function.*\(/,"function "+name+"(")},defineFnal=function(opts){return opts=opts||{},function(fn,arg1){var fnStr=fnAs(fn,"_$_$_"+opts.name);return this.require(fnStr),this.run(["function( data ){","  var origResolve = resolve;","  var res = [];","  ","  resolve = function( val ){","    res.push( val );","  };","  ","  var ret = data."+opts.name+"( _$_$_"+opts.name+(arguments.length>1?", "+JSON.stringify(arg1):"")+" );","  ","  resolve = origResolve;","  resolve( res.length > 0 ? res : ret );","}"].join("\n"))}};$$.fn.thread({reduce:defineFnal({name:"reduce"}),reduceRight:defineFnal({name:"reduceRight"}),map:defineFnal({name:"map"})});var fn=$$.thdfn;fn.promise=fn.run,fn.terminate=fn.halt=fn.stop,fn.include=fn.require,$$.worker=$$.Worker=$$.Thread,$$.fn.thread({on:$$.define.on(),one:$$.define.on({unbindSelfOnTrigger:!0}),off:$$.define.off(),trigger:$$.define.trigger()}),$$.define.eventAliasesOn($$.thdfn)}(cytoscape,"undefined"==typeof window?null:window),function($$,window){"use strict";$$.Fabric=function(N){if(!(this instanceof $$.Fabric))return new $$.Fabric(N);this._private={pass:[]};var defN=4;$$.is.number(N),N="undefined"!=typeof navigator&&null!=navigator.hardwareConcurrency?navigator.hardwareConcurrency:"undefined"!=typeof module?require("os").cpus().length:defN;for(var i=0;N>i;i++)this[i]=$$.Thread();this.length=N},$$.fabric=$$.Fabric,$$.fabfn=$$.Fabric.prototype,$$.fn.fabric=function(fnMap,options){for(var name in fnMap){var fn=fnMap[name];$$.Fabric.prototype[name]=fn}},$$.fn.fabric({require:function(fn,as){for(var i=0;i<this.length;i++){var thread=this[i];thread.require(fn,as)}return this},random:function(){var i=Math.round((this.length-1)*Math.random()),thread=this[i];return thread},run:function(fn){var pass=this._private.pass.shift();return this.random().pass(pass).run(fn)},message:function(m){return this.random().message(m)},broadcast:function(m){for(var i=0;i<this.length;i++){var thread=this[i];thread.message(m)}return this},stop:function(){for(var i=0;i<this.length;i++){var thread=this[i];thread.stop()}return this},pass:function(data){var pass=this._private.pass;return $$.is.array(data)?pass.push(data):$$.util.error("Only arrays or collections may be used with fabric.pass()"),this},spreadSize:function(){var subsize=Math.ceil(this._private.pass[0].length/this.length);return subsize=Math.max(1,subsize)},spread:function(fn){for(var self=this,_p=self._private,subsize=self.spreadSize(),pass=_p.pass.shift().concat([]),runPs=[],i=0;i<this.length;i++){var thread=this[i],slice=pass.splice(0,subsize),runP=thread.pass(slice).run(fn);runPs.push(runP);var doneEarly=0===pass.length;if(doneEarly)break}return $$.Promise.all(runPs).then(function(thens){for(var postpass=[],p=0,i=0;i<thens.length;i++)for(var then=thens[i],j=0;j<then.length;j++){var t=then[j];postpass[p++]=t}return postpass})},map:function(fn){var self=this;return self.require(fn,"_$_$_fabmap"),self.spread(function(split){var mapped=[],origResolve=resolve;resolve=function(val){mapped.push(val)};for(var i=0;i<split.length;i++){var oldLen=mapped.length,ret=_$_$_fabmap(split[i]),nothingInsdByResolve=oldLen===mapped.length;nothingInsdByResolve&&mapped.push(ret)}return resolve=origResolve,mapped})},filter:function(fn){var _p=this._private,pass=_p.pass[0];return this.map(fn).then(function(include){for(var ret=[],i=0;i<pass.length;i++){var datum=pass[i],incDatum=include[i];incDatum&&ret.push(datum)}return ret})},sort:function(cmp){var self=this,P=this._private.pass[0].length,subsize=this.spreadSize();return cmp=cmp||function(a,b){return b>a?-1:a>b?1:0},self.require(cmp,"_$_$_cmp"),self.spread(function(split){var sortedSplit=split.sort(_$_$_cmp);resolve(sortedSplit)}).then(function(joined){for(var merge=function(i,j,max){j=Math.min(j,P),max=Math.min(max,P);for(var l=i,r=j,sorted=[],k=l;max>k;k++){var eleI=joined[i],eleJ=joined[j];r>i&&(j>=max||cmp(eleI,eleJ)<=0)?(sorted.push(eleI),i++):(sorted.push(eleJ),j++)}for(var k=0;k<sorted.length;k++){var index=l+k;joined[index]=sorted[k]}},splitL=subsize;P>splitL;splitL*=2)for(var i=0;P>i;i+=2*splitL)merge(i,i+splitL,i+2*splitL);return joined})}});var defineRandomPasser=function(opts){return opts=opts||{},function(fn,arg1){var pass=this._private.pass.shift();return this.random().pass(pass)[opts.threadFn](fn,arg1)}};$$.fn.fabric({randomMap:defineRandomPasser({threadFn:"map"}),reduce:defineRandomPasser({threadFn:"reduce"}),reduceRight:defineRandomPasser({threadFn:"reduceRight"})});var fn=$$.fabfn;fn.promise=fn.run,fn.terminate=fn.halt=fn.stop,fn.include=fn.require,$$.fn.fabric({on:$$.define.on(),one:$$.define.on({unbindSelfOnTrigger:!0}),off:$$.define.off(),trigger:$$.define.trigger()}),$$.define.eventAliasesOn($$.fabfn)}(cytoscape,"undefined"==typeof window?null:window),function($$,window){"use strict";var defaults={},origDefaults=$$.util.copy(defaults);$$.defaults=function(opts){defaults=$$.util.extend({},origDefaults,opts)},$$.fn.core=function(fnMap,options){for(var name in fnMap){var fn=fnMap[name];$$.Core.prototype[name]=fn}},$$.Core=function(opts){if(!(this instanceof $$.Core))return new $$.Core(opts);var cy=this;opts=$$.util.extend({},defaults,opts);var container=opts.container,reg=container?container._cyreg:null;if(reg=reg||{},reg&&reg.cy){if(container)for(;container.firstChild;)container.removeChild(container.firstChild);reg.cy.notify({type:"destroy"}),reg={}}var readies=reg.readies=reg.readies||[];container&&(container._cyreg=reg),reg.cy=cy;var head=void 0!==window&&void 0!==container&&!opts.headless,options=opts;options.layout=$$.util.extend({name:head?"grid":"null"},options.layout),options.renderer=$$.util.extend({name:head?"canvas":"null"},options.renderer);var defVal=function(def,val,altVal){return void 0!==val?val:void 0!==altVal?altVal:def},_p=this._private={container:options.container,ready:!1,initrender:!1,options:options,elements:[],id2index:{},listeners:[],onRenders:[],aniEles:$$.Collection(this),scratch:{},layout:null,renderer:null,notificationsEnabled:!0,minZoom:1e-50,maxZoom:1e50,zoomingEnabled:defVal(!0,options.zoomingEnabled),userZoomingEnabled:defVal(!0,options.userZoomingEnabled),panningEnabled:defVal(!0,options.panningEnabled),userPanningEnabled:defVal(!0,options.userPanningEnabled),boxSelectionEnabled:defVal(!1,options.boxSelectionEnabled),autolock:defVal(!1,options.autolock,options.autolockNodes),autoungrabify:defVal(!1,options.autoungrabify,options.autoungrabifyNodes),autounselectify:defVal(!1,options.autounselectify),styleEnabled:void 0===options.styleEnabled?head:options.styleEnabled,zoom:$$.is.number(options.zoom)?options.zoom:1,pan:{x:$$.is.plainObject(options.pan)&&$$.is.number(options.pan.x)?options.pan.x:0,y:$$.is.plainObject(options.pan)&&$$.is.number(options.pan.y)?options.pan.y:0},animation:{current:[],queue:[]},hasCompoundNodes:!1,deferredExecQueue:[]},selType=options.selectionType;_p.selectionType=void 0===selType||"additive"!==selType&&"single"!==selType?"single":selType,$$.is.number(options.minZoom)&&$$.is.number(options.maxZoom)&&options.minZoom<options.maxZoom?(_p.minZoom=options.minZoom,_p.maxZoom=options.maxZoom):$$.is.number(options.minZoom)&&void 0===options.maxZoom?_p.minZoom=options.minZoom:$$.is.number(options.maxZoom)&&void 0===options.minZoom&&(_p.maxZoom=options.maxZoom);var loadExtData=function(next){for(var anyIsPromise=!1,i=0;i<extData.length;i++){var datum=extData[i];if($$.is.promise(datum)){anyIsPromise=!0;break}}return anyIsPromise?$$.Promise.all(extData).then(next):void next(extData)},extData=[options.style,options.elements];loadExtData(function(thens){var initStyle=thens[0],initEles=thens[1];_p.styleEnabled&&cy.setStyle(initStyle),cy.initRenderer($$.util.extend({hideEdgesOnViewport:options.hideEdgesOnViewport,hideLabelsOnViewport:options.hideLabelsOnViewport,textureOnViewport:options.textureOnViewport,wheelSensitivity:$$.is.number(options.wheelSensitivity)&&options.wheelSensitivity>0?options.wheelSensitivity:1,motionBlur:void 0===options.motionBlur?!0:options.motionBlur,motionBlurOpacity:void 0===options.motionBlurOpacity?.05:options.motionBlurOpacity,pixelRatio:$$.is.number(options.pixelRatio)&&options.pixelRatio>0?options.pixelRatio:"auto"===options.pixelRatio?void 0:1,desktopTapThreshold:void 0===options.desktopTapThreshold?4:options.desktopTapThreshold,touchTapThreshold:void 0===options.touchTapThreshold?8:options.touchTapThreshold},options.renderer)),options.initrender&&(cy.on("initrender",options.initrender),cy.on("initrender",function(){cy._private.initrender=!0})),cy.load(initEles,function(){cy.startAnimationLoop(),cy._private.ready=!0,$$.is.fn(options.ready)&&cy.on("ready",options.ready);for(var i=0;i<readies.length;i++){var fn=readies[i];cy.on("ready",fn)}reg&&(reg.readies=[]),cy.trigger("ready")},options.done)})},$$.corefn=$$.Core.prototype,$$.fn.core({isReady:function(){return this._private.ready},ready:function(fn){this.isReady()?this.trigger("ready",[],fn):this.on("ready",fn)},initrender:function(){return this._private.initrender},destroy:function(){this.notify({type:"destroy"});var domEle=this.container(),parEle=domEle.parentNode;if(parEle)try{parEle.removeChild(domEle)}catch(e){}return this},getElementById:function(id){var index=this._private.id2index[id];return void 0!==index?this._private.elements[index]:new $$.Collection(this)},selectionType:function(){return this._private.selectionType},hasCompoundNodes:function(){return this._private.hasCompoundNodes},styleEnabled:function(){return this._private.styleEnabled},addToPool:function(eles){for(var elements=this._private.elements,id2index=this._private.id2index,i=0;i<eles.length;i++){var ele=eles[i],id=ele._private.data.id,index=id2index[id],alreadyInPool=void 0!==index;alreadyInPool||(index=elements.length,elements.push(ele),id2index[id]=index,ele._private.index=index)}return this},removeFromPool:function(eles){for(var elements=this._private.elements,id2index=this._private.id2index,i=0;i<eles.length;i++){var ele=eles[i],id=ele._private.data.id,index=id2index[id],inPool=void 0!==index;if(inPool){this._private.id2index[id]=void 0,elements.splice(index,1);for(var j=index;j<elements.length;j++){var jid=elements[j]._private.data.id;id2index[jid]--,elements[j]._private.index--}}}},container:function(){return this._private.container},options:function(){return $$.util.copy(this._private.options)},json:function(params){var json={},cy=this;return json.elements={},cy.elements().each(function(i,ele){var group=ele.group();json.elements[group]||(json.elements[group]=[]),json.elements[group].push(ele.json())}),this._private.styleEnabled&&(json.style=cy.style().json()),json.zoomingEnabled=cy._private.zoomingEnabled,json.userZoomingEnabled=cy._private.userZoomingEnabled,json.zoom=cy._private.zoom,json.minZoom=cy._private.minZoom,json.maxZoom=cy._private.maxZoom,json.panningEnabled=cy._private.panningEnabled,json.userPanningEnabled=cy._private.userPanningEnabled,json.pan=cy._private.pan,json.boxSelectionEnabled=cy._private.boxSelectionEnabled,json.layout=cy._private.options.layout,json.renderer=cy._private.options.renderer,json.hideEdgesOnViewport=cy._private.options.hideEdgesOnViewport,json.hideLabelsOnViewport=cy._private.options.hideLabelsOnViewport,json.textureOnViewport=cy._private.options.textureOnViewport,json.wheelSensitivity=cy._private.options.wheelSensitivity,json.motionBlur=cy._private.options.motionBlur,json},defer:function(fn){var cy=this,_p=cy._private,q=_p.deferredExecQueue;q.push(fn),_p.deferredTimeout||(_p.deferredTimeout=setTimeout(function(){for(;q.length>0;)q.shift()();_p.deferredTimeout=null},0))}})}(cytoscape,"undefined"==typeof window?null:window),function($$,window){"use strict";function ready(f){var fn=!document||"interactive"!==document.readyState&&"complete"!==document.readyState?ready:f;setTimeout(fn,9,f)}$$.fn.core({add:function(opts){var elements,cy=this;if($$.is.elementOrCollection(opts)){var eles=opts;if(eles._private.cy===cy)elements=eles.restore();else{for(var jsons=[],i=0;i<eles.length;i++){var ele=eles[i];jsons.push(ele.json())}elements=new $$.Collection(cy,jsons)}}else if($$.is.array(opts)){var jsons=opts;elements=new $$.Collection(cy,jsons)}else if($$.is.plainObject(opts)&&($$.is.array(opts.nodes)||$$.is.array(opts.edges))){for(var elesByGroup=opts,jsons=[],grs=["nodes","edges"],i=0,il=grs.length;il>i;i++){var group=grs[i],elesArray=elesByGroup[group];if($$.is.array(elesArray))for(var j=0,jl=elesArray.length;jl>j;j++){var json=elesArray[j];json.group=group,jsons.push(json)}}elements=new $$.Collection(cy,jsons)}else{var json=opts;elements=new $$.Element(cy,json).collection()}return elements},remove:function(collection){if($$.is.elementOrCollection(collection))collection=collection;else if($$.is.string(collection)){var selector=collection;collection=this.$(selector)}return collection.remove()},load:function(elements,onload,ondone){function callback(){cy.one("layoutready",function(e){cy.notifications(!0),cy.trigger(e),cy.notify({type:"load",collection:cy.elements()}),cy.one("load",onload),cy.trigger("load")}).one("layoutstop",function(){cy.one("done",ondone),cy.trigger("done")});var layoutOpts=$$.util.extend({},cy._private.options.layout);layoutOpts.eles=cy.$(),cy.layout(layoutOpts)}var cy=this;cy.notifications(!1);var oldEles=cy.elements();return oldEles.length>0&&oldEles.remove(),null!=elements&&($$.is.plainObject(elements)||$$.is.array(elements))&&cy.add(elements),window?ready(callback):callback(),this}})}(cytoscape,"undefined"==typeof window?null:window),function($$,window){"use strict";$$.fn.core({animated:$$.define.animated(),clearQueue:$$.define.clearQueue(),delay:$$.define.delay(),animate:$$.define.animate(),stop:$$.define.stop(),addToAnimationPool:function(eles){var cy=this;cy.styleEnabled()&&cy._private.aniEles.merge(eles)},startAnimationLoop:function(){function globalAnimationStep(){$$.util.requestAnimationFrame(function(now){handleElements(now),globalAnimationStep()})}function handleElements(now){function handleElement(ele,isCore){var current=ele._private.animation.current,queue=ele._private.animation.queue,ranAnis=!1;if(0===current.length){var next=queue.length>0?queue.shift():null;next&&(next.callTime=now,current.push(next))}for(var completes=[],i=current.length-1;i>=0;i--){var ani=current[i];ani.started||startAnimation(ele,ani),step(ele,ani,now,isCore),ani.done&&(completes.push(ani),current.splice(i,1)),ranAnis=!0}for(var i=0;i<completes.length;i++){var ani=completes[i],complete=ani.params.complete;$$.is.fn(complete)&&complete.apply(ele,[now])}return isCore||0!==current.length||0!==queue.length||doneEles.push(ele),ranAnis}now=+new Date;for(var eles=cy._private.aniEles,doneEles=[],e=0;e<eles.length;e++){var ele=eles[e];handleElement(ele)}var ranCoreAni=handleElement(cy,!0);if(eles.length>0||ranCoreAni){var toNotify;if(eles.length>0){var updatedEles=eles.updateCompoundBounds();toNotify=updatedEles.length>0?eles.add(updatedEles):eles}cy.notify({type:"draw",collection:toNotify})}eles.unmerge(doneEles)}function startAnimation(self,ani){var isCore=$$.is.core(self),isEles=!isCore,ele=self,style=cy._private.style;if(isEles)var pos=ele._private.position,startPosition={x:pos.x,y:pos.y},startStyle=style.getValueStyle(ele);if(isCore)var pan=cy._private.pan,startPan={x:pan.x,y:pan.y},startZoom=cy._private.zoom;ani.started=!0,ani.startTime=Date.now(),ani.startPosition=startPosition,ani.startStyle=startStyle,ani.startPan=startPan,ani.startZoom=startZoom}function step(self,animation,now,isCore){var percent,style=cy._private.style,properties=animation.properties,params=animation.params,startTime=animation.startTime,isEles=!isCore;if(percent=0===animation.duration?1:Math.min(1,(now-startTime)/animation.duration),0>percent?percent=0:percent>1&&(percent=1),null==properties.delay){var startPos=animation.startPosition,endPos=properties.position,pos=self._private.position;endPos&&isEles&&(valid(startPos.x,endPos.x)&&(pos.x=ease(startPos.x,endPos.x,percent)),valid(startPos.y,endPos.y)&&(pos.y=ease(startPos.y,endPos.y,percent)));var startPan=animation.startPan,endPan=properties.pan,pan=self._private.pan,animatingPan=null!=endPan&&isCore;animatingPan&&(valid(startPan.x,endPan.x)&&(pan.x=ease(startPan.x,endPan.x,percent)),valid(startPan.y,endPan.y)&&(pan.y=ease(startPan.y,endPan.y,percent)),self.trigger("pan"));var startZoom=animation.startZoom,endZoom=properties.zoom,animatingZoom=null!=endZoom&&isCore;animatingZoom&&(valid(startZoom,endZoom)&&(self._private.zoom=ease(startZoom,endZoom,percent)),self.trigger("zoom")),(animatingPan||animatingZoom)&&self.trigger("viewport");var props=properties.style||properties.css;if(props&&isEles)for(var i=0;i<props.length;i++){var name=props[i].name,prop=props[i],end=prop,start=animation.startStyle[name],easedVal=ease(start,end,percent);style.overrideBypass(self,name,easedVal)}}return $$.is.fn(params.step)&&params.step.apply(self,[now]),percent>=1&&(animation.done=!0),percent}function valid(start,end){return null==start||null==end?!1:$$.is.number(start)&&$$.is.number(end)?!0:start&&end?!0:!1}function ease(startProp,endProp,percent){0>percent?percent=0:percent>1&&(percent=1);var start,end;if(start=null!=startProp.pxValue||null!=startProp.value?null!=startProp.pxValue?startProp.pxValue:startProp.value:startProp,end=null!=endProp.pxValue||null!=endProp.value?null!=endProp.pxValue?endProp.pxValue:endProp.value:endProp,$$.is.number(start)&&$$.is.number(end))return start+(end-start)*percent;if($$.is.number(start[0])&&$$.is.number(end[0])){var c1=start,c2=end,ch=function(ch1,ch2){var diff=ch2-ch1,min=ch1;return Math.round(percent*diff+min)},r=ch(c1[0],c2[0]),g=ch(c1[1],c2[1]),b=ch(c1[2],c2[2]);return[r,g,b]}return void 0}var cy=this;cy.styleEnabled()&&window&&globalAnimationStep()}})}(cytoscape,"undefined"==typeof window?null:window),function($$){"use strict";$$.fn.core({data:$$.define.data({field:"data",bindingEvent:"data",allowBinding:!0,allowSetting:!0,settingEvent:"data",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0}),removeData:$$.define.removeData({field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!0}),scratch:$$.define.data({field:"scratch",allowBinding:!1,allowSetting:!0,settingTriggersEvent:!1,allowGetting:!0}),removeScratch:$$.define.removeData({field:"scratch",triggerEvent:!1})})}(cytoscape),function($$){"use strict";$$.fn.core({on:$$.define.on(),one:$$.define.on({unbindSelfOnTrigger:!0
}),once:$$.define.on({unbindAllBindersOnTrigger:!0}),off:$$.define.off(),trigger:$$.define.trigger()}),$$.define.eventAliasesOn($$.corefn)}(cytoscape),function($$){"use strict";$$.fn.core({png:function(options){var renderer=this._private.renderer;return options=options||{},renderer.png(options)},jpg:function(options){var renderer=this._private.renderer;return options=options||{},options.bg=options.bg||"#fff",renderer.jpg(options)}}),$$.corefn.jpeg=$$.corefn.jpg}(cytoscape),function($$){"use strict";$$.fn.core({layout:function(params){var layout;return null==params&&(params=$$.util.extend({},this._private.options.layout),params.eles=this.$()),layout=this.initLayout(params),layout.run(),this},makeLayout:function(params){return this.initLayout(params)},initLayout:function(options){if(null==options)return void $$.util.error("Layout options must be specified to make a layout");if(null==options.name)return void $$.util.error("A `name` must be specified to make a layout");var name=options.name,LayoutProto=$$.extension("layout",name);if(null==LayoutProto)return void $$.util.error("Can not apply layout: No such layout `"+name+"` found; did you include its JS file?");options.eles=null!=options.eles?options.eles:this.$(),$$.is.string(options.eles)&&(options.eles=this.$(options.eles));var layout=new LayoutProto($$.util.extend({},options,{cy:this}));return $$.is.plainObject(layout._private)||(layout._private={}),layout._private.cy=this,layout._private.listeners=[],layout}}),$$.corefn.createLayout=$$.corefn.makeLayout}(cytoscape),function($$){"use strict";$$.fn.core({notify:function(params){if(this._private.batchingNotify){var bEles=this._private.batchNotifyEles,bTypes=this._private.batchNotifyTypes;if(params.collection)for(var i=0;i<params.collection.length;i++){var ele=params.collection[i];bEles.ids[ele._private.id]||bEles.push(ele)}return void(bTypes.ids[params.type]||bTypes.push(params.type))}if(this._private.notificationsEnabled){var renderer=this.renderer();renderer.notify(params)}},notifications:function(bool){var p=this._private;return void 0===bool?p.notificationsEnabled:void(p.notificationsEnabled=bool?!0:!1)},noNotifications:function(callback){this.notifications(!1),callback(),this.notifications(!0)},startBatch:function(){var _p=this._private;return _p.batchingStyle=_p.batchingNotify=!0,_p.batchStyleEles=[],_p.batchNotifyEles=[],_p.batchNotifyTypes=[],_p.batchStyleEles.ids={},_p.batchNotifyEles.ids={},_p.batchNotifyTypes.ids={},this},endBatch:function(){var _p=this._private;return _p.batchingStyle=!1,new $$.Collection(this,_p.batchStyleEles).updateStyle(),_p.batchingNotify=!1,this.notify({type:_p.batchNotifyTypes,collection:_p.batchNotifyEles}),this},batch:function(callback){return this.startBatch(),callback(),this.endBatch(),this},batchData:function(map){var cy=this;return this.batch(function(){for(var id in map){var data=map[id],ele=cy.getElementById(id);ele.data(data)}})}})}(cytoscape),function($$){"use strict";$$.fn.core({renderTo:function(context,zoom,pan,pxRatio){var r=this._private.renderer;return r.renderTo(context,zoom,pan,pxRatio),this},renderer:function(){return this._private.renderer},forceRender:function(){return this.notify({type:"draw"}),this},resize:function(){return this.notify({type:"resize"}),this.trigger("resize"),this},initRenderer:function(options){var cy=this,RendererProto=$$.extension("renderer",options.name);return null==RendererProto?void $$.util.error("Can not initialise: No such renderer `%s` found; did you include its JS file?",options.name):void(this._private.renderer=new RendererProto($$.util.extend({},options,{cy:cy,style:cy._private.style})))},triggerOnRender:function(){for(var cbs=this._private.onRenders,i=0;i<cbs.length;i++){var cb=cbs[i];cb()}return this},onRender:function(cb){return this._private.onRenders.push(cb),this},offRender:function(fn){var cbs=this._private.onRenders;if(null==fn)return this._private.onRenders=[],this;for(var i=0;i<cbs.length;i++){var cb=cbs[i];if(fn===cb){cbs.splice(i,1);break}}return this}})}(cytoscape),function($$){"use strict";$$.fn.core({collection:function(eles){return $$.is.string(eles)?this.$(eles):$$.is.elementOrCollection(eles)?eles.collection():$$.is.array(eles)?new $$.Collection(this,eles):new $$.Collection(this)},nodes:function(selector){var nodes=this.$(function(){return this.isNode()});return selector?nodes.filter(selector):nodes},edges:function(selector){var edges=this.$(function(){return this.isEdge()});return selector?edges.filter(selector):edges},$:function(selector){var eles=new $$.Collection(this,this._private.elements);return selector?eles.filter(selector):eles}}),$$.corefn.elements=$$.corefn.filter=$$.corefn.$}(cytoscape),function($$){"use strict";$$.fn.core({style:function(newStyle){if(newStyle){var s=this.setStyle(newStyle);s.update()}return this._private.style},setStyle:function(style){var _p=this._private;return _p.style=$$.is.stylesheet(style)?style.generateStyle(this):$$.is.array(style)?$$.style.fromJson(this,style):$$.is.string(style)?$$.style.fromString(this,style):new $$.Style(this),_p.style}})}(cytoscape),function($$){"use strict";$$.fn.core({autolock:function(bool){return void 0===bool?this._private.autolock:(this._private.autolock=bool?!0:!1,this)},autoungrabify:function(bool){return void 0===bool?this._private.autoungrabify:(this._private.autoungrabify=bool?!0:!1,this)},autounselectify:function(bool){return void 0===bool?this._private.autounselectify:(this._private.autounselectify=bool?!0:!1,this)},panningEnabled:function(bool){return void 0===bool?this._private.panningEnabled:(this._private.panningEnabled=bool?!0:!1,this)},userPanningEnabled:function(bool){return void 0===bool?this._private.userPanningEnabled:(this._private.userPanningEnabled=bool?!0:!1,this)},zoomingEnabled:function(bool){return void 0===bool?this._private.zoomingEnabled:(this._private.zoomingEnabled=bool?!0:!1,this)},userZoomingEnabled:function(bool){return void 0===bool?this._private.userZoomingEnabled:(this._private.userZoomingEnabled=bool?!0:!1,this)},boxSelectionEnabled:function(bool){return void 0===bool?this._private.boxSelectionEnabled:(this._private.boxSelectionEnabled=bool?!0:!1,this)},pan:function(){var dim,val,dims,x,y,args=arguments,pan=this._private.pan;switch(args.length){case 0:return pan;case 1:if($$.is.string(args[0]))return dim=args[0],pan[dim];if($$.is.plainObject(args[0])){if(!this._private.panningEnabled)return this;dims=args[0],x=dims.x,y=dims.y,$$.is.number(x)&&(pan.x=x),$$.is.number(y)&&(pan.y=y),this.trigger("pan viewport")}break;case 2:if(!this._private.panningEnabled)return this;dim=args[0],val=args[1],"x"!==dim&&"y"!==dim||!$$.is.number(val)||(pan[dim]=val),this.trigger("pan viewport")}return this.notify({type:"viewport"}),this},panBy:function(params){var dim,val,dims,x,y,args=arguments,pan=this._private.pan;if(!this._private.panningEnabled)return this;switch(args.length){case 1:$$.is.plainObject(args[0])&&(dims=args[0],x=dims.x,y=dims.y,$$.is.number(x)&&(pan.x+=x),$$.is.number(y)&&(pan.y+=y),this.trigger("pan viewport"));break;case 2:dim=args[0],val=args[1],"x"!==dim&&"y"!==dim||!$$.is.number(val)||(pan[dim]+=val),this.trigger("pan viewport")}return this.notify({type:"viewport"}),this},fit:function(elements,padding){var viewportState=this.getFitViewport(elements,padding);if(viewportState){var _p=this._private;_p.zoom=viewportState.zoom,_p.pan=viewportState.pan,this.trigger("pan zoom viewport"),this.notify({type:"viewport"})}return this},getFitViewport:function(elements,padding){if($$.is.number(elements)&&void 0===padding&&(padding=elements,elements=void 0),this._private.panningEnabled&&this._private.zoomingEnabled){var bb;if($$.is.string(elements)){var sel=elements;elements=this.$(sel)}else if($$.is.boundingBox(elements)){var bbe=elements;bb={x1:bbe.x1,y1:bbe.y1,x2:bbe.x2,y2:bbe.y2},bb.w=bb.x2-bb.x1,bb.h=bb.y2-bb.y1}else $$.is.elementOrCollection(elements)||(elements=this.elements());bb=bb||elements.boundingBox();var zoom,w=this.width(),h=this.height();if(padding=$$.is.number(padding)?padding:0,!isNaN(w)&&!isNaN(h)&&w>0&&h>0&&!isNaN(bb.w)&&!isNaN(bb.h)&&bb.w>0&&bb.h>0){zoom=Math.min((w-2*padding)/bb.w,(h-2*padding)/bb.h),zoom=zoom>this._private.maxZoom?this._private.maxZoom:zoom,zoom=zoom<this._private.minZoom?this._private.minZoom:zoom;var pan={x:(w-zoom*(bb.x1+bb.x2))/2,y:(h-zoom*(bb.y1+bb.y2))/2};return{zoom:zoom,pan:pan}}}},minZoom:function(zoom){return void 0===zoom?this._private.minZoom:($$.is.number(zoom)&&(this._private.minZoom=zoom),this)},maxZoom:function(zoom){return void 0===zoom?this._private.maxZoom:($$.is.number(zoom)&&(this._private.maxZoom=zoom),this)},zoom:function(params){var pos,zoom;if(void 0===params)return this._private.zoom;if($$.is.number(params))zoom=params;else if($$.is.plainObject(params)){if(zoom=params.level,params.position){var p=params.position,pan=this._private.pan,z=this._private.zoom;pos={x:p.x*z+pan.x,y:p.y*z+pan.y}}else params.renderedPosition&&(pos=params.renderedPosition);if(pos&&!this._private.panningEnabled)return this}if(!this._private.zoomingEnabled)return this;if(!$$.is.number(zoom)||pos&&(!$$.is.number(pos.x)||!$$.is.number(pos.y)))return this;if(zoom=zoom>this._private.maxZoom?this._private.maxZoom:zoom,zoom=zoom<this._private.minZoom?this._private.minZoom:zoom,pos){var pan1=this._private.pan,zoom1=this._private.zoom,zoom2=zoom,pan2={x:-zoom2/zoom1*(pos.x-pan1.x)+pos.x,y:-zoom2/zoom1*(pos.y-pan1.y)+pos.y};this._private.zoom=zoom,this._private.pan=pan2;var posChanged=pan1.x!==pan2.x||pan1.y!==pan2.y;this.trigger(" zoom "+(posChanged?" pan ":"")+" viewport ")}else this._private.zoom=zoom,this.trigger("zoom viewport");return this.notify({type:"viewport"}),this},viewport:function(opts){var _p=this._private,zoomDefd=!0,panDefd=!0,events=[],zoomFailed=!1,panFailed=!1;if(!opts)return this;if($$.is.number(opts.zoom)||(zoomDefd=!1),$$.is.plainObject(opts.pan)||(panDefd=!1),!zoomDefd&&!panDefd)return this;if(zoomDefd){var z=opts.zoom;z<_p.minZoom||z>_p.maxZoom||!_p.zoomingEnabled?zoomFailed=!0:(_p.zoom=z,events.push("zoom"))}if(panDefd&&(!zoomFailed||!opts.cancelOnFailedZoom)&&_p.panningEnabled){var p=opts.pan;$$.is.number(p.x)&&(_p.pan.x=p.x,panFailed=!1),$$.is.number(p.y)&&(_p.pan.y=p.y,panFailed=!1),panFailed||events.push("pan")}return events.length>0&&(events.push("viewport"),this.trigger(events.join(" ")),this.notify({type:"viewport"})),this},center:function(elements){var pan=this.getCenterPan(elements);return pan&&(this._private.pan=pan,this.trigger("pan viewport"),this.notify({type:"viewport"})),this},getCenterPan:function(elements,zoom){if(this._private.panningEnabled){if($$.is.string(elements)){var selector=elements;elements=this.elements(selector)}else $$.is.elementOrCollection(elements)||(elements=this.elements());var bb=elements.boundingBox(),w=this.width(),h=this.height();zoom=void 0===zoom?this._private.zoom:zoom;var pan={x:(w-zoom*(bb.x1+bb.x2))/2,y:(h-zoom*(bb.y1+bb.y2))/2};return pan}},reset:function(){return this._private.panningEnabled&&this._private.zoomingEnabled?(this.viewport({pan:{x:0,y:0},zoom:1}),this):this},width:function(){var container=this._private.container;return container?container.clientWidth:1},height:function(){var container=this._private.container;return container?container.clientHeight:1},extent:function(){var pan=this._private.pan,zoom=this._private.zoom,rb=this.renderedExtent(),b={x1:(rb.x1-pan.x)/zoom,x2:(rb.x2-pan.x)/zoom,y1:(rb.y1-pan.y)/zoom,y2:(rb.y2-pan.y)/zoom};return b.w=b.x2-b.x1,b.h=b.y2-b.y1,b},renderedExtent:function(){var width=this.width(),height=this.height();return{x1:0,y1:0,x2:width,y2:height,w:width,h:height}}}),$$.corefn.centre=$$.corefn.center,$$.corefn.autolockNodes=$$.corefn.autolock,$$.corefn.autoungrabifyNodes=$$.corefn.autoungrabify}(cytoscape),function($$){"use strict";$$.fn.collection=$$.fn.eles=function(fnMap,options){for(var name in fnMap){var fn=fnMap[name];$$.Collection.prototype[name]=fn}};var idFactory={prefix:{nodes:"n",edges:"e"},id:{nodes:0,edges:0},generate:function(cy,element,tryThisId){var json=$$.is.element(element)?element._private:element,group=json.group,id=null!=tryThisId?tryThisId:this.prefix[group]+this.id[group];if(cy.getElementById(id).empty())this.id[group]++;else for(;!cy.getElementById(id).empty();)id=this.prefix[group]+ ++this.id[group];return id}};$$.Element=function(cy,params,restore){if(!(this instanceof $$.Element))return new $$.Element(cy,params,restore);var self=this;if(restore=void 0===restore||restore?!0:!1,void 0===cy||void 0===params||!$$.is.core(cy))return void $$.util.error("An element must have a core reference and parameters set");if("nodes"!==params.group&&"edges"!==params.group)return void $$.util.error("An element must be of type `nodes` or `edges`; you specified `"+params.group+"`");if(this.length=1,this[0]=this,this._private={cy:cy,single:!0,data:params.data||{},position:params.position||{},autoWidth:void 0,autoHeight:void 0,listeners:[],group:params.group,style:{},rstyle:{},styleCxts:[],removed:!0,selected:params.selected?!0:!1,selectable:void 0===params.selectable?!0:params.selectable?!0:!1,locked:params.locked?!0:!1,grabbed:!1,grabbable:void 0===params.grabbable?!0:params.grabbable?!0:!1,active:!1,classes:{},animation:{current:[],queue:[]},rscratch:{},scratch:params.scratch||{},edges:[],children:[]},params.renderedPosition){var rpos=params.renderedPosition,pan=cy.pan(),zoom=cy.zoom();this._private.position={x:(rpos.x-pan.x)/zoom,y:(rpos.y-pan.y)/zoom}}if($$.is.string(params.classes))for(var classes=params.classes.split(/\s+/),i=0,l=classes.length;l>i;i++){var cls=classes[i];cls&&""!==cls&&(self._private.classes[cls]=!0)}params.css&&cy.style().applyBypass(this,params.css),(void 0===restore||restore)&&this.restore()},$$.Collection=function(cy,elements,options){if(!(this instanceof $$.Collection))return new $$.Collection(cy,elements);if(void 0===cy||!$$.is.core(cy))return void $$.util.error("A collection must have a reference to the core");var ids={},indexes={},createdElements=!1;if(elements){if(elements.length>0&&$$.is.plainObject(elements[0])&&!$$.is.element(elements[0])){createdElements=!0;for(var eles=[],elesIds={},i=0,l=elements.length;l>i;i++){var json=elements[i];null==json.data&&(json.data={});var data=json.data;if(null==data.id)data.id=idFactory.generate(cy,json);else if(0!==cy.getElementById(data.id).length||elesIds[data.id])continue;var ele=new $$.Element(cy,json,!1);eles.push(ele),elesIds[data.id]=!0}elements=eles}}else elements=[];this.length=0;for(var i=0,l=elements.length;l>i;i++){var element=elements[i];if(element){var id=element._private.data.id;(!options||options.unique&&!ids[id])&&(ids[id]=element,indexes[id]=this.length,this[this.length]=element,this.length++)}}this._private={cy:cy,ids:ids,indexes:indexes},createdElements&&this.restore()},$$.elefn=$$.elesfn=$$.Element.prototype=$$.Collection.prototype,$$.elesfn.cy=function(){return this._private.cy},$$.elesfn.element=function(){return this[0]},$$.elesfn.collection=function(){return $$.is.collection(this)?this:new $$.Collection(this._private.cy,[this])},$$.elesfn.unique=function(){return new $$.Collection(this._private.cy,this,{unique:!0})},$$.elesfn.getElementById=function(id){var cy=this._private.cy,ele=this._private.ids[id];return ele?ele:$$.Collection(cy)},$$.elesfn.json=function(){var ele=this.element();if(null==ele)return void 0;var p=ele._private,json=$$.util.copy({data:p.data,position:p.position,group:p.group,bypass:p.bypass,removed:p.removed,selected:p.selected,selectable:p.selectable,locked:p.locked,grabbed:p.grabbed,grabbable:p.grabbable,classes:""}),classes=[];for(var cls in p.classes)p.classes[cls]&&classes.push(cls);for(var i=0;i<classes.length;i++){var cls=classes[i];json.classes+=cls+(i<classes.length-1?" ":"")}return json},$$.elesfn.jsons=function(){for(var jsons=[],i=0;i<this.length;i++){var ele=this[i],json=ele.json();jsons.push(json)}return jsons},$$.elesfn.clone=function(){for(var cy=this.cy(),elesArr=[],i=0;i<this.length;i++){var ele=this[i],json=ele.json(),clone=new $$.Element(cy,json,!1);elesArr.push(clone)}return new $$.Collection(cy,elesArr)},$$.elesfn.copy=$$.elesfn.clone,$$.elesfn.restore=function(notifyRenderer){var self=this,restored=[],cy=self.cy();void 0===notifyRenderer&&(notifyRenderer=!0);for(var elements=[],nodes=[],edges=[],numNodes=0,numEdges=0,i=0,l=self.length;l>i;i++){var ele=self[i];ele.isNode()?(nodes.push(ele),numNodes++):(edges.push(ele),numEdges++)}elements=nodes.concat(edges);for(var i=0,l=elements.length;l>i;i++){var ele=elements[i];if(ele.removed()){var _private=ele._private,data=_private.data;if(void 0===data.id)data.id=idFactory.generate(cy,ele);else{if($$.is.emptyString(data.id)||!$$.is.string(data.id)){$$.util.error("Can not create element with invalid string ID `"+data.id+"`");continue}if(0!==cy.getElementById(data.id).length){$$.util.error("Can not create second element with ID `"+data.id+"`");continue}}var id=data.id;if(ele.isEdge()){for(var edge=ele,fields=["source","target"],fieldsLength=fields.length,badSourceOrTarget=!1,j=0;fieldsLength>j;j++){var field=fields[j],val=data[field];null==val||""===val?($$.util.error("Can not create edge `"+id+"` with unspecified "+field),badSourceOrTarget=!0):cy.getElementById(val).empty()&&($$.util.error("Can not create edge `"+id+"` with nonexistant "+field+" `"+val+"`"),badSourceOrTarget=!0)}if(badSourceOrTarget)continue;var src=cy.getElementById(data.source),tgt=cy.getElementById(data.target);src._private.edges.push(edge),tgt._private.edges.push(edge),edge._private.source=src,edge._private.target=tgt}_private.ids={},_private.ids[id]=ele,_private.removed=!1,cy.addToPool(ele),restored.push(ele)}}for(var i=0;numNodes>i;i++){var node=elements[i],data=node._private.data,parentId=node._private.data.parent,specifiedParent=null!=parentId;if(specifiedParent){var parent=cy.getElementById(parentId);if(parent.empty())data.parent=void 0;else{for(var selfAsParent=!1,ancestor=parent;!ancestor.empty();){if(node.same(ancestor)){selfAsParent=!0,data.parent=void 0;break}ancestor=ancestor.parent()}selfAsParent||(parent[0]._private.children.push(node),node._private.parent=parent[0],cy._private.hasCompoundNodes=!0)}}}if(restored=new $$.Collection(cy,restored),restored.length>0){var toUpdateStyle=restored.add(restored.connectedNodes()).add(restored.parent());toUpdateStyle.updateStyle(notifyRenderer),notifyRenderer?restored.rtrigger("add"):restored.trigger("add")}return self},$$.elesfn.removed=function(){var ele=this[0];return ele&&ele._private.removed},$$.elesfn.inside=function(){var ele=this[0];return ele&&!ele._private.removed},$$.elesfn.remove=function(notifyRenderer){function addConnectedEdges(node){for(var edges=node._private.edges,i=0;i<edges.length;i++)add(edges[i])}function addChildren(node){for(var children=node._private.children,i=0;i<children.length;i++)add(children[i])}function add(ele){var alreadyAdded=elesToRemoveIds[ele.id()];alreadyAdded||(elesToRemoveIds[ele.id()]=!0,ele.isNode()?(elesToRemove.push(ele),addConnectedEdges(ele),addChildren(ele)):elesToRemove.unshift(ele))}function removeEdgeRef(node,edge){for(var connectedEdges=node._private.edges,j=0;j<connectedEdges.length;j++){var connectedEdge=connectedEdges[j];if(edge===connectedEdge){connectedEdges.splice(j,1);break}}}function removeChildRef(parent,ele){ele=ele[0],parent=parent[0];for(var children=parent._private.children,j=0;j<children.length;j++)if(children[j][0]===ele[0]){children.splice(j,1);break}}var self=this,removed=[],elesToRemove=[],elesToRemoveIds={},cy=self._private.cy;void 0===notifyRenderer&&(notifyRenderer=!0);for(var i=0,l=self.length;l>i;i++){var ele=self[i];add(ele)}for(var i=0;i<elesToRemove.length;i++){var ele=elesToRemove[i];if(ele._private.removed=!0,cy.removeFromPool(ele),removed.push(ele),ele.isEdge()){var src=ele.source()[0],tgt=ele.target()[0];removeEdgeRef(src,ele),removeEdgeRef(tgt,ele)}else{var parent=ele.parent();0!==parent.length&&removeChildRef(parent,ele)}}var elesStillInside=cy._private.elements;cy._private.hasCompoundNodes=!1;for(var i=0;i<elesStillInside.length;i++){var ele=elesStillInside[i];if(ele.isParent()){cy._private.hasCompoundNodes=!0;break}}var removedElements=new $$.Collection(this.cy(),removed);removedElements.size()>0&&(notifyRenderer&&this.cy().notify({type:"remove",collection:removedElements}),removedElements.trigger("remove"));for(var checkedParentId={},i=0;i<elesToRemove.length;i++){var ele=elesToRemove[i],isNode="nodes"===ele._private.group,parentId=ele._private.data.parent;if(isNode&&void 0!==parentId&&!checkedParentId[parentId]){checkedParentId[parentId]=!0;var parent=cy.getElementById(parentId);parent&&0!==parent.length&&!parent._private.removed&&0===parent.children().length&&parent.updateStyle()}}return this},$$.elesfn.move=function(struct){var cy=this._private.cy;if(void 0!==struct.source||void 0!==struct.target){var srcId=struct.source,tgtId=struct.target,srcExists=cy.getElementById(srcId).length>0,tgtExists=cy.getElementById(tgtId).length>0;if(srcExists||tgtExists){var jsons=this.jsons();this.remove();for(var i=0;i<jsons.length;i++){var json=jsons[i];"edges"===json.group&&(srcExists&&(json.data.source=srcId),tgtExists&&(json.data.target=tgtId))}return cy.add(jsons)}}else if(void 0!==struct.parent){var parentId=struct.parent,parentExists=null===parentId||cy.getElementById(parentId).length>0;if(parentExists){var jsons=this.jsons(),descs=this.descendants(),descsEtc=descs.merge(descs.add(this).connectedEdges());this.remove();for(var i=0;i<this.length;i++){var json=jsons[i];"nodes"===json.group&&(json.data.parent=null===parentId?void 0:parentId)}}return cy.add(jsons).merge(descsEtc.restore())}return this}}(cytoscape),function($$){"use strict";$$.fn.eles({stdBreadthFirstSearch:function(options){return options=$$.util.extend({},options,{std:!0}),this.breadthFirstSearch(options)},breadthFirstSearch:function(roots,fn,directed){var options,std,thisArg;$$.is.plainObject(roots)&&!$$.is.elementOrCollection(roots)&&(options=roots,roots=options.roots,fn=options.visit,directed=options.directed,std=options.std,thisArg=options.thisArg),directed=2!==arguments.length||$$.is.fn(fn)?directed:fn,fn=$$.is.fn(fn)?fn:function(){};for(var found,cy=this._private.cy,v=$$.is.string(roots)?this.filter(roots):roots,Q=[],connectedNodes=[],connectedBy={},id2depth={},V={},j=0,nodes=this.nodes(),edges=this.edges(),i=0;i<v.length;i++)v[i].isNode()&&(Q.unshift(v[i]),V[v[i].id()]=!0,connectedNodes.push(v[i]),id2depth[v[i].id()]=0);for(;0!==Q.length;){var ret,v=Q.shift(),depth=id2depth[v.id()],prevEdge=connectedBy[v.id()],prevNode=null==prevEdge?void 0:prevEdge.connectedNodes().not(v)[0];if(ret=std?fn.call(thisArg,v,prevEdge,prevNode,j++,depth):fn.call(v,j++,depth,v,prevEdge,prevNode),ret===!0){found=v;break}if(ret===!1)break;for(var vwEdges=v.connectedEdges(directed?function(){return this.data("source")===v.id()}:void 0).intersect(edges),i=0;i<vwEdges.length;i++){var e=vwEdges[i],w=e.connectedNodes(function(){return this.id()!==v.id()}).intersect(nodes);0===w.length||V[w.id()]||(w=w[0],Q.push(w),V[w.id()]=!0,id2depth[w.id()]=id2depth[v.id()]+1,connectedNodes.push(w),connectedBy[w.id()]=e)}}for(var connectedEles=[],i=0;i<connectedNodes.length;i++){var node=connectedNodes[i],edge=connectedBy[node.id()];edge&&connectedEles.push(edge),connectedEles.push(node)}return{path:new $$.Collection(cy,connectedEles,{unique:!0}),found:new $$.Collection(cy,found,{unique:!0})}},stdDepthFirstSearch:function(options){return options=$$.util.extend({},options,{std:!0}),this.depthFirstSearch(options)},depthFirstSearch:function(roots,fn,directed){var options,std,thisArg;$$.is.plainObject(roots)&&!$$.is.elementOrCollection(roots)&&(options=roots,roots=options.roots,fn=options.visit,directed=options.directed,std=options.std,thisArg=options.thisArg),directed=2!==arguments.length||$$.is.fn(fn)?directed:fn,fn=$$.is.fn(fn)?fn:function(){};for(var found,cy=this._private.cy,v=$$.is.string(roots)?this.filter(roots):roots,S=[],connectedNodes=[],connectedBy={},id2depth={},discovered={},j=0,edges=this.edges(),nodes=this.nodes(),i=0;i<v.length;i++)v[i].isNode()&&(S.push(v[i]),connectedNodes.push(v[i]),id2depth[v[i].id()]=0);for(;0!==S.length;){var v=S.pop();if(!discovered[v.id()]){discovered[v.id()]=!0;var ret,depth=id2depth[v.id()],prevEdge=connectedBy[v.id()],prevNode=null==prevEdge?void 0:prevEdge.connectedNodes().not(v)[0];if(ret=std?fn.call(thisArg,v,prevEdge,prevNode,j++,depth):fn.call(v,j++,depth,v,prevEdge,prevNode),ret===!0){found=v;break}if(ret===!1)break;for(var vwEdges=v.connectedEdges(directed?function(){return this.data("source")===v.id()}:void 0).intersect(edges),i=0;i<vwEdges.length;i++){var e=vwEdges[i],w=e.connectedNodes(function(){return this.id()!==v.id()}).intersect(nodes);0===w.length||discovered[w.id()]||(w=w[0],S.push(w),id2depth[w.id()]=id2depth[v.id()]+1,connectedNodes.push(w),connectedBy[w.id()]=e)}}}for(var connectedEles=[],i=0;i<connectedNodes.length;i++){var node=connectedNodes[i],edge=connectedBy[node.id()];edge&&connectedEles.push(edge),connectedEles.push(node)}return{path:new $$.Collection(cy,connectedEles,{unique:!0}),found:new $$.Collection(cy,found,{unique:!0})}},kruskal:function(weightFn){function findSet(ele){for(var i=0;i<forest.length;i++){var eles=forest[i];if(eles.anySame(ele))return{eles:eles,index:i}}}weightFn=$$.is.fn(weightFn)?weightFn:function(){return 1};for(var A=new $$.Collection(this._private.cy,[]),forest=[],nodes=this.nodes(),i=0;i<nodes.length;i++)forest.push(nodes[i].collection());for(var edges=this.edges(),S=edges.toArray().sort(function(a,b){var weightA=weightFn.call(a,a),weightB=weightFn.call(b,b);return weightA-weightB}),i=0;i<S.length;i++){var edge=S[i],u=edge.source()[0],v=edge.target()[0],setU=findSet(u),setV=findSet(v);setU.index!==setV.index&&(A=A.add(edge),forest[setU.index]=setU.eles.add(setV.eles),forest.splice(setV.index,1))}return nodes.add(A)},dijkstra:function(root,weightFn,directed){var options;$$.is.plainObject(root)&&!$$.is.elementOrCollection(root)&&(options=root,root=options.root,weightFn=options.weight,directed=options.directed);var cy=this._private.cy;weightFn=$$.is.fn(weightFn)?weightFn:function(){return 1};for(var source=$$.is.string(root)?this.filter(root)[0]:root[0],dist={},prev={},knownDist={},edges=this.edges().filter(function(){return!this.isLoop()}),nodes=this.nodes(),Q=[],i=0;i<nodes.length;i++)dist[nodes[i].id()]=nodes[i].same(source)?0:1/0,Q.push(nodes[i]);var valueFn=function(node){return dist[node.id()]};Q=new $$.Collection(cy,Q);for(var heap=$$.Minheap(cy,Q,valueFn),distBetween=function(u,v){for(var smallestEdge,uvs=(directed?u.edgesTo(v):u.edgesWith(v)).intersect(edges),smallestDistance=1/0,i=0;i<uvs.length;i++){var edge=uvs[i],weight=weightFn.apply(edge,[edge]);(smallestDistance>weight||!smallestEdge)&&(smallestDistance=weight,smallestEdge=edge)}return{edge:smallestEdge,dist:smallestDistance}};heap.size()>0;){var smallestEl=heap.pop(),smalletsDist=smallestEl.value,uid=smallestEl.id,u=cy.getElementById(uid);if(knownDist[uid]=smalletsDist,smalletsDist===Math.Infinite)break;for(var neighbors=u.neighborhood().intersect(nodes),i=0;i<neighbors.length;i++){var v=neighbors[i],vid=v.id(),vDist=distBetween(u,v),alt=smalletsDist+vDist.dist;alt<heap.getValueById(vid)&&(heap.edit(vid,alt),prev[vid]={node:u,edge:vDist.edge})}}return{distanceTo:function(node){var target=$$.is.string(node)?nodes.filter(node)[0]:node[0];return knownDist[target.id()]},pathTo:function(node){var target=$$.is.string(node)?nodes.filter(node)[0]:node[0],S=[],u=target;if(target.length>0)for(S.unshift(target);prev[u.id()];){var p=prev[u.id()];S.unshift(p.edge),S.unshift(p.node),u=p.node}return new $$.Collection(cy,S)}}}}),$$.elesfn.bfs=$$.elesfn.breadthFirstSearch,$$.elesfn.dfs=$$.elesfn.depthFirstSearch,$$.elesfn.stdBfs=$$.elesfn.stdBreadthFirstSearch,$$.elesfn.stdDfs=$$.elesfn.stdDepthFirstSearch}(cytoscape),function($$){"use strict";$$.fn.eles({aStar:function(options){options=options||{};var reconstructPath=function(start,end,cameFromMap,pathAcum){if(start==end)return pathAcum.push(cy.getElementById(end)),pathAcum;if(end in cameFromMap){var previous=cameFromMap[end],previousEdge=cameFromEdge[end];return pathAcum.push(cy.getElementById(end)),pathAcum.push(cy.getElementById(previousEdge)),reconstructPath(start,previous,cameFromMap,pathAcum)}return void 0},findMin=function(openSet,fScore){if(0===openSet.length)return void 0;for(var minPos=0,tempScore=fScore[openSet[0]],i=1;i<openSet.length;i++){var s=fScore[openSet[i]];tempScore>s&&(tempScore=s,minPos=i)}return minPos},cy=this._private.cy;if(null==options||null==options.root)return void 0;var source=$$.is.string(options.root)?this.filter(options.root)[0]:options.root[0];if(null==options.goal)return void 0;var target=$$.is.string(options.goal)?this.filter(options.goal)[0]:options.goal[0];if(null!=options.heuristic&&$$.is.fn(options.heuristic))var heuristic=options.heuristic;else var heuristic=function(){return 0};if(null!=options.weight&&$$.is.fn(options.weight))var weightFn=options.weight;else var weightFn=function(e){return 1};if(null!=options.directed)var directed=options.directed;else var directed=!1;var closedSet=[],openSet=[source.id()],cameFrom={},cameFromEdge={},gScore={},fScore={};gScore[source.id()]=0,fScore[source.id()]=heuristic(source);for(var edges=this.edges().stdFilter(function(e){return!e.isLoop()}),nodes=this.nodes(),steps=0;openSet.length>0;){var minPos=findMin(openSet,fScore),cMin=cy.getElementById(openSet[minPos]);if(steps++,cMin.id()==target.id()){var rPath=reconstructPath(source.id(),target.id(),cameFrom,[]);return rPath.reverse(),{found:!0,distance:gScore[cMin.id()],path:new $$.Collection(cy,rPath),steps:steps}}closedSet.push(cMin.id()),openSet.splice(minPos,1);var vwEdges=cMin.connectedEdges();directed&&(vwEdges=vwEdges.stdFilter(function(ele){return ele.data("source")===cMin.id()})),vwEdges=vwEdges.intersect(edges);for(var i=0;i<vwEdges.length;i++){var e=vwEdges[i],w=e.connectedNodes().stdFilter(function(n){return n.id()!==cMin.id()}).intersect(nodes);if(-1==closedSet.indexOf(w.id())){var tempScore=gScore[cMin.id()]+weightFn.apply(e,[e]);-1!=openSet.indexOf(w.id())?tempScore<gScore[w.id()]&&(gScore[w.id()]=tempScore,fScore[w.id()]=tempScore+heuristic(w),cameFrom[w.id()]=cMin.id()):(gScore[w.id()]=tempScore,fScore[w.id()]=tempScore+heuristic(w),openSet.push(w.id()),cameFrom[w.id()]=cMin.id(),cameFromEdge[w.id()]=e.id())}}}return{found:!1,distance:void 0,path:void 0,steps:steps}},floydWarshall:function(options){options=options||{};var cy=this._private.cy;if(null!=options.weight&&$$.is.fn(options.weight))var weightFn=options.weight;else var weightFn=function(e){return 1};if(null!=options.directed)var directed=options.directed;else var directed=!1;for(var edges=this.edges().stdFilter(function(e){return!e.isLoop()}),nodes=this.nodes(),numNodes=nodes.length,id2position={},i=0;numNodes>i;i++)id2position[nodes[i].id()]=i;for(var dist=[],i=0;numNodes>i;i++){for(var newRow=new Array(numNodes),j=0;numNodes>j;j++)newRow[j]=i==j?0:1/0;dist.push(newRow)}var next=[],edgeNext=[],initMatrix=function(next){for(var i=0;numNodes>i;i++){for(var newRow=new Array(numNodes),j=0;numNodes>j;j++)newRow[j]=void 0;next.push(newRow)}};initMatrix(next),initMatrix(edgeNext);for(var i=0;i<edges.length;i++){var sourceIndex=id2position[edges[i].source().id()],targetIndex=id2position[edges[i].target().id()],weight=weightFn.apply(edges[i],[edges[i]]);dist[sourceIndex][targetIndex]>weight&&(dist[sourceIndex][targetIndex]=weight,next[sourceIndex][targetIndex]=targetIndex,edgeNext[sourceIndex][targetIndex]=edges[i])}if(!directed)for(var i=0;i<edges.length;i++){var sourceIndex=id2position[edges[i].target().id()],targetIndex=id2position[edges[i].source().id()],weight=weightFn.apply(edges[i],[edges[i]]);dist[sourceIndex][targetIndex]>weight&&(dist[sourceIndex][targetIndex]=weight,next[sourceIndex][targetIndex]=targetIndex,edgeNext[sourceIndex][targetIndex]=edges[i])}for(var k=0;numNodes>k;k++)for(var i=0;numNodes>i;i++)for(var j=0;numNodes>j;j++)dist[i][k]+dist[k][j]<dist[i][j]&&(dist[i][j]=dist[i][k]+dist[k][j],
next[i][j]=next[i][k]);for(var position2id=[],i=0;numNodes>i;i++)position2id.push(nodes[i].id());var res={distance:function(from,to){if($$.is.string(from))var fromId=cy.filter(from)[0].id();else var fromId=from.id();if($$.is.string(to))var toId=cy.filter(to)[0].id();else var toId=to.id();return dist[id2position[fromId]][id2position[toId]]},path:function(from,to){var reconstructPathAux=function(from,to,next,position2id,edgeNext){if(from===to)return cy.getElementById(position2id[from]);if(void 0===next[from][to])return void 0;for(var path=[cy.getElementById(position2id[from])],prev=from;from!==to;){prev=from,from=next[from][to];var edge=edgeNext[prev][from];path.push(edge),path.push(cy.getElementById(position2id[from]))}return path};if($$.is.string(from))var fromId=cy.filter(from)[0].id();else var fromId=from.id();if($$.is.string(to))var toId=cy.filter(to)[0].id();else var toId=to.id();var pathArr=reconstructPathAux(id2position[fromId],id2position[toId],next,position2id,edgeNext);return new $$.Collection(cy,pathArr)}};return res},bellmanFord:function(options){if(options=options||{},null!=options.weight&&$$.is.fn(options.weight))var weightFn=options.weight;else var weightFn=function(e){return 1};if(null!=options.directed)var directed=options.directed;else var directed=!1;if(null==options.root)return void $$.util.error("options.root required");if($$.is.string(options.root))var source=this.filter(options.root)[0];else var source=options.root[0];for(var cy=this._private.cy,edges=this.edges().stdFilter(function(e){return!e.isLoop()}),nodes=this.nodes(),numNodes=nodes.length,id2position={},i=0;numNodes>i;i++)id2position[nodes[i].id()]=i;for(var cost=[],predecessor=[],predEdge=[],i=0;numNodes>i;i++)cost[i]=nodes[i].id()===source.id()?0:1/0,predecessor[i]=void 0;for(var flag=!1,i=1;numNodes>i;i++){flag=!1;for(var e=0;e<edges.length;e++){var sourceIndex=id2position[edges[e].source().id()],targetIndex=id2position[edges[e].target().id()],weight=weightFn.apply(edges[e],[edges[e]]),temp=cost[sourceIndex]+weight;if(temp<cost[targetIndex]&&(cost[targetIndex]=temp,predecessor[targetIndex]=sourceIndex,predEdge[targetIndex]=edges[e],flag=!0),!directed){var temp=cost[targetIndex]+weight;temp<cost[sourceIndex]&&(cost[sourceIndex]=temp,predecessor[sourceIndex]=targetIndex,predEdge[sourceIndex]=edges[e],flag=!0)}}if(!flag)break}if(flag)for(var e=0;e<edges.length;e++){var sourceIndex=id2position[edges[e].source().id()],targetIndex=id2position[edges[e].target().id()],weight=weightFn.apply(edges[e],[edges[e]]);if(cost[sourceIndex]+weight<cost[targetIndex])return $$.util.error("Error: graph contains a negative weigth cycle!"),{pathTo:void 0,distanceTo:void 0,hasNegativeWeightCycle:!0}}for(var position2id=[],i=0;numNodes>i;i++)position2id.push(nodes[i].id());var res={distanceTo:function(to){if($$.is.string(to))var toId=cy.filter(to)[0].id();else var toId=to.id();return cost[id2position[toId]]},pathTo:function(to){var reconstructPathAux=function(predecessor,fromPos,toPos,position2id,acumPath,predEdge){for(;;){if(acumPath.push(cy.getElementById(position2id[toPos])),acumPath.push(predEdge[toPos]),fromPos===toPos)return acumPath;var predPos=predecessor[toPos];if("undefined"==typeof predPos)return void 0;toPos=predPos}};if($$.is.string(to))var toId=cy.filter(to)[0].id();else var toId=to.id();var path=[],res=reconstructPathAux(predecessor,id2position[source.id()],id2position[toId],position2id,path,predEdge);return null!=res&&res.reverse(),new $$.Collection(cy,res)},hasNegativeWeightCycle:!1};return res},kargerStein:function(options){options=options||{};var colapse=function(edgeIndex,nodeMap,remainingEdges){for(var edgeInfo=remainingEdges[edgeIndex],sourceIn=edgeInfo[1],targetIn=edgeInfo[2],partition1=nodeMap[sourceIn],partition2=nodeMap[targetIn],newEdges=remainingEdges.filter(function(edge){return nodeMap[edge[1]]===partition1&&nodeMap[edge[2]]===partition2?!1:nodeMap[edge[1]]===partition2&&nodeMap[edge[2]]===partition1?!1:!0}),i=0;i<newEdges.length;i++){var edge=newEdges[i];edge[1]===partition2?(newEdges[i]=edge.slice(0),newEdges[i][1]=partition1):edge[2]===partition2&&(newEdges[i]=edge.slice(0),newEdges[i][2]=partition1)}for(var i=0;i<nodeMap.length;i++)nodeMap[i]===partition2&&(nodeMap[i]=partition1);return newEdges},contractUntil=function(metaNodeMap,remainingEdges,size,sizeLimit){if(sizeLimit>=size)return remainingEdges;var edgeIndex=Math.floor(Math.random()*remainingEdges.length),newEdges=colapse(edgeIndex,metaNodeMap,remainingEdges);return contractUntil(metaNodeMap,newEdges,size-1,sizeLimit)},cy=this._private.cy,edges=this.edges().stdFilter(function(e){return!e.isLoop()}),nodes=this.nodes(),numNodes=nodes.length,numEdges=edges.length,numIter=Math.ceil(Math.pow(Math.log(numNodes)/Math.LN2,2)),stopSize=Math.floor(numNodes/Math.sqrt(2));if(2>numNodes)return void $$.util.error("At least 2 nodes are required for KargerSteing algorithm!");for(var id2position={},i=0;numNodes>i;i++)id2position[nodes[i].id()]=i;for(var edgeIndexes=[],i=0;numEdges>i;i++){var e=edges[i];edgeIndexes.push([i,id2position[e.source().id()],id2position[e.target().id()]])}for(var minCut,minCutSize=1/0,originalMetaNode=[],i=0;numNodes>i;i++)originalMetaNode.push(i);for(var iter=0;numIter>=iter;iter++){var metaNodeMap=originalMetaNode.slice(0),edgesState=contractUntil(metaNodeMap,edgeIndexes,numNodes,stopSize),metaNodeMap2=metaNodeMap.slice(0),res1=contractUntil(metaNodeMap,edgesState,stopSize,2),res2=contractUntil(metaNodeMap2,edgesState,stopSize,2);res1.length<=res2.length&&res1.length<minCutSize?(minCutSize=res1.length,minCut=[res1,metaNodeMap]):res2.length<=res1.length&&res2.length<minCutSize&&(minCutSize=res2.length,minCut=[res2,metaNodeMap2])}for(var resEdges=minCut[0].map(function(e){return edges[e[0]]}),partition1=[],partition2=[],witnessNodePartition=minCut[1][0],i=0;i<minCut[1].length;i++){var partitionId=minCut[1][i];partitionId===witnessNodePartition?partition1.push(nodes[i]):partition2.push(nodes[i])}var ret={cut:new $$.Collection(cy,resEdges),partition1:new $$.Collection(cy,partition1),partition2:new $$.Collection(cy,partition2)};return ret},pageRank:function(options){options=options||{};var normalizeVector=function(vector){for(var length=vector.length,total=0,i=0;length>i;i++)total+=vector[i];for(var i=0;length>i;i++)vector[i]=vector[i]/total};if(null!=options&&null!=options.dampingfactor)var dampingFactor=options.dampingFactor;else var dampingFactor=.8;if(null!=options&&null!=options.precision)var epsilon=options.precision;else var epsilon=1e-6;if(null!=options&&null!=options.iterations)var numIter=options.iterations;else var numIter=200;if(null!=options&&null!=options.weight&&$$.is.fn(options.weight))var weightFn=options.weight;else var weightFn=function(e){return 1};for(var cy=this._private.cy,edges=this.edges().stdFilter(function(e){return!e.isLoop()}),nodes=this.nodes(),numNodes=nodes.length,numEdges=edges.length,id2position={},i=0;numNodes>i;i++)id2position[nodes[i].id()]=i;for(var matrix=[],columnSum=[],additionalProb=(1-dampingFactor)/numNodes,i=0;numNodes>i;i++){for(var newRow=[],j=0;numNodes>j;j++)newRow.push(0);matrix.push(newRow),columnSum.push(0)}for(var i=0;numEdges>i;i++){var edge=edges[i],s=id2position[edge.source().id()],t=id2position[edge.target().id()],w=weightFn.apply(edge,[edge]);matrix[t][s]+=w,columnSum[s]+=w}for(var p=1/numNodes+additionalProb,j=0;numNodes>j;j++)if(0===columnSum[j])for(var i=0;numNodes>i;i++)matrix[i][j]=p;else for(var i=0;numNodes>i;i++)matrix[i][j]=matrix[i][j]/columnSum[j]+additionalProb;for(var previous,eigenvector=[],nullVector=[],i=0;numNodes>i;i++)eigenvector.push(1),nullVector.push(0);for(var iter=0;numIter>iter;iter++){for(var temp=nullVector.slice(0),i=0;numNodes>i;i++)for(var j=0;numNodes>j;j++)temp[i]+=matrix[i][j]*eigenvector[j];normalizeVector(temp),previous=eigenvector,eigenvector=temp;for(var diff=0,i=0;numNodes>i;i++)diff+=Math.pow(previous[i]-eigenvector[i],2);if(epsilon>diff)break}var res={rank:function(node){if($$.is.string(node))var nodeId=cy.filter(node)[0].id();else var nodeId=node.id();return eigenvector[id2position[nodeId]]}};return res},degreeCentralityNormalized:function(options){if(options=options||{},null!=options.directed)var directed=options.directed;else var directed=!1;var nodes=this.nodes(),numNodes=nodes.length;if(directed){for(var indegrees={},outdegrees={},maxIndegree=0,maxOutdegree=0,i=0;numNodes>i;i++){var node=nodes[i],currDegree=this.degreeCentrality($$.util.extend({},options,{root:node}));maxIndegree<currDegree.indegree&&(maxIndegree=currDegree.indegree),maxOutdegree<currDegree.outdegree&&(maxOutdegree=currDegree.outdegree),indegrees[node.id()]=currDegree.indegree,outdegrees[node.id()]=currDegree.outdegree}return{indegree:function(node){if($$.is.string(node))var node=cy.filter(node)[0].id();else var node=node.id();return indegrees[node]/maxIndegree},outdegree:function(node){if($$.is.string(node))var node=cy.filter(node)[0].id();else var node=node.id();return outdegrees[node]/maxOutdegree}}}for(var degrees={},maxDegree=0,i=0;numNodes>i;i++){var node=nodes[i],currDegree=this.degreeCentrality($$.util.extend({},options,{root:node}));maxDegree<currDegree.degree&&(maxDegree=currDegree.degree),degrees[node.id()]=currDegree.degree}return{degree:function(node){if($$.is.string(node))var node=cy.filter(node)[0].id();else var node=node.id();return degrees[node]/maxDegree}}},degreeCentrality:function(options){options=options||{};var callingEles=this;if(null==options||null==options.root)return void 0;var root=$$.is.string(options.root)?this.filter(options.root)[0]:options.root[0];if(null!=options.weight&&$$.is.fn(options.weight))var weightFn=options.weight;else var weightFn=function(e){return 1};if(null!=options.directed)var directed=options.directed;else var directed=!1;if(null!=options.alpha&&$$.is.number(options.alpha))var alpha=options.alpha;else alpha=0;if(directed){for(var incoming=root.connectedEdges('edge[target = "'+root.id()+'"]').intersection(callingEles),outgoing=root.connectedEdges('edge[source = "'+root.id()+'"]').intersection(callingEles),k_in=incoming.length,k_out=outgoing.length,s_in=0,s_out=0,i=0;i<incoming.length;i++){var edge=incoming[i];s_in+=weightFn.apply(edge,[edge])}for(var i=0;i<outgoing.length;i++){var edge=outgoing[i];s_out+=weightFn.apply(edge,[edge])}return{indegree:Math.pow(k_in,1-alpha)*Math.pow(s_in,alpha),outdegree:Math.pow(k_out,1-alpha)*Math.pow(s_out,alpha)}}for(var connEdges=root.connectedEdges().intersection(callingEles),k=connEdges.length,s=0,i=0;i<connEdges.length;i++){var edge=connEdges[i];s+=weightFn.apply(edge,[edge])}return{degree:Math.pow(k,1-alpha)*Math.pow(s,alpha)}},closenessCentralityNormalized:function(options){options=options||{};var harmonic=options.harmonic;void 0===harmonic&&(harmonic=!0);for(var closenesses={},maxCloseness=0,nodes=this.nodes(),fw=this.floydWarshall({weight:options.weight,directed:options.directed}),i=0;i<nodes.length;i++){for(var currCloseness=0,j=0;j<nodes.length;j++)if(i!=j){var d=fw.distance(nodes[i],nodes[j]);currCloseness+=harmonic?1/d:d}harmonic||(currCloseness=1/currCloseness),currCloseness>maxCloseness&&(maxCloseness=currCloseness),closenesses[nodes[i].id()]=currCloseness}return{closeness:function(node){if($$.is.string(node))var node=cy.filter(node)[0].id();else var node=node.id();return closenesses[node]/maxCloseness}}},closenessCentrality:function(options){if(options=options||{},null==options.root)return void $$.util.error("options.root required");if($$.is.string(options.root))var root=this.filter(options.root)[0];else var root=options.root[0];if(null!=options.weight&&$$.is.fn(options.weight))var weight=options.weight;else var weight=function(){return 1};if(null!=options.directed&&$$.is.bool(options.directed))var directed=options.directed;else var directed=!1;var harmonic=options.harmonic;void 0===harmonic&&(harmonic=!0);for(var dijkstra=this.dijkstra({root:root,weight:weight,directed:directed}),totalDistance=0,nodes=this.nodes(),i=0;i<nodes.length;i++)if(nodes[i].id()!=root.id()){var d=dijkstra.distanceTo(nodes[i]);totalDistance+=harmonic?1/d:d}return harmonic?totalDistance:1/totalDistance},betweennessCentrality:function(options){if(options=options||{},null!=options.weight&&$$.is.fn(options.weight))var weightFn=options.weight,weighted=!0;else var weighted=!1;if(null!=options.directed&&$$.is.bool(options.directed))var directed=options.directed;else var directed=!1;for(var priorityInsert=function(queue,ele){queue.unshift(ele);for(var i=0;d[queue[i]]<d[queue[i+1]]&&i<queue.length-1;i++){var tmp=queue[i];queue[i]=queue[i+1],queue[i+1]=tmp}},cy=this._private.cy,V=this.nodes(),A={},C={},i=0;i<V.length;i++)A[V[i].id()]=directed?V[i].outgoers("node"):V[i].openNeighborhood("node");for(var i=0;i<V.length;i++)C[V[i].id()]=0;for(var s=0;s<V.length;s++){for(var S=[],P={},g={},d={},Q=[],i=0;i<V.length;i++)P[V[i].id()]=[],g[V[i].id()]=0,d[V[i].id()]=Number.POSITIVE_INFINITY;for(g[V[s].id()]=1,d[V[s].id()]=0,Q.unshift(V[s].id());Q.length>0;){var v=Q.pop();S.push(v),A[v].forEach(weighted?function(w){if(cy.$("#"+v).edgesTo(w).length>0)var edge=cy.$("#"+v).edgesTo(w)[0];else var edge=w.edgesTo("#"+v)[0];var edgeWeight=weightFn.apply(edge,[edge]);d[w.id()]>d[v]+edgeWeight&&(d[w.id()]=d[v]+edgeWeight,Q.indexOf(w.id())<0?priorityInsert(Q,w.id()):(Q.splice(Q.indexOf(w.id()),1),priorityInsert(Q,w.id())),g[w.id()]=0,P[w.id()]=[]),d[w.id()]==d[v]+edgeWeight&&(g[w.id()]=g[w.id()]+g[v],P[w.id()].push(v))}:function(w){d[w.id()]==Number.POSITIVE_INFINITY&&(Q.unshift(w.id()),d[w.id()]=d[v]+1),d[w.id()]==d[v]+1&&(g[w.id()]=g[w.id()]+g[v],P[w.id()].push(v))})}for(var e={},i=0;i<V.length;i++)e[V[i].id()]=0;for(;S.length>0;){var w=S.pop();P[w].forEach(function(v){e[v]=e[v]+g[v]/g[w]*(1+e[w]),w!=V[s].id()&&(C[w]=C[w]+e[w])})}}var max=0;for(var key in C)max<C[key]&&(max=C[key]);var ret={betweenness:function(node){if($$.is.string(node))var node=cy.filter(node)[0].id();else var node=node.id();return C[node]},betweennessNormalized:function(node){if($$.is.string(node))var node=cy.filter(node)[0].id();else var node=node.id();return C[node]/max}};return ret.betweennessNormalised=ret.betweennessNormalized,ret}}),$$.elesfn.dc=$$.elesfn.degreeCentrality,$$.elesfn.dcn=$$.elesfn.degreeCentralityNormalised=$$.elesfn.degreeCentralityNormalized,$$.elesfn.cc=$$.elesfn.closenessCentrality,$$.elesfn.ccn=$$.elesfn.closenessCentralityNormalised=$$.elesfn.closenessCentralityNormalized,$$.elesfn.bc=$$.elesfn.betweennessCentrality}(cytoscape),function($$){"use strict";$$.fn.eles({animated:$$.define.animated(),clearQueue:$$.define.clearQueue(),delay:$$.define.delay(),animate:$$.define.animate(),stop:$$.define.stop()})}(cytoscape),function($$){"use strict";$$.fn.eles({addClass:function(classes){classes=classes.split(/\s+/);for(var self=this,changed=[],i=0;i<classes.length;i++){var cls=classes[i];if(!$$.is.emptyString(cls))for(var j=0;j<self.length;j++){var ele=self[j],hasClass=ele._private.classes[cls];ele._private.classes[cls]=!0,hasClass||changed.push(ele)}}return changed.length>0&&new $$.Collection(this._private.cy,changed).updateStyle().trigger("class"),self},hasClass:function(className){var ele=this[0];return null!=ele&&ele._private.classes[className]?!0:!1},toggleClass:function(classesStr,toggle){for(var classes=classesStr.split(/\s+/),self=this,changed=[],i=0,il=self.length;il>i;i++)for(var ele=self[i],j=0;j<classes.length;j++){var cls=classes[j];if(!$$.is.emptyString(cls)){var hasClass=ele._private.classes[cls],shouldAdd=toggle||void 0===toggle&&!hasClass;shouldAdd?(ele._private.classes[cls]=!0,hasClass||changed.push(ele)):(ele._private.classes[cls]=!1,hasClass&&changed.push(ele))}}return changed.length>0&&new $$.Collection(this._private.cy,changed).updateStyle().trigger("class"),self},removeClass:function(classes){classes=classes.split(/\s+/);for(var self=this,changed=[],i=0;i<self.length;i++)for(var ele=self[i],j=0;j<classes.length;j++){var cls=classes[j];if(cls&&""!==cls){var hasClass=ele._private.classes[cls];ele._private.classes[cls]=void 0,hasClass&&changed.push(ele)}}return changed.length>0&&new $$.Collection(self._private.cy,changed).updateStyle(),self.trigger("class"),self},flashClass:function(classes,duration){var self=this;if(null==duration)duration=250;else if(0===duration)return self;return self.addClass(classes),setTimeout(function(){self.removeClass(classes)},duration),self}})}(cytoscape),function($$){"use strict";$$.fn.eles({allAre:function(selector){return this.filter(selector).length===this.length},is:function(selector){return this.filter(selector).length>0},some:function(fn,thisArg){for(var i=0;i<this.length;i++){var ret=thisArg?fn.apply(thisArg,[this[i],i,this]):fn(this[i],i,this);if(ret)return!0}return!1},every:function(fn,thisArg){for(var i=0;i<this.length;i++){var ret=thisArg?fn.apply(thisArg,[this[i],i,this]):fn(this[i],i,this);if(!ret)return!1}return!0},same:function(collection){return collection=this.cy().collection(collection),this.length!==collection.length?!1:this.intersect(collection).length===this.length},anySame:function(collection){return collection=this.cy().collection(collection),this.intersect(collection).length>0},allAreNeighbors:function(collection){return collection=this.cy().collection(collection),this.neighborhood().intersect(collection).length===collection.length}}),$$.elesfn.allAreNeighbours=$$.elesfn.allAreNeighbors}(cytoscape),function($$){"use strict";$$.fn.eles({parent:function(selector){for(var parents=[],cy=this._private.cy,i=0;i<this.length;i++){var ele=this[i],parent=cy.getElementById(ele._private.data.parent);parent.size()>0&&parents.push(parent)}return new $$.Collection(cy,parents,{unique:!0}).filter(selector)},parents:function(selector){for(var parents=[],eles=this.parent();eles.nonempty();){for(var i=0;i<eles.length;i++){var ele=eles[i];parents.push(ele)}eles=eles.parent()}return new $$.Collection(this.cy(),parents,{unique:!0}).filter(selector)},commonAncestors:function(selector){for(var ancestors,i=0;i<this.length;i++){var ele=this[i],parents=ele.parents();ancestors=ancestors||parents,ancestors=ancestors.intersect(parents)}return ancestors.filter(selector)},orphans:function(selector){return this.stdFilter(function(ele){return ele.isNode()&&ele.parent().empty()}).filter(selector)},nonorphans:function(selector){return this.stdFilter(function(ele){return ele.isNode()&&ele.parent().nonempty()}).filter(selector)},children:function(selector){for(var children=[],i=0;i<this.length;i++){var ele=this[i];children=children.concat(ele._private.children)}return new $$.Collection(this.cy(),children,{unique:!0}).filter(selector)},siblings:function(selector){return this.parent().children().not(this).filter(selector)},isParent:function(){var ele=this[0];return ele?0!==ele._private.children.length:void 0},isChild:function(){var ele=this[0];return ele?void 0!==ele._private.data.parent&&0!==ele.parent().length:void 0},descendants:function(selector){function add(eles){for(var i=0;i<eles.length;i++){var ele=eles[i];elements.push(ele),ele.children().nonempty()&&add(ele.children())}}var elements=[];return add(this.children()),new $$.Collection(this.cy(),elements,{unique:!0}).filter(selector)}}),$$.elesfn.ancestors=$$.elesfn.parents}(cytoscape),function($$){"use strict";var borderWidthMultiplier=1,borderWidthAdjustment=0;$$.fn.eles({data:$$.define.data({field:"data",bindingEvent:"data",allowBinding:!0,allowSetting:!0,settingEvent:"data",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,immutableKeys:{id:!0,source:!0,target:!0,parent:!0},updateStyle:!0}),removeData:$$.define.removeData({field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!0,immutableKeys:{id:!0,source:!0,target:!0,parent:!0},updateStyle:!0}),scratch:$$.define.data({field:"scratch",bindingEvent:"scratch",allowBinding:!0,allowSetting:!0,settingEvent:"scratch",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeScratch:$$.define.removeData({field:"scratch",event:"scratch",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0}),rscratch:$$.define.data({field:"rscratch",allowBinding:!1,allowSetting:!0,settingTriggersEvent:!1,allowGetting:!0}),removeRscratch:$$.define.removeData({field:"rscratch",triggerEvent:!1}),id:function(){var ele=this[0];return ele?ele._private.data.id:void 0},position:$$.define.data({field:"position",bindingEvent:"position",allowBinding:!0,allowSetting:!0,settingEvent:"position",settingTriggersEvent:!0,triggerFnName:"rtrigger",allowGetting:!0,validKeys:["x","y"],onSet:function(eles){var updatedEles=eles.updateCompoundBounds();updatedEles.rtrigger("position")},canSet:function(ele){return!ele.locked()}}),silentPosition:$$.define.data({field:"position",bindingEvent:"position",allowBinding:!1,allowSetting:!0,settingEvent:"position",settingTriggersEvent:!1,triggerFnName:"trigger",allowGetting:!0,validKeys:["x","y"],onSet:function(eles){eles.updateCompoundBounds()},canSet:function(ele){return!ele.locked()}}),positions:function(pos,silent){if($$.is.plainObject(pos))this.position(pos);else if($$.is.fn(pos)){for(var fn=pos,i=0;i<this.length;i++){var ele=this[i],pos=fn.apply(ele,[i,ele]);if(pos&&!ele.locked()){var elePos=ele._private.position;elePos.x=pos.x,elePos.y=pos.y}}var updatedEles=this.updateCompoundBounds(),toTrigger=updatedEles.length>0?this.add(updatedEles):this;silent?toTrigger.trigger("position"):toTrigger.rtrigger("position")}return this},silentPositions:function(pos){return this.positions(pos,!0)},updateCompoundBounds:function(){function update(parent){var children=parent.children(),style=parent._private.style,includeLabels="include"===style["compound-sizing-wrt-labels"].value,bb=children.boundingBox({includeLabels:includeLabels,includeEdges:!0}),padding={top:style["padding-top"].pxValue,bottom:style["padding-bottom"].pxValue,left:style["padding-left"].pxValue,right:style["padding-right"].pxValue},pos=parent._private.position,didUpdate=!1;"auto"===style.width.value&&(parent._private.autoWidth=bb.w+padding.left+padding.right,pos.x=(bb.x1+bb.x2-padding.left+padding.right)/2,didUpdate=!0),"auto"===style.height.value&&(parent._private.autoHeight=bb.h+padding.top+padding.bottom,pos.y=(bb.y1+bb.y2-padding.top+padding.bottom)/2,didUpdate=!0),didUpdate&&updated.push(parent)}var cy=this.cy();if(!cy.styleEnabled()||!cy.hasCompoundNodes())return cy.collection();for(var updated=[],eles=this.parent();eles.nonempty();){for(var i=0;i<eles.length;i++){var ele=eles[i];update(ele)}eles=eles.parent()}return new $$.Collection(cy,updated)},renderedPosition:function(dim,val){var ele=this[0],cy=this.cy(),zoom=cy.zoom(),pan=cy.pan(),rpos=$$.is.plainObject(dim)?dim:void 0,setting=void 0!==rpos||void 0!==val&&$$.is.string(dim);if(ele&&ele.isNode()){if(!setting){var pos=ele._private.position;return rpos={x:pos.x*zoom+pan.x,y:pos.y*zoom+pan.y},void 0===dim?rpos:rpos[dim]}for(var i=0;i<this.length;i++){var ele=this[i];void 0!==val?ele._private.position[dim]=(val-pan[dim])/zoom:void 0!==rpos&&(ele._private.position={x:(rpos.x-pan.x)/zoom,y:(rpos.y-pan.y)/zoom})}this.rtrigger("position")}else if(!setting)return void 0;return this},relativePosition:function(dim,val){var ele=this[0],cy=this.cy(),ppos=$$.is.plainObject(dim)?dim:void 0,setting=void 0!==ppos||void 0!==val&&$$.is.string(dim),hasCompoundNodes=cy.hasCompoundNodes();if(ele&&ele.isNode()){if(!setting){var pos=ele._private.position,parent=hasCompoundNodes?ele.parent():null,hasParent=parent&&parent.length>0,relativeToParent=hasParent;hasParent&&(parent=parent[0]);var origin=relativeToParent?parent._private.position:{x:0,y:0};return ppos={x:pos.x-origin.x,y:pos.y-origin.y},void 0===dim?ppos:ppos[dim]}for(var i=0;i<this.length;i++){var ele=this[i],parent=hasCompoundNodes?ele.parent():null,hasParent=parent&&parent.length>0,relativeToParent=hasParent;hasParent&&(parent=parent[0]);var origin=relativeToParent?parent._private.position:{x:0,y:0};void 0!==val?ele._private.position[dim]=val+origin[dim]:void 0!==ppos&&(ele._private.position={x:ppos.x+origin.x,y:ppos.y+origin.y})}this.rtrigger("position")}else if(!setting)return void 0;return this},width:function(){var ele=this[0],cy=ele._private.cy,styleEnabled=cy._private.styleEnabled;if(ele){if(styleEnabled){var w=ele._private.style.width;return"auto"===w.strValue?ele._private.autoWidth:w.pxValue}return 1}},outerWidth:function(){var ele=this[0],cy=ele._private.cy,styleEnabled=cy._private.styleEnabled;if(ele){if(styleEnabled){var style=ele._private.style,width="auto"===style.width.strValue?ele._private.autoWidth:style.width.pxValue,border=style["border-width"]?style["border-width"].pxValue*borderWidthMultiplier+borderWidthAdjustment:0;return width+border}return 1}},renderedWidth:function(){var ele=this[0];if(ele){var width=ele.width();return width*this.cy().zoom()}},renderedOuterWidth:function(){var ele=this[0];if(ele){var owidth=ele.outerWidth();return owidth*this.cy().zoom()}},height:function(){var ele=this[0],cy=ele._private.cy,styleEnabled=cy._private.styleEnabled;if(ele&&"nodes"===ele._private.group){if(styleEnabled){var h=ele._private.style.height;return"auto"===h.strValue?ele._private.autoHeight:h.pxValue}return 1}},outerHeight:function(){var ele=this[0],cy=ele._private.cy,styleEnabled=cy._private.styleEnabled;if(ele&&"nodes"===ele._private.group){if(!styleEnabled)return 1;var style=ele._private.style,height="auto"===style.height.strValue?ele._private.autoHeight:style.height.pxValue,border=style["border-width"]?style["border-width"].pxValue*borderWidthMultiplier+borderWidthAdjustment:0;return height+border}},renderedHeight:function(){var ele=this[0];if(ele&&"nodes"===ele._private.group){var height=ele.height();return height*this.cy().zoom()}},renderedOuterHeight:function(){var ele=this[0];if(ele&&"nodes"===ele._private.group){var oheight=ele.outerHeight();return oheight*this.cy().zoom()}},renderedBoundingBox:function(options){var bb=this.boundingBox(options),cy=this.cy(),zoom=cy.zoom(),pan=cy.pan(),x1=bb.x1*zoom+pan.x,x2=bb.x2*zoom+pan.x,y1=bb.y1*zoom+pan.y,y2=bb.y2*zoom+pan.y;return{x1:x1,x2:x2,y1:y1,y2:y2,w:x2-x1,h:y2-y1}},boundingBox:function(options){var eles=this,cy=eles._private.cy,cy_p=cy._private,styleEnabled=cy_p.styleEnabled;options=options||{};var includeNodes=void 0===options.includeNodes?!0:options.includeNodes,includeEdges=void 0===options.includeEdges?!0:options.includeEdges,includeLabels=void 0===options.includeLabels?!0:options.includeLabels;styleEnabled&&cy_p.renderer.recalculateRenderedStyle(this);for(var x1=1/0,x2=-(1/0),y1=1/0,y2=-(1/0),i=0;i<eles.length;i++){var ex1,ex2,ey1,ey2,x,y,ele=eles[i],_p=ele._private,style=_p.style,display=styleEnabled?_p.style.display.value:"element",isNode="nodes"===_p.group,includedEle=!1;if("none"!==display){if(isNode&&includeNodes){includedEle=!0;var pos=_p.position;x=pos.x,y=pos.y;var w=ele.outerWidth(),halfW=w/2,h=ele.outerHeight(),halfH=h/2;ex1=x-halfW,ex2=x+halfW,ey1=y-halfH,ey2=y+halfH,x1=x1>ex1?ex1:x1,x2=ex2>x2?ex2:x2,y1=y1>ey1?ey1:y1,y2=ey2>y2?ey2:y2}else if(ele.isEdge()&&includeEdges){includedEle=!0;var n1=_p.source,n1_p=n1._private,n1pos=n1_p.position,n2=_p.target,n2_p=n2._private,n2pos=n2_p.position,rstyle=_p.rstyle||{};if(ex1=n1pos.x,ex2=n2pos.x,ey1=n1pos.y,ey2=n2pos.y,ex1>ex2){var temp=ex1;ex1=ex2,ex2=temp}if(ey1>ey2){var temp=ey1;ey1=ey2,ey2=temp}if(x1=x1>ex1?ex1:x1,x2=ex2>x2?ex2:x2,y1=y1>ey1?ey1:y1,y2=ey2>y2?ey2:y2,styleEnabled)for(var bpts=rstyle.bezierPts||[],w=style.width.pxValue,wHalf=w/2,j=0;j<bpts.length;j++){var bpt=bpts[j];ex1=bpt.x-wHalf,ex2=bpt.x+wHalf,ey1=bpt.y-wHalf,ey2=bpt.y+wHalf,x1=x1>ex1?ex1:x1,x2=ex2>x2?ex2:x2,y1=y1>ey1?ey1:y1,y2=ey2>y2?ey2:y2}if(styleEnabled&&"haystack"===style["curve-style"].strValue){var hpts=_p.rscratch.haystackPts;if(ex1=hpts[0],ey1=hpts[1],ex2=hpts[2],ey2=hpts[3],ex1>ex2){var temp=ex1;ex1=ex2,ex2=temp}if(ey1>ey2){var temp=ey1;ey1=ey2,ey2=temp}x1=x1>ex1?ex1:x1,x2=ex2>x2?ex2:x2,y1=y1>ey1?ey1:y1,y2=ey2>y2?ey2:y2}}if(styleEnabled){var style=ele._private.style,rstyle=ele._private.rstyle,label=style.content.strValue,fontSize=style["font-size"],halign=style["text-halign"],valign=style["text-valign"],labelWidth=rstyle.labelWidth,labelHeight=rstyle.labelHeight,labelX=rstyle.labelX,labelY=rstyle.labelY;if(includedEle&&includeLabels&&label&&fontSize&&null!=labelHeight&&null!=labelWidth&&null!=labelX&&null!=labelY&&halign&&valign){var lx1,lx2,ly1,ly2,lh=labelHeight,lw=labelWidth;if(ele.isEdge())lx1=labelX-lw/2,lx2=labelX+lw/2,ly1=labelY-lh/2,ly2=labelY+lh/2;else{switch(halign.value){case"left":lx1=labelX-lw,lx2=labelX;break;case"center":lx1=labelX-lw/2,lx2=labelX+lw/2;break;case"right":lx1=labelX,lx2=labelX+lw}switch(valign.value){case"top":ly1=labelY-lh,ly2=labelY;break;case"center":ly1=labelY-lh/2,ly2=labelY+lh/2;break;case"bottom":ly1=labelY,ly2=labelY+lh}}x1=x1>lx1?lx1:x1,x2=lx2>x2?lx2:x2,y1=y1>ly1?ly1:y1,y2=ly2>y2?ly2:y2}}}}var noninf=function(x){return x===1/0||x===-(1/0)?0:x};return x1=noninf(x1),x2=noninf(x2),y1=noninf(y1),y2=noninf(y2),{x1:x1,x2:x2,y1:y1,y2:y2,w:x2-x1,h:y2-y1}}});var fn=$$.elesfn;fn.attr=fn.data,fn.removeAttr=fn.removeData,fn.modelPosition=fn.point=fn.position,fn.modelPositions=fn.points=fn.positions,fn.renderedPoint=fn.renderedPosition,fn.relativePoint=fn.relativePosition,fn.boundingbox=fn.boundingBox,fn.renderedBoundingbox=fn.renderedBoundingBox}(cytoscape),function($$){"use strict";function defineDegreeFunction(callback){return function(includeLoops){var self=this;if(void 0===includeLoops&&(includeLoops=!0),0!==self.length&&self.isNode()&&!self.removed()){for(var degree=0,node=self[0],connectedEdges=node._private.edges,i=0;i<connectedEdges.length;i++){var edge=connectedEdges[i];(includeLoops||!edge.isLoop())&&(degree+=callback(node,edge))}return degree}}}function defineDegreeBoundsFunction(degreeFn,callback){return function(includeLoops){for(var ret,nodes=this.nodes(),i=0;i<nodes.length;i++){var ele=nodes[i],degree=ele[degreeFn](includeLoops);void 0===degree||void 0!==ret&&!callback(degree,ret)||(ret=degree)}return ret}}$$.fn.eles({degree:defineDegreeFunction(function(node,edge){return edge.source().same(edge.target())?2:1}),indegree:defineDegreeFunction(function(node,edge){return edge.target().same(node)?1:0}),outdegree:defineDegreeFunction(function(node,edge){return edge.source().same(node)?1:0})}),$$.fn.eles({minDegree:defineDegreeBoundsFunction("degree",function(degree,min){return min>degree}),maxDegree:defineDegreeBoundsFunction("degree",function(degree,max){return degree>max}),minIndegree:defineDegreeBoundsFunction("indegree",function(degree,min){return min>degree}),maxIndegree:defineDegreeBoundsFunction("indegree",function(degree,max){return degree>max}),minOutdegree:defineDegreeBoundsFunction("outdegree",function(degree,min){return min>degree}),maxOutdegree:defineDegreeBoundsFunction("outdegree",function(degree,max){return degree>max})}),$$.fn.eles({totalDegree:function(includeLoops){for(var total=0,nodes=this.nodes(),i=0;i<nodes.length;i++)total+=nodes[i].degree(includeLoops);return total}})}(cytoscape),function($$){"use strict";$$.fn.eles({on:$$.define.on(),one:$$.define.on({unbindSelfOnTrigger:!0}),once:$$.define.on({unbindAllBindersOnTrigger:!0}),off:$$.define.off(),trigger:$$.define.trigger(),rtrigger:function(event,extraParams){return 0!==this.length?(this.cy().notify({type:event,collection:this}),this.trigger(event,extraParams),this):void 0}}),$$.define.eventAliasesOn($$.elesfn)}(cytoscape),function($$){"use strict";$$.fn.eles({nodes:function(selector){return this.filter(function(i,element){return element.isNode()}).filter(selector)},edges:function(selector){return this.filter(function(i,element){return element.isEdge()}).filter(selector)},filter:function(filter){var cy=this._private.cy;if($$.is.fn(filter)){for(var elements=[],i=0;i<this.length;i++){var ele=this[i];filter.apply(ele,[i,ele])&&elements.push(ele)}return new $$.Collection(cy,elements)}return $$.is.string(filter)||$$.is.elementOrCollection(filter)?new $$.Selector(filter).filter(this):void 0===filter?this:new $$.Collection(cy)},not:function(toRemove){var cy=this._private.cy;if(toRemove){
$$.is.string(toRemove)&&(toRemove=this.filter(toRemove));for(var elements=[],i=0;i<this.length;i++){var element=this[i],remove=toRemove._private.ids[element.id()];remove||elements.push(element)}return new $$.Collection(cy,elements)}return this},absoluteComplement:function(){var cy=this._private.cy;return cy.elements().not(this)},intersect:function(other){var cy=this._private.cy;if($$.is.string(other)){var selector=other;return this.filter(selector)}for(var elements=[],col1=this,col2=other,col1Smaller=this.length<other.length,ids2=col1Smaller?col2._private.ids:col1._private.ids,col=col1Smaller?col1:col2,i=0;i<col.length;i++){var id=col[i]._private.data.id,ele=ids2[id];ele&&elements.push(ele)}return new $$.Collection(cy,elements)},xor:function(other){var cy=this._private.cy;$$.is.string(other)&&(other=cy.$(other));var elements=[],col1=this,col2=other,add=function(col,other){for(var i=0;i<col.length;i++){var ele=col[i],id=ele._private.data.id,inOther=other._private.ids[id];inOther||elements.push(ele)}};return add(col1,col2),add(col2,col1),new $$.Collection(cy,elements)},diff:function(other){var cy=this._private.cy;$$.is.string(other)&&(other=cy.$(other));var left=[],right=[],both=[],col1=this,col2=other,add=function(col,other,retEles){for(var i=0;i<col.length;i++){var ele=col[i],id=ele._private.data.id,inOther=other._private.ids[id];inOther?both.push(ele):retEles.push(ele)}};return add(col1,col2,left),add(col2,col1,right),{left:new $$.Collection(cy,left,{unique:!0}),right:new $$.Collection(cy,right,{unique:!0}),both:new $$.Collection(cy,both,{unique:!0})}},add:function(toAdd){var cy=this._private.cy;if(!toAdd)return this;if($$.is.string(toAdd)){var selector=toAdd;toAdd=cy.elements(selector)}for(var elements=[],i=0;i<this.length;i++)elements.push(this[i]);for(var i=0;i<toAdd.length;i++){var add=!this._private.ids[toAdd[i].id()];add&&elements.push(toAdd[i])}return new $$.Collection(cy,elements)},merge:function(toAdd){var _p=this._private,cy=_p.cy;if(!toAdd)return this;if($$.is.string(toAdd)){var selector=toAdd;toAdd=cy.elements(selector)}for(var i=0;i<toAdd.length;i++){var toAddEle=toAdd[i],id=toAddEle.id(),add=!_p.ids[id];if(add){var index=this.length++;this[index]=toAddEle,_p.ids[id]=toAddEle,_p.indexes[id]=index}}return this},unmergeOne:function(ele){ele=ele[0];var _p=this._private,id=ele.id(),i=_p.indexes[id];if(null==i)return this;this[i]=void 0,_p.ids[id]=void 0,_p.indexes[id]=void 0;var unmergedLastEle=i===this.length-1;if(this.length>1&&!unmergedLastEle){var lastEleI=this.length-1,lastEle=this[lastEleI];this[lastEleI]=void 0,this[i]=lastEle,_p.indexes[lastEle.id()]=i}return this.length--,this},unmerge:function(toRemove){var cy=this._private.cy;if(!toRemove)return this;if($$.is.string(toRemove)){var selector=toRemove;toRemove=cy.elements(selector)}for(var i=0;i<toRemove.length;i++)this.unmergeOne(toRemove[i]);return this},map:function(mapFn,thisArg){for(var arr=[],eles=this,i=0;i<eles.length;i++){var ele=eles[i],ret=thisArg?mapFn.apply(thisArg,[ele,i,eles]):mapFn(ele,i,eles);arr.push(ret)}return arr},stdFilter:function(fn,thisArg){for(var filterEles=[],eles=this,cy=this._private.cy,i=0;i<eles.length;i++){var ele=eles[i],include=thisArg?fn.apply(thisArg,[ele,i,eles]):fn(ele,i,eles);include&&filterEles.push(ele)}return new $$.Collection(cy,filterEles)},max:function(valFn,thisArg){for(var maxEle,max=-(1/0),eles=this,i=0;i<eles.length;i++){var ele=eles[i],val=thisArg?valFn.apply(thisArg,[ele,i,eles]):valFn(ele,i,eles);val>max&&(max=val,maxEle=ele)}return{value:max,ele:maxEle}},min:function(valFn,thisArg){for(var minEle,min=1/0,eles=this,i=0;i<eles.length;i++){var ele=eles[i],val=thisArg?valFn.apply(thisArg,[ele,i,eles]):valFn(ele,i,eles);min>val&&(min=val,minEle=ele)}return{value:min,ele:minEle}}});var fn=$$.elesfn;fn.u=fn["|"]=fn["+"]=fn.union=fn.or=fn.add,fn["\\"]=fn["!"]=fn["-"]=fn.difference=fn.relativeComplement=fn.not,fn.n=fn["&"]=fn["."]=fn.and=fn.intersection=fn.intersect,fn["^"]=fn["(+)"]=fn["(-)"]=fn.symmetricDifference=fn.symdiff=fn.xor,fn.fnFilter=fn.filterFn=fn.stdFilter,fn.complement=fn.abscomp=fn.absoluteComplement}(cytoscape),function($$){"use strict";$$.fn.eles({isNode:function(){return"nodes"===this.group()},isEdge:function(){return"edges"===this.group()},isLoop:function(){return this.isEdge()&&this.source().id()===this.target().id()},isSimple:function(){return this.isEdge()&&this.source().id()!==this.target().id()},group:function(){var ele=this[0];return ele?ele._private.group:void 0}})}(cytoscape),function($$){"use strict";$$.fn.eles({each:function(fn){if($$.is.fn(fn))for(var i=0;i<this.length;i++){var ele=this[i],ret=fn.apply(ele,[i,ele]);if(ret===!1)break}return this},forEach:function(fn,thisArg){if($$.is.fn(fn))for(var i=0;i<this.length;i++){var ele=this[i],ret=thisArg?fn.apply(thisArg,[ele,i,this]):fn(ele,i,this);if(ret===!1)break}return this},toArray:function(){for(var array=[],i=0;i<this.length;i++)array.push(this[i]);return array},slice:function(start,end){var array=[],thisSize=this.length;null==end&&(end=thisSize),null==start&&(start=0),0>start&&(start=thisSize+start),0>end&&(end=thisSize+end);for(var i=start;i>=0&&end>i&&thisSize>i;i++)array.push(this[i]);return new $$.Collection(this.cy(),array)},size:function(){return this.length},eq:function(i){return this[i]||new $$.Collection(this.cy())},first:function(){return this[0]||new $$.Collection(this.cy())},last:function(){return this[this.length-1]||new $$.Collection(this.cy())},empty:function(){return 0===this.length},nonempty:function(){return!this.empty()},sort:function(sortFn){if(!$$.is.fn(sortFn))return this;var cy=this.cy(),sorted=this.toArray().sort(sortFn);return new $$.Collection(cy,sorted)},sortByZIndex:function(){return this.sort($$.Collection.zIndexSort)},zDepth:function(){var ele=this[0];if(!ele)return void 0;var _p=ele._private,group=_p.group;if("nodes"===group){var depth=_p.data.parent?ele.parents().size():0;return ele.isParent()?depth:Number.MAX_VALUE}var src=_p.source,tgt=_p.target,srcDepth=src.zDepth(),tgtDepth=tgt.zDepth();return Math.max(srcDepth,tgtDepth,0)}}),$$.Collection.zIndexSort=function(a,b){var cy=a.cy(),a_p=a._private,b_p=b._private,zDiff=a_p.style["z-index"].value-b_p.style["z-index"].value,depthA=0,depthB=0,hasCompoundNodes=cy.hasCompoundNodes(),aIsNode="nodes"===a_p.group,aIsEdge="edges"===a_p.group,bIsNode="nodes"===b_p.group,bIsEdge="edges"===b_p.group;hasCompoundNodes&&(depthA=a.zDepth(),depthB=b.zDepth());var depthDiff=depthA-depthB,sameDepth=0===depthDiff;return sameDepth?aIsNode&&bIsEdge?1:aIsEdge&&bIsNode?-1:0===zDiff?a_p.index-b_p.index:zDiff:depthDiff}}(cytoscape),function($$){"use strict";$$.fn.eles({layoutPositions:function(layout,options,fn){var nodes=this.nodes(),cy=this.cy();if(layout.trigger({type:"layoutstart",layout:layout}),options.animate){for(var i=0;i<nodes.length;i++){var node=nodes[i],lastNode=i===nodes.length-1,newPos=fn.call(node,i,node),pos=node.position();$$.is.number(pos.x)&&$$.is.number(pos.y)||node.silentPosition({x:0,y:0}),node.animate({position:newPos},{duration:options.animationDuration,step:lastNode?function(){options.fit&&cy.fit(options.eles,options.padding)}:void 0,complete:lastNode?function(){null!=options.zoom&&cy.zoom(options.zoom),options.pan&&cy.pan(options.pan),options.fit&&cy.fit(options.eles,options.padding),layout.one("layoutstop",options.stop),layout.trigger({type:"layoutstop",layout:layout})}:void 0})}layout.one("layoutready",options.ready),layout.trigger({type:"layoutready",layout:layout})}else nodes.positions(fn),options.fit&&cy.fit(options.eles,options.padding),null!=options.zoom&&cy.zoom(options.zoom),options.pan&&cy.pan(options.pan),layout.one("layoutready",options.ready),layout.trigger({type:"layoutready",layout:layout}),layout.one("layoutstop",options.stop),layout.trigger({type:"layoutstop",layout:layout});return this},layout:function(options){var cy=this.cy();return cy.layout($$.util.extend({},options,{eles:this})),this},makeLayout:function(options){var cy=this.cy();return cy.makeLayout($$.util.extend({},options,{eles:this}))}}),$$.elesfn.createLayout=$$.elesfn.makeLayout}(cytoscape),function($$){"use strict";$$.fn.eles({updateStyle:function(notifyRenderer){var cy=this._private.cy;if(!cy.styleEnabled())return this;if(cy._private.batchingStyle){for(var bEles=cy._private.batchStyleEles,i=0;i<this.length;i++){var ele=this[i];bEles.ids[ele._private.id]||bEles.push(ele)}return this}var style=cy.style();notifyRenderer=notifyRenderer||void 0===notifyRenderer?!0:!1,style.apply(this);var updatedCompounds=this.updateCompoundBounds(),toNotify=updatedCompounds.length>0?this.add(updatedCompounds):this;return notifyRenderer?toNotify.rtrigger("style"):toNotify.trigger("style"),this},updateMappers:function(notifyRenderer){var cy=this._private.cy,style=cy.style();if(notifyRenderer=notifyRenderer||void 0===notifyRenderer?!0:!1,!cy.styleEnabled())return this;style.updateMappers(this);var updatedCompounds=this.updateCompoundBounds(),toNotify=updatedCompounds.length>0?this.add(updatedCompounds):this;return notifyRenderer?toNotify.rtrigger("style"):toNotify.trigger("style"),this},renderedCss:function(property){var cy=this.cy();if(!cy.styleEnabled())return this;var ele=this[0];if(ele){var renstyle=ele.cy().style().getRenderedStyle(ele);return void 0===property?renstyle:renstyle[property]}},css:function(name,value){var cy=this.cy();if(!cy.styleEnabled())return this;var updateTransitions=!1,style=cy.style();if($$.is.plainObject(name)){var props=name;style.applyBypass(this,props,updateTransitions);var updatedCompounds=this.updateCompoundBounds(),toNotify=updatedCompounds.length>0?this.add(updatedCompounds):this;toNotify.rtrigger("style")}else if($$.is.string(name)){if(void 0===value){var ele=this[0];return ele?ele._private.style[name].strValue:void 0}style.applyBypass(this,name,value,updateTransitions);var updatedCompounds=this.updateCompoundBounds(),toNotify=updatedCompounds.length>0?this.add(updatedCompounds):this;toNotify.rtrigger("style")}else if(void 0===name){var ele=this[0];return ele?style.getRawStyle(ele):void 0}return this},removeCss:function(names){var cy=this.cy();if(!cy.styleEnabled())return this;var updateTransitions=!1,style=cy.style(),eles=this;if(void 0===names)for(var i=0;i<eles.length;i++){var ele=eles[i];style.removeAllBypasses(ele,updateTransitions)}else{names=names.split(/\s+/);for(var i=0;i<eles.length;i++){var ele=eles[i];style.removeBypasses(ele,names,updateTransitions)}}var updatedCompounds=this.updateCompoundBounds(),toNotify=updatedCompounds.length>0?this.add(updatedCompounds):this;return toNotify.rtrigger("style"),this},show:function(){return this.css("display","element"),this},hide:function(){return this.css("display","none"),this},visible:function(){var cy=this.cy();if(!cy.styleEnabled())return!0;var ele=this[0],hasCompoundNodes=cy.hasCompoundNodes();if(ele){var style=ele._private.style;if("visible"!==style.visibility.value||"element"!==style.display.value)return!1;if("nodes"===ele._private.group){if(!hasCompoundNodes)return!0;var parents=ele._private.data.parent?ele.parents():null;if(parents)for(var i=0;i<parents.length;i++){var parent=parents[i],pStyle=parent._private.style,pVis=pStyle.visibility.value,pDis=pStyle.display.value;if("visible"!==pVis||"element"!==pDis)return!1}return!0}var src=ele._private.source,tgt=ele._private.target;return src.visible()&&tgt.visible()}},hidden:function(){var ele=this[0];return ele?!ele.visible():void 0},effectiveOpacity:function(){var cy=this.cy();if(!cy.styleEnabled())return 1;var hasCompoundNodes=cy.hasCompoundNodes(),ele=this[0];if(ele){var _p=ele._private,parentOpacity=_p.style.opacity.value;if(!hasCompoundNodes)return parentOpacity;var parents=_p.data.parent?ele.parents():null;if(parents)for(var i=0;i<parents.length;i++){var parent=parents[i],opacity=parent._private.style.opacity.value;parentOpacity=opacity*parentOpacity}return parentOpacity}},transparent:function(){var cy=this.cy();if(!cy.styleEnabled())return!1;var ele=this[0],hasCompoundNodes=ele.cy().hasCompoundNodes();return ele?hasCompoundNodes?0===ele.effectiveOpacity():0===ele._private.style.opacity.value:void 0},isFullAutoParent:function(){var cy=this.cy();if(!cy.styleEnabled())return!1;var ele=this[0];if(ele){var autoW="auto"===ele._private.style.width.value,autoH="auto"===ele._private.style.height.value;return ele.isParent()&&autoW&&autoH}},backgrounding:function(){var cy=this.cy();if(!cy.styleEnabled())return!1;var ele=this[0];return ele._private.backgrounding?!0:!1}}),$$.elesfn.bypass=$$.elesfn.style=$$.elesfn.css,$$.elesfn.renderedStyle=$$.elesfn.renderedCss,$$.elesfn.removeBypass=$$.elesfn.removeStyle=$$.elesfn.removeCss}(cytoscape),function($$){"use strict";function defineSwitchFunction(params){return function(){var args=arguments,changedEles=[];if(2===args.length){var data=args[0],handler=args[1];this.bind(params.event,data,handler)}else if(1===args.length){var handler=args[0];this.bind(params.event,handler)}else if(0===args.length){for(var i=0;i<this.length;i++){var ele=this[i],able=!params.ableField||ele._private[params.ableField],changed=ele._private[params.field]!=params.value;if(params.overrideAble){var overrideAble=params.overrideAble(ele);if(void 0!==overrideAble&&(able=overrideAble,!overrideAble))return this}able&&(ele._private[params.field]=params.value,changed&&changedEles.push(ele))}var changedColl=$$.Collection(this.cy(),changedEles);changedColl.updateStyle(),changedColl.trigger(params.event)}return this}}function defineSwitchSet(params){$$.elesfn[params.field]=function(){var ele=this[0];if(ele){if(params.overrideField){var val=params.overrideField(ele);if(void 0!==val)return val}return ele._private[params.field]}},$$.elesfn[params.on]=defineSwitchFunction({event:params.on,field:params.field,ableField:params.ableField,overrideAble:params.overrideAble,value:!0}),$$.elesfn[params.off]=defineSwitchFunction({event:params.off,field:params.field,ableField:params.ableField,overrideAble:params.overrideAble,value:!1})}defineSwitchSet({field:"locked",overrideField:function(ele){return ele.cy().autolock()?!0:void 0},on:"lock",off:"unlock"}),defineSwitchSet({field:"grabbable",overrideField:function(ele){return ele.cy().autoungrabify()?!1:void 0},on:"grabify",off:"ungrabify"}),defineSwitchSet({field:"selected",ableField:"selectable",overrideAble:function(ele){return ele.cy().autounselectify()?!1:void 0},on:"select",off:"unselect"}),defineSwitchSet({field:"selectable",overrideField:function(ele){return ele.cy().autounselectify()?!1:void 0},on:"selectify",off:"unselectify"}),$$.elesfn.deselect=$$.elesfn.unselect,$$.elesfn.grabbed=function(){var ele=this[0];return ele?ele._private.grabbed:void 0},defineSwitchSet({field:"active",on:"activate",off:"unactivate"}),$$.elesfn.inactive=function(){var ele=this[0];return ele?!ele._private.active:void 0}}(cytoscape),function($$){"use strict";function defineSourceFunction(params){return function(selector){for(var sources=[],cy=this._private.cy,i=0;i<this.length;i++){var ele=this[i],src=ele._private[params.attr];src&&sources.push(src)}return new $$.Collection(cy,sources,{unique:!0}).filter(selector)}}function defineEdgesWithFunction(params){return function(otherNodes){var elements=[],cy=this._private.cy,p=params||{};$$.is.string(otherNodes)&&(otherNodes=cy.$(otherNodes));for(var thisIds=this._private.ids,otherIds=otherNodes._private.ids,h=0;h<otherNodes.length;h++)for(var edges=otherNodes[h]._private.edges,i=0;i<edges.length;i++){var edge=edges[i],edgeData=edge._private.data,thisToOther=thisIds[edgeData.source]&&otherIds[edgeData.target],otherToThis=otherIds[edgeData.source]&&thisIds[edgeData.target],edgeConnectsThisAndOther=thisToOther||otherToThis;if(edgeConnectsThisAndOther){if(p.thisIs){if("source"===p.thisIs&&!thisToOther)continue;if("target"===p.thisIs&&!otherToThis)continue}elements.push(edge)}}return new $$.Collection(cy,elements,{unique:!0})}}function defineParallelEdgesFunction(params){var defaults={codirected:!1};return params=$$.util.extend({},defaults,params),function(selector){for(var cy=this._private.cy,elements=[],edges=this.edges(),p=params,i=0;i<edges.length;i++)for(var edge1=edges[i],src1=edge1.source()[0],srcid1=src1.id(),tgt1=edge1.target()[0],tgtid1=tgt1.id(),srcEdges1=src1._private.edges,j=0;j<srcEdges1.length;j++){var edge2=srcEdges1[j],edge2data=edge2._private.data,tgtid2=edge2data.target,srcid2=edge2data.source,codirected=tgtid2===tgtid1&&srcid2===srcid1,oppdirected=srcid1===tgtid2&&tgtid1===srcid2;(p.codirected&&codirected||!p.codirected&&(codirected||oppdirected))&&elements.push(edge2)}return new $$.Collection(cy,elements,{unique:!0}).filter(selector)}}$$.fn.eles({roots:function(selector){for(var eles=this,roots=[],i=0;i<eles.length;i++){var ele=eles[i];if(ele.isNode()){var hasEdgesPointingIn=ele.connectedEdges(function(){return this.data("target")===ele.id()&&this.data("source")!==ele.id()}).length>0;hasEdgesPointingIn||roots.push(ele)}}return new $$.Collection(this._private.cy,roots,{unique:!0}).filter(selector)},leaves:function(selector){for(var eles=this,leaves=[],i=0;i<eles.length;i++){var ele=eles[i];if(ele.isNode()){var hasEdgesPointingOut=ele.connectedEdges(function(){return this.data("source")===ele.id()&&this.data("target")!==ele.id()}).length>0;hasEdgesPointingOut||leaves.push(ele)}}return new $$.Collection(this._private.cy,leaves,{unique:!0}).filter(selector)},outgoers:function(selector){for(var eles=this,oEles=[],i=0;i<eles.length;i++){var ele=eles[i],eleId=ele.id();if(ele.isNode())for(var edges=ele._private.edges,j=0;j<edges.length;j++){var edge=edges[j],srcId=edge._private.data.source,tgtId=edge._private.data.target;srcId===eleId&&tgtId!==eleId&&(oEles.push(edge),oEles.push(edge.target()[0]))}}return new $$.Collection(this._private.cy,oEles,{unique:!0}).filter(selector)},successors:function(selector){for(var eles=this,sEles=[],sElesIds={};;){var outgoers=eles.outgoers();if(0===outgoers.length)break;for(var newOutgoers=!1,i=0;i<outgoers.length;i++){var outgoer=outgoers[i],outgoerId=outgoer.id();sElesIds[outgoerId]||(sElesIds[outgoerId]=!0,sEles.push(outgoer),newOutgoers=!0)}if(!newOutgoers)break;eles=outgoers}return new $$.Collection(this._private.cy,sEles,{unique:!0}).filter(selector)},incomers:function(selector){for(var eles=this,oEles=[],i=0;i<eles.length;i++){var ele=eles[i],eleId=ele.id();if(ele.isNode())for(var edges=ele._private.edges,j=0;j<edges.length;j++){var edge=edges[j],srcId=edge._private.data.source,tgtId=edge._private.data.target;tgtId===eleId&&srcId!==eleId&&(oEles.push(edge),oEles.push(edge.source()[0]))}}return new $$.Collection(this._private.cy,oEles,{unique:!0}).filter(selector)},predecessors:function(selector){for(var eles=this,pEles=[],pElesIds={};;){var incomers=eles.incomers();if(0===incomers.length)break;for(var newIncomers=!1,i=0;i<incomers.length;i++){var incomer=incomers[i],incomerId=incomer.id();pElesIds[incomerId]||(pElesIds[incomerId]=!0,pEles.push(incomer),newIncomers=!0)}if(!newIncomers)break;eles=incomers}return new $$.Collection(this._private.cy,pEles,{unique:!0}).filter(selector)}}),$$.fn.eles({neighborhood:function(selector){for(var elements=[],cy=this._private.cy,nodes=this.nodes(),i=0;i<nodes.length;i++)for(var node=nodes[i],connectedEdges=node.connectedEdges(),j=0;j<connectedEdges.length;j++){var edge=connectedEdges[j],otherNode=edge.connectedNodes().not(node);otherNode.length>0&&elements.push(otherNode[0]),elements.push(edge[0])}return new $$.Collection(cy,elements,{unique:!0}).filter(selector)},closedNeighborhood:function(selector){return this.neighborhood().add(this).filter(selector)},openNeighborhood:function(selector){return this.neighborhood(selector)}}),$$.elesfn.neighbourhood=$$.elesfn.neighborhood,$$.elesfn.closedNeighbourhood=$$.elesfn.closedNeighborhood,$$.elesfn.openNeighbourhood=$$.elesfn.openNeighborhood,$$.fn.eles({source:function(selector){var src,ele=this[0];return ele&&(src=ele._private.source),src&&selector?src.filter(selector):src},target:function(selector){var tgt,ele=this[0];return ele&&(tgt=ele._private.target),tgt&&selector?tgt.filter(selector):tgt},sources:defineSourceFunction({attr:"source"}),targets:defineSourceFunction({attr:"target"})}),$$.fn.eles({edgesWith:defineEdgesWithFunction(),edgesTo:defineEdgesWithFunction({thisIs:"source"})}),$$.fn.eles({connectedEdges:function(selector){for(var retEles=[],cy=this._private.cy,eles=this,i=0;i<eles.length;i++){var node=eles[i];if(node.isNode())for(var edges=node._private.edges,j=0;j<edges.length;j++){var edge=edges[j];retEles.push(edge)}}return new $$.Collection(cy,retEles,{unique:!0}).filter(selector)},connectedNodes:function(selector){for(var retEles=[],cy=this._private.cy,eles=this,i=0;i<eles.length;i++){var edge=eles[i];edge.isEdge()&&(retEles.push(edge.source()[0]),retEles.push(edge.target()[0]))}return new $$.Collection(cy,retEles,{unique:!0}).filter(selector)},parallelEdges:defineParallelEdgesFunction(),codirectedEdges:defineParallelEdgesFunction({codirected:!0})})}(cytoscape),function($$){"use strict";$$.fn.eles({fit:function(){},center:function(){}})}(cytoscape),function($$){"use strict";$$.Minheap=function(cy,eles,valueFn){return new $$.Heap(cy,eles,$$.Heap.minHeapComparator,valueFn)},$$.Maxheap=function(cy,eles,valueFn){return new $$.Heap(cy,eles,$$.Heap.maxHeapComparator,valueFn)},$$.Heap=function(cy,eles,comparator,valueFn){if("undefined"!=typeof comparator&&"undefined"!=typeof eles){"undefined"==typeof valueFn&&(valueFn=$$.Heap.idFn);var id,heap,elesLen,sourceHeap=[],pointers={},elements=[],i=0;for(eles=this.getArgumentAsCollection(eles,cy),elesLen=eles.length,i=0;elesLen>i;i+=1){if(sourceHeap.push(valueFn.call(cy,eles[i],i,eles)),id=eles[i].id(),pointers.hasOwnProperty(id))throw"ERROR: Multiple items with the same id found: "+id;pointers[id]=i,elements.push(id)}for(this._private={cy:cy,heap:sourceHeap,pointers:pointers,elements:elements,comparator:comparator,extractor:valueFn,length:elesLen},i=Math.floor(elesLen/2);i>=0;i-=1)heap=this.heapify(i);return heap}},$$.Heap.idFn=function(node){return node.id()},$$.Heap.minHeapComparator=function(a,b){return a>=b},$$.Heap.maxHeapComparator=function(a,b){return b>=a},$$.fn.heap=function(fnMap,options){for(var name in fnMap){var fn=fnMap[name];$$.Heap.prototype[name]=fn}},$$.heapfn=$$.Heap.prototype,$$.heapfn.size=function(){return this._private.length},$$.heapfn.getArgumentAsCollection=function(eles,cy){var result;if("undefined"==typeof cy&&(cy=this._private.cy),$$.is.elementOrCollection(eles))result=eles;else{for(var resultArray=[],sourceEles=[].concat.apply([],[eles]),i=0;i<sourceEles.length;i++){var id=sourceEles[i],ele=cy.getElementById(id);ele.length>0&&resultArray.push(ele)}result=new $$.Collection(cy,resultArray)}return result},$$.heapfn.isHeap=function(){var i,left,right,lCheck,rCheck,array=this._private.heap,arrlen=array.length,comparator=this._private.comparator;for(i=0;arrlen>i;i+=1)if(left=2*i+1,right=left+1,lCheck=arrlen>left?comparator(array[left],array[i]):!0,rCheck=arrlen>right?comparator(array[right],array[i]):!0,!lCheck||!rCheck)return!1;return!0},$$.heapfn.heapSwap=function(i,j){var heap=this._private.heap,pointers=this._private.pointers,elements=this._private.elements,swapValue=heap[i],swapElems=elements[i],idI=elements[i],idJ=elements[j];heap[i]=heap[j],elements[i]=elements[j],pointers[idI]=j,pointers[idJ]=i,heap[j]=swapValue,elements[j]=swapElems},$$.heapfn.heapify=function(i,rootToLeaf){var array,current,left,right,best,comparator,parent,treeLen=0,condHeap=!1;for("undefined"==typeof rootToLeaf&&(rootToLeaf=!0),array=this._private.heap,treeLen=array.length,comparator=this._private.comparator,current=i;!condHeap;)rootToLeaf?(left=2*current+1,right=left+1,best=current,treeLen>left&&!comparator(array[left],array[best])&&(best=left),treeLen>right&&!comparator(array[right],array[best])&&(best=right),condHeap=best===current,condHeap||(this.heapSwap(best,current),current=best)):(parent=Math.floor((current-1)/2),best=current,condHeap=0>parent||comparator(array[best],array[parent]),condHeap||(this.heapSwap(best,parent),current=parent))},$$.heapfn.insert=function(eles){var element,elindex,elvalue,elid,i,elements=this.getArgumentAsCollection(eles),elsize=elements.length;for(i=0;elsize>i;i+=1){if(element=elements[i],elindex=this._private.heap.length,elvalue=this._private.extractor(element),elid=element.id(),this._private.pointers.hasOwnProperty(elid))throw"ERROR: Multiple items with the same id found: "+elid;this._private.heap.push(elvalue),this._private.elements.push(elid),this._private.pointers[elid]=elindex,this.heapify(elindex,!1)}this._private.length=this._private.heap.length},$$.heapfn.getValueById=function(elementId){if(this._private.pointers.hasOwnProperty(elementId)){var elementIndex=this._private.pointers[elementId];return this._private.heap[elementIndex]}},$$.heapfn.contains=function(eles){for(var elements=this.getArgumentAsCollection(eles),i=0;i<elements.length;i+=1){var elementId=elements[i].id();if(!this._private.pointers.hasOwnProperty(elementId))return!1}return!0},$$.heapfn.top=function(){return this._private.length>0?{value:this._private.heap[0],id:this._private.elements[0]}:void 0},$$.heapfn.pop=function(){if(this._private.length>0){var removeCandidate,removeValue,remId,top=this.top(),lastIndex=this._private.length-1;return this.heapSwap(0,lastIndex),removeCandidate=this._private.elements[lastIndex],removeValue=this._private.heap[lastIndex],remId=removeCandidate,this._private.heap.pop(),this._private.elements.pop(),this._private.length=this._private.heap.length,this._private.pointers[remId]=void 0,this.heapify(0),top}},$$.heapfn.findDirectionHeapify=function(index){var parent=Math.floor((index-1)/2),array=this._private.heap,condHeap=0>parent||this._private.comparator(array[index],array[parent]);this.heapify(index,condHeap)},$$.heapfn.edit=function(eles,edit){for(var elements=this.getArgumentAsCollection(eles),i=0;i<elements.length;i+=1){var elementId=elements[i].id(),elementIndex=this._private.pointers[elementId],elementValue=this._private.heap[elementIndex];$$.is.number(edit)?this._private.heap[elementIndex]=edit:$$.is.fn(edit)&&(this._private.heap[elementIndex]=edit.call(this._private.cy,elementValue,elementIndex)),this.findDirectionHeapify(elementIndex)}},$$.heapfn.remove=function(eles){for(var elements=this.getArgumentAsCollection(eles),i=0;i<elements.length;i+=1){var removeCandidate,removeValue,remId,elementId=elements[i].id(),elementIndex=this._private.pointers[elementId],lastIndex=this._private.length-1;elementIndex!==lastIndex&&this.heapSwap(elementIndex,lastIndex),removeCandidate=this._private.elements[lastIndex],removeValue=this._private.heap[lastIndex],remId=removeCandidate,this._private.heap.pop(),this._private.elements.pop(),this._private.length=this._private.heap.length,this._private.pointers[remId]=void 0,this.findDirectionHeapify(elementIndex)}return removeValue}}(cytoscape),function($$){"use strict";function CanvasRenderer(options){this.options=options,this.data={select:[void 0,void 0,void 0,void 0,0],renderer:this,cy:options.cy,container:options.cy.container(),canvases:new Array(CanvasRenderer.CANVAS_LAYERS),contexts:new Array(CanvasRenderer.CANVAS_LAYERS),canvasNeedsRedraw:new Array(CanvasRenderer.CANVAS_LAYERS),bufferCanvases:new Array(CanvasRenderer.BUFFER_COUNT),bufferContexts:new Array(CanvasRenderer.CANVAS_LAYERS)},this.hoverData={down:null,last:null,downTime:null,triggerMode:null,dragging:!1,initialPan:[null,null],capture:!1},this.timeoutData={panTimeout:null},this.dragData={possibleDragElements:[]},this.touchData={start:null,capture:!1,startPosition:[null,null,null,null,null,null],singleTouchStartTime:null,singleTouchMoved:!0,now:[null,null,null,null,null,null],earlier:[null,null,null,null,null,null]},this.zoomData={freeToZoom:!1,lastPointerX:null},this.redraws=0,this.showFps=options.showFps,this.bindings=[],this.data.canvasContainer=document.createElement("div");var containerStyle=this.data.canvasContainer.style;containerStyle.position="absolute",containerStyle.zIndex="0",containerStyle.overflow="hidden",this.data.container.appendChild(this.data.canvasContainer);for(var i=0;i<CanvasRenderer.CANVAS_LAYERS;i++)this.data.canvases[i]=document.createElement("canvas"),this.data.contexts[i]=this.data.canvases[i].getContext("2d"),this.data.canvases[i].style.position="absolute",this.data.canvases[i].setAttribute("data-id","layer"+i),this.data.canvases[i].style.zIndex=String(CanvasRenderer.CANVAS_LAYERS-i),this.data.canvasContainer.appendChild(this.data.canvases[i]),this.data.canvasNeedsRedraw[i]=!1;this.data.topCanvas=this.data.canvases[0],this.data.canvases[CanvasRenderer.NODE].setAttribute("data-id","layer"+CanvasRenderer.NODE+"-node"),this.data.canvases[CanvasRenderer.SELECT_BOX].setAttribute("data-id","layer"+CanvasRenderer.SELECT_BOX+"-selectbox"),this.data.canvases[CanvasRenderer.DRAG].setAttribute("data-id","layer"+CanvasRenderer.DRAG+"-drag");for(var i=0;i<CanvasRenderer.BUFFER_COUNT;i++)this.data.bufferCanvases[i]=document.createElement("canvas"),this.data.bufferContexts[i]=this.data.bufferCanvases[i].getContext("2d"),this.data.bufferCanvases[i].style.position="absolute",this.data.bufferCanvases[i].setAttribute("data-id","buffer"+i),this.data.bufferCanvases[i].style.zIndex=String(-i-1),this.data.bufferCanvases[i].style.visibility="hidden";this.hideEdgesOnViewport=options.hideEdgesOnViewport,this.hideLabelsOnViewport=options.hideLabelsOnViewport,this.textureOnViewport=options.textureOnViewport,this.wheelSensitivity=options.wheelSensitivity,this.motionBlurEnabled=options.motionBlur,this.forcedPixelRatio=options.pixelRatio,this.motionBlur=!0,this.motionBlurOpacity=options.motionBlurOpacity,this.motionBlurTransparency=1-this.motionBlurOpacity,this.motionBlurPxRatio=1,this.mbPxRBlurry=1,this.minMbLowQualFrames=4,this.fullQualityMb=!1,this.clearedForMotionBlur=[],this.desktopTapThreshold=options.desktopTapThreshold,this.desktopTapThreshold2=options.desktopTapThreshold*options.desktopTapThreshold,this.touchTapThreshold=options.touchTapThreshold,this.touchTapThreshold2=options.touchTapThreshold*options.touchTapThreshold,this.tapholdDuration=500,this.load()}CanvasRenderer.CANVAS_LAYERS=3,CanvasRenderer.SELECT_BOX=0,CanvasRenderer.DRAG=1,CanvasRenderer.NODE=2,CanvasRenderer.BUFFER_COUNT=3,CanvasRenderer.TEXTURE_BUFFER=0,CanvasRenderer.MOTIONBLUR_BUFFER_NODE=1,CanvasRenderer.MOTIONBLUR_BUFFER_DRAG=2,CanvasRenderer.panOrBoxSelectDelay=400;var pathsImpld="undefined"!=typeof Path2D;CanvasRenderer.usePaths=function(){return pathsImpld},CanvasRenderer.prototype.notify=function(params){var types;types=$$.is.array(params.type)?params.type:[params.type];for(var i=0;i<types.length;i++){var type=types[i];switch(type){case"destroy":return void this.destroy();case"add":case"remove":case"load":this.updateNodesCache(),this.updateEdgesCache();break;case"viewport":this.data.canvasNeedsRedraw[CanvasRenderer.SELECT_BOX]=!0;break;case"style":this.updateCachedZSortedEles()}("load"===type||"resize"===type)&&(this.invalidateContainerClientCoordsCache(),this.matchCanvasSize(this.data.container))}this.data.canvasNeedsRedraw[CanvasRenderer.NODE]=!0,this.data.canvasNeedsRedraw[CanvasRenderer.DRAG]=!0,this.redraw()},CanvasRenderer.prototype.destroy=function(){this.destroyed=!0;for(var i=0;i<this.bindings.length;i++){var binding=this.bindings[i],b=binding;b.target.removeEventListener(b.event,b.handler,b.useCapture)}if(this.removeObserver&&this.removeObserver.disconnect(),this.labelCalcDiv)try{document.body.removeChild(this.labelCalcDiv)}catch(e){}};for(var fnName in $$.math)CanvasRenderer.prototype[fnName]=$$.math[fnName];$$("renderer","canvas",CanvasRenderer)}(cytoscape),function($$){"use strict";var CanvasRenderer=$$("renderer","canvas"),rendFunc=CanvasRenderer.prototype,arrowShapes=CanvasRenderer.arrowShapes={};CanvasRenderer.arrowShapeHeight=.3;var bbCollide=function(x,y,centerX,centerY,width,height,direction,padding){var x1=centerX-width/2,x2=centerX+width/2,y1=centerY-height/2,y2=centerY+height/2;return x>=x1&&x2>=x&&y>=y1&&y2>=y},transform=function(x,y,size,angle,translation){
angle=-angle;var xRotated=x*Math.cos(angle)-y*Math.sin(angle),yRotated=x*Math.sin(angle)+y*Math.cos(angle),xScaled=xRotated*size,yScaled=yRotated*size,xTranslated=xScaled+translation.x,yTranslated=yScaled+translation.y;return{x:xTranslated,y:yTranslated}};arrowShapes.arrow={_points:[-.15,-.3,0,0,.15,-.3],collide:function(x,y,centerX,centerY,width,height,direction,padding){var points=arrowShapes.arrow._points;return $$.math.pointInsidePolygon(x,y,points,centerX,centerY,width,height,direction,padding)},roughCollide:bbCollide,draw:function(context,size,angle,translation){for(var points=arrowShapes.arrow._points,i=0;i<points.length/2;i++){var pt=transform(points[2*i],points[2*i+1],size,angle,translation);context.lineTo(pt.x,pt.y)}},spacing:function(edge){return 0},gap:function(edge){return 2*edge._private.style.width.pxValue}},arrowShapes.triangle=arrowShapes.arrow,arrowShapes["triangle-backcurve"]={_ctrlPt:[0,-.15],collide:function(x,y,centerX,centerY,width,height,direction,padding){var points=arrowShapes.triangle._points;return $$.math.pointInsidePolygon(x,y,points,centerX,centerY,width,height,direction,padding)},roughCollide:bbCollide,draw:function(context,size,angle,translation){for(var firstPt,points=arrowShapes.triangle._points,i=0;i<points.length/2;i++){var pt=transform(points[2*i],points[2*i+1],size,angle,translation);0===i&&(firstPt=pt),context.lineTo(pt.x,pt.y)}var ctrlPt=this._ctrlPt,ctrlPtTrans=transform(ctrlPt[0],ctrlPt[1],size,angle,translation);context.quadraticCurveTo(ctrlPtTrans.x,ctrlPtTrans.y,firstPt.x,firstPt.y)},spacing:function(edge){return 0},gap:function(edge){return 2*edge._private.style.width.pxValue}},arrowShapes["triangle-tee"]={_points:[-.15,-.3,0,0,.15,-.3,-.15,-.3],_pointsTee:[-.15,-.4,-.15,-.5,.15,-.5,.15,-.4],collide:function(x,y,centerX,centerY,width,height,direction,padding){var triPts=arrowShapes["triangle-tee"]._points,teePts=arrowShapes["triangle-tee"]._pointsTee,inside=$$.math.pointInsidePolygon(x,y,teePts,centerX,centerY,width,height,direction,padding)||$$.math.pointInsidePolygon(x,y,triPts,centerX,centerY,width,height,direction,padding);return inside},roughCollide:bbCollide,draw:function(context,size,angle,translation){for(var triPts=arrowShapes["triangle-tee"]._points,i=0;i<triPts.length/2;i++){var pt=transform(triPts[2*i],triPts[2*i+1],size,angle,translation);context.lineTo(pt.x,pt.y)}var teePts=arrowShapes["triangle-tee"]._pointsTee,firstTeePt=transform(teePts[0],teePts[1],size,angle,translation);context.moveTo(firstTeePt.x,firstTeePt.y);for(var i=0;i<teePts.length/2;i++){var pt=transform(teePts[2*i],teePts[2*i+1],size,angle,translation);context.lineTo(pt.x,pt.y)}},spacing:function(edge){return 0},gap:function(edge){return 2*edge._private.style.width.pxValue}},arrowShapes["half-triangle-overshot"]={_points:[0,-.25,-.5,-.25,.5,.25],leavePathOpen:!0,matchEdgeWidth:!0,collide:function(x,y,centerX,centerY,width,height,direction,padding){var points=this._points;return $$.math.pointInsidePolygon(x,y,points,centerX,centerY,width,height,direction,padding)},roughCollide:bbCollide,draw:function(context,size,angle,translation){for(var points=this._points,i=0;i<points.length/2;i++){var pt=transform(points[2*i],points[2*i+1],size,angle,translation);context.lineTo(pt.x,pt.y)}},spacing:function(edge){return 0},gap:function(edge){return 2*edge._private.style.width.pxValue}},arrowShapes.none={collide:function(x,y,centerX,centerY,width,height,direction,padding){return!1},roughCollide:function(x,y,centerX,centerY,width,height,direction,padding){return!1},draw:function(context){},spacing:function(edge){return 0},gap:function(edge){return 0}},arrowShapes.circle={_baseRadius:.15,collide:function(x,y,centerX,centerY,width,height,direction,padding){if(width!=height){var aspectRatio=(height+padding)/(width+padding);return y/=aspectRatio,centerY/=aspectRatio,Math.pow(centerX-x,2)+Math.pow(centerY-y,2)<=Math.pow((width+padding)*arrowShapes.circle._baseRadius,2)}return Math.pow(centerX-x,2)+Math.pow(centerY-y,2)<=Math.pow((width+padding)*arrowShapes.circle._baseRadius,2)},roughCollide:bbCollide,draw:function(context,size,angle,translation){context.arc(translation.x,translation.y,arrowShapes.circle._baseRadius*size,0,2*Math.PI,!1)},spacing:function(edge){return rendFunc.getArrowWidth(edge._private.style.width.pxValue)*arrowShapes.circle._baseRadius},gap:function(edge){return 2*edge._private.style.width.pxValue}},arrowShapes.inhibitor={_points:[-.25,0,-.25,-.1,.25,-.1,.25,0],collide:function(x,y,centerX,centerY,width,height,direction,padding){var points=arrowShapes.inhibitor._points;return $$.math.pointInsidePolygon(x,y,points,centerX,centerY,width,height,direction,padding)},roughCollide:bbCollide,draw:function(context,size,angle,translation){for(var points=arrowShapes.inhibitor._points,i=0;i<points.length/2;i++){var pt=transform(points[2*i],points[2*i+1],size,angle,translation);context.lineTo(pt.x,pt.y)}},spacing:function(edge){return 1},gap:function(edge){return 1}},arrowShapes.tee=arrowShapes.inhibitor,arrowShapes.square={_points:[-.15,0,.15,0,.15,-.3,-.15,-.3],collide:function(x,y,centerX,centerY,width,height,direction,padding){var points=arrowShapes.square._points;return $$.math.pointInsidePolygon(x,y,points,centerX,centerY,width,height,direction,padding)},roughCollide:bbCollide,draw:function(context,size,angle,translation){for(var points=arrowShapes.square._points,i=0;i<points.length/2;i++){var pt=transform(points[2*i],points[2*i+1],size,angle,translation);context.lineTo(pt.x,pt.y)}},spacing:function(edge){return 0},gap:function(edge){return 2*edge._private.style.width.pxValue}},arrowShapes.diamond={_points:[-.15,-.15,0,-.3,.15,-.15,0,0],collide:function(x,y,centerX,centerY,width,height,direction,padding){var points=arrowShapes.diamond._points;return $$.math.pointInsidePolygon(x,y,points,centerX,centerY,width,height,direction,padding)},roughCollide:bbCollide,draw:function(context,size,angle,translation){for(var points=arrowShapes.diamond._points,i=0;i<points.length/2;i++){var pt=transform(points[2*i],points[2*i+1],size,angle,translation);context.lineTo(pt.x,pt.y)}},spacing:function(edge){return 0},gap:function(edge){return edge._private.style.width.pxValue}}}(cytoscape),function($$){"use strict";var CanvasRenderer=$$("renderer","canvas"),CRp=CanvasRenderer.prototype;CRp.getCachedNodes=function(){var data=this.data,cy=this.data.cy;return null==data.cache&&(data.cache={}),null==data.cache.cachedNodes&&(data.cache.cachedNodes=cy.nodes()),data.cache.cachedNodes},CRp.updateNodesCache=function(){var data=this.data,cy=this.data.cy;null==data.cache&&(data.cache={}),data.cache.cachedNodes=cy.nodes()},CRp.getCachedEdges=function(){var data=this.data,cy=this.data.cy;return null==data.cache&&(data.cache={}),null==data.cache.cachedEdges&&(data.cache.cachedEdges=cy.edges()),data.cache.cachedEdges},CRp.updateEdgesCache=function(){var data=this.data,cy=this.data.cy;null==data.cache&&(data.cache={}),data.cache.cachedEdges=cy.edges()}}(cytoscape),function($$){"use strict";var CanvasRenderer=$$("renderer","canvas"),CRp=CanvasRenderer.prototype;CRp.projectIntoViewport=function(clientX,clientY){var offsets=this.findContainerClientCoords(),offsetLeft=offsets[0],offsetTop=offsets[1],x=clientX-offsetLeft,y=clientY-offsetTop;return x-=this.data.cy.pan().x,y-=this.data.cy.pan().y,x/=this.data.cy.zoom(),y/=this.data.cy.zoom(),[x,y]},CRp.findContainerClientCoords=function(){var container=this.data.container,bb=this.containerBB=this.containerBB||container.getBoundingClientRect();return[bb.left,bb.top,bb.right-bb.left,bb.bottom-bb.top]},CRp.invalidateContainerClientCoordsCache=function(){this.containerBB=null},CRp.findNearestElement=function(x,y,visibleElementsOnly,isTouch){function checkNode(node){var width=node.outerWidth()+2*nodeThreshold,height=node.outerHeight()+2*nodeThreshold,hw=width/2,hh=height/2,pos=node._private.position;if(pos.x-hw<=x&&x<=pos.x+hw&&pos.y-hh<=y&&y<=pos.y+hh){var visible=!visibleElementsOnly||node.visible()&&!node.transparent();if(visibleElementsOnly&&!visible)return;{var shape=CanvasRenderer.nodeShapes[self.getNodeShape(node)];node._private.style["border-width"].pxValue/2}shape.checkPoint(x,y,0,width,height,pos.x,pos.y)&&near.push(node)}}function checkEdge(edge){var sqDist,passedVisibilityCheck,rs=edge._private.rscratch,style=edge._private.style,width=style.width.pxValue/2+edgeThreshold,widthSq=width*width,width2=2*width,src=edge._private.source,tgt=edge._private.target,inEdgeBB=!1,passesVisibilityCheck=function(){if(void 0!==passedVisibilityCheck)return passedVisibilityCheck;if(!visibleElementsOnly)return passedVisibilityCheck=!0,!0;var visible=edge.visible()&&!edge.transparent();return visible?(passedVisibilityCheck=!0,!0):(passedVisibilityCheck=!1,!1)};if("self"===rs.edgeType||"compound"===rs.edgeType)((inEdgeBB=$$.math.inBezierVicinity(x,y,rs.startX,rs.startY,rs.cp2ax,rs.cp2ay,rs.selfEdgeMidX,rs.selfEdgeMidY,widthSq))&&passesVisibilityCheck()&&widthSq>(sqDist=$$.math.sqDistanceToQuadraticBezier(x,y,rs.startX,rs.startY,rs.cp2ax,rs.cp2ay,rs.selfEdgeMidX,rs.selfEdgeMidY))||(inEdgeBB=$$.math.inBezierVicinity(x,y,rs.selfEdgeMidX,rs.selfEdgeMidY,rs.cp2cx,rs.cp2cy,rs.endX,rs.endY,widthSq))&&passesVisibilityCheck()&&widthSq>(sqDist=$$.math.sqDistanceToQuadraticBezier(x,y,rs.selfEdgeMidX,rs.selfEdgeMidY,rs.cp2cx,rs.cp2cy,rs.endX,rs.endY)))&&near.push(edge);else if("haystack"===rs.edgeType){var radius=style["haystack-radius"].value,halfRadius=radius/2,tgtPos=tgt._private.position,tgtW=tgt.width(),tgtH=tgt.height(),srcPos=src._private.position,srcW=src.width(),srcH=src.height(),startX=srcPos.x+rs.source.x*srcW*halfRadius,startY=srcPos.y+rs.source.y*srcH*halfRadius,endX=tgtPos.x+rs.target.x*tgtW*halfRadius,endY=tgtPos.y+rs.target.y*tgtH*halfRadius;(inEdgeBB=$$.math.inLineVicinity(x,y,startX,startY,endX,endY,width2))&&passesVisibilityCheck()&&widthSq>(sqDist=$$.math.sqDistanceToFiniteLine(x,y,startX,startY,endX,endY))&&near.push(edge)}else"straight"===rs.edgeType?(inEdgeBB=$$.math.inLineVicinity(x,y,rs.startX,rs.startY,rs.endX,rs.endY,width2))&&passesVisibilityCheck()&&widthSq>(sqDist=$$.math.sqDistanceToFiniteLine(x,y,rs.startX,rs.startY,rs.endX,rs.endY))&&near.push(edge):"bezier"===rs.edgeType&&(inEdgeBB=$$.math.inBezierVicinity(x,y,rs.startX,rs.startY,rs.cp2x,rs.cp2y,rs.endX,rs.endY,widthSq))&&passesVisibilityCheck()&&widthSq>(sqDist=$$.math.sqDistanceToQuadraticBezier(x,y,rs.startX,rs.startY,rs.cp2x,rs.cp2y,rs.endX,rs.endY))&&near.push(edge);if(inEdgeBB&&passesVisibilityCheck()&&0===near.length||near[near.length-1]!==edge){var srcShape=CanvasRenderer.arrowShapes[style["source-arrow-shape"].value],tgtShape=CanvasRenderer.arrowShapes[style["target-arrow-shape"].value],src=src||edge._private.source,tgt=tgt||edge._private.target,tgtPos=tgt._private.position,srcPos=src._private.position,srcArW=self.getArrowWidth(style.width.pxValue),srcArH=self.getArrowHeight(style.width.pxValue),tgtArW=srcArW,tgtArH=srcArH;(srcShape.roughCollide(x,y,rs.arrowStartX,rs.arrowStartY,srcArW,srcArH,[rs.arrowStartX-srcPos.x,rs.arrowStartY-srcPos.y],edgeThreshold)&&srcShape.collide(x,y,rs.arrowStartX,rs.arrowStartY,srcArW,srcArH,[rs.arrowStartX-srcPos.x,rs.arrowStartY-srcPos.y],edgeThreshold)||tgtShape.roughCollide(x,y,rs.arrowEndX,rs.arrowEndY,tgtArW,tgtArH,[rs.arrowEndX-tgtPos.x,rs.arrowEndY-tgtPos.y],edgeThreshold)&&tgtShape.collide(x,y,rs.arrowEndX,rs.arrowEndY,tgtArW,tgtArH,[rs.arrowEndX-tgtPos.x,rs.arrowEndY-tgtPos.y],edgeThreshold))&&near.push(edge)}hasCompounds&&near.length>0&&near[near.length-1]===edge&&(checkNode(src),checkNode(tgt))}for(var self=this,eles=this.getCachedZSortedEles(),near=[],zoom=this.data.cy.zoom(),hasCompounds=this.data.cy.hasCompoundNodes(),edgeThreshold=(isTouch?24:8)/zoom,nodeThreshold=(isTouch?8:2)/zoom,i=eles.length-1;i>=0;i--){var ele=eles[i];if(near.length>0)break;"nodes"===ele._private.group?checkNode(eles[i]):checkEdge(eles[i])}return near.length>0?near[near.length-1]:null},CRp.getAllInBox=function(x1,y1,x2,y2){var nodes=this.getCachedNodes(),edges=this.getCachedEdges(),box=[],x1c=Math.min(x1,x2),x2c=Math.max(x1,x2),y1c=Math.min(y1,y2),y2c=Math.max(y1,y2);x1=x1c,x2=x2c,y1=y1c,y2=y2c;for(var heur,i=0;i<nodes.length;i++){var pos=nodes[i]._private.position,nShape=this.getNodeShape(nodes[i]),w=this.getNodeWidth(nodes[i]),h=this.getNodeHeight(nodes[i]),border=nodes[i]._private.style["border-width"].pxValue/2,shapeObj=CanvasRenderer.nodeShapes[nShape];shapeObj.intersectBox(x1,y1,x2,y2,w,h,pos.x,pos.y,border)&&box.push(nodes[i])}for(var i=0;i<edges.length;i++){var rs=edges[i]._private.rscratch;if("self"==edges[i]._private.rscratch.edgeType&&((heur=$$.math.boxInBezierVicinity(x1,y1,x2,y2,rs.startX,rs.startY,rs.cp2ax,rs.cp2ay,rs.endX,rs.endY,edges[i]._private.style.width.pxValue))&&(2==heur||1==heur&&$$.math.checkBezierInBox(x1,y1,x2,y2,rs.startX,rs.startY,rs.cp2ax,rs.cp2ay,rs.endX,rs.endY,edges[i]._private.style.width.pxValue))||(heur=$$.math.boxInBezierVicinity(x1,y1,x2,y2,rs.startX,rs.startY,rs.cp2cx,rs.cp2cy,rs.endX,rs.endY,edges[i]._private.style.width.pxValue))&&(2==heur||1==heur&&$$.math.checkBezierInBox(x1,y1,x2,y2,rs.startX,rs.startY,rs.cp2cx,rs.cp2cy,rs.endX,rs.endY,edges[i]._private.style.width.pxValue)))&&box.push(edges[i]),"bezier"==rs.edgeType&&(heur=$$.math.boxInBezierVicinity(x1,y1,x2,y2,rs.startX,rs.startY,rs.cp2x,rs.cp2y,rs.endX,rs.endY,edges[i]._private.style.width.pxValue))&&(2==heur||1==heur&&$$.math.checkBezierInBox(x1,y1,x2,y2,rs.startX,rs.startY,rs.cp2x,rs.cp2y,rs.endX,rs.endY,edges[i]._private.style.width.pxValue))&&box.push(edges[i]),"straight"==rs.edgeType&&(heur=$$.math.boxInBezierVicinity(x1,y1,x2,y2,rs.startX,rs.startY,.5*rs.startX+.5*rs.endX,.5*rs.startY+.5*rs.endY,rs.endX,rs.endY,edges[i]._private.style.width.pxValue))&&(2==heur||1==heur&&$$.math.checkStraightEdgeInBox(x1,y1,x2,y2,rs.startX,rs.startY,rs.endX,rs.endY,edges[i]._private.style.width.pxValue))&&box.push(edges[i]),"haystack"==rs.edgeType){var tgt=edges[i].target()[0],tgtPos=tgt.position(),src=edges[i].source()[0],srcPos=src.position(),startX=srcPos.x+rs.source.x,startY=srcPos.y+rs.source.y,endX=tgtPos.x+rs.target.x,endY=tgtPos.y+rs.target.y,startInBox=startX>=x1&&x2>=startX&&startY>=y1&&y2>=startY,endInBox=endX>=x1&&x2>=endX&&endY>=y1&&y2>=endY;startInBox&&endInBox&&box.push(edges[i])}}return box},CRp.getNodeWidth=function(node){return node.width()},CRp.getNodeHeight=function(node){return node.height()},CRp.getNodeShape=function(node){var shape=node._private.style.shape.value;return node.isParent()?"rectangle"===shape||"roundrectangle"===shape?shape:"rectangle":shape},CRp.getNodePadding=function(node){var left=node._private.style["padding-left"].pxValue,right=node._private.style["padding-right"].pxValue,top=node._private.style["padding-top"].pxValue,bottom=node._private.style["padding-bottom"].pxValue;return isNaN(left)&&(left=0),isNaN(right)&&(right=0),isNaN(top)&&(top=0),isNaN(bottom)&&(bottom=0),{left:left,right:right,top:top,bottom:bottom}},CRp.zOrderSort=$$.Collection.zIndexSort,CRp.updateCachedZSortedEles=function(){this.getCachedZSortedEles(!0)},CRp.getCachedZSortedEles=function(forceRecalc){var lastNodes=this.lastZOrderCachedNodes,lastEdges=this.lastZOrderCachedEdges,nodes=this.getCachedNodes(),edges=this.getCachedEdges(),eles=[];if(!forceRecalc&&lastNodes&&lastEdges&&lastNodes===nodes&&lastEdges===edges)eles=this.cachedZSortedEles;else{for(var i=0;i<nodes.length;i++)nodes[i].visible()&&!nodes[i].transparent()&&eles.push(nodes[i]);for(var i=0;i<edges.length;i++)edges[i].visible()&&!edges[i].transparent()&&eles.push(edges[i]);eles.sort(this.zOrderSort),this.cachedZSortedEles=eles}return this.lastZOrderCachedNodes=nodes,this.lastZOrderCachedEdges=edges,eles},CRp.projectBezier=function(edge){function pushBezierPts(pts){bpts.push({x:qbezierAt(pts[0],pts[2],pts[4],.05),y:qbezierAt(pts[1],pts[3],pts[5],.05)}),bpts.push({x:qbezierAt(pts[0],pts[2],pts[4],.25),y:qbezierAt(pts[1],pts[3],pts[5],.25)}),bpts.push({x:qbezierAt(pts[0],pts[2],pts[4],.4),y:qbezierAt(pts[1],pts[3],pts[5],.4)});var mid={x:qbezierAt(pts[0],pts[2],pts[4],.5),y:qbezierAt(pts[1],pts[3],pts[5],.5)};bpts.push(mid),"self"===rs.edgeType||"compound"===rs.edgeType?(rs.midX=rs.selfEdgeMidX,rs.midY=rs.selfEdgeMidY):(rs.midX=mid.x,rs.midY=mid.y),bpts.push({x:qbezierAt(pts[0],pts[2],pts[4],.6),y:qbezierAt(pts[1],pts[3],pts[5],.6)}),bpts.push({x:qbezierAt(pts[0],pts[2],pts[4],.75),y:qbezierAt(pts[1],pts[3],pts[5],.75)}),bpts.push({x:qbezierAt(pts[0],pts[2],pts[4],.95),y:qbezierAt(pts[1],pts[3],pts[5],.95)})}var qbezierAt=$$.math.qbezierAt,rs=edge._private.rscratch,bpts=edge._private.rstyle.bezierPts=[];"self"===rs.edgeType?(pushBezierPts([rs.startX,rs.startY,rs.cp2ax,rs.cp2ay,rs.selfEdgeMidX,rs.selfEdgeMidY]),pushBezierPts([rs.selfEdgeMidX,rs.selfEdgeMidY,rs.cp2cx,rs.cp2cy,rs.endX,rs.endY])):"bezier"===rs.edgeType&&pushBezierPts([rs.startX,rs.startY,rs.cp2x,rs.cp2y,rs.endX,rs.endY])},CRp.recalculateNodeLabelProjection=function(node){var content=node._private.style.content.strValue;if(content&&!content.match(/^\s+$/)){var textX,textY,nodeWidth=node.outerWidth(),nodeHeight=node.outerHeight(),nodePos=node._private.position,textHalign=node._private.style["text-halign"].strValue,textValign=node._private.style["text-valign"].strValue,rs=node._private.rscratch,rstyle=node._private.rstyle;switch(textHalign){case"left":textX=nodePos.x-nodeWidth/2;break;case"right":textX=nodePos.x+nodeWidth/2;break;default:textX=nodePos.x}switch(textValign){case"top":textY=nodePos.y-nodeHeight/2;break;case"bottom":textY=nodePos.y+nodeHeight/2;break;default:textY=nodePos.y}rs.labelX=textX,rs.labelY=textY,rstyle.labelX=textX,rstyle.labelY=textY,this.applyLabelDimensions(node)}},CRp.recalculateEdgeLabelProjection=function(edge){var content=edge._private.style.content.strValue;if(content&&!content.match(/^\s+$/)){var textX,textY,edgeCenterX,edgeCenterY,_p=edge._private,rs=_p.rscratch,rstyle=_p.rstyle;if("self"==rs.edgeType)edgeCenterX=rs.selfEdgeMidX,edgeCenterY=rs.selfEdgeMidY;else if("straight"==rs.edgeType)edgeCenterX=(rs.startX+rs.endX)/2,edgeCenterY=(rs.startY+rs.endY)/2;else if("bezier"==rs.edgeType)edgeCenterX=$$.math.qbezierAt(rs.startX,rs.cp2x,rs.endX,.5),edgeCenterY=$$.math.qbezierAt(rs.startY,rs.cp2y,rs.endY,.5);else if("haystack"==rs.edgeType){var pts=rs.haystackPts;edgeCenterX=(pts[0]+pts[2])/2,edgeCenterY=(pts[1]+pts[3])/2}textX=edgeCenterX,textY=edgeCenterY,rs.labelX=textX,rs.labelY=textY,rstyle.labelX=textX,rstyle.labelY=textY,this.applyLabelDimensions(edge)}},CRp.applyLabelDimensions=function(ele){var rs=ele._private.rscratch,rstyle=ele._private.rstyle,text=this.getLabelText(ele),labelDims=this.calculateLabelDimensions(ele,text);rstyle.labelWidth=labelDims.width,rs.labelWidth=labelDims.width,rstyle.labelHeight=labelDims.height,rs.labelHeight=labelDims.height},CRp.getLabelText=function(ele){var style=ele._private.style,text=ele._private.style.content.strValue,textTransform=style["text-transform"].value,rscratch=ele._private.rscratch;if("none"==textTransform||("uppercase"==textTransform?text=text.toUpperCase():"lowercase"==textTransform&&(text=text.toLowerCase())),"wrap"===style["text-wrap"].value){if(rscratch.labelWrapKey===rscratch.labelKey)return rscratch.labelWrapCachedText;for(var lines=text.split("\n"),maxW=style["text-max-width"].pxValue,wrappedLines=[],l=0;l<lines.length;l++){var line=lines[l],lineDims=this.calculateLabelDimensions(ele,line,"line="+line),lineW=lineDims.width;if(lineW>maxW){for(var words=line.split(/\s+/),subline="",w=0;w<words.length;w++){var word=words[w],testLine=0===subline.length?word:subline+" "+word,testDims=this.calculateLabelDimensions(ele,testLine,"testLine="+testLine),testW=testDims.width;maxW>=testW?subline+=word+" ":(wrappedLines.push(subline),subline=word+" ")}subline.match(/^\s+$/)||wrappedLines.push(subline)}else wrappedLines.push(line)}rscratch.labelWrapCachedLines=wrappedLines,rscratch.labelWrapCachedText=text=wrappedLines.join("\n"),rscratch.labelWrapKey=rscratch.labelKey}return text},CRp.calculateLabelDimensions=function(ele,text,extraKey){var r=this,style=ele._private.style,fStyle=style["font-style"].strValue,size=style["font-size"].pxValue+"px",family=style["font-family"].strValue,weight=style["font-weight"].strValue,cacheKey=ele._private.labelKey;extraKey&&(cacheKey+="$@$"+extraKey);var cache=r.labelDimCache||(r.labelDimCache={});if(cache[cacheKey])return cache[cacheKey];var div=this.labelCalcDiv;div||(div=this.labelCalcDiv=document.createElement("div"),document.body.appendChild(div));var ds=div.style;return ds.fontFamily=family,ds.fontStyle=fStyle,ds.fontSize=size,ds.fontWeight=weight,ds.position="absolute",ds.left="-9999px",ds.top="-9999px",ds.zIndex="-1",ds.visibility="hidden",ds.pointerEvents="none",ds.padding="0",ds.lineHeight="1",ds.whiteSpace="wrap"===style["text-wrap"].value?"pre":"normal",div.textContent=text,cache[cacheKey]={width:div.clientWidth,height:div.clientHeight},cache[cacheKey]},CRp.recalculateRenderedStyle=function(eles){for(var edges=[],nodes=[],handledEdge={},i=0;i<eles.length;i++){var ele=eles[i],_p=ele._private,style=_p.style,rs=_p.rscratch,rstyle=_p.rstyle,id=_p.data.id,bbStyleSame=null!=rs.boundingBoxKey&&_p.boundingBoxKey===rs.boundingBoxKey,labelStyleSame=null!=rs.labelKey&&_p.labelKey===rs.labelKey,styleSame=bbStyleSame&&labelStyleSame;if("nodes"===ele._private.group){var pos=_p.position,posSame=null!=rstyle.nodeX&&null!=rstyle.nodeY&&pos.x===rstyle.nodeX&&pos.y===rstyle.nodeY,wSame=null!=rstyle.nodeW&&rstyle.nodeW===style.width.pxValue,hSame=null!=rstyle.nodeH&&rstyle.nodeH===style.height.pxValue;posSame&&styleSame&&wSame&&hSame||nodes.push(ele),rstyle.nodeX=pos.x,rstyle.nodeY=pos.y,rstyle.nodeW=style.width.pxValue,rstyle.nodeH=style.height.pxValue}else{var srcPos=ele._private.source._private.position,tgtPos=ele._private.target._private.position,srcSame=null!=rstyle.srcX&&null!=rstyle.srcY&&srcPos.x===rstyle.srcX&&srcPos.y===rstyle.srcY,tgtSame=null!=rstyle.tgtX&&null!=rstyle.tgtY&&tgtPos.x===rstyle.tgtX&&tgtPos.y===rstyle.tgtY,positionsSame=srcSame&&tgtSame;if(!positionsSame||!styleSame){var curveType=_p.style["curve-style"].value;if("bezier"===curveType){if(!handledEdge[id]){edges.push(ele),handledEdge[id]=!0;for(var parallelEdges=ele.parallelEdges(),i=0;i<parallelEdges.length;i++){var pEdge=parallelEdges[i],pId=pEdge._private.data.id;handledEdge[pId]||(edges.push(pEdge),handledEdge[pId]=!0)}}}else edges.push(ele)}rstyle.srcX=srcPos.x,rstyle.srcY=srcPos.y,rstyle.tgtX=tgtPos.x,rstyle.tgtY=tgtPos.y}rs.boundingBoxKey=_p.boundingBoxKey,rs.labelKey=_p.labelKey}this.recalculateEdgeProjections(edges),this.recalculateLabelProjections(nodes,edges)},CRp.recalculateLabelProjections=function(nodes,edges){for(var i=0;i<nodes.length;i++)this.recalculateNodeLabelProjection(nodes[i]);for(var i=0;i<edges.length;i++)this.recalculateEdgeLabelProjection(edges[i])},CRp.recalculateEdgeProjections=function(edges){this.findEdgeControlPoints(edges)},CRp.findEdgeControlPoints=function(edges){if(edges&&0!==edges.length){for(var pairId,cy=this.data.cy,hasCompounds=cy.hasCompoundNodes(),hashTable={},pairIds=[],haystackEdges=[],i=0;i<edges.length;i++){var edge=edges[i],style=edge._private.style,edgeIsUnbundled="unbundled-bezier"===style["curve-style"].value;if("none"!==style.display.value)if("haystack"!==style["curve-style"].value){var srcId=edge._private.data.source,tgtId=edge._private.data.target;pairId=srcId>tgtId?tgtId+"-"+srcId:srcId+"-"+tgtId,edgeIsUnbundled&&(pairId="unbundled"+edge._private.data.id),null==hashTable[pairId]&&(hashTable[pairId]=[],pairIds.push(pairId)),hashTable[pairId].push(edge),edgeIsUnbundled&&(hashTable[pairId].hasUnbundled=!0)}else haystackEdges.push(edge)}for(var src,tgt,srcPos,tgtPos,srcW,srcH,tgtW,tgtH,srcShape,tgtShape,srcBorder,tgtBorder,vectorNormInverse,badBezier,p=0;p<pairIds.length;p++){pairId=pairIds[p];var pairEdges=hashTable[pairId];if(pairEdges.sort(function(edge1,edge2){return edge1._private.index-edge2._private.index}),src=pairEdges[0]._private.source,tgt=pairEdges[0]._private.target,src._private.data.id>tgt._private.data.id){var temp=src;src=tgt,tgt=temp}if(srcPos=src._private.position,tgtPos=tgt._private.position,srcW=this.getNodeWidth(src),srcH=this.getNodeHeight(src),tgtW=this.getNodeWidth(tgt),tgtH=this.getNodeHeight(tgt),srcShape=CanvasRenderer.nodeShapes[this.getNodeShape(src)],tgtShape=CanvasRenderer.nodeShapes[this.getNodeShape(tgt)],srcBorder=src._private.style["border-width"].pxValue,tgtBorder=tgt._private.style["border-width"].pxValue,badBezier=!1,pairEdges.length>1&&src!==tgt||pairEdges.hasUnbundled){var srcOutside=srcShape.intersectLine(srcPos.x,srcPos.y,srcW,srcH,tgtPos.x,tgtPos.y,srcBorder/2),tgtOutside=tgtShape.intersectLine(tgtPos.x,tgtPos.y,tgtW,tgtH,srcPos.x,srcPos.y,tgtBorder/2),midptSrcPts={x1:srcOutside[0],x2:tgtOutside[0],y1:srcOutside[1],y2:tgtOutside[1]},dy=tgtOutside[1]-srcOutside[1],dx=tgtOutside[0]-srcOutside[0],l=Math.sqrt(dx*dx+dy*dy),vector={x:dx,y:dy},vectorNorm={x:vector.x/l,y:vector.y/l};vectorNormInverse={x:-vectorNorm.y,y:vectorNorm.x},(tgtShape.checkPoint(srcOutside[0],srcOutside[1],tgtBorder/2,tgtW,tgtH,tgtPos.x,tgtPos.y)||srcShape.checkPoint(tgtOutside[0],tgtOutside[1],srcBorder/2,srcW,srcH,srcPos.x,srcPos.y))&&(vectorNormInverse={},badBezier=!0)}for(var edge,rs,i=0;i<pairEdges.length;i++){edge=pairEdges[i],rs=edge._private.rscratch;var edgeIndex1=rs.lastEdgeIndex,edgeIndex2=i,numEdges1=rs.lastNumEdges,numEdges2=pairEdges.length,eStyle=edge._private.style,stepSize=eStyle["control-point-step-size"].pxValue,stepDist=void 0!==eStyle["control-point-distance"]?eStyle["control-point-distance"].pxValue:void 0,stepWeight=eStyle["control-point-weight"].value,edgeIsUnbundled="unbundled-bezier"===eStyle["curve-style"].value,swappedDirection=edge._private.source!==src;swappedDirection&&edgeIsUnbundled&&(stepDist*=-1);var srcX1=rs.lastSrcCtlPtX,srcX2=srcPos.x,srcY1=rs.lastSrcCtlPtY,srcY2=srcPos.y,srcW1=rs.lastSrcCtlPtW,srcW2=src.outerWidth(),srcH1=rs.lastSrcCtlPtH,srcH2=src.outerHeight(),tgtX1=rs.lastTgtCtlPtX,tgtX2=tgtPos.x,tgtY1=rs.lastTgtCtlPtY,tgtY2=tgtPos.y,tgtW1=rs.lastTgtCtlPtW,tgtW2=tgt.outerWidth(),tgtH1=rs.lastTgtCtlPtH,tgtH2=tgt.outerHeight(),width1=rs.lastW,width2=eStyle["control-point-step-size"].pxValue;if(rs.badBezier=badBezier?!0:!1,srcX1!==srcX2||srcY1!==srcY2||srcW1!==srcW2||srcH1!==srcH2||tgtX1!==tgtX2||tgtY1!==tgtY2||tgtW1!==tgtW2||tgtH1!==tgtH2||width1!==width2||!(edgeIndex1===edgeIndex2&&numEdges1===numEdges2||edgeIsUnbundled)){if(rs.lastSrcCtlPtX=srcX2,rs.lastSrcCtlPtY=srcY2,rs.lastSrcCtlPtW=srcW2,rs.lastSrcCtlPtH=srcH2,rs.lastTgtCtlPtX=tgtX2,rs.lastTgtCtlPtY=tgtY2,rs.lastTgtCtlPtW=tgtW2,rs.lastTgtCtlPtH=tgtH2,rs.lastEdgeIndex=edgeIndex2,rs.lastNumEdges=numEdges2,rs.lastWidth=width2,src===tgt){rs.edgeType="self";var j=i,loopDist=stepSize;edgeIsUnbundled&&(j=0,loopDist=stepDist),rs.cp2ax=srcPos.x,rs.cp2ay=srcPos.y-(1+Math.pow(srcH,1.12)/100)*loopDist*(j/3+1),rs.cp2cx=srcPos.x-(1+Math.pow(srcW,1.12)/100)*loopDist*(j/3+1),rs.cp2cy=srcPos.y,rs.selfEdgeMidX=(rs.cp2ax+rs.cp2cx)/2,rs.selfEdgeMidY=(rs.cp2ay+rs.cp2cy)/2}else if(hasCompounds&&(src.isParent()||src.isChild()||tgt.isParent()||tgt.isChild())&&(src.parents().anySame(tgt)||tgt.parents().anySame(src))){rs.edgeType="compound",rs.badBezier=!1;var j=i,loopDist=stepSize;edgeIsUnbundled&&(j=0,loopDist=stepDist);var loopW=50,loopaPos={x:srcPos.x-srcW/2,y:srcPos.y-srcH/2},loopbPos={x:tgtPos.x-tgtW/2,y:tgtPos.y-tgtH/2},minCompoundStretch=1;rs.cp2ax=loopaPos.x,rs.compoundStretchA=Math.max(minCompoundStretch,Math.log(.01*srcW)),rs.cp2ay=loopaPos.y-(1+Math.pow(loopW,1.12)/100)*loopDist*(j/3+1)*rs.compoundStretchA,rs.compoundStretchB=Math.max(minCompoundStretch,Math.log(.01*tgtW)),rs.cp2cx=loopbPos.x-(1+Math.pow(loopW,1.12)/100)*loopDist*(j/3+1)*rs.compoundStretchB,rs.cp2cy=loopbPos.y,rs.selfEdgeMidX=(rs.cp2ax+rs.cp2cx)/2,rs.selfEdgeMidY=(rs.cp2ay+rs.cp2cy)/2}else if(pairEdges.length%2!==1||i!==Math.floor(pairEdges.length/2)||edgeIsUnbundled){var manStepDist,normStepDist=(.5-pairEdges.length/2+i)*stepSize,sign=$$.math.signum(normStepDist);manStepDist=edgeIsUnbundled?stepDist:void 0!==stepDist?sign*stepDist:void 0;var distanceFromMidpoint=void 0!==manStepDist?manStepDist:normStepDist,w1=1-stepWeight,w2=stepWeight;swappedDirection&&(w1=stepWeight,w2=1-stepWeight);var adjustedMidpt={x:midptSrcPts.x1*w1+midptSrcPts.x2*w2,y:midptSrcPts.y1*w1+midptSrcPts.y2*w2};rs.edgeType="bezier",rs.cp2x=adjustedMidpt.x+vectorNormInverse.x*distanceFromMidpoint,rs.cp2y=adjustedMidpt.y+vectorNormInverse.y*distanceFromMidpoint}else rs.edgeType="straight";this.findEndpoints(edge);var badStart=!$$.is.number(rs.startX)||!$$.is.number(rs.startY),badAStart=!$$.is.number(rs.arrowStartX)||!$$.is.number(rs.arrowStartY),badEnd=!$$.is.number(rs.endX)||!$$.is.number(rs.endY),badAEnd=!$$.is.number(rs.arrowEndX)||!$$.is.number(rs.arrowEndY),minCpADistFactor=3,arrowW=this.getArrowWidth(edge._private.style.width.pxValue)*CanvasRenderer.arrowShapeHeight,minCpADist=minCpADistFactor*arrowW,startACpDist=$$.math.distance({x:rs.cp2x,y:rs.cp2y},{x:rs.startX,y:rs.startY}),closeStartACp=minCpADist>startACpDist,endACpDist=$$.math.distance({x:rs.cp2x,y:rs.cp2y},{x:rs.endX,y:rs.endY}),closeEndACp=minCpADist>endACpDist;if("bezier"===rs.edgeType){var overlapping=!1;if(badStart||badAStart||closeStartACp){overlapping=!0;var cpD={x:rs.cp2x-srcPos.x,y:rs.cp2y-srcPos.y},cpL=Math.sqrt(cpD.x*cpD.x+cpD.y*cpD.y),cpM={x:cpD.x/cpL,y:cpD.y/cpL},radius=Math.max(srcW,srcH),cpProj={x:rs.cp2x+2*cpM.x*radius,y:rs.cp2y+2*cpM.y*radius},srcCtrlPtIntn=srcShape.intersectLine(srcPos.x,srcPos.y,srcW,srcH,cpProj.x,cpProj.y,srcBorder/2);closeStartACp?(rs.cp2x=rs.cp2x+cpM.x*(minCpADist-startACpDist),rs.cp2y=rs.cp2y+cpM.y*(minCpADist-startACpDist)):(rs.cp2x=srcCtrlPtIntn[0]+cpM.x*minCpADist,rs.cp2y=srcCtrlPtIntn[1]+cpM.y*minCpADist)}if(badEnd||badAEnd||closeEndACp){overlapping=!0;var cpD={x:rs.cp2x-tgtPos.x,y:rs.cp2y-tgtPos.y},cpL=Math.sqrt(cpD.x*cpD.x+cpD.y*cpD.y),cpM={x:cpD.x/cpL,y:cpD.y/cpL},radius=Math.max(srcW,srcH),cpProj={x:rs.cp2x+2*cpM.x*radius,y:rs.cp2y+2*cpM.y*radius},tgtCtrlPtIntn=tgtShape.intersectLine(tgtPos.x,tgtPos.y,tgtW,tgtH,cpProj.x,cpProj.y,tgtBorder/2);closeEndACp?(rs.cp2x=rs.cp2x+cpM.x*(minCpADist-endACpDist),rs.cp2y=rs.cp2y+cpM.y*(minCpADist-endACpDist)):(rs.cp2x=tgtCtrlPtIntn[0]+cpM.x*minCpADist,rs.cp2y=tgtCtrlPtIntn[1]+cpM.y*minCpADist)}overlapping&&this.findEndpoints(edge)}else"straight"===rs.edgeType&&(rs.midX=(srcX2+tgtX2)/2,rs.midY=(srcY2+tgtY2)/2);this.projectBezier(edge),this.recalculateEdgeLabelProjection(edge)}}}for(var i=0;i<haystackEdges.length;i++){var edge=haystackEdges[i],_p=edge._private,rscratch=_p.rscratch,rs=rscratch;if(!rscratch.haystack){var angle=2*Math.random()*Math.PI;rscratch.source={x:Math.cos(angle),y:Math.sin(angle)};var angle=2*Math.random()*Math.PI;rscratch.target={x:Math.cos(angle),y:Math.sin(angle)}}var src=_p.source,tgt=_p.target,srcPos=src._private.position,tgtPos=tgt._private.position,srcW=src.width(),tgtW=tgt.width(),srcH=src.height(),tgtH=tgt.height(),radius=style["haystack-radius"].value,halfRadius=radius/2;rs.haystackPts=[rs.source.x*srcW*halfRadius+srcPos.x,rs.source.y*srcH*halfRadius+srcPos.y,rs.target.x*tgtW*halfRadius+tgtPos.x,rs.target.y*tgtH*halfRadius+tgtPos.y],rscratch.edgeType="haystack",rscratch.haystack=!0,this.recalculateEdgeLabelProjection(edge)}return hashTable}},CRp.findEndpoints=function(edge){var intersect,source=edge.source()[0],target=edge.target()[0],tgtArShape=edge._private.style["target-arrow-shape"].value,srcArShape=edge._private.style["source-arrow-shape"].value,tgtBorderW=target._private.style["border-width"].pxValue,srcBorderW=source._private.style["border-width"].pxValue,rs=edge._private.rscratch;if("self"==rs.edgeType||"compound"==rs.edgeType){var cp=[rs.cp2cx,rs.cp2cy];intersect=CanvasRenderer.nodeShapes[this.getNodeShape(target)].intersectLine(target._private.position.x,target._private.position.y,this.getNodeWidth(target),this.getNodeHeight(target),cp[0],cp[1],tgtBorderW/2);var arrowEnd=$$.math.shortenIntersection(intersect,cp,CanvasRenderer.arrowShapes[tgtArShape].spacing(edge)),edgeEnd=$$.math.shortenIntersection(intersect,cp,CanvasRenderer.arrowShapes[tgtArShape].gap(edge));

rs.endX=edgeEnd[0],rs.endY=edgeEnd[1],rs.arrowEndX=arrowEnd[0],rs.arrowEndY=arrowEnd[1];var cp=[rs.cp2ax,rs.cp2ay];intersect=CanvasRenderer.nodeShapes[this.getNodeShape(source)].intersectLine(source._private.position.x,source._private.position.y,this.getNodeWidth(source),this.getNodeHeight(source),cp[0],cp[1],srcBorderW/2);var arrowStart=$$.math.shortenIntersection(intersect,cp,CanvasRenderer.arrowShapes[srcArShape].spacing(edge)),edgeStart=$$.math.shortenIntersection(intersect,cp,CanvasRenderer.arrowShapes[srcArShape].gap(edge));rs.startX=edgeStart[0],rs.startY=edgeStart[1],rs.arrowStartX=arrowStart[0],rs.arrowStartY=arrowStart[1]}else if("straight"==rs.edgeType){intersect=CanvasRenderer.nodeShapes[this.getNodeShape(target)].intersectLine(target._private.position.x,target._private.position.y,this.getNodeWidth(target),this.getNodeHeight(target),source.position().x,source.position().y,tgtBorderW/2),rs.noArrowPlacement=0===intersect.length?!0:!1;var arrowEnd=$$.math.shortenIntersection(intersect,[source.position().x,source.position().y],CanvasRenderer.arrowShapes[tgtArShape].spacing(edge)),edgeEnd=$$.math.shortenIntersection(intersect,[source.position().x,source.position().y],CanvasRenderer.arrowShapes[tgtArShape].gap(edge));rs.endX=edgeEnd[0],rs.endY=edgeEnd[1],rs.arrowEndX=arrowEnd[0],rs.arrowEndY=arrowEnd[1],intersect=CanvasRenderer.nodeShapes[this.getNodeShape(source)].intersectLine(source._private.position.x,source._private.position.y,this.getNodeWidth(source),this.getNodeHeight(source),target.position().x,target.position().y,srcBorderW/2),rs.noArrowPlacement=0===intersect.length?!0:!1;var arrowStart=$$.math.shortenIntersection(intersect,[target.position().x,target.position().y],CanvasRenderer.arrowShapes[srcArShape].spacing(edge)),edgeStart=$$.math.shortenIntersection(intersect,[target.position().x,target.position().y],CanvasRenderer.arrowShapes[srcArShape].gap(edge));rs.startX=edgeStart[0],rs.startY=edgeStart[1],rs.arrowStartX=arrowStart[0],rs.arrowStartY=arrowStart[1],rs.badLine=$$.is.number(rs.startX)&&$$.is.number(rs.startY)&&$$.is.number(rs.endX)&&$$.is.number(rs.endY)?!1:!0}else if("bezier"==rs.edgeType){var cp=[rs.cp2x,rs.cp2y];intersect=CanvasRenderer.nodeShapes[this.getNodeShape(target)].intersectLine(target._private.position.x,target._private.position.y,this.getNodeWidth(target),this.getNodeHeight(target),cp[0],cp[1],tgtBorderW/2);var arrowEnd=$$.math.shortenIntersection(intersect,cp,CanvasRenderer.arrowShapes[tgtArShape].spacing(edge)),edgeEnd=$$.math.shortenIntersection(intersect,cp,CanvasRenderer.arrowShapes[tgtArShape].gap(edge));rs.endX=edgeEnd[0],rs.endY=edgeEnd[1],rs.arrowEndX=arrowEnd[0],rs.arrowEndY=arrowEnd[1],intersect=CanvasRenderer.nodeShapes[this.getNodeShape(source)].intersectLine(source._private.position.x,source._private.position.y,this.getNodeWidth(source),this.getNodeHeight(source),cp[0],cp[1],srcBorderW/2);var arrowStart=$$.math.shortenIntersection(intersect,cp,CanvasRenderer.arrowShapes[srcArShape].spacing(edge)),edgeStart=$$.math.shortenIntersection(intersect,cp,CanvasRenderer.arrowShapes[srcArShape].gap(edge));rs.startX=edgeStart[0],rs.startY=edgeStart[1],rs.arrowStartX=arrowStart[0],rs.arrowStartY=arrowStart[1]}else if(rs.isArcEdge)return},CRp.findEdges=function(nodeSet){for(var edges=this.getCachedEdges(),hashTable={},adjacentEdges=[],i=0;i<nodeSet.length;i++)hashTable[nodeSet[i]._private.data.id]=nodeSet[i];for(var i=0;i<edges.length;i++)(hashTable[edges[i]._private.data.source]||hashTable[edges[i]._private.data.target])&&adjacentEdges.push(edges[i]);return adjacentEdges},CRp.getArrowWidth=CRp.getArrowHeight=function(edgeWidth){var cache=this.arrowWidthCache=this.arrowWidthCache||{},cachedVal=cache[edgeWidth];return cachedVal?cachedVal:(cachedVal=Math.max(Math.pow(13.37*edgeWidth,.9),29),cache[edgeWidth]=cachedVal,cachedVal)}}(cytoscape),function($$){"use strict";var CanvasRenderer=$$("renderer","canvas"),CRp=CanvasRenderer.prototype;CRp.drawEdge=function(context,edge,drawOverlayInstead){var rs=edge._private.rscratch,usePaths=CanvasRenderer.usePaths();if(!rs.badBezier&&("bezier"!==rs.edgeType&&"straight"!==rs.edgeType||!isNaN(rs.startX))){var style=edge._private.style;if(!(style.width.pxValue<=0)){var overlayPadding=style["overlay-padding"].pxValue,overlayOpacity=style["overlay-opacity"].value,overlayColor=style["overlay-color"].value;if(drawOverlayInstead){if(0===overlayOpacity)return;this.strokeStyle(context,overlayColor[0],overlayColor[1],overlayColor[2],overlayOpacity),context.lineCap="round","self"!=edge._private.rscratch.edgeType||usePaths||(context.lineCap="butt")}else{var lineColor=style["line-color"].value;this.strokeStyle(context,lineColor[0],lineColor[1],lineColor[2],style.opacity.value),context.lineCap="butt"}var startNode,endNode,source,target;source=startNode=edge._private.source,target=endNode=edge._private.target;var edgeWidth=style.width.pxValue+(drawOverlayInstead?2*overlayPadding:0),lineStyle=drawOverlayInstead?"solid":style["line-style"].value;context.lineWidth=edgeWidth;var shadowBlur=style["shadow-blur"].pxValue,shadowOpacity=style["shadow-opacity"].value,shadowColor=style["shadow-color"].value,shadowOffsetX=style["shadow-offset-x"].pxValue,shadowOffsetY=style["shadow-offset-y"].pxValue;if(this.shadowStyle(context,shadowColor,drawOverlayInstead?0:shadowOpacity,shadowBlur,shadowOffsetX,shadowOffsetY),"haystack"===rs.edgeType)this.drawStyledEdge(edge,context,rs.haystackPts,lineStyle,edgeWidth);else if("self"===rs.edgeType||"compound"===rs.edgeType){var details=edge._private.rscratch,points=[details.startX,details.startY,details.cp2ax,details.cp2ay,details.selfEdgeMidX,details.selfEdgeMidY,details.selfEdgeMidX,details.selfEdgeMidY,details.cp2cx,details.cp2cy,details.endX,details.endY];this.drawStyledEdge(edge,context,points,lineStyle,edgeWidth)}else if("straight"===rs.edgeType){var nodeDirectionX=endNode._private.position.x-startNode._private.position.x,nodeDirectionY=endNode._private.position.y-startNode._private.position.y,edgeDirectionX=rs.endX-rs.startX,edgeDirectionY=rs.endY-rs.startY;if(0>nodeDirectionX*edgeDirectionX+nodeDirectionY*edgeDirectionY)rs.straightEdgeTooShort=!0;else{var details=rs;this.drawStyledEdge(edge,context,[details.startX,details.startY,details.endX,details.endY],lineStyle,edgeWidth),rs.straightEdgeTooShort=!1}}else{var details=rs;this.drawStyledEdge(edge,context,[details.startX,details.startY,details.cp2x,details.cp2y,details.endX,details.endY],lineStyle,edgeWidth)}"haystack"===rs.edgeType?this.drawArrowheads(context,edge,drawOverlayInstead):rs.noArrowPlacement!==!0&&void 0!==rs.startX&&this.drawArrowheads(context,edge,drawOverlayInstead),this.shadowStyle(context,"transparent",0)}}},CRp.drawStyledEdge=function(edge,context,pts,type,width){var path,rs=edge._private.rscratch,canvasCxt=context,pathCacheHit=!1,usePaths=CanvasRenderer.usePaths();if(usePaths){for(var pathCacheKey=pts,keyLengthMatches=rs.pathCacheKey&&pathCacheKey.length===rs.pathCacheKey.length,keyMatches=keyLengthMatches,i=0;keyMatches&&i<pathCacheKey.length;i++)rs.pathCacheKey[i]!==pathCacheKey[i]&&(keyMatches=!1);keyMatches?(path=context=rs.pathCache,pathCacheHit=!0):(path=context=new Path2D,rs.pathCacheKey=pathCacheKey,rs.pathCache=path)}if(canvasCxt.setLineDash)switch(type){case"dotted":canvasCxt.setLineDash([1,1]);break;case"dashed":canvasCxt.setLineDash([6,3]);break;case"solid":canvasCxt.setLineDash([])}pathCacheHit||(context.beginPath&&context.beginPath(),context.moveTo(pts[0],pts[1]),6!==pts.length||rs.badBezier?12!==pts.length||rs.badBezier?4!==pts.length||rs.badLine||context.lineTo(pts[2],pts[3]):(context.quadraticCurveTo(pts[2],pts[3],pts[4],pts[5]),context.quadraticCurveTo(pts[8],pts[9],pts[10],pts[11])):context.quadraticCurveTo(pts[2],pts[3],pts[4],pts[5])),context=canvasCxt,usePaths?context.stroke(path):context.stroke(),context.setLineDash&&context.setLineDash([])},CRp.drawArrowheads=function(context,edge,drawOverlayInstead){function drawArrowhead(prefix,x,y,dispX,dispY){var arrowShape=style[prefix+"-arrow-shape"].value;if("none"!==arrowShape){var gco=context.globalCompositeOperation,arrowClearFill="hollow"===style[prefix+"-arrow-fill"].value?"both":"filled",arrowFill=style[prefix+"-arrow-fill"].value;"half-triangle-overshot"===arrowShape&&(arrowFill="hollow",arrowClearFill="hollow"),(1!==style.opacity.value||"hollow"===arrowFill)&&(context.globalCompositeOperation="destination-out",self.fillStyle(context,255,255,255,1),self.strokeStyle(context,255,255,255,1),self.drawArrowShape(edge,prefix,context,arrowClearFill,style.width.pxValue,style[prefix+"-arrow-shape"].value,x,y,dispX,dispY),context.globalCompositeOperation=gco);var color=style[prefix+"-arrow-color"].value;self.fillStyle(context,color[0],color[1],color[2],style.opacity.value),self.strokeStyle(context,color[0],color[1],color[2],style.opacity.value),self.drawArrowShape(edge,prefix,context,arrowFill,style.width.pxValue,style[prefix+"-arrow-shape"].value,x,y,dispX,dispY)}}if(!drawOverlayInstead){var dispX,dispY,startX,startY,endX,endY,rs=edge._private.rscratch,self=this,isHaystack="haystack"===rs.edgeType,srcPos=edge.source().position(),tgtPos=edge.target().position();isHaystack?(startX=rs.haystackPts[0],startY=rs.haystackPts[1],endX=rs.haystackPts[2],endY=rs.haystackPts[3]):(startX=rs.arrowStartX,startY=rs.arrowStartY,endX=rs.arrowEndX,endY=rs.arrowEndY);var style=edge._private.style;dispX=startX-srcPos.x,dispY=startY-srcPos.y,isHaystack||isNaN(startX)||isNaN(startY)||isNaN(dispX)||isNaN(dispY)||drawArrowhead("source",startX,startY,dispX,dispY);var midX=rs.midX,midY=rs.midY;isHaystack&&(midX=(startX+endX)/2,midY=(startY+endY)/2),dispX=startX-endX,dispY=startY-endY,"self"===rs.edgeType&&(dispX=1,dispY=-1),isNaN(midX)||isNaN(midY)||drawArrowhead("mid-target",midX,midY,dispX,dispY),dispX*=-1,dispY*=-1,isNaN(midX)||isNaN(midY)||drawArrowhead("mid-source",midX,midY,dispX,dispY),dispX=endX-tgtPos.x,dispY=endY-tgtPos.y,isHaystack||isNaN(endX)||isNaN(endY)||isNaN(dispX)||isNaN(dispY)||drawArrowhead("target",endX,endY,dispX,dispY)}},CRp.drawArrowShape=function(edge,arrowType,context,fill,edgeWidth,shape,x,y,dispX,dispY){var path,usePaths=CanvasRenderer.usePaths(),rs=edge._private.rscratch,pathCacheHit=!1,canvasContext=context,translation={x:x,y:y},angle=Math.asin(dispY/Math.sqrt(dispX*dispX+dispY*dispY));0>dispX?angle+=Math.PI/2:angle=-(Math.PI/2+angle);var size=this.getArrowWidth(edgeWidth),shapeImpl=CanvasRenderer.arrowShapes[shape];if(usePaths){var pathCacheKey=size+"$"+shape+"$"+angle+"$"+x+"$"+y;rs.arrowPathCacheKey=rs.arrowPathCacheKey||{},rs.arrowPathCache=rs.arrowPathCache||{};var alreadyCached=rs.arrowPathCacheKey[arrowType]===pathCacheKey;alreadyCached?(path=context=rs.arrowPathCache[arrowType],pathCacheHit=!0):(path=context=new Path2D,rs.arrowPathCacheKey[arrowType]=pathCacheKey,rs.arrowPathCache[arrowType]=path)}context.beginPath&&context.beginPath(),pathCacheHit||shapeImpl.draw(context,size,angle,translation),!shapeImpl.leavePathOpen&&context.closePath&&context.closePath(),context=canvasContext,("filled"===fill||"both"===fill)&&(usePaths?context.fill(path):context.fill()),("hollow"===fill||"both"===fill)&&(context.lineWidth=shapeImpl.matchEdgeWidth?edgeWidth:1,context.lineJoin="miter",usePaths?context.stroke(path):context.stroke())}}(cytoscape),function($$){"use strict";var CanvasRenderer=$$("renderer","canvas"),CRp=CanvasRenderer.prototype;CRp.getCachedImage=function(url,onLoad){var r=this,imageCache=r.imageCache=r.imageCache||{};if(imageCache[url]&&imageCache[url].image)return imageCache[url].image;var cache=imageCache[url]=imageCache[url]||{},image=cache.image=new Image;return image.addEventListener("load",onLoad),image.src=url,image},CRp.safeDrawImage=function(context,img,ix,iy,iw,ih,x,y,w,h){var r=this;try{context.drawImage(img,ix,iy,iw,ih,x,y,w,h)}catch(e){r.data.canvasNeedsRedraw[CanvasRenderer.NODE]=!0,r.data.canvasNeedsRedraw[CanvasRenderer.DRAG]=!0,r.drawingImage=!0,r.redraw()}},CRp.drawInscribedImage=function(context,img,node){var r=this,nodeX=node._private.position.x,nodeY=node._private.position.y,style=node._private.style,fit=style["background-fit"].value,xPos=style["background-position-x"],yPos=style["background-position-y"],repeat=style["background-repeat"].value,nodeW=node.width(),nodeH=node.height(),rs=node._private.rscratch,clip=style["background-clip"].value,shouldClip="node"===clip,imgOpacity=style["background-image-opacity"].value,w=img.width,h=img.height;if(0!==w&&0!==h){var bgW=style["background-width"];"auto"!==bgW.value&&(w="%"===bgW.units?bgW.value/100*nodeW:bgW.pxValue);var bgH=style["background-height"];if("auto"!==bgH.value&&(h="%"===bgH.units?bgH.value/100*nodeH:bgH.pxValue),0!==w&&0!==h){if("contain"===fit){var scale=Math.min(nodeW/w,nodeH/h);w*=scale,h*=scale}else if("cover"===fit){var scale=Math.max(nodeW/w,nodeH/h);w*=scale,h*=scale}var x=nodeX-nodeW/2;x+="%"===xPos.units?(nodeW-w)*xPos.value/100:xPos.pxValue;var y=nodeY-nodeH/2;y+="%"===yPos.units?(nodeH-h)*yPos.value/100:yPos.pxValue,rs.pathCache&&(x-=nodeX,y-=nodeY,nodeX=0,nodeY=0);var gAlpha=context.globalAlpha;if(context.globalAlpha=imgOpacity,"no-repeat"===repeat)shouldClip&&(context.save(),rs.pathCache?context.clip(rs.pathCache):(CanvasRenderer.nodeShapes[r.getNodeShape(node)].drawPath(context,nodeX,nodeY,nodeW,nodeH),context.clip())),r.safeDrawImage(context,img,0,0,img.width,img.height,x,y,w,h),shouldClip&&context.restore();else{var pattern=context.createPattern(img,repeat);context.fillStyle=pattern,CanvasRenderer.nodeShapes[r.getNodeShape(node)].drawPath(context,nodeX,nodeY,nodeW,nodeH),context.translate(x,y),context.fill(),context.translate(-x,-y)}context.globalAlpha=gAlpha}}}}(cytoscape),function($$){"use strict";function roundRect(ctx,x,y,width,height,radius){var radius=radius||5;ctx.beginPath(),ctx.moveTo(x+radius,y),ctx.lineTo(x+width-radius,y),ctx.quadraticCurveTo(x+width,y,x+width,y+radius),ctx.lineTo(x+width,y+height-radius),ctx.quadraticCurveTo(x+width,y+height,x+width-radius,y+height),ctx.lineTo(x+radius,y+height),ctx.quadraticCurveTo(x,y+height,x,y+height-radius),ctx.lineTo(x,y+radius),ctx.quadraticCurveTo(x,y,x+radius,y),ctx.closePath(),ctx.fill()}var CanvasRenderer=$$("renderer","canvas"),CRp=CanvasRenderer.prototype;CRp.drawEdgeText=function(context,edge){var text=edge._private.style.content.strValue;if(!(!text||text.match(/^\s+$/)||this.hideEdgesOnViewport&&(this.dragData.didDrag||this.pinching||this.hoverData.dragging||this.data.wheel||this.swipePanning))){var computedSize=edge._private.style["font-size"].pxValue*edge.cy().zoom(),minSize=edge._private.style["min-zoomed-font-size"].pxValue;if(!(minSize>computedSize)){context.textAlign="center",context.textBaseline="middle";var rs=edge._private.rscratch;if($$.is.number(rs.labelX)&&$$.is.number(rs.labelY)){var theta,dx,dy,style=edge._private.style,autorotate="autorotate"===style["edge-text-rotation"].strValue;if(autorotate){switch(rs.edgeType){case"haystack":dx=rs.haystackPts[2]-rs.haystackPts[0],dy=rs.haystackPts[3]-rs.haystackPts[1];break;default:dx=rs.endX-rs.startX,dy=rs.endY-rs.startY}theta=Math.atan(dy/dx),context.translate(rs.labelX,rs.labelY),context.rotate(theta),this.drawText(context,edge,0,0),context.rotate(-theta),context.translate(-rs.labelX,-rs.labelY)}else this.drawText(context,edge,rs.labelX,rs.labelY)}}}},CRp.drawNodeText=function(context,node){var text=node._private.style.content.strValue;if(text&&!text.match(/^\s+$/)){var computedSize=node._private.style["font-size"].pxValue*node.cy().zoom(),minSize=node._private.style["min-zoomed-font-size"].pxValue;if(!(minSize>computedSize)){var textHalign=node._private.style["text-halign"].strValue,textValign=node._private.style["text-valign"].strValue,rs=node._private.rscratch;if($$.is.number(rs.labelX)&&$$.is.number(rs.labelY)){switch(textHalign){case"left":context.textAlign="right";break;case"right":context.textAlign="left";break;default:context.textAlign="center"}switch(textValign){case"top":context.textBaseline="bottom";break;case"bottom":context.textBaseline="top";break;default:context.textBaseline="middle"}this.drawText(context,node,rs.labelX,rs.labelY)}}}},CRp.getFontCache=function(context){var cache;this.fontCaches=this.fontCaches||[];for(var i=0;i<this.fontCaches.length;i++)if(cache=this.fontCaches[i],cache.context===context)return cache;return cache={context:context},this.fontCaches.push(cache),cache},CRp.setupTextStyle=function(context,element){var parentOpacity=element.effectiveOpacity(),style=element._private.style,labelStyle=style["font-style"].strValue,labelSize=style["font-size"].pxValue+"px",labelFamily=style["font-family"].strValue,labelWeight=style["font-weight"].strValue,opacity=style["text-opacity"].value*style.opacity.value*parentOpacity,outlineOpacity=style["text-outline-opacity"].value*opacity,color=style.color.value,outlineColor=style["text-outline-color"].value,shadowBlur=style["text-shadow-blur"].pxValue,shadowOpacity=style["text-shadow-opacity"].value,shadowColor=style["text-shadow-color"].value,shadowOffsetX=style["text-shadow-offset-x"].pxValue,shadowOffsetY=style["text-shadow-offset-y"].pxValue,fontCacheKey=element._private.fontKey,cache=this.getFontCache(context);cache.key!==fontCacheKey&&(context.font=labelStyle+" "+labelWeight+" "+labelSize+" "+labelFamily,cache.key=fontCacheKey);var text=this.getLabelText(element);return context.lineJoin="round",this.fillStyle(context,color[0],color[1],color[2],opacity),this.strokeStyle(context,outlineColor[0],outlineColor[1],outlineColor[2],outlineOpacity),this.shadowStyle(context,shadowColor,shadowOpacity,shadowBlur,shadowOffsetX,shadowOffsetY),text},CRp.drawText=function(context,element,textX,textY){var _p=element._private,style=_p.style,rstyle=_p.rstyle,rscratch=_p.rscratch,parentOpacity=element.effectiveOpacity();if(0!==parentOpacity&&0!==style["text-opacity"].value){var text=this.setupTextStyle(context,element),halign=style["text-halign"].value,valign=style["text-valign"].value;if(element.isEdge()&&(halign="center",valign="center"),null!=text&&!isNaN(textX)&&!isNaN(textY)){var backgroundOpacity=style["text-background-opacity"].value,borderOpacity=style["text-border-opacity"].value,textBorderWidth=style["text-border-width"].pxValue;if(backgroundOpacity>0||textBorderWidth>0&&borderOpacity>0){var margin=4+textBorderWidth/2;element.isNode()&&("top"===valign?textY-=margin:"bottom"===valign&&(textY+=margin),"left"===halign?textX-=margin:"right"===halign&&(textX+=margin));var bgWidth=rstyle.labelWidth,bgHeight=rstyle.labelHeight,bgX=textX;halign&&("center"==halign?bgX-=bgWidth/2:"left"==halign&&(bgX-=bgWidth));var bgY=textY;if(element.isNode()?"top"==valign?bgY-=bgHeight:"center"==valign&&(bgY-=bgHeight/2):bgY-=bgHeight/2,"autorotate"===style["edge-text-rotation"].strValue?(textY=0,bgWidth+=4,bgX=textX-bgWidth/2,bgY=textY-bgHeight/2):(bgX-=margin,bgY-=margin,bgHeight+=2*margin,bgWidth+=2*margin),backgroundOpacity>0){var textFill=context.fillStyle,textBackgroundColor=style["text-background-color"].value;context.fillStyle="rgba("+textBackgroundColor[0]+","+textBackgroundColor[1]+","+textBackgroundColor[2]+","+backgroundOpacity*parentOpacity+")";var styleShape=style["text-background-shape"].strValue;"roundrectangle"==styleShape?roundRect(context,bgX,bgY,bgWidth,bgHeight,2):context.fillRect(bgX,bgY,bgWidth,bgHeight),context.fillStyle=textFill}if(textBorderWidth>0&&borderOpacity>0){var textStroke=context.strokeStyle,textLineWidth=context.lineWidth,textBorderColor=style["text-border-color"].value,textBorderStyle=style["text-border-style"].value;if(context.strokeStyle="rgba("+textBorderColor[0]+","+textBorderColor[1]+","+textBorderColor[2]+","+borderOpacity*parentOpacity+")",context.lineWidth=textBorderWidth,context.setLineDash)switch(textBorderStyle){case"dotted":context.setLineDash([1,1]);break;case"dashed":context.setLineDash([4,2]);break;case"double":context.lineWidth=textBorderWidth/4,context.setLineDash([]);break;case"solid":context.setLineDash([])}if(context.strokeRect(bgX,bgY,bgWidth,bgHeight),"double"===textBorderStyle){var whiteWidth=textBorderWidth/2;context.strokeRect(bgX+whiteWidth,bgY+whiteWidth,bgWidth-2*whiteWidth,bgHeight-2*whiteWidth)}context.setLineDash&&context.setLineDash([]),context.lineWidth=textLineWidth,context.strokeStyle=textStroke}}var lineWidth=2*style["text-outline-width"].pxValue;if(lineWidth>0&&(context.lineWidth=lineWidth),"wrap"===style["text-wrap"].value){var lines=rscratch.labelWrapCachedLines,lineHeight=rstyle.labelHeight/lines.length;switch(valign){case"top":textY-=(lines.length-1)*lineHeight;break;case"bottom":break;default:case"center":textY-=(lines.length-1)*lineHeight/2}for(var l=0;l<lines.length;l++)lineWidth>0&&context.strokeText(lines[l],textX,textY),context.fillText(lines[l],textX,textY),textY+=lineHeight}else lineWidth>0&&context.strokeText(text,textX,textY),context.fillText(text,textX,textY);this.shadowStyle(context,"transparent",0)}}}}(cytoscape),function($$){"use strict";var CanvasRenderer=$$("renderer","canvas"),CRp=CanvasRenderer.prototype;CRp.drawNode=function(context,node,drawOverlayInstead){var nodeWidth,nodeHeight,path,r=this,style=node._private.style,rs=node._private.rscratch,_p=node._private,usePaths=CanvasRenderer.usePaths(),canvasContext=context,pathCacheHit=!1,overlayPadding=style["overlay-padding"].pxValue,overlayOpacity=style["overlay-opacity"].value,overlayColor=style["overlay-color"].value;if(!drawOverlayInstead||0!==overlayOpacity){var parentOpacity=node.effectiveOpacity();if(0!==parentOpacity)if(nodeWidth=this.getNodeWidth(node),nodeHeight=this.getNodeHeight(node),context.lineWidth=style["border-width"].pxValue,void 0!==drawOverlayInstead&&drawOverlayInstead)overlayOpacity>0&&(this.fillStyle(context,overlayColor[0],overlayColor[1],overlayColor[2],overlayOpacity),CanvasRenderer.nodeShapes.roundrectangle.drawPath(context,node._private.position.x,node._private.position.y,nodeWidth+2*overlayPadding,nodeHeight+2*overlayPadding),context.fill());else{var image,url=style["background-image"].value[2]||style["background-image"].value[1];if(void 0!==url){image=this.getCachedImage(url,function(){r.data.canvasNeedsRedraw[CanvasRenderer.NODE]=!0,r.data.canvasNeedsRedraw[CanvasRenderer.DRAG]=!0,r.drawingImage=!0,r.redraw()});var prevBging=_p.backgrounding;_p.backgrounding=!image.complete,prevBging!==_p.backgrounding&&node.updateStyle(!1)}var bgColor=style["background-color"].value,borderColor=style["border-color"].value,borderStyle=style["border-style"].value;this.fillStyle(context,bgColor[0],bgColor[1],bgColor[2],style["background-opacity"].value*parentOpacity),this.strokeStyle(context,borderColor[0],borderColor[1],borderColor[2],style["border-opacity"].value*parentOpacity);var shadowBlur=style["shadow-blur"].pxValue,shadowOpacity=style["shadow-opacity"].value,shadowColor=style["shadow-color"].value,shadowOffsetX=style["shadow-offset-x"].pxValue,shadowOffsetY=style["shadow-offset-y"].pxValue;if(this.shadowStyle(context,shadowColor,shadowOpacity,shadowBlur,shadowOffsetX,shadowOffsetY),context.lineJoin="miter",context.setLineDash)switch(borderStyle){case"dotted":context.setLineDash([1,1]);break;case"dashed":context.setLineDash([4,2]);break;case"solid":case"double":context.setLineDash([])}var styleShape=style.shape.strValue,pos=node._private.position;if(usePaths){var pathCacheKey=styleShape+"$"+nodeWidth+"$"+nodeHeight;context.translate(pos.x,pos.y),rs.pathCacheKey===pathCacheKey?(path=context=rs.pathCache,pathCacheHit=!0):(path=context=new Path2D,rs.pathCacheKey=pathCacheKey,rs.pathCache=path)}if(!pathCacheHit){var npos=pos;usePaths&&(npos={x:0,y:0}),CanvasRenderer.nodeShapes[this.getNodeShape(node)].drawPath(context,npos.x,npos.y,nodeWidth,nodeHeight)}context=canvasContext,usePaths?context.fill(path):context.fill(),this.shadowStyle(context,"transparent",0),void 0!==url&&image.complete&&this.drawInscribedImage(context,image,node);var darkness=style["background-blacken"].value,borderWidth=style["border-width"].pxValue;if(this.hasPie(node)&&(this.drawPie(context,node,parentOpacity),(0!==darkness||0!==borderWidth)&&(usePaths||CanvasRenderer.nodeShapes[this.getNodeShape(node)].drawPath(context,pos.x,pos.y,nodeWidth,nodeHeight))),darkness>0?(this.fillStyle(context,0,0,0,darkness),usePaths?context.fill(path):context.fill()):0>darkness&&(this.fillStyle(context,255,255,255,-darkness),usePaths?context.fill(path):context.fill()),borderWidth>0&&(usePaths?context.stroke(path):context.stroke(),"double"===borderStyle)){context.lineWidth=style["border-width"].pxValue/3;var gco=context.globalCompositeOperation;context.globalCompositeOperation="destination-out",usePaths?context.stroke(path):context.stroke(),context.globalCompositeOperation=gco}usePaths&&context.translate(-pos.x,-pos.y),context.setLineDash&&context.setLineDash([])}}},CRp.hasPie=function(node){return node=node[0],node._private.hasPie},CRp.drawPie=function(context,node,nodeOpacity){node=node[0];var _p=node._private,style=_p.style,pieSize=style["pie-size"],nodeW=this.getNodeWidth(node),nodeH=this.getNodeHeight(node),x=_p.position.x,y=_p.position.y,radius=Math.min(nodeW,nodeH)/2,lastPercent=0,usePaths=CanvasRenderer.usePaths();usePaths&&(x=0,y=0),"%"===pieSize.units?radius=radius*pieSize.value/100:void 0!==pieSize.pxValue&&(radius=pieSize.pxValue/2);for(var i=1;i<=$$.style.pieBackgroundN;i++){var size=style["pie-"+i+"-background-size"].value,color=style["pie-"+i+"-background-color"].value,opacity=style["pie-"+i+"-background-opacity"].value*nodeOpacity,percent=size/100,angleStart=1.5*Math.PI+2*Math.PI*lastPercent,angleDelta=2*Math.PI*percent,angleEnd=angleStart+angleDelta;0===size||lastPercent>=1||lastPercent+percent>1||(context.beginPath(),context.moveTo(x,y),context.arc(x,y,radius,angleStart,angleEnd),context.closePath(),this.fillStyle(context,color[0],color[1],color[2],opacity),context.fill(),lastPercent+=percent)}}}(cytoscape),function($$){"use strict";var CanvasRenderer=$$("renderer","canvas"),CR=CanvasRenderer,CRp=CanvasRenderer.prototype;CRp.getPixelRatio=function(){var context=this.data.contexts[0];if(null!=this.forcedPixelRatio)return this.forcedPixelRatio;var backingStore=context.backingStorePixelRatio||context.webkitBackingStorePixelRatio||context.mozBackingStorePixelRatio||context.msBackingStorePixelRatio||context.oBackingStorePixelRatio||context.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/backingStore},CRp.paintCache=function(context){for(var cache,caches=this.paintCaches=this.paintCaches||[],needToCreateCache=!0,i=0;i<caches.length;i++)if(cache=caches[i],cache.context===context){needToCreateCache=!1;break}return needToCreateCache&&(cache={context:context},caches.push(cache)),cache},CRp.fillStyle=function(context,r,g,b,a){context.fillStyle="rgba("+r+","+g+","+b+","+a+")"},CRp.strokeStyle=function(context,r,g,b,a){context.strokeStyle="rgba("+r+","+g+","+b+","+a+")"},CRp.shadowStyle=function(context,color,opacity,blur,offsetX,offsetY){var zoom=this.data.cy.zoom(),cache=this.paintCache(context);(0!==cache.shadowOpacity||0!==opacity)&&(cache.shadowOpacity=opacity,opacity>0?(context.shadowBlur=blur*zoom,context.shadowColor="rgba("+color[0]+","+color[1]+","+color[2]+","+opacity+")",context.shadowOffsetX=offsetX*zoom,context.shadowOffsetY=offsetY*zoom):(context.shadowBlur=0,context.shadowColor="transparent"))},CRp.matchCanvasSize=function(container){var data=this.data,width=container.clientWidth,height=container.clientHeight,pixelRatio=this.getPixelRatio(),mbPxRatio=this.motionBlurPxRatio;(container===this.data.bufferCanvases[CR.MOTIONBLUR_BUFFER_NODE]||container===this.data.bufferCanvases[CR.MOTIONBLUR_BUFFER_DRAG])&&(pixelRatio=mbPxRatio);var canvas,canvasWidth=width*pixelRatio,canvasHeight=height*pixelRatio;if(canvasWidth!==this.canvasWidth||canvasHeight!==this.canvasHeight){this.fontCaches=null;var canvasContainer=data.canvasContainer;canvasContainer.style.width=width+"px",canvasContainer.style.height=height+"px";for(var i=0;i<CanvasRenderer.CANVAS_LAYERS;i++)canvas=data.canvases[i],(canvas.width!==canvasWidth||canvas.height!==canvasHeight)&&(canvas.width=canvasWidth,canvas.height=canvasHeight,canvas.style.width=width+"px",canvas.style.height=height+"px");for(var i=0;i<CanvasRenderer.BUFFER_COUNT;i++)canvas=data.bufferCanvases[i],(canvas.width!==canvasWidth||canvas.height!==canvasHeight)&&(canvas.width=canvasWidth,canvas.height=canvasHeight,canvas.style.width=width+"px",canvas.style.height=height+"px");this.textureMult=1,1>=pixelRatio&&(canvas=data.bufferCanvases[CanvasRenderer.TEXTURE_BUFFER],this.textureMult=2,canvas.width=canvasWidth*this.textureMult,canvas.height=canvasHeight*this.textureMult),this.canvasWidth=canvasWidth,this.canvasHeight=canvasHeight}},CRp.renderTo=function(cxt,zoom,pan,pxRatio){this.redraw({forcedContext:cxt,forcedZoom:zoom,forcedPan:pan,drawAllLayers:!0,forcedPxRatio:pxRatio})},CRp.timeToRender=function(){return this.redrawTotalTime/this.redrawCount},CanvasRenderer.minRedrawLimit=1e3/60,CanvasRenderer.maxRedrawLimit=1e3,CanvasRenderer.motionBlurDelay=100,CRp.redraw=function(options){function drawToContext(){function mbclear(context,x,y,w,h){var gco=context.globalCompositeOperation;context.globalCompositeOperation="destination-out",r.fillStyle(context,255,255,255,r.motionBlurTransparency),context.fillRect(x,y,w,h),context.globalCompositeOperation=gco}function setContextTransform(context,clear){var ePan,eZoom,w,h;r.clearingMotionBlur||context!==data.bufferContexts[CR.MOTIONBLUR_BUFFER_NODE]&&context!==data.bufferContexts[CR.MOTIONBLUR_BUFFER_DRAG]?(ePan=effectivePan,eZoom=effectiveZoom,w=r.canvasWidth,h=r.canvasHeight):(ePan={x:pan.x*mbPxRatio,y:pan.y*mbPxRatio},eZoom=zoom*mbPxRatio,w=r.canvasWidth*mbPxRatio,h=r.canvasHeight*mbPxRatio),context.setTransform(1,0,0,1,0,0),"motionBlur"===clear?mbclear(context,0,0,w,h):forcedContext||void 0!==clear&&!clear||context.clearRect(0,0,w,h),drawAllLayers||(context.translate(ePan.x,ePan.y),context.scale(eZoom,eZoom)),forcedPan&&context.translate(forcedPan.x,forcedPan.y),forcedZoom&&context.scale(forcedZoom,forcedZoom)}function drawElements(list,context){for(var eles=list.eles,i=0;i<eles.length;i++){var ele=eles[i];ele.isNode()?(r.drawNode(context,ele),hideLabels||r.drawNodeText(context,ele),r.drawNode(context,ele,!0)):hideEdges||(r.drawEdge(context,ele),hideLabels||r.drawEdgeText(context,ele),r.drawEdge(context,ele,!0))}}r.textureDrawLastFrame&&!textureDraw&&(needDraw[CR.NODE]=!0,needDraw[CR.SELECT_BOX]=!0);var edges=r.getCachedEdges(),coreStyle=cy.style()._private.coreStyle,zoom=cy.zoom(),effectiveZoom=void 0!==forcedZoom?forcedZoom:zoom,pan=cy.pan(),effectivePan={x:pan.x,y:pan.y},vp={zoom:zoom,pan:{x:pan.x,y:pan.y}},prevVp=r.prevViewport,viewportIsDiff=void 0===prevVp||vp.zoom!==prevVp.zoom||vp.pan.x!==prevVp.pan.x||vp.pan.y!==prevVp.pan.y;viewportIsDiff||inNodeDragGesture&&!hasCompoundNodes||(r.motionBlurPxRatio=1),forcedPan&&(effectivePan=forcedPan),effectiveZoom*=pixelRatio,effectivePan.x*=pixelRatio,effectivePan.y*=pixelRatio;var eles={drag:{nodes:[],edges:[],eles:[]},nondrag:{nodes:[],edges:[],eles:[]}};if(textureDraw||(r.textureDrawLastFrame=!1),textureDraw){r.textureDrawLastFrame=!0;var bb;if(!r.textureCache){r.textureCache={},bb=r.textureCache.bb=cy.elements().boundingBox(),r.textureCache.texture=r.data.bufferCanvases[CanvasRenderer.TEXTURE_BUFFER];var cxt=r.data.bufferContexts[CanvasRenderer.TEXTURE_BUFFER];cxt.setTransform(1,0,0,1,0,0),cxt.clearRect(0,0,r.canvasWidth*r.textureMult,r.canvasHeight*r.textureMult),r.redraw({forcedContext:cxt,drawOnlyNodeLayer:!0,forcedPxRatio:pixelRatio*r.textureMult});var vp=r.textureCache.viewport={zoom:cy.zoom(),pan:cy.pan(),width:r.canvasWidth,height:r.canvasHeight};vp.mpan={x:(0-vp.pan.x)/vp.zoom,y:(0-vp.pan.y)/vp.zoom}}needDraw[CR.DRAG]=!1,needDraw[CR.NODE]=!1;var context=data.contexts[CR.NODE],texture=r.textureCache.texture,vp=r.textureCache.viewport;bb=r.textureCache.bb,context.setTransform(1,0,0,1,0,0),motionBlur?mbclear(context,0,0,vp.width,vp.height):context.clearRect(0,0,vp.width,vp.height);var outsideBgColor=coreStyle["outside-texture-bg-color"].value,outsideBgOpacity=coreStyle["outside-texture-bg-opacity"].value;

r.fillStyle(context,outsideBgColor[0],outsideBgColor[1],outsideBgColor[2],outsideBgOpacity),context.fillRect(0,0,vp.width,vp.height);var zoom=cy.zoom();setContextTransform(context,!1),context.clearRect(vp.mpan.x,vp.mpan.y,vp.width/vp.zoom/pixelRatio,vp.height/vp.zoom/pixelRatio),context.drawImage(texture,vp.mpan.x,vp.mpan.y,vp.width/vp.zoom/pixelRatio,vp.height/vp.zoom/pixelRatio)}else r.textureOnViewport&&!forcedContext&&(r.textureCache=null);var vpManip=r.pinching||r.hoverData.dragging||r.swipePanning||r.data.wheelZooming||r.hoverData.draggingEles,hideEdges=r.hideEdgesOnViewport&&vpManip,hideLabels=r.hideLabelsOnViewport&&vpManip;if(needDraw[CR.DRAG]||needDraw[CR.NODE]||drawAllLayers||drawOnlyNodeLayer){hideEdges||r.findEdgeControlPoints(edges);for(var zEles=r.getCachedZSortedEles(),extent=cy.extent(),i=0;i<zEles.length;i++){var list,ele=zEles[i],bb=forcedContext?null:ele.boundingBox(),insideExtent=forcedContext?!0:$$.math.boundingBoxesIntersect(extent,bb);insideExtent&&(list=ele._private.rscratch.inDragLayer?eles.drag:eles.nondrag,list.eles.push(ele))}}var needMbClear=[];if(needMbClear[CR.NODE]=!needDraw[CR.NODE]&&motionBlur&&!r.clearedForMotionBlur[CR.NODE]||r.clearingMotionBlur,needMbClear[CR.NODE]&&(r.clearedForMotionBlur[CR.NODE]=!0),needMbClear[CR.DRAG]=!needDraw[CR.DRAG]&&motionBlur&&!r.clearedForMotionBlur[CR.DRAG]||r.clearingMotionBlur,needMbClear[CR.DRAG]&&(r.clearedForMotionBlur[CR.DRAG]=!0),needDraw[CR.NODE]||drawAllLayers||drawOnlyNodeLayer||needMbClear[CR.NODE]){var useBuffer=motionBlur&&!needMbClear[CR.NODE]&&1!==mbPxRatio,context=forcedContext||(useBuffer?r.data.bufferContexts[CR.MOTIONBLUR_BUFFER_NODE]:data.contexts[CR.NODE]),clear=motionBlur&&!useBuffer?"motionBlur":void 0;setContextTransform(context,clear),drawElements(eles.nondrag,context),drawAllLayers||motionBlur||(needDraw[CR.NODE]=!1)}if(!drawOnlyNodeLayer&&(needDraw[CR.DRAG]||drawAllLayers||needMbClear[CR.DRAG])){var useBuffer=motionBlur&&!needMbClear[CR.DRAG]&&1!==mbPxRatio,context=forcedContext||(useBuffer?r.data.bufferContexts[CR.MOTIONBLUR_BUFFER_DRAG]:data.contexts[CR.DRAG]);setContextTransform(context,motionBlur&&!useBuffer?"motionBlur":void 0),drawElements(eles.drag,context),drawAllLayers||motionBlur||(needDraw[CR.DRAG]=!1)}if(r.showFps||!drawOnlyNodeLayer&&needDraw[CR.SELECT_BOX]&&!drawAllLayers){var context=forcedContext||data.contexts[CR.SELECT_BOX];if(setContextTransform(context),1==data.select[4]&&(r.hoverData.selecting||r.touchData.selecting)){var zoom=data.cy.zoom(),borderWidth=coreStyle["selection-box-border-width"].value/zoom;context.lineWidth=borderWidth,context.fillStyle="rgba("+coreStyle["selection-box-color"].value[0]+","+coreStyle["selection-box-color"].value[1]+","+coreStyle["selection-box-color"].value[2]+","+coreStyle["selection-box-opacity"].value+")",context.fillRect(data.select[0],data.select[1],data.select[2]-data.select[0],data.select[3]-data.select[1]),borderWidth>0&&(context.strokeStyle="rgba("+coreStyle["selection-box-border-color"].value[0]+","+coreStyle["selection-box-border-color"].value[1]+","+coreStyle["selection-box-border-color"].value[2]+","+coreStyle["selection-box-opacity"].value+")",context.strokeRect(data.select[0],data.select[1],data.select[2]-data.select[0],data.select[3]-data.select[1]))}if(data.bgActivePosistion&&!r.hoverData.selecting){var zoom=data.cy.zoom(),pos=data.bgActivePosistion;context.fillStyle="rgba("+coreStyle["active-bg-color"].value[0]+","+coreStyle["active-bg-color"].value[1]+","+coreStyle["active-bg-color"].value[2]+","+coreStyle["active-bg-opacity"].value+")",context.beginPath(),context.arc(pos.x,pos.y,coreStyle["active-bg-size"].pxValue/zoom,0,2*Math.PI),context.fill()}var timeToRender=r.averageRedrawTime;if(r.showFps&&timeToRender){timeToRender=Math.round(timeToRender);var fps=Math.round(1e3/timeToRender);context.setTransform(1,0,0,1,0,0),context.fillStyle="rgba(255, 0, 0, 0.75)",context.strokeStyle="rgba(255, 0, 0, 0.75)",context.lineWidth=1,context.fillText("1 frame = "+timeToRender+" ms = "+fps+" fps",0,20);var maxFps=60;context.strokeRect(0,30,250,20),context.fillRect(0,30,250*Math.min(fps/maxFps,1),20)}drawAllLayers||(needDraw[CR.SELECT_BOX]=!1)}if(motionBlur&&1!==mbPxRatio){var cxtNode=data.contexts[CR.NODE],txtNode=r.data.bufferCanvases[CR.MOTIONBLUR_BUFFER_NODE],cxtDrag=data.contexts[CR.DRAG],txtDrag=r.data.bufferCanvases[CR.MOTIONBLUR_BUFFER_DRAG],drawMotionBlur=function(cxt,txt,needClear){cxt.setTransform(1,0,0,1,0,0),needClear||!motionBlurFadeEffect?cxt.clearRect(0,0,r.canvasWidth,r.canvasHeight):mbclear(cxt,0,0,r.canvasWidth,r.canvasHeight);var pxr=mbPxRatio;cxt.drawImage(txt,0,0,r.canvasWidth*pxr,r.canvasHeight*pxr,0,0,r.canvasWidth,r.canvasHeight)};(needDraw[CR.NODE]||needMbClear[CR.NODE])&&(drawMotionBlur(cxtNode,txtNode,needMbClear[CR.NODE]),needDraw[CR.NODE]=!1),(needDraw[CR.DRAG]||needMbClear[CR.DRAG])&&(drawMotionBlur(cxtDrag,txtDrag,needMbClear[CR.DRAG]),needDraw[CR.DRAG]=!1)}var endTime=Date.now();void 0===r.averageRedrawTime&&(r.averageRedrawTime=endTime-startTime),void 0===r.redrawCount&&(r.redrawCount=0),r.redrawCount++,void 0===r.redrawTotalTime&&(r.redrawTotalTime=0),r.redrawTotalTime+=endTime-startTime,r.lastRedrawTime=endTime-startTime,r.averageRedrawTime=r.averageRedrawTime/2+(endTime-startTime)/2,r.currentlyDrawing=!1,r.prevViewport=vp,r.clearingMotionBlur&&(r.clearingMotionBlur=!1,r.motionBlurCleared=!0,r.motionBlur=!0),motionBlur&&(r.motionBlurTimeout=setTimeout(function(){r.motionBlurTimeout=null,r.clearedForMotionBlur[CR.NODE]=!1,r.clearedForMotionBlur[CR.DRAG]=!1,r.motionBlur=!1,r.clearingMotionBlur=!textureDraw,r.mbFrames=0,needDraw[CR.NODE]=!0,needDraw[CR.DRAG]=!0,r.redraw()},CanvasRenderer.motionBlurDelay)),r.drawingImage=!1}options=options||{};var forcedContext=options.forcedContext,drawAllLayers=options.drawAllLayers,drawOnlyNodeLayer=options.drawOnlyNodeLayer,forcedZoom=options.forcedZoom,forcedPan=options.forcedPan,r=this,pixelRatio=void 0===options.forcedPxRatio?this.getPixelRatio():options.forcedPxRatio,cy=r.data.cy,data=r.data,needDraw=data.canvasNeedsRedraw,textureDraw=r.textureOnViewport&&!forcedContext&&(r.pinching||r.hoverData.dragging||r.swipePanning||r.data.wheelZooming),motionBlur=void 0!==options.motionBlur?options.motionBlur:r.motionBlur,mbPxRatio=r.motionBlurPxRatio,hasCompoundNodes=cy.hasCompoundNodes(),inNodeDragGesture=r.hoverData.draggingEles,inBoxSelection=r.hoverData.selecting||r.touchData.selecting?!0:!1;motionBlur=motionBlur&&!forcedContext&&r.motionBlurEnabled&&!inBoxSelection;var motionBlurFadeEffect=motionBlur;!forcedContext&&r.motionBlurTimeout&&clearTimeout(r.motionBlurTimeout),!forcedContext&&this.redrawTimeout&&clearTimeout(this.redrawTimeout),this.redrawTimeout=null,void 0===this.averageRedrawTime&&(this.averageRedrawTime=0);var minRedrawLimit=CanvasRenderer.minRedrawLimit,maxRedrawLimit=CanvasRenderer.maxRedrawLimit,redrawLimit=this.averageRedrawTime;redrawLimit=minRedrawLimit>redrawLimit?minRedrawLimit:redrawLimit,redrawLimit=maxRedrawLimit>redrawLimit?redrawLimit:maxRedrawLimit,void 0===this.lastDrawTime&&(this.lastDrawTime=0);var nowTime=Date.now(),timeElapsed=nowTime-this.lastDrawTime,callAfterLimit=timeElapsed>=redrawLimit;if(!forcedContext&&!r.clearingMotionBlur){if(!callAfterLimit||this.currentlyDrawing)return void(this.redrawTimeout=setTimeout(function(){r.redraw()},redrawLimit));this.lastDrawTime=nowTime,this.currentlyDrawing=!0}motionBlur&&(null==r.mbFrames&&(r.mbFrames=0),r.drawingImage||r.mbFrames++,r.mbFrames<3&&(motionBlurFadeEffect=!1),r.mbFrames>r.minMbLowQualFrames&&(r.motionBlurPxRatio=r.mbPxRBlurry)),r.clearingMotionBlur&&(r.motionBlurPxRatio=1);var startTime=Date.now();forcedContext?drawToContext():$$.util.requestAnimationFrame(drawToContext),forcedContext||r.initrender||(r.initrender=!0,cy.trigger("initrender")),forcedContext||cy.triggerOnRender()}}(cytoscape),function($$){"use strict";var CanvasRenderer=$$("renderer","canvas"),CRp=CanvasRenderer.prototype;CRp.drawPolygonPath=function(context,x,y,width,height,points){var halfW=width/2,halfH=height/2;context.beginPath&&context.beginPath(),context.moveTo(x+halfW*points[0],y+halfH*points[1]);for(var i=1;i<points.length/2;i++)context.lineTo(x+halfW*points[2*i],y+halfH*points[2*i+1]);context.closePath()},CRp.drawPolygon=function(context,x,y,width,height,points){this.drawPolygonPath(context,x,y,width,height,points),context.fill()},CRp.drawRoundRectanglePath=function(context,x,y,width,height,radius){var halfWidth=width/2,halfHeight=height/2,cornerRadius=$$.math.getRoundRectangleRadius(width,height);context.beginPath&&context.beginPath(),context.moveTo(x,y-halfHeight),context.arcTo(x+halfWidth,y-halfHeight,x+halfWidth,y,cornerRadius),context.arcTo(x+halfWidth,y+halfHeight,x,y+halfHeight,cornerRadius),context.arcTo(x-halfWidth,y+halfHeight,x-halfWidth,y,cornerRadius),context.arcTo(x-halfWidth,y-halfHeight,x,y-halfHeight,cornerRadius),context.lineTo(x,y-halfHeight),context.closePath()},CRp.drawRoundRectangle=function(context,x,y,width,height,radius){this.drawRoundRectanglePath(context,x,y,width,height,radius),context.fill()}}(cytoscape),function($$){"use strict";var CanvasRenderer=$$("renderer","canvas"),CRp=CanvasRenderer.prototype;CRp.createBuffer=function(w,h){var buffer=document.createElement("canvas");return buffer.width=w,buffer.height=h,[buffer,buffer.getContext("2d")]},CRp.bufferCanvasImage=function(options){var data=this.data,cy=data.cy,bb=cy.elements().boundingBox(),width=options.full?Math.ceil(bb.w):this.data.container.clientWidth,height=options.full?Math.ceil(bb.h):this.data.container.clientHeight,scale=1;if(void 0!==options.scale)width*=options.scale,height*=options.scale,scale=options.scale;else if($$.is.number(options.maxWidth)||$$.is.number(options.maxHeight)){var maxScaleW=1/0,maxScaleH=1/0;$$.is.number(options.maxWidth)&&(maxScaleW=scale*options.maxWidth/width),$$.is.number(options.maxHeight)&&(maxScaleH=scale*options.maxHeight/height),scale=Math.min(maxScaleW,maxScaleH),width*=scale,height*=scale}var buffCanvas=document.createElement("canvas");buffCanvas.width=width,buffCanvas.height=height,buffCanvas.style.width=width+"px",buffCanvas.style.height=height+"px";var buffCxt=buffCanvas.getContext("2d");if(width>0&&height>0)if(buffCxt.clearRect(0,0,width,height),options.bg&&(buffCxt.fillStyle=options.bg,buffCxt.rect(0,0,width,height),buffCxt.fill()),buffCxt.globalCompositeOperation="source-over",options.full)this.redraw({forcedContext:buffCxt,drawAllLayers:!0,forcedZoom:scale,forcedPan:{x:-bb.x1*scale,y:-bb.y1*scale},forcedPxRatio:1});else{var cyPan=cy.pan(),pan={x:cyPan.x*scale,y:cyPan.y*scale},zoom=cy.zoom()*scale;this.redraw({forcedContext:buffCxt,drawAllLayers:!0,forcedZoom:zoom,forcedPan:pan,forcedPxRatio:1})}return buffCanvas},CRp.png=function(options){return this.bufferCanvasImage(options).toDataURL("image/png")},CRp.jpg=function(options){return this.bufferCanvasImage(options).toDataURL("image/jpeg")}}(cytoscape),function($$){"use strict";var CanvasRenderer=$$("renderer","canvas"),CR=CanvasRenderer,CRp=CR.prototype;CRp.registerBinding=function(target,event,handler,useCapture){this.bindings.push({target:target,event:event,handler:handler,useCapture:useCapture}),target.addEventListener(event,handler,useCapture)},CRp.nodeIsDraggable=function(node){return 0!==node._private.style.opacity.value&&"visible"==node._private.style.visibility.value&&"element"==node._private.style.display.value&&!node.locked()&&node.grabbable()?!0:!1},CRp.load=function(){var r=this,getDragListIds=function(opts){var listHasId;if(opts.addToList&&r.data.cy.hasCompoundNodes()){if(!opts.addToList.hasId){opts.addToList.hasId={};for(var i=0;i<opts.addToList.length;i++){var ele=opts.addToList[i];opts.addToList.hasId[ele.id()]=!0}}listHasId=opts.addToList.hasId}return listHasId||{}},addDescendantsToDrag=function(node,opts){if(node._private.cy.hasCompoundNodes()&&(null!=opts.inDragLayer||null!=opts.addToList))for(var listHasId=getDragListIds(opts),innerNodes=node.descendants(),i=0;i<innerNodes.size();i++){var iNode=innerNodes[i],_p=iNode._private;opts.inDragLayer&&(_p.rscratch.inDragLayer=!0),opts.addToList&&!listHasId[iNode.id()]&&(opts.addToList.push(iNode),listHasId[iNode.id()]=!0,_p.grabbed=!0);for(var edges=_p.edges,j=0;opts.inDragLayer&&j<edges.length;j++)edges[j]._private.rscratch.inDragLayer=!0}},addNodeToDrag=function(node,opts){var _p=node._private,listHasId=getDragListIds(opts);opts.inDragLayer&&(_p.rscratch.inDragLayer=!0),opts.addToList&&!listHasId[node.id()]&&(opts.addToList.push(node),listHasId[node.id()]=!0,_p.grabbed=!0);for(var edges=_p.edges,i=0;opts.inDragLayer&&i<edges.length;i++)edges[i]._private.rscratch.inDragLayer=!0;addDescendantsToDrag(node,opts),updateAncestorsInDragLayer(node,{inDragLayer:opts.inDragLayer})},freeDraggedElements=function(draggedElements){if(draggedElements)for(var i=0;i<draggedElements.length;i++){var dEi_p=draggedElements[i]._private;if("nodes"===dEi_p.group){dEi_p.rscratch.inDragLayer=!1,dEi_p.grabbed=!1;for(var sEdges=dEi_p.edges,j=0;j<sEdges.length;j++)sEdges[j]._private.rscratch.inDragLayer=!1;updateAncestorsInDragLayer(draggedElements[i],{inDragLayer:!1})}else"edges"===dEi_p.group&&(dEi_p.rscratch.inDragLayer=!1)}},updateAncestorsInDragLayer=function(node,opts){if(null!=opts.inDragLayer||null!=opts.addToList){var parent=node;if(node._private.cy.hasCompoundNodes()){for(;parent.parent().nonempty();)parent=parent.parent()[0];if(parent!=node){for(var nodes=parent.descendants().merge(parent).unmerge(node).unmerge(node.descendants()),edges=nodes.connectedEdges(),listHasId=getDragListIds(opts),i=0;i<nodes.size();i++)void 0!==opts.inDragLayer&&(nodes[i]._private.rscratch.inDragLayer=opts.inDragLayer),opts.addToList&&!listHasId[nodes[i].id()]&&(opts.addToList.push(nodes[i]),listHasId[nodes[i].id()]=!0,nodes[i]._private.grabbed=!0);for(var j=0;void 0!==opts.inDragLayer&&j<edges.length;j++)edges[j]._private.rscratch.inDragLayer=opts.inDragLayer}}}};"undefined"!=typeof MutationObserver?(r.removeObserver=new MutationObserver(function(mutns){for(var i=0;i<mutns.length;i++){var mutn=mutns[i],rNodes=mutn.removedNodes;if(rNodes)for(var j=0;j<rNodes.length;j++){var rNode=rNodes[j];if(rNode===r.data.container){r.destroy();break}}}}),r.removeObserver.observe(r.data.container.parentNode,{childList:!0})):r.registerBinding(r.data.container,"DOMNodeRemoved",function(e){r.destroy()}),r.registerBinding(window,"resize",$$.util.debounce(function(e){r.invalidateContainerClientCoordsCache(),r.matchCanvasSize(r.data.container),r.data.canvasNeedsRedraw[CR.NODE]=!0,r.redraw()},100));for(var invalCtnrBBOnScroll=function(domEle){r.registerBinding(domEle,"scroll",function(e){r.invalidateContainerClientCoordsCache()})},bbCtnr=r.data.cy.container();invalCtnrBBOnScroll(bbCtnr),bbCtnr.parentNode;)bbCtnr=bbCtnr.parentNode;r.registerBinding(r.data.container,"contextmenu",function(e){e.preventDefault()});var inBoxSelection=function(){return 0!==r.data.select[4]};r.registerBinding(r.data.container,"mousedown",function(e){e.preventDefault(),r.hoverData.capture=!0,r.hoverData.which=e.which;var cy=r.data.cy,pos=r.projectIntoViewport(e.clientX,e.clientY),select=r.data.select,near=r.findNearestElement(pos[0],pos[1],!0,!1),draggedElements=r.dragData.possibleDragElements;r.hoverData.mdownPos=pos;var needsRedraw=r.data.canvasNeedsRedraw,checkForTaphold=function(){r.hoverData.tapholdCancelled=!1,clearTimeout(r.hoverData.tapholdTimeout),r.hoverData.tapholdTimeout=setTimeout(function(){if(!r.hoverData.tapholdCancelled){var ele=r.hoverData.down;ele?ele.trigger(new $$.Event(e,{type:"taphold",cyPosition:{x:pos[0],y:pos[1]}})):cy.trigger(new $$.Event(e,{type:"taphold",cyPosition:{x:pos[0],y:pos[1]}}))}},r.tapholdDuration)};if(3==e.which){r.hoverData.cxtStarted=!0;var cxtEvt=new $$.Event(e,{type:"cxttapstart",cyPosition:{x:pos[0],y:pos[1]}});near?(near.activate(),near.trigger(cxtEvt),r.hoverData.down=near):cy.trigger(cxtEvt),r.hoverData.downTime=(new Date).getTime(),r.hoverData.cxtDragged=!1}else if(1==e.which){if(near&&near.activate(),null!=near){if(r.nodeIsDraggable(near)){var grabEvent=new $$.Event(e,{type:"grab",cyPosition:{x:pos[0],y:pos[1]}});if(near.isNode()&&!near.selected())draggedElements=r.dragData.possibleDragElements=[],addNodeToDrag(near,{addToList:draggedElements}),near.trigger(grabEvent);else if(near.isNode()&&near.selected()){draggedElements=r.dragData.possibleDragElements=[];for(var selectedNodes=cy.$(function(){return this.isNode()&&this.selected()}),i=0;i<selectedNodes.length;i++)r.nodeIsDraggable(selectedNodes[i])&&addNodeToDrag(selectedNodes[i],{addToList:draggedElements});near.trigger(grabEvent)}needsRedraw[CR.NODE]=!0,needsRedraw[CR.DRAG]=!0}near.trigger(new $$.Event(e,{type:"mousedown",cyPosition:{x:pos[0],y:pos[1]}})).trigger(new $$.Event(e,{type:"tapstart",cyPosition:{x:pos[0],y:pos[1]}})).trigger(new $$.Event(e,{type:"vmousedown",cyPosition:{x:pos[0],y:pos[1]}}))}else null==near&&cy.trigger(new $$.Event(e,{type:"mousedown",cyPosition:{x:pos[0],y:pos[1]}})).trigger(new $$.Event(e,{type:"tapstart",cyPosition:{x:pos[0],y:pos[1]}})).trigger(new $$.Event(e,{type:"vmousedown",cyPosition:{x:pos[0],y:pos[1]}}));if(r.hoverData.down=near,r.hoverData.downTime=(new Date).getTime(),null==near||near.isEdge()){select[4]=1;var timeUntilActive=Math.max(0,CR.panOrBoxSelectDelay-(+new Date-r.hoverData.downTime));clearTimeout(r.bgActiveTimeout),cy.boxSelectionEnabled()||near&&near.isEdge()?r.bgActiveTimeout=setTimeout(function(){near&&near.unactivate(),r.data.bgActivePosistion={x:pos[0],y:pos[1]},r.hoverData.dragging=!0,needsRedraw[CR.SELECT_BOX]=!0,r.redraw()},timeUntilActive):(r.data.bgActivePosistion={x:pos[0],y:pos[1]},needsRedraw[CR.SELECT_BOX]=!0,r.redraw())}checkForTaphold()}select[0]=select[2]=pos[0],select[1]=select[3]=pos[1]},!1),r.registerBinding(window,"mousemove",$$.util.throttle(function(e){var preventDefault=!1,capture=r.hoverData.capture;if(!capture){var containerPageCoords=r.findContainerClientCoords();if(!(e.clientX>containerPageCoords[0]&&e.clientX<containerPageCoords[0]+r.canvasWidth&&e.clientY>containerPageCoords[1]&&e.clientY<containerPageCoords[1]+r.canvasHeight))return;for(var cyContainer=r.data.container,target=e.target,tParent=target.parentNode,containerIsTarget=!1;tParent;){if(tParent===cyContainer){containerIsTarget=!0;break}tParent=tParent.parentNode}if(!containerIsTarget)return}var cy=r.data.cy,zoom=cy.zoom(),pos=r.projectIntoViewport(e.clientX,e.clientY),select=r.data.select,needsRedraw=r.data.canvasNeedsRedraw,near=null;r.hoverData.draggingEles||(near=r.findNearestElement(pos[0],pos[1],!0,!1));var last=r.hoverData.last,down=r.hoverData.down,disp=[pos[0]-select[2],pos[1]-select[3]],draggedElements=r.dragData.possibleDragElements,dx=select[2]-select[0],dx2=dx*dx,dy=select[3]-select[1],dy2=dy*dy,dist2=dx2+dy2,rdist2=dist2*zoom*zoom;r.hoverData.tapholdCancelled=!0;var updateDragDelta=function(){var dragDelta=r.hoverData.dragDelta=r.hoverData.dragDelta||[];0===dragDelta.length?(dragDelta.push(disp[0]),dragDelta.push(disp[1])):(dragDelta[0]+=disp[0],dragDelta[1]+=disp[1])};if(preventDefault=!0,null!=near?near.trigger(new $$.Event(e,{type:"mousemove",cyPosition:{x:pos[0],y:pos[1]}})).trigger(new $$.Event(e,{type:"vmousemove",cyPosition:{x:pos[0],y:pos[1]}})).trigger(new $$.Event(e,{type:"tapdrag",cyPosition:{x:pos[0],y:pos[1]}})):null==near&&cy.trigger(new $$.Event(e,{type:"mousemove",cyPosition:{x:pos[0],y:pos[1]}})).trigger(new $$.Event(e,{type:"vmousemove",cyPosition:{x:pos[0],y:pos[1]}})).trigger(new $$.Event(e,{type:"tapdrag",cyPosition:{x:pos[0],y:pos[1]}})),3===r.hoverData.which){var cxtEvt=new $$.Event(e,{type:"cxtdrag",cyPosition:{x:pos[0],y:pos[1]}});down?down.trigger(cxtEvt):cy.trigger(cxtEvt),r.hoverData.cxtDragged=!0,r.hoverData.cxtOver&&near===r.hoverData.cxtOver||(r.hoverData.cxtOver&&r.hoverData.cxtOver.trigger(new $$.Event(e,{type:"cxtdragout",cyPosition:{x:pos[0],y:pos[1]}})),r.hoverData.cxtOver=near,near&&near.trigger(new $$.Event(e,{type:"cxtdragover",cyPosition:{x:pos[0],y:pos[1]}})))}else if(r.hoverData.dragging){if(preventDefault=!0,cy.panningEnabled()&&cy.userPanningEnabled()){var deltaP;if(r.hoverData.justStartedPan){var mdPos=r.hoverData.mdownPos;deltaP={x:(pos[0]-mdPos[0])*zoom,y:(pos[1]-mdPos[1])*zoom},r.hoverData.justStartedPan=!1}else deltaP={x:disp[0]*zoom,y:disp[1]*zoom};cy.panBy(deltaP),r.hoverData.dragged=!0}pos=r.projectIntoViewport(e.clientX,e.clientY)}else if(1==select[4]&&(null==down||down.isEdge())&&(!cy.boxSelectionEnabled()||+new Date-r.hoverData.downTime>=CR.panOrBoxSelectDelay)&&!r.hoverData.selecting&&rdist2>=r.desktopTapThreshold2&&cy.panningEnabled()&&cy.userPanningEnabled())r.hoverData.dragging=!0,r.hoverData.selecting=!1,r.hoverData.justStartedPan=!0,select[4]=0;else{if(cy.boxSelectionEnabled()&&!r.hoverData.dragging&&Math.pow(select[2]-select[0],2)+Math.pow(select[3]-select[1],2)>7&&select[4]&&(clearTimeout(r.bgActiveTimeout),r.data.bgActivePosistion=void 0,r.hoverData.selecting=!0,needsRedraw[CR.SELECT_BOX]=!0,r.redraw()),down&&down.isEdge()&&down.active()&&down.unactivate(),near!=last&&(last&&(last.trigger(new $$.Event(e,{type:"mouseout",cyPosition:{x:pos[0],y:pos[1]}})),last.trigger(new $$.Event(e,{type:"tapdragout",cyPosition:{x:pos[0],y:pos[1]}}))),near&&(near.trigger(new $$.Event(e,{type:"mouseover",cyPosition:{x:pos[0],y:pos[1]}})),near.trigger(new $$.Event(e,{type:"tapdragover",cyPosition:{x:pos[0],y:pos[1]}}))),r.hoverData.last=near),down&&down.isNode()&&r.nodeIsDraggable(down))if(rdist2>=r.desktopTapThreshold2){var justStartedDrag=!r.dragData.didDrag;justStartedDrag&&(needsRedraw[CR.NODE]=!0),r.dragData.didDrag=!0;for(var toTrigger=[],i=0;i<draggedElements.length;i++){var dEle=draggedElements[i];if(r.hoverData.draggingEles||addNodeToDrag(dEle,{inDragLayer:!0}),dEle.isNode()&&r.nodeIsDraggable(dEle)&&dEle.grabbed()){var dPos=dEle._private.position;if(toTrigger.push(dEle),$$.is.number(disp[0])&&$$.is.number(disp[1])&&(dPos.x+=disp[0],dPos.y+=disp[1],justStartedDrag)){var dragDelta=r.hoverData.dragDelta;$$.is.number(dragDelta[0])&&$$.is.number(dragDelta[1])&&(dPos.x+=dragDelta[0],dPos.y+=dragDelta[1])}}}r.hoverData.draggingEles=!0;var tcol=new $$.Collection(cy,toTrigger);tcol.updateCompoundBounds(),tcol.trigger("position drag"),needsRedraw[CR.DRAG]=!0,r.redraw()}else updateDragDelta();preventDefault=!0}return select[2]=pos[0],select[3]=pos[1],preventDefault?(e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),!1):void 0},1e3/30,{trailing:!0}),!1),r.registerBinding(window,"mouseup",function(e){var capture=r.hoverData.capture;if(capture){r.hoverData.capture=!1;var cy=r.data.cy,pos=r.projectIntoViewport(e.clientX,e.clientY),select=r.data.select,near=r.findNearestElement(pos[0],pos[1],!0,!1),draggedElements=r.dragData.possibleDragElements,down=r.hoverData.down,shiftDown=e.shiftKey,needsRedraw=r.data.canvasNeedsRedraw;if(r.data.bgActivePosistion&&(needsRedraw[CR.SELECT_BOX]=!0,r.redraw()),r.data.bgActivePosistion=void 0,clearTimeout(r.bgActiveTimeout),down&&down.unactivate(),3===r.hoverData.which){var cxtEvt=new $$.Event(e,{type:"cxttapend",cyPosition:{x:pos[0],y:pos[1]}});if(down?down.trigger(cxtEvt):cy.trigger(cxtEvt),!r.hoverData.cxtDragged){var cxtTap=new $$.Event(e,{type:"cxttap",cyPosition:{x:pos[0],y:pos[1]}});down?down.trigger(cxtTap):cy.trigger(cxtTap)}r.hoverData.cxtDragged=!1,r.hoverData.which=null}else{if(null!=down||r.dragData.didDrag||r.hoverData.dragged||(cy.$(function(){return this.selected()}).unselect(),draggedElements.length>0&&(needsRedraw[CR.NODE]=!0),r.dragData.possibleDragElements=draggedElements=[]),null!=near?near.trigger(new $$.Event(e,{type:"mouseup",cyPosition:{x:pos[0],y:pos[1]}})).trigger(new $$.Event(e,{type:"tapend",cyPosition:{x:pos[0],y:pos[1]}})).trigger(new $$.Event(e,{type:"vmouseup",cyPosition:{x:pos[0],y:pos[1]}})):null==near&&cy.trigger(new $$.Event(e,{type:"mouseup",cyPosition:{x:pos[0],y:pos[1]}})).trigger(new $$.Event(e,{type:"tapend",cyPosition:{x:pos[0],y:pos[1]}})).trigger(new $$.Event(e,{type:"vmouseup",cyPosition:{x:pos[0],y:pos[1]}})),r.dragData.didDrag||r.hoverData.dragged||(null!=near?near.trigger(new $$.Event(e,{type:"click",cyPosition:{x:pos[0],y:pos[1]}})).trigger(new $$.Event(e,{type:"tap",cyPosition:{x:pos[0],y:pos[1]}})).trigger(new $$.Event(e,{type:"vclick",cyPosition:{x:pos[0],y:pos[1]}})):null==near&&cy.trigger(new $$.Event(e,{type:"click",cyPosition:{x:pos[0],y:pos[1]}})).trigger(new $$.Event(e,{type:"tap",cyPosition:{x:pos[0],y:pos[1]}})).trigger(new $$.Event(e,{type:"vclick",cyPosition:{x:pos[0],y:pos[1]}}))),near!=down||r.dragData.didDrag||null!=near&&near._private.selectable&&(r.hoverData.dragging||("additive"===cy.selectionType()||shiftDown?near.selected()?near.unselect():near.select():shiftDown||(cy.$(":selected").unmerge(near).unselect(),near.select())),needsRedraw[CR.NODE]=!0),r.hoverData.selecting&&cy.boxSelectionEnabled()&&Math.pow(select[2]-select[0],2)+Math.pow(select[3]-select[1],2)>7&&select[4]){var newlySelected=[],box=r.getAllInBox(select[0],select[1],select[2],select[3]);needsRedraw[CR.SELECT_BOX]=!0,box.length>0&&(needsRedraw[CR.NODE]=!0);for(var i=0;i<box.length;i++)box[i]._private.selectable&&newlySelected.push(box[i]);var newlySelCol=new $$.Collection(cy,newlySelected);"additive"===cy.selectionType()?newlySelCol.select():(shiftDown||cy.$(":selected").unmerge(newlySelCol).unselect(),newlySelCol.select()),r.redraw()}r.hoverData.dragging&&(r.hoverData.dragging=!1,needsRedraw[CR.SELECT_BOX]=!0,needsRedraw[CR.NODE]=!0,r.redraw()),select[4]||(needsRedraw[CR.DRAG]=!0,needsRedraw[CR.NODE]=!0,freeDraggedElements(draggedElements),down&&down.trigger("free"))}select[4]=0,r.hoverData.down=null,r.hoverData.cxtStarted=!1,r.hoverData.draggingEles=!1,r.hoverData.selecting=!1,r.dragData.didDrag=!1,r.hoverData.dragged=!1,r.hoverData.dragDelta=[]}},!1);var wheelHandler=function(e){if(!r.scrollingPage){var cy=r.data.cy,pos=r.projectIntoViewport(e.clientX,e.clientY),rpos=[pos[0]*cy.zoom()+cy.pan().x,pos[1]*cy.zoom()+cy.pan().y];if(r.hoverData.draggingEles||r.hoverData.dragging||r.hoverData.cxtStarted||inBoxSelection())return void e.preventDefault();if(cy.panningEnabled()&&cy.userPanningEnabled()&&cy.zoomingEnabled()&&cy.userZoomingEnabled()){e.preventDefault(),r.data.wheelZooming=!0,clearTimeout(r.data.wheelTimeout),r.data.wheelTimeout=setTimeout(function(){r.data.wheelZooming=!1,r.data.canvasNeedsRedraw[CR.NODE]=!0,r.redraw()},150);var diff=e.deltaY/-250||e.wheelDeltaY/1e3||e.wheelDelta/1e3;diff*=r.wheelSensitivity;var needsWheelFix=1===e.deltaMode;needsWheelFix&&(diff*=33),cy.zoom({level:cy.zoom()*Math.pow(10,diff),renderedPosition:{x:rpos[0],y:rpos[1]}})}}};r.registerBinding(r.data.container,"wheel",wheelHandler,!0),r.registerBinding(window,"scroll",function(e){r.scrollingPage=!0,clearTimeout(r.scrollingPageTimeout),r.scrollingPageTimeout=setTimeout(function(){r.scrollingPage=!1},250)},!0),r.registerBinding(r.data.container,"mouseout",function(e){var pos=r.projectIntoViewport(e.clientX,e.clientY);r.data.cy.trigger(new $$.Event(e,{type:"mouseout",cyPosition:{x:pos[0],y:pos[1]}}))},!1),r.registerBinding(r.data.container,"mouseover",function(e){var pos=r.projectIntoViewport(e.clientX,e.clientY);r.data.cy.trigger(new $$.Event(e,{type:"mouseover",cyPosition:{x:pos[0],y:pos[1]}}))},!1);var f1x1,f1y1,f2x1,f2y1,distance1,distance1Sq,center1,modelCenter1,offsetLeft,offsetTop,containerWidth,containerHeight,twoFingersStartInside,distance=function(x1,y1,x2,y2){return Math.sqrt((x2-x1)*(x2-x1)+(y2-y1)*(y2-y1))},distanceSq=function(x1,y1,x2,y2){return(x2-x1)*(x2-x1)+(y2-y1)*(y2-y1)};r.registerBinding(r.data.container,"touchstart",function(e){clearTimeout(this.threeFingerSelectTimeout),e.target!==r.data.link&&e.preventDefault(),r.touchData.capture=!0,r.data.bgActivePosistion=void 0;var cy=r.data.cy,nodes=r.getCachedNodes(),edges=r.getCachedEdges(),now=r.touchData.now,earlier=r.touchData.earlier,needsRedraw=r.data.canvasNeedsRedraw;if(e.touches[0]){var pos=r.projectIntoViewport(e.touches[0].clientX,e.touches[0].clientY);now[0]=pos[0],now[1]=pos[1]}if(e.touches[1]){var pos=r.projectIntoViewport(e.touches[1].clientX,e.touches[1].clientY);now[2]=pos[0],now[3]=pos[1]}if(e.touches[2]){var pos=r.projectIntoViewport(e.touches[2].clientX,e.touches[2].clientY);now[4]=pos[0],now[5]=pos[1]}if(e.touches[1]){var release=function(eles){for(var i=0;i<eles.length;i++)eles[i]._private.grabbed=!1,eles[i]._private.rscratch.inDragLayer=!1,eles[i].active()&&eles[i].unactivate()};release(nodes),release(edges);var offsets=r.findContainerClientCoords();offsetLeft=offsets[0],offsetTop=offsets[1],containerWidth=offsets[2],containerHeight=offsets[3],f1x1=e.touches[0].clientX-offsetLeft,f1y1=e.touches[0].clientY-offsetTop,f2x1=e.touches[1].clientX-offsetLeft,f2y1=e.touches[1].clientY-offsetTop,twoFingersStartInside=f1x1>=0&&containerWidth>=f1x1&&f2x1>=0&&containerWidth>=f2x1&&f1y1>=0&&containerHeight>=f1y1&&f2y1>=0&&containerHeight>=f2y1;var pan=cy.pan(),zoom=cy.zoom();distance1=distance(f1x1,f1y1,f2x1,f2y1),distance1Sq=distanceSq(f1x1,f1y1,f2x1,f2y1),center1=[(f1x1+f2x1)/2,(f1y1+f2y1)/2],modelCenter1=[(center1[0]-pan.x)/zoom,(center1[1]-pan.y)/zoom];var cxtDistThreshold=200,cxtDistThresholdSq=cxtDistThreshold*cxtDistThreshold;if(cxtDistThresholdSq>distance1Sq&&!e.touches[2]){var near1=r.findNearestElement(now[0],now[1],!0,!0),near2=r.findNearestElement(now[2],now[3],!0,!0);return near1&&near1.isNode()?(near1.activate().trigger(new $$.Event(e,{type:"cxttapstart",cyPosition:{x:now[0],y:now[1]}})),r.touchData.start=near1):near2&&near2.isNode()?(near2.activate().trigger(new $$.Event(e,{type:"cxttapstart",cyPosition:{x:now[0],y:now[1]}})),r.touchData.start=near2):(cy.trigger(new $$.Event(e,{type:"cxttapstart",cyPosition:{x:now[0],y:now[1]}})),r.touchData.start=null),r.touchData.start&&(r.touchData.start._private.grabbed=!1),r.touchData.cxt=!0,r.touchData.cxtDragged=!1,r.data.bgActivePosistion=void 0,void r.redraw()}}if(e.touches[2]);else if(e.touches[1]);else if(e.touches[0]){var near=r.findNearestElement(now[0],now[1],!0,!0);if(null!=near){if(near.activate(),r.touchData.start=near,near.isNode()&&r.nodeIsDraggable(near)){var draggedEles=r.dragData.touchDragEles=[];if(needsRedraw[CR.NODE]=!0,needsRedraw[CR.DRAG]=!0,near.selected())for(var selectedNodes=cy.$(function(){return this.isNode()&&this.selected()}),k=0;k<selectedNodes.length;k++){var selectedNode=selectedNodes[k];r.nodeIsDraggable(selectedNode)&&addNodeToDrag(selectedNode,{addToList:draggedEles})}else addNodeToDrag(near,{addToList:draggedEles});near.trigger(new $$.Event(e,{type:"grab",cyPosition:{x:now[0],y:now[1]}}))}near.trigger(new $$.Event(e,{type:"touchstart",cyPosition:{x:now[0],y:now[1]}})).trigger(new $$.Event(e,{type:"tapstart",cyPosition:{x:now[0],y:now[1]}})).trigger(new $$.Event(e,{type:"vmousdown",cyPosition:{x:now[0],y:now[1]}}))}null==near&&(cy.trigger(new $$.Event(e,{type:"touchstart",cyPosition:{x:now[0],y:now[1]}})).trigger(new $$.Event(e,{type:"tapstart",cyPosition:{x:now[0],y:now[1]}})).trigger(new $$.Event(e,{type:"vmousedown",cyPosition:{x:now[0],y:now[1]}})),r.data.bgActivePosistion={x:pos[0],y:pos[1]},needsRedraw[CR.SELECT_BOX]=!0,r.redraw());for(var i=0;i<now.length;i++)earlier[i]=now[i],r.touchData.startPosition[i]=now[i];r.touchData.singleTouchMoved=!1,r.touchData.singleTouchStartTime=+new Date,clearTimeout(r.touchData.tapholdTimeout),r.touchData.tapholdTimeout=setTimeout(function(){r.touchData.singleTouchMoved!==!1||r.pinching||(r.touchData.start?r.touchData.start.trigger(new $$.Event(e,{type:"taphold",cyPosition:{x:now[0],y:now[1]}})):(r.data.cy.trigger(new $$.Event(e,{type:"taphold",cyPosition:{x:now[0],y:now[1]}})),cy.$(":selected").unselect()))},r.tapholdDuration)}},!1),r.registerBinding(window,"touchmove",$$.util.throttle(function(e){var select=r.data.select,capture=r.touchData.capture;capture&&e.preventDefault();var cy=r.data.cy,now=r.touchData.now,earlier=r.touchData.earlier,zoom=cy.zoom(),needsRedraw=r.data.canvasNeedsRedraw;if(e.touches[0]){var pos=r.projectIntoViewport(e.touches[0].clientX,e.touches[0].clientY);now[0]=pos[0],
now[1]=pos[1]}if(e.touches[1]){var pos=r.projectIntoViewport(e.touches[1].clientX,e.touches[1].clientY);now[2]=pos[0],now[3]=pos[1]}if(e.touches[2]){var pos=r.projectIntoViewport(e.touches[2].clientX,e.touches[2].clientY);now[4]=pos[0],now[5]=pos[1]}for(var disp=[],j=0;j<now.length;j++)disp[j]=now[j]-earlier[j];var startPos=r.touchData.startPosition,dx=now[0]-startPos[0],dx2=dx*dx,dy=now[1]-startPos[1],dy2=dy*dy,dist2=dx2+dy2,rdist2=dist2*zoom*zoom;if(capture&&r.touchData.cxt){var f1x2=e.touches[0].clientX-offsetLeft,f1y2=e.touches[0].clientY-offsetTop,f2x2=e.touches[1].clientX-offsetLeft,f2y2=e.touches[1].clientY-offsetTop,distance2Sq=distanceSq(f1x2,f1y2,f2x2,f2y2),factorSq=distance2Sq/distance1Sq,distThreshold=150,distThresholdSq=distThreshold*distThreshold,factorThreshold=1.5,factorThresholdSq=factorThreshold*factorThreshold;if(factorSq>=factorThresholdSq||distance2Sq>=distThresholdSq){r.touchData.cxt=!1,r.touchData.start&&(r.touchData.start.unactivate(),r.touchData.start=null),r.data.bgActivePosistion=void 0,needsRedraw[CR.SELECT_BOX]=!0;var cxtEvt=new $$.Event(e,{type:"cxttapend",cyPosition:{x:now[0],y:now[1]}});r.touchData.start?r.touchData.start.trigger(cxtEvt):cy.trigger(cxtEvt)}}if(capture&&r.touchData.cxt){var cxtEvt=new $$.Event(e,{type:"cxtdrag",cyPosition:{x:now[0],y:now[1]}});r.data.bgActivePosistion=void 0,needsRedraw[CR.SELECT_BOX]=!0,r.touchData.start?r.touchData.start.trigger(cxtEvt):cy.trigger(cxtEvt),r.touchData.start&&(r.touchData.start._private.grabbed=!1),r.touchData.cxtDragged=!0;var near=r.findNearestElement(now[0],now[1],!0,!0);r.touchData.cxtOver&&near===r.touchData.cxtOver||(r.touchData.cxtOver&&r.touchData.cxtOver.trigger(new $$.Event(e,{type:"cxtdragout",cyPosition:{x:now[0],y:now[1]}})),r.touchData.cxtOver=near,near&&near.trigger(new $$.Event(e,{type:"cxtdragover",cyPosition:{x:now[0],y:now[1]}})))}else if(capture&&e.touches[2]&&cy.boxSelectionEnabled())r.data.bgActivePosistion=void 0,clearTimeout(this.threeFingerSelectTimeout),this.lastThreeTouch=+new Date,r.touchData.selecting=!0,needsRedraw[CR.SELECT_BOX]=!0,select&&0!==select.length&&void 0!==select[0]?(select[2]=(now[0]+now[2]+now[4])/3,select[3]=(now[1]+now[3]+now[5])/3):(select[0]=(now[0]+now[2]+now[4])/3,select[1]=(now[1]+now[3]+now[5])/3,select[2]=(now[0]+now[2]+now[4])/3+1,select[3]=(now[1]+now[3]+now[5])/3+1),select[4]=1,r.touchData.selecting=!0,r.redraw();else if(capture&&e.touches[1]&&cy.zoomingEnabled()&&cy.panningEnabled()&&cy.userZoomingEnabled()&&cy.userPanningEnabled()){r.data.bgActivePosistion=void 0,needsRedraw[CR.SELECT_BOX]=!0;var draggedEles=r.dragData.touchDragEles;if(draggedEles){needsRedraw[CR.DRAG]=!0;for(var i=0;i<draggedEles.length;i++)draggedEles[i]._private.grabbed=!1,draggedEles[i]._private.rscratch.inDragLayer=!1}var f1x2=e.touches[0].clientX-offsetLeft,f1y2=e.touches[0].clientY-offsetTop,f2x2=e.touches[1].clientX-offsetLeft,f2y2=e.touches[1].clientY-offsetTop,distance2=distance(f1x2,f1y2,f2x2,f2y2),factor=distance2/distance1;if(1!=factor&&twoFingersStartInside){var df1x=f1x2-f1x1,df1y=f1y2-f1y1,df2x=f2x2-f2x1,df2y=f2y2-f2y1,tx=(df1x+df2x)/2,ty=(df1y+df2y)/2,zoom1=cy.zoom(),zoom2=zoom1*factor,pan1=cy.pan(),ctrx=modelCenter1[0]*zoom1+pan1.x,ctry=modelCenter1[1]*zoom1+pan1.y,pan2={x:-zoom2/zoom1*(ctrx-pan1.x-tx)+ctrx,y:-zoom2/zoom1*(ctry-pan1.y-ty)+ctry};if(r.touchData.start){var draggedEles=r.dragData.touchDragEles;if(draggedEles)for(var i=0;i<draggedEles.length;i++){var dEi_p=draggedEles[i]._private;dEi_p.grabbed=!1,dEi_p.rscratch.inDragLayer=!1}var start_p=r.touchData.start._private;start_p.active=!1,start_p.grabbed=!1,start_p.rscratch.inDragLayer=!1,needsRedraw[CR.DRAG]=!0,r.touchData.start.trigger("free").trigger("unactivate")}cy.viewport({zoom:zoom2,pan:pan2,cancelOnFailedZoom:!0}),distance1=distance2,f1x1=f1x2,f1y1=f1y2,f2x1=f2x2,f2y1=f2y2,r.pinching=!0}if(e.touches[0]){var pos=r.projectIntoViewport(e.touches[0].clientX,e.touches[0].clientY);now[0]=pos[0],now[1]=pos[1]}if(e.touches[1]){var pos=r.projectIntoViewport(e.touches[1].clientX,e.touches[1].clientY);now[2]=pos[0],now[3]=pos[1]}if(e.touches[2]){var pos=r.projectIntoViewport(e.touches[2].clientX,e.touches[2].clientY);now[4]=pos[0],now[5]=pos[1]}}else if(e.touches[0]){var start=r.touchData.start,last=r.touchData.last,near=near||r.findNearestElement(now[0],now[1],!0,!0);if(null!=start&&"nodes"==start._private.group&&r.nodeIsDraggable(start))if(rdist2>=r.touchTapThreshold2){for(var draggedEles=r.dragData.touchDragEles,k=0;k<draggedEles.length;k++){var draggedEle=draggedEles[k];if(r.nodeIsDraggable(draggedEle)&&draggedEle.isNode()&&draggedEle.grabbed()){r.dragData.didDrag=!0;var dPos=draggedEle._private.position,justStartedDrag=!r.hoverData.draggingEles;if($$.is.number(disp[0])&&$$.is.number(disp[1])&&(dPos.x+=disp[0],dPos.y+=disp[1]),justStartedDrag){addNodeToDrag(draggedEle,{inDragLayer:!0}),needsRedraw[CR.NODE]=!0;var dragDelta=r.touchData.dragDelta;$$.is.number(dragDelta[0])&&$$.is.number(dragDelta[1])&&(dPos.x+=dragDelta[0],dPos.y+=dragDelta[1])}}}var tcol=new $$.Collection(cy,draggedEle);tcol.updateCompoundBounds(),tcol.trigger("position drag"),r.hoverData.draggingEles=!0,needsRedraw[CR.DRAG]=!0,r.touchData.startPosition[0]==earlier[0]&&r.touchData.startPosition[1]==earlier[1]&&(needsRedraw[CR.NODE]=!0),r.redraw()}else{var dragDelta=r.touchData.dragDelta=r.touchData.dragDelta||[];0===dragDelta.length?(dragDelta.push(disp[0]),dragDelta.push(disp[1])):(dragDelta[0]+=disp[0],dragDelta[1]+=disp[1])}null!=start&&(start.trigger(new $$.Event(e,{type:"touchmove",cyPosition:{x:now[0],y:now[1]}})),start.trigger(new $$.Event(e,{type:"tapdrag",cyPosition:{x:now[0],y:now[1]}})),start.trigger(new $$.Event(e,{type:"vmousemove",cyPosition:{x:now[0],y:now[1]}}))),null==start&&(null!=near&&(near.trigger(new $$.Event(e,{type:"touchmove",cyPosition:{x:now[0],y:now[1]}})),near.trigger(new $$.Event(e,{type:"tapdrag",cyPosition:{x:now[0],y:now[1]}})),near.trigger(new $$.Event(e,{type:"vmousemove",cyPosition:{x:now[0],y:now[1]}}))),null==near&&(cy.trigger(new $$.Event(e,{type:"touchmove",cyPosition:{x:now[0],y:now[1]}})),cy.trigger(new $$.Event(e,{type:"tapdrag",cyPosition:{x:now[0],y:now[1]}})),cy.trigger(new $$.Event(e,{type:"vmousemove",cyPosition:{x:now[0],y:now[1]}})))),near!=last&&(last&&last.trigger(new $$.Event(e,{type:"tapdragout",cyPosition:{x:now[0],y:now[1]}})),near&&near.trigger(new $$.Event(e,{type:"tapdragover",cyPosition:{x:now[0],y:now[1]}}))),r.touchData.last=near;for(var i=0;i<now.length;i++)now[i]&&r.touchData.startPosition[i]&&Math.abs(now[i]-r.touchData.startPosition[i])>4&&(r.touchData.singleTouchMoved=!0);if(capture&&(null==start||start.isEdge())&&cy.panningEnabled()&&cy.userPanningEnabled()){r.swipePanning?cy.panBy({x:disp[0]*zoom,y:disp[1]*zoom}):rdist2>=r.touchTapThreshold2&&(r.swipePanning=!0,cy.panBy({x:dx*zoom,y:dy*zoom})),start&&(start.unactivate(),r.data.bgActivePosistion||(r.data.bgActivePosistion={x:now[0],y:now[1]}),needsRedraw[CR.SELECT_BOX]=!0,r.touchData.start=null);var pos=r.projectIntoViewport(e.touches[0].clientX,e.touches[0].clientY);now[0]=pos[0],now[1]=pos[1]}}for(var j=0;j<now.length;j++)earlier[j]=now[j]},1e3/30,{trailing:!0}),!1),r.registerBinding(window,"touchcancel",function(e){var start=r.touchData.start;r.touchData.capture=!1,start&&start.unactivate()}),r.registerBinding(window,"touchend",function(e){var start=r.touchData.start,capture=r.touchData.capture;if(capture){r.touchData.capture=!1,e.preventDefault();var select=r.data.select;r.swipePanning=!1,r.hoverData.draggingEles=!1;var cy=r.data.cy,zoom=cy.zoom(),now=r.touchData.now,earlier=r.touchData.earlier,needsRedraw=r.data.canvasNeedsRedraw;if(e.touches[0]){var pos=r.projectIntoViewport(e.touches[0].clientX,e.touches[0].clientY);now[0]=pos[0],now[1]=pos[1]}if(e.touches[1]){var pos=r.projectIntoViewport(e.touches[1].clientX,e.touches[1].clientY);now[2]=pos[0],now[3]=pos[1]}if(e.touches[2]){var pos=r.projectIntoViewport(e.touches[2].clientX,e.touches[2].clientY);now[4]=pos[0],now[5]=pos[1]}start&&start.unactivate();var ctxTapend;if(r.touchData.cxt){if(ctxTapend=new $$.Event(e,{type:"cxttapend",cyPosition:{x:now[0],y:now[1]}}),start?start.trigger(ctxTapend):cy.trigger(ctxTapend),!r.touchData.cxtDragged){var ctxTap=new $$.Event(e,{type:"cxttap",cyPosition:{x:now[0],y:now[1]}});start?start.trigger(ctxTap):cy.trigger(ctxTap)}return r.touchData.start&&(r.touchData.start._private.grabbed=!1),r.touchData.cxt=!1,r.touchData.start=null,void r.redraw()}if(!e.touches[2]&&cy.boxSelectionEnabled()&&r.touchData.selecting){r.touchData.selecting=!1,clearTimeout(this.threeFingerSelectTimeout);var newlySelected=[],box=r.getAllInBox(select[0],select[1],select[2],select[3]);select[0]=void 0,select[1]=void 0,select[2]=void 0,select[3]=void 0,select[4]=0,needsRedraw[CR.SELECT_BOX]=!0;for(var i=0;i<box.length;i++)box[i]._private.selectable&&newlySelected.push(box[i]);var newlySelCol=new $$.Collection(cy,newlySelected);"single"===cy.selectionType()&&cy.$(":selected").unmerge(newlySelCol).unselect(),newlySelCol.select(),newlySelCol.length>0?needsRedraw[CR.NODE]=!0:r.redraw()}var updateStartStyle=!1;if(null!=start&&(start._private.active=!1,updateStartStyle=!0,start.unactivate()),e.touches[2])r.data.bgActivePosistion=void 0,needsRedraw[CR.SELECT_BOX]=!0;else if(e.touches[1]);else if(e.touches[0]);else if(!e.touches[0]){r.data.bgActivePosistion=void 0,needsRedraw[CR.SELECT_BOX]=!0;var draggedEles=r.dragData.touchDragEles;if(null!=start){var startWasGrabbed=start._private.grabbed;freeDraggedElements(draggedEles),needsRedraw[CR.DRAG]=!0,needsRedraw[CR.NODE]=!0,startWasGrabbed&&start.trigger("free"),start.trigger(new $$.Event(e,{type:"touchend",cyPosition:{x:now[0],y:now[1]}})).trigger(new $$.Event(e,{type:"tapend",cyPosition:{x:now[0],y:now[1]}})).trigger(new $$.Event(e,{type:"vmouseup",cyPosition:{x:now[0],y:now[1]}})),start.unactivate(),r.touchData.start=null}else{var near=r.findNearestElement(now[0],now[1],!0,!0);null!=near&&near.trigger(new $$.Event(e,{type:"touchend",cyPosition:{x:now[0],y:now[1]}})).trigger(new $$.Event(e,{type:"tapend",cyPosition:{x:now[0],y:now[1]}})).trigger(new $$.Event(e,{type:"vmouseup",cyPosition:{x:now[0],y:now[1]}})),null==near&&cy.trigger(new $$.Event(e,{type:"touchend",cyPosition:{x:now[0],y:now[1]}})).trigger(new $$.Event(e,{type:"tapend",cyPosition:{x:now[0],y:now[1]}})).trigger(new $$.Event(e,{type:"vmouseup",cyPosition:{x:now[0],y:now[1]}}))}var dx=r.touchData.startPosition[0]-now[0],dx2=dx*dx,dy=r.touchData.startPosition[1]-now[1],dy2=dy*dy,dist2=dx2+dy2,rdist2=dist2*zoom*zoom;null!=start&&!r.dragData.didDrag&&start._private.selectable&&rdist2<r.touchTapThreshold2&&!r.pinching&&("single"===cy.selectionType()?(cy.$(":selected").unmerge(start).unselect(),start.select()):start.selected()?start.unselect():start.select(),updateStartStyle=!0,needsRedraw[CR.NODE]=!0),r.touchData.singleTouchMoved===!1&&(start?start.trigger(new $$.Event(e,{type:"tap",cyPosition:{x:now[0],y:now[1]}})).trigger(new $$.Event(e,{type:"vclick",cyPosition:{x:now[0],y:now[1]}})):cy.trigger(new $$.Event(e,{type:"tap",cyPosition:{x:now[0],y:now[1]}})).trigger(new $$.Event(e,{type:"vclick",cyPosition:{x:now[0],y:now[1]}}))),r.touchData.singleTouchMoved=!0}for(var j=0;j<now.length;j++)earlier[j]=now[j];r.dragData.didDrag=!1,0===e.touches.length&&(r.touchData.dragDelta=[]),updateStartStyle&&start&&start.updateStyle(!1),e.touches.length<2&&(r.pinching=!1,needsRedraw[CR.NODE]=!0,r.redraw())}},!1)}}(cytoscape),function($$){"use strict";function generatePolygon(name,points){nodeShapes[name]={points:points,draw:function(context,centerX,centerY,width,height){renderer.drawPolygon(context,centerX,centerY,width,height,nodeShapes[name].points)},drawPath:function(context,centerX,centerY,width,height){renderer.drawPolygonPath(context,centerX,centerY,width,height,nodeShapes[name].points)},intersectLine:function(nodeX,nodeY,width,height,x,y,padding){return $$.math.polygonIntersectLine(x,y,nodeShapes[name].points,nodeX,nodeY,width/2,height/2,padding)},intersectBox:function(x1,y1,x2,y2,width,height,centerX,centerY,padding){var points=nodeShapes[name].points;return $$.math.boxIntersectPolygon(x1,y1,x2,y2,points,width,height,centerX,centerY,[0,-1],padding)},checkPoint:function(x,y,padding,width,height,centerX,centerY){return $$.math.pointInsidePolygon(x,y,nodeShapes[name].points,centerX,centerY,width,height,[0,-1],padding)}}}for(var CanvasRenderer=$$("renderer","canvas"),renderer=CanvasRenderer.prototype,usePaths=CanvasRenderer.usePaths(),nodeShapes=CanvasRenderer.nodeShapes={},sin0=Math.sin(0),cos0=Math.cos(0),sin={},cos={},ellipseStepSize=.1,i=0*Math.PI;i<2*Math.PI;i+=ellipseStepSize)sin[i]=Math.sin(i),cos[i]=Math.cos(i);nodeShapes.ellipse={draw:function(context,centerX,centerY,width,height){nodeShapes.ellipse.drawPath(context,centerX,centerY,width,height),context.fill()},drawPath:function(context,centerX,centerY,width,height){if(usePaths){context.beginPath&&context.beginPath();for(var xPos,yPos,rw=width/2,rh=height/2,i=0*Math.PI;i<2*Math.PI;i+=ellipseStepSize)xPos=centerX-rw*sin[i]*sin0+rw*cos[i]*cos0,yPos=centerY+rh*cos[i]*sin0+rh*sin[i]*cos0,0===i?context.moveTo(xPos,yPos):context.lineTo(xPos,yPos);context.closePath()}else context.beginPath&&context.beginPath(),context.translate(centerX,centerY),context.scale(width/2,height/2),context.arc(0,0,1,0,2*Math.PI*.999,!1),context.closePath(),context.scale(2/width,2/height),context.translate(-centerX,-centerY)},intersectLine:function(nodeX,nodeY,width,height,x,y,padding){var intersect=$$.math.intersectLineEllipse(x,y,nodeX,nodeY,width/2+padding,height/2+padding);return intersect},intersectBox:function(x1,y1,x2,y2,width,height,centerX,centerY,padding){return $$.math.boxIntersectEllipse(x1,y1,x2,y2,padding,width,height,centerX,centerY)},checkPoint:function(x,y,padding,width,height,centerX,centerY){return x-=centerX,y-=centerY,x/=width/2+padding,y/=height/2+padding,Math.pow(x,2)+Math.pow(y,2)<=1}},generatePolygon("triangle",$$.math.generateUnitNgonPointsFitToSquare(3,0)),generatePolygon("square",$$.math.generateUnitNgonPointsFitToSquare(4,0)),nodeShapes.rectangle=nodeShapes.square,nodeShapes.roundrectangle={points:$$.math.generateUnitNgonPointsFitToSquare(4,0),draw:function(context,centerX,centerY,width,height){renderer.drawRoundRectangle(context,centerX,centerY,width,height,10)},drawPath:function(context,centerX,centerY,width,height){renderer.drawRoundRectanglePath(context,centerX,centerY,width,height,10)},intersectLine:function(nodeX,nodeY,width,height,x,y,padding){return $$.math.roundRectangleIntersectLine(x,y,nodeX,nodeY,width,height,padding)},intersectBox:function(x1,y1,x2,y2,width,height,centerX,centerY,padding){return $$.math.roundRectangleIntersectBox(x1,y1,x2,y2,width,height,centerX,centerY,padding)},checkPoint:function(x,y,padding,width,height,centerX,centerY){var cornerRadius=$$.math.getRoundRectangleRadius(width,height);if($$.math.pointInsidePolygon(x,y,nodeShapes.roundrectangle.points,centerX,centerY,width,height-2*cornerRadius,[0,-1],padding))return!0;if($$.math.pointInsidePolygon(x,y,nodeShapes.roundrectangle.points,centerX,centerY,width-2*cornerRadius,height,[0,-1],padding))return!0;var checkInEllipse=function(x,y,centerX,centerY,width,height,padding){return x-=centerX,y-=centerY,x/=width/2+padding,y/=height/2+padding,Math.pow(x,2)+Math.pow(y,2)<=1};return checkInEllipse(x,y,centerX-width/2+cornerRadius,centerY-height/2+cornerRadius,2*cornerRadius,2*cornerRadius,padding)?!0:checkInEllipse(x,y,centerX+width/2-cornerRadius,centerY-height/2+cornerRadius,2*cornerRadius,2*cornerRadius,padding)?!0:checkInEllipse(x,y,centerX+width/2-cornerRadius,centerY+height/2-cornerRadius,2*cornerRadius,2*cornerRadius,padding)?!0:checkInEllipse(x,y,centerX-width/2+cornerRadius,centerY+height/2-cornerRadius,2*cornerRadius,2*cornerRadius,padding)?!0:!1}},generatePolygon("diamond",[0,1,1,0,0,-1,-1,0]),generatePolygon("pentagon",$$.math.generateUnitNgonPointsFitToSquare(5,0)),generatePolygon("hexagon",$$.math.generateUnitNgonPointsFitToSquare(6,0)),generatePolygon("heptagon",$$.math.generateUnitNgonPointsFitToSquare(7,0)),generatePolygon("octagon",$$.math.generateUnitNgonPointsFitToSquare(8,0));var star5Points=new Array(20),outerPoints=$$.math.generateUnitNgonPoints(5,0),innerPoints=$$.math.generateUnitNgonPoints(5,Math.PI/5),innerRadius=.5*(3-Math.sqrt(5));innerRadius*=1.57;for(var i=0;i<innerPoints.length/2;i++)innerPoints[2*i]*=innerRadius,innerPoints[2*i+1]*=innerRadius;for(var i=0;5>i;i++)star5Points[4*i]=outerPoints[2*i],star5Points[4*i+1]=outerPoints[2*i+1],star5Points[4*i+2]=innerPoints[2*i],star5Points[4*i+3]=innerPoints[2*i+1];star5Points=$$.math.fitPolygonToSquare(star5Points),generatePolygon("star",star5Points),generatePolygon("vee",[-1,-1,0,-.333,1,-1,0,1]),generatePolygon("rhomboid",[-1,-1,.333,-1,1,1,-.333,1])}(cytoscape),function($$){"use strict";function ArborLayout(options){this._private={},this._private.options=$$.util.extend({},defaults,options)}var defaults={animate:!0,maxSimulationTime:4e3,fit:!0,padding:30,boundingBox:void 0,ungrabifyWhileSimulating:!1,ready:void 0,stop:void 0,repulsion:void 0,stiffness:void 0,friction:void 0,gravity:!0,fps:void 0,precision:void 0,nodeMass:void 0,edgeLength:void 0,stepSize:.1,stableEnergy:function(energy){var e=energy;return e.max<=.5||e.mean<=.3},infinite:!1};ArborLayout.prototype.run=function(){var layout=this,options=this._private.options;return $$.util.require("arbor",function(arbor){function calculateValueForElement(element,value){return null==value?void 0:"function"==typeof value?value.apply(element,[element._private.data,{nodes:nodes.length,edges:edges.length,element:element}]):value}function addNode(node){if(!node.isFullAutoParent()){var id=node._private.data.id,mass=calculateValueForElement(node,options.nodeMass),locked=node._private.locked,nPos=node.position(),pos=sys.fromScreen({x:nPos.x,y:nPos.y});node.scratch().arbor=sys.addNode(id,{element:node,mass:mass,fixed:locked,x:locked?pos.x:void 0,y:locked?pos.y:void 0})}}function addEdge(edge){var src=edge.source().id(),tgt=edge.target().id(),length=calculateValueForElement(edge,options.edgeLength);edge.scratch().arbor=sys.addEdge(src,tgt,{length:length})}var cy=options.cy,eles=options.eles,nodes=eles.nodes().not(":parent"),edges=eles.edges(),bb=$$.util.makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()}),simUpdatingPos=!1;if(layout.trigger({type:"layoutstart",layout:layout}),void 0!==options.liveUpdate&&(options.animate=options.liveUpdate),eles.nodes().size()<=1)return options.fit&&cy.reset(),eles.nodes().position({x:Math.round((bb.x1+bb.x2)/2),y:Math.round((bb.y1+bb.y2)/2)}),layout.one("layoutready",options.ready),layout.trigger({type:"layoutready",layout:layout}),layout.one("layoutstop",options.stop),void layout.trigger({type:"layoutstop",layout:layout});var sys=layout._private.system=arbor.ParticleSystem();sys.parameters({repulsion:options.repulsion,stiffness:options.stiffness,friction:options.friction,gravity:options.gravity,fps:options.fps,dt:options.dt,precision:options.precision}),options.animate&&options.fit&&cy.fit(bb,options.padding);var doneTimeout,doneTime=250,ready=!1,lastDraw=+new Date,sysRenderer={init:function(system){},redraw:function(){var energy=sys.energy();if(!options.infinite&&null!=options.stableEnergy&&null!=energy&&energy.n>0&&options.stableEnergy(energy))return void layout.stop();options.infinite||doneTime==1/0||(clearTimeout(doneTimeout),doneTimeout=setTimeout(doneHandler,doneTime));var movedNodes=cy.collection();sys.eachNode(function(n,point){var data=n.data,node=data.element;null!=node&&(node.locked()||node.grabbed()||(node.silentPosition({x:bb.x1+point.x,y:bb.y1+point.y}),movedNodes.merge(node)))}),options.animate&&movedNodes.length>0&&(simUpdatingPos=!0,movedNodes.rtrigger("position"),options.fit&&cy.fit(options.padding),lastDraw=+new Date,simUpdatingPos=!1),ready||(ready=!0,layout.one("layoutready",options.ready),layout.trigger({type:"layoutready",layout:layout}))}};sys.renderer=sysRenderer,sys.screenSize(bb.w,bb.h),sys.screenPadding(options.padding,options.padding,options.padding,options.padding),sys.screenStep(options.stepSize);var grabHandler;nodes.on("grab free position",grabHandler=function(e){if(!simUpdatingPos){var pos=this.position(),apos=sys.fromScreen(pos);if(apos){var p=arbor.Point(apos.x,apos.y),padding=options.padding;switch(bb.x1+padding<=pos.x&&pos.x<=bb.x2-padding&&bb.y1+padding<=pos.y&&pos.y<=bb.y2-padding&&(this.scratch().arbor.p=p),e.type){case"grab":this.scratch().arbor.fixed=!0;break;case"free":this.scratch().arbor.fixed=!1}}}});var lockHandler;nodes.on("lock unlock",lockHandler=function(e){node.scratch().arbor.fixed=node.locked()});var removeHandler;eles.on("remove",removeHandler=function(e){});var addHandler;cy.on("add","*",addHandler=function(){});var resizeHandler;cy.on("resize",resizeHandler=function(){if(null==options.boundingBox&&null!=layout._private.system){var w=cy.width(),h=cy.height();sys.screenSize(w,h)}}),nodes.each(function(i,node){addNode(node)}),edges.each(function(i,edge){addEdge(edge)});var grabbableNodes=nodes.filter(":grabbable");options.ungrabifyWhileSimulating&&grabbableNodes.ungrabify();var doneHandler=layout._private.doneHandler=function(){layout._private.doneHandler=null,options.animate||(options.fit&&cy.reset(),nodes.rtrigger("position")),nodes.off("grab free position",grabHandler),nodes.off("lock unlock",lockHandler),eles.off("remove",removeHandler),cy.off("add","*",addHandler),cy.off("resize",resizeHandler),options.ungrabifyWhileSimulating&&grabbableNodes.grabify(),layout.one("layoutstop",options.stop),layout.trigger({type:"layoutstop",layout:layout})};sys.start(),!options.infinite&&null!=options.maxSimulationTime&&options.maxSimulationTime>0&&options.maxSimulationTime!==1/0&&setTimeout(function(){layout.stop()},options.maxSimulationTime)}),this},ArborLayout.prototype.stop=function(){return null!=this._private.system&&this._private.system.stop(),this._private.doneHandler&&this._private.doneHandler(),this},$$("layout","arbor",ArborLayout)}(cytoscape),function($$){"use strict";function BreadthFirstLayout(options){this.options=$$.util.extend({},defaults,options)}var defaults={fit:!0,directed:!1,padding:30,circle:!1,spacingFactor:1.75,boundingBox:void 0,avoidOverlap:!0,roots:void 0,maximalAdjustments:0,animate:!1,animationDuration:500,ready:void 0,stop:void 0};BreadthFirstLayout.prototype.run=function(){var roots,params=this.options,options=params,cy=params.cy,eles=options.eles,nodes=eles.nodes().not(":parent"),graph=eles,bb=$$.util.makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()});if($$.is.elementOrCollection(options.roots))roots=options.roots;else if($$.is.array(options.roots)){for(var rootsArray=[],i=0;i<options.roots.length;i++){var id=options.roots[i],ele=cy.getElementById(id);rootsArray.push(ele)}roots=new $$.Collection(cy,rootsArray)}else if($$.is.string(options.roots))roots=cy.$(options.roots);else if(options.directed)roots=nodes.roots();else{for(var components=[],unhandledNodes=nodes;unhandledNodes.length>0;){var currComp=cy.collection();eles.bfs({roots:unhandledNodes[0],visit:function(i,depth,node,edge,pNode){currComp=currComp.add(node)},directed:!1}),unhandledNodes=unhandledNodes.not(currComp),components.push(currComp)}roots=cy.collection();for(var i=0;i<components.length;i++){var comp=components[i],maxDegree=comp.maxDegree(!1),compRoots=comp.filter(function(){return this.degree(!1)===maxDegree});roots=roots.add(compRoots)}}var depths=[],foundByBfs={},id2depth={},prevNode={},prevEdge={},successors={};graph.bfs({roots:roots,directed:options.directed,visit:function(i,depth,node,edge,pNode){var ele=this[0],id=ele.id();if(depths[depth]||(depths[depth]=[]),depths[depth].push(ele),foundByBfs[id]=!0,id2depth[id]=depth,prevNode[id]=pNode,prevEdge[id]=edge,pNode){var prevId=pNode.id(),succ=successors[prevId]=successors[prevId]||[];succ.push(node)}}});for(var orphanNodes=[],i=0;i<nodes.length;i++){var ele=nodes[i];foundByBfs[ele.id()]||orphanNodes.push(ele)}for(var maxChecks=3*orphanNodes.length,checks=0;0!==orphanNodes.length&&maxChecks>checks;){for(var node=orphanNodes.shift(),neighbors=node.neighborhood().nodes(),assignedDepth=!1,i=0;i<neighbors.length;i++){var depth=id2depth[neighbors[i].id()];if(void 0!==depth){depths[depth].push(node),assignedDepth=!0;break}}assignedDepth||orphanNodes.push(node),checks++}for(;0!==orphanNodes.length;){var node=orphanNodes.shift(),assignedDepth=!1;assignedDepth||(0===depths.length&&depths.push([]),depths[0].push(node))}var assignDepthsToEles=function(){for(var i=0;i<depths.length;i++)for(var eles=depths[i],j=0;j<eles.length;j++){var ele=eles[j];ele._private.scratch.breadthfirst={depth:i,index:j}}};assignDepthsToEles();for(var intersectsDepth=function(node){for(var highestOther,edges=node.connectedEdges(function(){return this.data("target")===node.id()}),thisInfo=node._private.scratch.breadthfirst,highestDepthOfOther=0,i=0;i<edges.length;i++){var edge=edges[i],otherNode=edge.source()[0],otherInfo=otherNode._private.scratch.breadthfirst;thisInfo.depth<=otherInfo.depth&&highestDepthOfOther<otherInfo.depth&&(highestDepthOfOther=otherInfo.depth,highestOther=otherNode)}return highestOther},adj=0;adj<options.maximalAdjustments;adj++){for(var nDepths=depths.length,elesToMove=[],i=0;nDepths>i;i++)for(var depth=depths[i],nDepth=depth.length,j=0;nDepth>j;j++){var ele=depth[j],info=ele._private.scratch.breadthfirst,intEle=intersectsDepth(ele);intEle&&(info.intEle=intEle,elesToMove.push(ele))}for(var i=0;i<elesToMove.length;i++){var ele=elesToMove[i],info=ele._private.scratch.breadthfirst,intEle=info.intEle,intInfo=intEle._private.scratch.breadthfirst;depths[info.depth].splice(info.index,1);for(var newDepth=intInfo.depth+1;newDepth>depths.length-1;)depths.push([]);depths[newDepth].push(ele),info.depth=newDepth,info.index=depths[newDepth].length-1}assignDepthsToEles()}var minDistance=0;if(options.avoidOverlap){for(var i=0;i<nodes.length;i++){var w=nodes[i].outerWidth(),h=nodes[i].outerHeight();minDistance=Math.max(minDistance,w,h)}minDistance*=options.spacingFactor}for(var cachedWeightedPercent={},getWeightedPercent=function(ele){if(cachedWeightedPercent[ele.id()])return cachedWeightedPercent[ele.id()];for(var eleDepth=ele._private.scratch.breadthfirst.depth,neighbors=ele.neighborhood().nodes().not(":parent"),percent=0,samples=0,i=0;i<neighbors.length;i++){var neighbor=neighbors[i],bf=neighbor._private.scratch.breadthfirst,index=bf.index,depth=bf.depth,nDepth=depths[depth].length;(eleDepth>depth||0===eleDepth)&&(percent+=index/nDepth,samples++)}return samples=Math.max(1,samples),percent/=samples,0===samples&&(percent=void 0),cachedWeightedPercent[ele.id()]=percent,percent},sortFn=function(a,b){var apct=getWeightedPercent(a),bpct=getWeightedPercent(b);return apct-bpct},times=0;3>times;times++){for(var i=0;i<depths.length;i++)depths[i]=depths[i].sort(sortFn);assignDepthsToEles()}for(var biggestDepthSize=0,i=0;i<depths.length;i++)biggestDepthSize=Math.max(depths[i].length,biggestDepthSize);for(var center={x:bb.x1+bb.w/2,y:bb.x1+bb.h/2},getPosition=function(ele,isBottomDepth){var info=ele._private.scratch.breadthfirst,depth=info.depth,index=info.index,depthSize=depths[depth].length,distanceX=Math.max(bb.w/(depthSize+1),minDistance),distanceY=Math.max(bb.h/(depths.length+1),minDistance),radiusStepSize=Math.min(bb.w/2/depths.length,bb.h/2/depths.length);if(radiusStepSize=Math.max(radiusStepSize,minDistance),options.circle){if(options.circle){var radius=radiusStepSize*depth+radiusStepSize-(depths.length>0&&depths[0].length<=3?radiusStepSize/2:0),theta=2*Math.PI/depths[depth].length*index;return 0===depth&&1===depths[0].length&&(radius=1),{x:center.x+radius*Math.cos(theta),y:center.y+radius*Math.sin(theta)}}return{x:center.x+(index+1-(depthSize+1)/2)*distanceX,y:(depth+1)*distanceY}}var epos={x:center.x+(index+1-(depthSize+1)/2)*distanceX,y:(depth+1)*distanceY};return isBottomDepth?epos:epos},pos={},i=depths.length-1;i>=0;i--)for(var depth=depths[i],j=0;j<depth.length;j++){var node=depth[j];pos[node.id()]=getPosition(node,i===depths.length-1)}return nodes.layoutPositions(this,options,function(){return pos[this.id()]}),this},$$("layout","breadthfirst",BreadthFirstLayout)}(cytoscape),function($$){"use strict";function CircleLayout(options){this.options=$$.util.extend({},defaults,options)}var defaults={fit:!0,padding:30,boundingBox:void 0,avoidOverlap:!0,radius:void 0,startAngle:1.5*Math.PI,counterclockwise:!1,sort:void 0,animate:!1,animationDuration:500,ready:void 0,stop:void 0};CircleLayout.prototype.run=function(){var params=this.options,options=params,cy=params.cy,eles=options.eles,nodes=eles.nodes().not(":parent");options.sort&&(nodes=nodes.sort(options.sort));for(var r,bb=$$.util.makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()}),center={x:bb.x1+bb.w/2,y:bb.y1+bb.h/2},theta=options.startAngle,dTheta=2*Math.PI/nodes.length,minDistance=0,i=0;i<nodes.length;i++){var w=nodes[i].outerWidth(),h=nodes[i].outerHeight();minDistance=Math.max(minDistance,w,h)}if(r=$$.is.number(options.radius)?options.radius:nodes.length<=1?0:Math.min(bb.h,bb.w)/2-minDistance,nodes.length>1&&options.avoidOverlap){minDistance*=1.75;var dTheta=2*Math.PI/nodes.length,dcos=Math.cos(dTheta)-Math.cos(0),dsin=Math.sin(dTheta)-Math.sin(0),rMin=Math.sqrt(minDistance*minDistance/(dcos*dcos+dsin*dsin));r=Math.max(rMin,r)}var getPos=function(i,ele){var rx=r*Math.cos(theta),ry=r*Math.sin(theta),pos={x:center.x+rx,y:center.y+ry};return theta=options.counterclockwise?theta-dTheta:theta+dTheta,pos};return nodes.layoutPositions(this,options,getPos),this},$$("layout","circle",CircleLayout)}(cytoscape),function($$){"use strict";function ColaLayout(options){this.options=$$.util.extend(!0,{},defaults,options)}var defaults={animate:!0,refresh:1,maxSimulationTime:4e3,ungrabifyWhileSimulating:!1,fit:!0,padding:30,boundingBox:void 0,ready:function(){},stop:function(){},randomize:!1,avoidOverlap:!0,handleDisconnected:!0,nodeSpacing:function(node){return 10},flow:void 0,alignment:void 0,edgeLength:void 0,edgeSymDiffLength:void 0,edgeJaccardLength:void 0,unconstrIter:void 0,userConstIter:void 0,allConstIter:void 0,infinite:!1};ColaLayout.prototype.run=function(){var layout=this,options=this.options;return layout.manuallyStopped=!1,$$.util.require("cola",function(cola){var cy=options.cy,eles=options.eles,nodes=eles.nodes(),edges=eles.edges(),ready=!1,bb=$$.util.makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()}),getOptVal=function(val,ele){if($$.is.fn(val)){var fn=val;return fn.apply(ele,[ele])}return val},updateNodePositions=function(){for(var x={min:1/0,max:-(1/0)},y={min:1/0,max:-(1/0)},i=0;i<nodes.length;i++){var node=nodes[i],scratch=node._private.scratch.cola;if(x.min=Math.min(x.min,scratch.x||0),x.max=Math.max(x.max,scratch.x||0),y.min=Math.min(y.min,scratch.y||0),y.max=Math.max(y.max,scratch.y||0),!scratch.updatedDims){var nbb=node.boundingBox(),padding=getOptVal(options.nodeSpacing,node);scratch.width=nbb.w+2*padding,scratch.height=nbb.h+2*padding}}nodes.positions(function(i,node){var retPos,scratch=node._private.scratch.cola;return node.grabbed()||node.isParent()||(retPos={x:bb.x1+scratch.x-x.min,y:bb.y1+scratch.y-y.min},$$.is.number(retPos.x)&&$$.is.number(retPos.y)||(retPos=void 0)),retPos}),nodes.updateCompoundBounds(),ready||(onReady(),ready=!0),options.fit&&cy.fit(options.padding)},onDone=function(){options.ungrabifyWhileSimulating&&grabbableNodes.grabify(),nodes.off("grab free position",grabHandler),nodes.off("lock unlock",lockHandler),layout.one("layoutstop",options.stop),layout.trigger({type:"layoutstop",layout:layout})},onReady=function(){layout.one("layoutready",options.ready),layout.trigger({type:"layoutready",layout:layout})},ticksPerFrame=options.refresh,tickSkip=1;options.refresh<0?(tickSkip=Math.abs(options.refresh),ticksPerFrame=1):ticksPerFrame=Math.max(1,ticksPerFrame);var adaptor=layout.adaptor=cola.adaptor({
trigger:function(e){var TICK=cola.EventType?cola.EventType.tick:null,END=cola.EventType?cola.EventType.end:null;switch(e.type){case"tick":case TICK:options.animate&&updateNodePositions();break;case"end":case END:updateNodePositions(),options.infinite||onDone()}},kick:function(){var inftick=function(){if(layout.manuallyStopped)return onDone(),!0;var ret=adaptor.tick();return ret&&options.infinite&&adaptor.resume(),ret},multitick=function(){for(var ret,i=0;ticksPerFrame>i&&!ret;i++)ret=ret||inftick();return ret};if(options.animate){var frame=function(){multitick()||$$.util.requestAnimationFrame(frame)};$$.util.requestAnimationFrame(frame)}else for(;!inftick(););},on:function(type,listener){},drag:function(){}});layout.adaptor=adaptor;var grabbableNodes=nodes.filter(":grabbable");options.ungrabifyWhileSimulating&&grabbableNodes.ungrabify();var grabHandler;nodes.on("grab free position",grabHandler=function(e){var node=this,scrCola=node._private.scratch.cola,pos=node._private.position;switch(node.grabbed()?(scrCola.x=pos.x-bb.x1,scrCola.y=pos.y-bb.y1,adaptor.dragstart(scrCola)):$$.is.number(scrCola.x)&&$$.is.number(scrCola.y)&&(pos.x=scrCola.x+bb.x1,pos.y=scrCola.y+bb.y1),e.type){case"grab":adaptor.dragstart(scrCola),adaptor.resume();break;case"free":adaptor.dragend(scrCola)}});var lockHandler;nodes.on("lock unlock",lockHandler=function(e){var node=this,scrCola=node._private.scratch.cola;node.locked()?adaptor.dragstart(scrCola):adaptor.dragend(scrCola)});var nonparentNodes=nodes.stdFilter(function(node){return!node.isParent()});if(adaptor.nodes(nonparentNodes.map(function(node,i){var padding=getOptVal(options.nodeSpacing,node),pos=node.position(),nbb=node.boundingBox(),struct=node._private.scratch.cola={x:options.randomize||void 0===pos.x?Math.round(Math.random()*bb.w):pos.x,y:options.randomize||void 0===pos.y?Math.round(Math.random()*bb.h):pos.y,width:nbb.w+2*padding,height:nbb.h+2*padding,index:i};return struct})),options.alignment){var offsetsX=[],offsetsY=[];nonparentNodes.forEach(function(node){var align=getOptVal(options.alignment,node),scrCola=node._private.scratch.cola,index=scrCola.index;align&&(null!=align.x&&offsetsX.push({node:index,offset:align.x}),null!=align.y&&offsetsY.push({node:index,offset:align.y}))});var constraints=[];offsetsX.length>0&&constraints.push({type:"alignment",axis:"x",offsets:offsetsX}),offsetsY.length>0&&constraints.push({type:"alignment",axis:"y",offsets:offsetsY}),adaptor.constraints(constraints)}adaptor.groups(nodes.stdFilter(function(node){return node.isParent()}).map(function(node,i){var style=node._private.style,optPadding=getOptVal(options.nodeSpacing,node),pleft=style["padding-left"].pxValue+optPadding,pright=style["padding-right"].pxValue+optPadding,ptop=style["padding-top"].pxValue+optPadding,pbottom=style["padding-bottom"].pxValue+optPadding;return node._private.scratch.cola={index:i,padding:Math.max(pleft,pright,ptop,pbottom),leaves:node.descendants().stdFilter(function(child){return!child.isParent()}).map(function(child){return child[0]._private.scratch.cola.index})},node}).map(function(node){return node._private.scratch.cola.groups=node.descendants().stdFilter(function(child){return child.isParent()}).map(function(child){return child._private.scratch.cola.index}),node._private.scratch.cola}));var length,lengthFnName;null!=options.edgeLength?(length=options.edgeLength,lengthFnName="linkDistance"):null!=options.edgeSymDiffLength?(length=options.edgeSymDiffLength,lengthFnName="symmetricDiffLinkLengths"):null!=options.edgeJaccardLength?(length=options.edgeJaccardLength,lengthFnName="jaccardLinkLengths"):(length=100,lengthFnName="linkDistance");var lengthGetter=function(link){return link.calcLength};if(adaptor.links(edges.stdFilter(function(edge){return!edge.source().isParent()&&!edge.target().isParent()}).map(function(edge,i){var c=edge._private.scratch.cola={source:edge.source()[0]._private.scratch.cola.index,target:edge.target()[0]._private.scratch.cola.index};return null!=length&&(c.calcLength=getOptVal(length,edge)),c})),adaptor.size([bb.w,bb.h]),null!=length&&adaptor[lengthFnName](lengthGetter),options.flow){var flow,defAxis="y",defMinSep=50;$$.is.string(options.flow)?flow={axis:options.flow,minSeparation:defMinSep}:$$.is.number(options.flow)?flow={axis:defAxis,minSeparation:options.flow}:$$.is.plainObject(options.flow)?(flow=options.flow,flow.axis=flow.axis||defAxis,flow.minSeparation=null!=flow.minSeparation?flow.minSeparation:defMinSep):flow={axis:defAxis,minSeparation:defMinSep},adaptor.flowLayout(flow.axis,flow.minSeparation)}layout.trigger({type:"layoutstart",layout:layout}),adaptor.avoidOverlaps(options.avoidOverlap).handleDisconnected(options.handleDisconnected).start(options.unconstrIter,options.userConstIter,options.allConstIter),options.infinite||setTimeout(function(){layout.manuallyStopped||adaptor.stop()},options.maxSimulationTime)}),this},ColaLayout.prototype.stop=function(){return this.adaptor&&(this.manuallyStopped=!0,this.adaptor.stop()),this},$$("layout","cola",ColaLayout)}(cytoscape),function($$){"use strict";function ConcentricLayout(options){this.options=$$.util.extend({},defaults,options)}var defaults={fit:!0,padding:30,startAngle:1.5*Math.PI,counterclockwise:!1,minNodeSpacing:10,boundingBox:void 0,avoidOverlap:!0,height:void 0,width:void 0,concentric:function(node){return node.degree()},levelWidth:function(nodes){return nodes.maxDegree()/4},animate:!1,animationDuration:500,ready:void 0,stop:void 0};ConcentricLayout.prototype.run=function(){for(var params=this.options,options=params,cy=params.cy,eles=options.eles,nodes=eles.nodes().not(":parent"),bb=$$.util.makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()}),center={x:bb.x1+bb.w/2,y:bb.y1+bb.h/2},nodeValues=[],theta=options.startAngle,maxNodeSize=0,i=0;i<nodes.length;i++){var value,node=nodes[i];value=options.concentric.apply(node,[node]),nodeValues.push({value:value,node:node}),node._private.scratch.concentric=value}nodes.updateStyle();for(var i=0;i<nodes.length;i++){var node=nodes[i];maxNodeSize=Math.max(maxNodeSize,node.outerWidth(),node.outerHeight())}nodeValues.sort(function(a,b){return b.value-a.value});for(var levelWidth=options.levelWidth(nodes),levels=[[]],currentLevel=levels[0],i=0;i<nodeValues.length;i++){var val=nodeValues[i];if(currentLevel.length>0){var diff=Math.abs(currentLevel[0].value-val.value);diff>=levelWidth&&(currentLevel=[],levels.push(currentLevel))}currentLevel.push(val)}var pos={},r=0,minDist=maxNodeSize+options.minNodeSpacing;if(!options.avoidOverlap){var firstLvlHasMulti=levels.length>0&&levels[0].length>1,maxR=Math.min(bb.w,bb.h)/2-minDist,rStep=maxR/(levels.length+firstLvlHasMulti?1:0);minDist=Math.min(minDist,rStep)}for(var i=0;i<levels.length;i++){var level=levels[i],dTheta=2*Math.PI/level.length;if(level.length>1&&options.avoidOverlap){var dcos=Math.cos(dTheta)-Math.cos(0),dsin=Math.sin(dTheta)-Math.sin(0),rMin=Math.sqrt(minDist*minDist/(dcos*dcos+dsin*dsin));r=Math.max(rMin,r)}for(var j=0;j<level.length;j++){var val=level[j],theta=options.startAngle+(options.counterclockwise?-1:1)*dTheta*j,p={x:center.x+r*Math.cos(theta),y:center.y+r*Math.sin(theta)};pos[val.node.id()]=p}r+=minDist}return nodes.layoutPositions(this,options,function(){var id=this.id();return pos[id]}),this},$$("layout","concentric",ConcentricLayout)}(cytoscape),function($$){"use strict";function CoseLayout(options){this.options=$$.util.extend({},defaults,options)}var DEBUG,defaults={ready:function(){},stop:function(){},animate:!0,refresh:4,fit:!0,padding:30,boundingBox:void 0,randomize:!0,debug:!1,nodeRepulsion:4e5,nodeOverlap:10,idealEdgeLength:10,edgeElasticity:100,nestingFactor:5,gravity:250,numIter:100,initialTemp:200,coolingFactor:.95,minTemp:1};CoseLayout.prototype.run=function(){var options=this.options,cy=options.cy,layout=this;layout.stopped=!1,layout.trigger({type:"layoutstart",layout:layout}),DEBUG=!0===options.debug?!0:!1;var startTime=new Date,layoutInfo=createLayoutInfo(cy,layout,options);DEBUG&&printLayoutInfo(layoutInfo),!0===options.randomize&&randomizePositions(layoutInfo,cy),updatePositions(layoutInfo,cy,options);var mainLoop=function(i){return layout.stopped?!1:(step(layoutInfo,cy,options,i),layoutInfo.temperature=layoutInfo.temperature*options.coolingFactor,layoutInfo.temperature<options.minTemp?!1:!0)},done=function(){refreshPositions(layoutInfo,cy,options),!0===options.fit&&cy.fit(options.padding);var endTime=new Date;console.info("Layout took "+(endTime-startTime)+" ms"),layout.one("layoutstop",options.stop),layout.trigger({type:"layoutstop",layout:layout})};if(options.animate){var i=0,frame=function(){for(var loopRet,f=0;f<options.refresh&&i<options.numIter;){var loopRet=mainLoop(i);if(loopRet===!1)break;f++,i++}refreshPositions(layoutInfo,cy,options),options.fit&&cy.fit(options.padding),loopRet!==!1&&i+1<options.numIter?$$.util.requestAnimationFrame(frame):done()};$$.util.requestAnimationFrame(frame)}else{for(var i=0;i<options.numIter&&mainLoop(i)!==!1;i++);done()}return this},CoseLayout.prototype.stop=function(){return this.stopped=!0,this};var createLayoutInfo=function(cy,layout,options){for(var edges=options.eles.edges(),nodes=options.eles.nodes(),layoutInfo={layout:layout,layoutNodes:[],idToIndex:{},nodeSize:nodes.size(),graphSet:[],indexToGraph:[],layoutEdges:[],edgeSize:edges.size(),temperature:options.initialTemp,clientWidth:cy.width(),clientHeight:cy.width(),boundingBox:$$.util.makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()})},i=0;i<layoutInfo.nodeSize;i++){var tempNode={};tempNode.id=nodes[i].data("id"),tempNode.parentId=nodes[i].data("parent"),tempNode.children=[],tempNode.positionX=nodes[i].position("x"),tempNode.positionY=nodes[i].position("y"),tempNode.offsetX=0,tempNode.offsetY=0,tempNode.height=nodes[i].height(),tempNode.width=nodes[i].width(),tempNode.maxX=tempNode.positionX+tempNode.width/2,tempNode.minX=tempNode.positionX-tempNode.width/2,tempNode.maxY=tempNode.positionY+tempNode.height/2,tempNode.minY=tempNode.positionY-tempNode.height/2,tempNode.padLeft=nodes[i]._private.style["padding-left"].pxValue,tempNode.padRight=nodes[i]._private.style["padding-right"].pxValue,tempNode.padTop=nodes[i]._private.style["padding-top"].pxValue,tempNode.padBottom=nodes[i]._private.style["padding-bottom"].pxValue,layoutInfo.layoutNodes.push(tempNode),layoutInfo.idToIndex[tempNode.id]=i}for(var queue=[],start=0,end=-1,tempGraph=[],i=0;i<layoutInfo.nodeSize;i++){var n=layoutInfo.layoutNodes[i],p_id=n.parentId;null!=p_id?layoutInfo.layoutNodes[layoutInfo.idToIndex[p_id]].children.push(n.id):(queue[++end]=n.id,tempGraph.push(n.id))}for(layoutInfo.graphSet.push(tempGraph);end>=start;){var node_id=queue[start++],node_ix=layoutInfo.idToIndex[node_id],node=layoutInfo.layoutNodes[node_ix],children=node.children;if(children.length>0){layoutInfo.graphSet.push(children);for(var i=0;i<children.length;i++)queue[++end]=children[i]}}for(var i=0;i<layoutInfo.graphSet.length;i++)for(var graph=layoutInfo.graphSet[i],j=0;j<graph.length;j++){var index=layoutInfo.idToIndex[graph[j]];layoutInfo.indexToGraph[index]=i}for(var i=0;i<layoutInfo.edgeSize;i++){var e=edges[i],tempEdge={};tempEdge.id=e.data("id"),tempEdge.sourceId=e.data("source"),tempEdge.targetId=e.data("target");var idealLength=options.idealEdgeLength,sourceIx=layoutInfo.idToIndex[tempEdge.sourceId],targetIx=layoutInfo.idToIndex[tempEdge.targetId],sourceGraph=layoutInfo.indexToGraph[sourceIx],targetGraph=layoutInfo.indexToGraph[targetIx];if(sourceGraph!=targetGraph){for(var lca=findLCA(tempEdge.sourceId,tempEdge.targetId,layoutInfo),lcaGraph=layoutInfo.graphSet[lca],depth=0,tempNode=layoutInfo.layoutNodes[sourceIx];-1===$.inArray(tempNode.id,lcaGraph);)tempNode=layoutInfo.layoutNodes[layoutInfo.idToIndex[tempNode.parentId]],depth++;for(tempNode=layoutInfo.layoutNodes[targetIx];-1===$.inArray(tempNode.id,lcaGraph);)tempNode=layoutInfo.layoutNodes[layoutInfo.idToIndex[tempNode.parentId]],depth++;idealLength*=depth*options.nestingFactor}tempEdge.idealLength=idealLength,layoutInfo.layoutEdges.push(tempEdge)}return layoutInfo},findLCA=function(node1,node2,layoutInfo){var res=findLCA_aux(node1,node2,0,layoutInfo);return 2>res.count?0:res.graph},findLCA_aux=function(node1,node2,graphIx,layoutInfo){var graph=layoutInfo.graphSet[graphIx];if(-1<$.inArray(node1,graph)&&-1<$.inArray(node2,graph))return{count:2,graph:graphIx};for(var c=0,i=0;i<graph.length;i++){var nodeId=graph[i],nodeIx=layoutInfo.idToIndex[nodeId],children=layoutInfo.layoutNodes[nodeIx].children;if(0!==children.length){var childGraphIx=layoutInfo.indexToGraph[layoutInfo.idToIndex[children[0]]],result=findLCA_aux(node1,node2,childGraphIx,layoutInfo);if(0!==result.count){if(1!==result.count)return result;if(c++,2===c)break}}}return{count:c,graph:graphIx}},printLayoutInfo=function(layoutInfo){if(DEBUG){console.debug("layoutNodes:");for(var i=0;i<layoutInfo.nodeSize;i++){var n=layoutInfo.layoutNodes[i],s="\nindex: "+i+"\nId: "+n.id+"\nChildren: "+n.children.toString()+"\nparentId: "+n.parentId+"\npositionX: "+n.positionX+"\npositionY: "+n.positionY+"\nOffsetX: "+n.offsetX+"\nOffsetY: "+n.offsetY+"\npadLeft: "+n.padLeft+"\npadRight: "+n.padRight+"\npadTop: "+n.padTop+"\npadBottom: "+n.padBottom;console.debug(s)}console.debug("idToIndex");for(var i in layoutInfo.idToIndex)console.debug("Id: "+i+"\nIndex: "+layoutInfo.idToIndex[i]);console.debug("Graph Set");for(var set=layoutInfo.graphSet,i=0;i<set.length;i++)console.debug("Set : "+i+": "+set[i].toString());for(var s="IndexToGraph",i=0;i<layoutInfo.indexToGraph.length;i++)s+="\nIndex : "+i+" Graph: "+layoutInfo.indexToGraph[i];console.debug(s),s="Layout Edges";for(var i=0;i<layoutInfo.layoutEdges.length;i++){var e=layoutInfo.layoutEdges[i];s+="\nEdge Index: "+i+" ID: "+e.id+" SouceID: "+e.sourceId+" TargetId: "+e.targetId+" Ideal Length: "+e.idealLength}console.debug(s),s="nodeSize: "+layoutInfo.nodeSize,s+="\nedgeSize: "+layoutInfo.edgeSize,s+="\ntemperature: "+layoutInfo.temperature,console.debug(s)}},randomizePositions=function(layoutInfo,cy){for(var width=layoutInfo.clientWidth,height=layoutInfo.clientHeight,i=0;i<layoutInfo.nodeSize;i++){var n=layoutInfo.layoutNodes[i];n.positionX=Math.random()*width,n.positionY=Math.random()*height}},refreshPositions=function(layoutInfo,cy,options){var layout=layoutInfo.layout,nodes=options.eles.nodes(),bb=layoutInfo.boundingBox,coseBB={x1:1/0,x2:-(1/0),y1:1/0,y2:-(1/0)};options.boundingBox&&(nodes.forEach(function(node){var lnode=layoutInfo.layoutNodes[layoutInfo.idToIndex[node.data("id")]];coseBB.x1=Math.min(coseBB.x1,lnode.positionX),coseBB.x2=Math.max(coseBB.x2,lnode.positionX),coseBB.y1=Math.min(coseBB.y1,lnode.positionY),coseBB.y2=Math.max(coseBB.y2,lnode.positionY)}),coseBB.w=coseBB.x2-coseBB.x1,coseBB.h=coseBB.y2-coseBB.y1),nodes.positions(function(i,ele){var lnode=layoutInfo.layoutNodes[layoutInfo.idToIndex[ele.data("id")]];if(options.boundingBox){var pctX=(lnode.positionX-coseBB.x1)/coseBB.w,pctY=(lnode.positionY-coseBB.y1)/coseBB.h;return{x:bb.x1+pctX*bb.w,y:bb.y1+pctY*bb.h}}return{x:lnode.positionX,y:lnode.positionY}}),!0!==layoutInfo.ready&&(layoutInfo.ready=!0,layout.one("layoutready",options.ready),layout.trigger({type:"layoutready",layout:this}))},step=function(layoutInfo,cy,options,step){calculateNodeForces(layoutInfo,cy,options),calculateEdgeForces(layoutInfo,cy,options),calculateGravityForces(layoutInfo,cy,options),propagateForces(layoutInfo,cy,options),updatePositions(layoutInfo,cy,options)},calculateNodeForces=function(layoutInfo,cy,options){for(var i=0;i<layoutInfo.graphSet.length;i++)for(var graph=layoutInfo.graphSet[i],numNodes=graph.length,j=0;numNodes>j;j++)for(var node1=layoutInfo.layoutNodes[layoutInfo.idToIndex[graph[j]]],k=j+1;numNodes>k;k++){var node2=layoutInfo.layoutNodes[layoutInfo.idToIndex[graph[k]]];nodeRepulsion(node1,node2,layoutInfo,cy,options)}},nodeRepulsion=function(node1,node2,layoutInfo,cy,options){var directionX=node2.positionX-node1.positionX,directionY=node2.positionY-node1.positionY;if(0!==directionX||0!==directionY){var overlap=nodesOverlap(node1,node2,directionX,directionY);if(overlap>0)var force=options.nodeOverlap*overlap,distance=Math.sqrt(directionX*directionX+directionY*directionY),forceX=force*directionX/distance,forceY=force*directionY/distance;else var point1=findClippingPoint(node1,directionX,directionY),point2=findClippingPoint(node2,-1*directionX,-1*directionY),distanceX=point2.x-point1.x,distanceY=point2.y-point1.y,distanceSqr=distanceX*distanceX+distanceY*distanceY,distance=Math.sqrt(distanceSqr),force=options.nodeRepulsion/distanceSqr,forceX=force*distanceX/distance,forceY=force*distanceY/distance;node1.offsetX-=forceX,node1.offsetY-=forceY,node2.offsetX+=forceX,node2.offsetY+=forceY}},findClippingPoint=function(node,dX,dY){var X=node.positionX,Y=node.positionY,H=node.height,W=node.width,dirSlope=dY/dX,nodeSlope=H/W,res={};do{if(0===dX&&dY>0){res.x=X,res.y=Y+H/2;break}if(0===dX&&0>dY){res.x=X,res.y=Y+H/2;break}if(dX>0&&dirSlope>=-1*nodeSlope&&nodeSlope>=dirSlope){res.x=X+W/2,res.y=Y+W*dY/2/dX;break}if(0>dX&&dirSlope>=-1*nodeSlope&&nodeSlope>=dirSlope){res.x=X-W/2,res.y=Y-W*dY/2/dX;break}if(dY>0&&(-1*nodeSlope>=dirSlope||dirSlope>=nodeSlope)){res.x=X+H*dX/2/dY,res.y=Y+H/2;break}if(0>dY&&(-1*nodeSlope>=dirSlope||dirSlope>=nodeSlope)){res.x=X-H*dX/2/dY,res.y=Y-H/2;break}}while(!1);return res},nodesOverlap=function(node1,node2,dX,dY){if(dX>0)var overlapX=node1.maxX-node2.minX;else var overlapX=node2.maxX-node1.minX;if(dY>0)var overlapY=node1.maxY-node2.minY;else var overlapY=node2.maxY-node1.minY;return overlapX>=0&&overlapY>=0?Math.sqrt(overlapX*overlapX+overlapY*overlapY):0},calculateEdgeForces=function(layoutInfo,cy,options){for(var i=0;i<layoutInfo.edgeSize;i++){var edge=layoutInfo.layoutEdges[i],sourceIx=layoutInfo.idToIndex[edge.sourceId],source=layoutInfo.layoutNodes[sourceIx],targetIx=layoutInfo.idToIndex[edge.targetId],target=layoutInfo.layoutNodes[targetIx],directionX=target.positionX-source.positionX,directionY=target.positionY-source.positionY;if(0===directionX&&0===directionY)return;var point1=findClippingPoint(source,directionX,directionY),point2=findClippingPoint(target,-1*directionX,-1*directionY),lx=point2.x-point1.x,ly=point2.y-point1.y,l=Math.sqrt(lx*lx+ly*ly),force=Math.pow(edge.idealLength-l,2)/options.edgeElasticity;if(0!==l)var forceX=force*lx/l,forceY=force*ly/l;else var forceX=0,forceY=0;source.offsetX+=forceX,source.offsetY+=forceY,target.offsetX-=forceX,target.offsetY-=forceY}},calculateGravityForces=function(layoutInfo,cy,options){for(var i=0;i<layoutInfo.graphSet.length;i++){var graph=layoutInfo.graphSet[i],numNodes=graph.length;if(0===i)var centerX=layoutInfo.clientHeight/2,centerY=layoutInfo.clientWidth/2;else var temp=layoutInfo.layoutNodes[layoutInfo.idToIndex[graph[0]]],parent=layoutInfo.layoutNodes[layoutInfo.idToIndex[temp.parentId]],centerX=parent.positionX,centerY=parent.positionY;for(var j=0;numNodes>j;j++){var node=layoutInfo.layoutNodes[layoutInfo.idToIndex[graph[j]]],dx=centerX-node.positionX,dy=centerY-node.positionY,d=Math.sqrt(dx*dx+dy*dy);if(d>1){var fx=options.gravity*dx/d,fy=options.gravity*dy/d;node.offsetX+=fx,node.offsetY+=fy}}}},propagateForces=function(layoutInfo,cy,options){var queue=[],start=0,end=-1;for(queue.push.apply(queue,layoutInfo.graphSet[0]),end+=layoutInfo.graphSet[0].length;end>=start;){var nodeId=queue[start++],nodeIndex=layoutInfo.idToIndex[nodeId],node=layoutInfo.layoutNodes[nodeIndex],children=node.children;if(0<children.length){for(var offX=node.offsetX,offY=node.offsetY,i=0;i<children.length;i++){var childNode=layoutInfo.layoutNodes[layoutInfo.idToIndex[children[i]]];childNode.offsetX+=offX,childNode.offsetY+=offY,queue[++end]=children[i]}node.offsetX=0,node.offsetY=0}}},updatePositions=function(layoutInfo,cy,options){for(var i=0;i<layoutInfo.nodeSize;i++){var n=layoutInfo.layoutNodes[i];0<n.children.length&&(n.maxX=void 0,n.minX=void 0,n.maxY=void 0,n.minY=void 0)}for(var i=0;i<layoutInfo.nodeSize;i++){var n=layoutInfo.layoutNodes[i];if(!(0<n.children.length)){var tempForce=limitForce(n.offsetX,n.offsetY,layoutInfo.temperature);n.positionX+=tempForce.x,n.positionY+=tempForce.y,n.offsetX=0,n.offsetY=0,n.minX=n.positionX-n.width,n.maxX=n.positionX+n.width,n.minY=n.positionY-n.height,n.maxY=n.positionY+n.height,updateAncestryBoundaries(n,layoutInfo)}}for(var i=0;i<layoutInfo.nodeSize;i++){var n=layoutInfo.layoutNodes[i];0<n.children.length&&(n.positionX=(n.maxX+n.minX)/2,n.positionY=(n.maxY+n.minY)/2,n.width=n.maxX-n.minX,n.height=n.maxY-n.minY)}},limitForce=function(forceX,forceY,max){var force=Math.sqrt(forceX*forceX+forceY*forceY);if(force>max)var res={x:max*forceX/force,y:max*forceY/force};else var res={x:forceX,y:forceY};return res},updateAncestryBoundaries=function(node,layoutInfo){var parentId=node.parentId;if(null!=parentId){var p=layoutInfo.layoutNodes[layoutInfo.idToIndex[parentId]],flag=!1;return(null==p.maxX||node.maxX+p.padRight>p.maxX)&&(p.maxX=node.maxX+p.padRight,flag=!0),(null==p.minX||node.minX-p.padLeft<p.minX)&&(p.minX=node.minX-p.padLeft,flag=!0),(null==p.maxY||node.maxY+p.padBottom>p.maxY)&&(p.maxY=node.maxY+p.padBottom,flag=!0),(null==p.minY||node.minY-p.padTop<p.minY)&&(p.minY=node.minY-p.padTop,flag=!0),flag?updateAncestryBoundaries(p,layoutInfo):void 0}};$$("layout","cose",CoseLayout)}(cytoscape),function($$){"use strict";function DagreLayout(options){this.options=$$.util.extend(!0,{},defaults,options)}var defaults={nodeSep:void 0,edgeSep:void 0,rankSep:void 0,rankDir:void 0,minLen:function(edge){return 1},edgeWeight:function(edge){return 1},fit:!0,padding:30,animate:!1,animationDuration:500,boundingBox:void 0,ready:function(){},stop:function(){}};DagreLayout.prototype.run=function(){var options=this.options,layout=this;return $$.util.require("dagre",function(dagre){var cy=options.cy,eles=options.eles,getVal=function(ele,val){return $$.is.fn(val)?val.apply(ele,[ele]):val},bb=$$.util.makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()}),g=new dagre.graphlib.Graph({multigraph:!0,compound:!0}),gObj={},setGObj=function(name,val){null!=val&&(gObj[name]=val)};setGObj("nodesep",options.nodeSep),setGObj("edgesep",options.edgeSep),setGObj("ranksep",options.rankSep),setGObj("rankdir",options.rankDir),g.setGraph(gObj),g.setDefaultEdgeLabel(function(){return{}}),g.setDefaultNodeLabel(function(){return{}});for(var nodes=eles.nodes(),i=0;i<nodes.length;i++){var node=nodes[i];g.setNode(node.id(),{width:node.width(),height:node.height(),name:node.id()})}for(var i=0;i<nodes.length;i++){var node=nodes[i];node.isChild()&&g.setParent(node.id(),node.parent().id())}for(var edges=eles.edges().stdFilter(function(edge){return!edge.source().isParent()&&!edge.target().isParent()}),i=0;i<edges.length;i++){var edge=edges[i];g.setEdge(edge.source().id(),edge.target().id(),{minlen:getVal(edge,options.minLen),weight:getVal(edge,options.edgeWeight),name:edge.id()},edge.id())}dagre.layout(g);for(var gNodeIds=g.nodes(),i=0;i<gNodeIds.length;i++){var id=gNodeIds[i],n=g.node(id);cy.getElementById(id).scratch().dagre=n}var dagreBB;options.boundingBox?(dagreBB={x1:1/0,x2:-(1/0),y1:1/0,y2:-(1/0)},nodes.forEach(function(node){var dModel=node.scratch().dagre;dagreBB.x1=Math.min(dagreBB.x1,dModel.x),dagreBB.x2=Math.max(dagreBB.x2,dModel.x),dagreBB.y1=Math.min(dagreBB.y1,dModel.y),dagreBB.y2=Math.max(dagreBB.y2,dModel.y)}),dagreBB.w=dagreBB.x2-dagreBB.x1,dagreBB.h=dagreBB.y2-dagreBB.y1):dagreBB=bb;var constrainPos=function(p){if(options.boundingBox){var xPct=(p.x-dagreBB.x1)/dagreBB.w,yPct=(p.y-dagreBB.y1)/dagreBB.h;return{x:bb.x1+xPct*bb.w,y:bb.y1+yPct*bb.h}}return p};nodes.layoutPositions(layout,options,function(){var dModel=this.scratch().dagre;return constrainPos({x:dModel.x,y:dModel.y})})}),this},$$("layout","dagre",DagreLayout)}(cytoscape),function($$){"use strict";function GridLayout(options){this.options=$$.util.extend({},defaults,options)}var defaults={fit:!0,padding:30,boundingBox:void 0,avoidOverlap:!0,rows:void 0,columns:void 0,position:function(node){},sort:void 0,animate:!1,animationDuration:500,ready:void 0,stop:void 0};GridLayout.prototype.run=function(){var params=this.options,options=params,cy=params.cy,eles=options.eles,nodes=eles.nodes().not(":parent");options.sort&&(nodes=nodes.sort(options.sort));var bb=$$.util.makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()});if(0===bb.h||0===bb.w)nodes.layoutPositions(this,options,function(){return{x:bb.x1,y:bb.y1}});else{var cells=nodes.size(),splits=Math.sqrt(cells*bb.h/bb.w),rows=Math.round(splits),cols=Math.round(bb.w/bb.h*splits),small=function(val){if(null==val)return Math.min(rows,cols);var min=Math.min(rows,cols);min==rows?rows=val:cols=val},large=function(val){if(null==val)return Math.max(rows,cols);var max=Math.max(rows,cols);max==rows?rows=val:cols=val};if(null!=options.rows&&null!=options.columns)rows=options.rows,cols=options.columns;else if(null!=options.rows&&null==options.columns)rows=options.rows,cols=Math.ceil(cells/rows);else if(null==options.rows&&null!=options.columns)cols=options.columns,rows=Math.ceil(cells/cols);else if(cols*rows>cells){var sm=small(),lg=large();(sm-1)*lg>=cells?small(sm-1):(lg-1)*sm>=cells&&large(lg-1)}else for(;cells>cols*rows;){var sm=small(),lg=large();(lg+1)*sm>=cells?large(lg+1):small(sm+1)}var cellWidth=bb.w/cols,cellHeight=bb.h/rows;if(options.avoidOverlap)for(var i=0;i<nodes.length;i++){var node=nodes[i],w=node.outerWidth(),h=node.outerHeight();cellWidth=Math.max(cellWidth,w),cellHeight=Math.max(cellHeight,h)}for(var cellUsed={},used=function(row,col){return cellUsed["c-"+row+"-"+col]?!0:!1},use=function(row,col){cellUsed["c-"+row+"-"+col]=!0},row=0,col=0,moveToNextCell=function(){col++,col>=cols&&(col=0,row++)},id2manPos={},i=0;i<nodes.length;i++){var node=nodes[i],rcPos=options.position(node);if(rcPos&&(void 0!==rcPos.row||void 0!==rcPos.col)){var pos={row:rcPos.row,col:rcPos.col};if(void 0===pos.col)for(pos.col=0;used(pos.row,pos.col);)pos.col++;else if(void 0===pos.row)for(pos.row=0;used(pos.row,pos.col);)pos.row++;id2manPos[node.id()]=pos,use(pos.row,pos.col)}}var getPos=function(i,element){var x,y;if(element.locked()||element.isFullAutoParent())return!1;var rcPos=id2manPos[element.id()];if(rcPos)x=rcPos.col*cellWidth+cellWidth/2+bb.x1,y=rcPos.row*cellHeight+cellHeight/2+bb.y1;else{for(;used(row,col);)moveToNextCell();x=col*cellWidth+cellWidth/2+bb.x1,y=row*cellHeight+cellHeight/2+bb.y1,use(row,col),moveToNextCell()}return{x:x,y:y}};nodes.layoutPositions(this,options,getPos)}return this},$$("layout","grid",GridLayout)}(cytoscape),function($$){"use strict";function NullLayout(options){this.options=$$.util.extend(!0,{},defaults,options)}var defaults={ready:function(){},stop:function(){}};NullLayout.prototype.run=function(){{var options=this.options,eles=options.eles,layout=this;options.cy}return layout.trigger("layoutstart"),eles.nodes().positions(function(){return{x:0,y:0}}),layout.one("layoutready",options.ready),layout.trigger("layoutready"),layout.one("layoutstop",options.stop),layout.trigger("layoutstop"),this},NullLayout.prototype.stop=function(){return this},$$("layout","null",NullLayout)}(cytoscape),function($$){"use strict";function PresetLayout(options){this.options=$$.util.extend(!0,{},defaults,options)}var defaults={positions:void 0,zoom:void 0,pan:void 0,fit:!0,padding:30,animate:!1,animationDuration:500,ready:void 0,stop:void 0};PresetLayout.prototype.run=function(){function getPosition(node){if(null==options.positions)return null;if(posIsFn)return options.positions.apply(node,[node]);var pos=options.positions[node._private.data.id];return null==pos?null:pos}var options=this.options,eles=options.eles,nodes=eles.nodes(),posIsFn=$$.is.fn(options.positions);return nodes.layoutPositions(this,options,function(i,node){var position=getPosition(node);return node.locked()||null==position?!1:position}),this},$$("layout","preset",PresetLayout)}(cytoscape),function($$){"use strict";function RandomLayout(options){this.options=$$.util.extend(!0,{},defaults,options)}var defaults={fit:!0,padding:30,boundingBox:void 0,animate:!1,animationDuration:500,ready:void 0,stop:void 0};RandomLayout.prototype.run=function(){var options=this.options,cy=options.cy,eles=options.eles,nodes=eles.nodes().not(":parent"),bb=$$.util.makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()}),getPos=function(i,node){return{x:bb.x1+Math.round(Math.random()*bb.w),y:bb.y1+Math.round(Math.random()*bb.h)}};return nodes.layoutPositions(this,options,getPos),this},$$("layout","random",RandomLayout)}(cytoscape),function($$){"use strict";function SpreadLayout(options){this.options=$$.util.extend({},defaults,options)}function cellCentroid(cell){for(var p1,p2,f,hes=cell.halfedges,area=0,x=0,y=0,i=0;i<hes.length;++i)p1=hes[i].getEndpoint(),p2=hes[i].getStartpoint(),area+=p1.x*p2.y,area-=p1.y*p2.x,f=p1.x*p2.y-p2.x*p1.y,x+=(p1.x+p2.x)*f,y+=(p1.y+p2.y)*f;return area/=2,f=6*area,{x:x/f,y:y/f}}function sitesDistance(ls,rs){var dx=ls.x-rs.x,dy=ls.y-rs.y;return Math.sqrt(dx*dx+dy*dy)}var defaults={animate:!0,ready:void 0,stop:void 0,fit:!0,minDist:20,padding:20,expandingFactor:-1,maxFruchtermanReingoldIterations:50,maxExpandIterations:4,boundingBox:void 0};SpreadLayout.prototype.run=function(){var layout=this,options=this.options;return $$.util.requires(["foograph","Voronoi"],function(foograph,Voronoi){function setPositions(pData){for(var dataVertices=pData.vertices,vertices=[],i=0;i<dataVertices.length;++i){var dv=dataVertices[i];vertices[dv.id]={x:dv.x,y:dv.y}}nodes.positions(function(i,node){var id=node._private.data.id,vertex=vertices[id];return{x:Math.round(simBB.x1+vertex.x),y:Math.round(simBB.y1+vertex.y)}}),options.fit&&cy.fit(options.padding),cy.nodes().rtrigger("position")}var cy=options.cy,nodes=cy.nodes(),edges=cy.edges(),cWidth=cy.width(),cHeight=cy.height(),simulationBounds=options.boundingBox?$$.util.makeBoundingBox(options.boundingBox):null,padding=options.padding,simBBFactor=Math.max(1,.8*Math.log(nodes.length));nodes.length<100&&(simBBFactor/=2),layout.trigger({type:"layoutstart",layout:layout});var simBB={x1:0,y1:0,x2:cWidth*simBBFactor,y2:cHeight*simBBFactor};simulationBounds&&(simBB.x1=simulationBounds.x1,simBB.y1=simulationBounds.y1,simBB.x2=simulationBounds.x2,simBB.y2=simulationBounds.y2),simBB.x1+=padding,simBB.y1+=padding,simBB.x2-=padding,simBB.y2-=padding;var width=simBB.x2-simBB.x1,height=simBB.y2-simBB.y1,startTime=Date.now();if(nodes.size()<=1){nodes.positions({x:Math.round((simBB.x1+simBB.x2)/2),y:Math.round((simBB.y1+simBB.y2)/2)}),options.fit&&cy.fit(options.padding);var endTime=Date.now();return console.info("Layout on "+nodes.size()+" nodes took "+(endTime-startTime)+" ms"),layout.one("layoutready",options.ready),layout.trigger("layoutready"),layout.one("layoutstop",options.stop),void layout.trigger("layoutstop")}var pData={width:width,height:height,minDist:options.minDist,expFact:options.expandingFactor,expIt:0,maxExpIt:options.maxExpandIterations,vertices:[],edges:[],startTime:startTime,maxFruchtermanReingoldIterations:options.maxFruchtermanReingoldIterations};nodes.each(function(i,node){var nodeId=this._private.data.id;pData.vertices.push({id:nodeId,x:0,y:0})}),edges.each(function(){var srcNodeId=this.source().id(),tgtNodeId=this.target().id();pData.edges.push({src:srcNodeId,tgt:tgtNodeId})});var t1=$$.Thread();t1.require(foograph,"foograph"),t1.require(Voronoi),t1.require(sitesDistance),t1.require(cellCentroid);var didLayoutReady=!1;t1.on("message",function(e){var pData=e.message;options.animate&&(setPositions(pData),didLayoutReady||(layout.trigger("layoutready"),didLayoutReady=!0))}),layout.one("layoutready",options.ready),t1.pass(pData).run(function(pData){function checkMinDist(ee){for(var infractions=0,eei=0;eei<ee.length;++eei){var e=ee[eei];null!=e.lSite&&null!=e.rSite&&sitesDistance(e.lSite,e.rSite)<lMinDist&&++infractions}return infractions;

}foograph=eval("foograph"),Voronoi=eval("Voronoi");for(var lWidth=pData.width,lHeight=pData.height,lMinDist=pData.minDist,lExpFact=pData.expFact,lMaxExpIt=pData.maxExpIt,lMaxFruchtermanReingoldIterations=pData.maxFruchtermanReingoldIterations,savePositions=function(){pData.width=lWidth,pData.height=lHeight,pData.expIt=expandIteration,pData.expFact=lExpFact,pData.vertices=[];for(var i=0;i<fv.length;++i)pData.vertices.push({id:fv[i].label,x:fv[i].x,y:fv[i].y})},messagePositions=function(){broadcast(pData)},frg=new foograph.Graph("FRgraph",!1),frgNodes={},dataVertices=pData.vertices,ni=0;ni<dataVertices.length;++ni){var id=dataVertices[ni].id,v=new foograph.Vertex(id,Math.round(Math.random()*lHeight),Math.round(Math.random()*lHeight));frgNodes[id]=v,frg.insertVertex(v)}for(var dataEdges=pData.edges,ei=0;ei<dataEdges.length;++ei){var srcNodeId=dataEdges[ei].src,tgtNodeId=dataEdges[ei].tgt;frg.insertEdge("",1,frgNodes[srcNodeId],frgNodes[tgtNodeId])}var fv=frg.vertices,iterations=lMaxFruchtermanReingoldIterations,frLayoutManager=new foograph.ForceDirectedVertexLayout(lWidth,lHeight,iterations,!1,lMinDist);frLayoutManager.callback=function(){savePositions(),messagePositions()},frLayoutManager.layout(frg),savePositions(),messagePositions();for(var voronoi=new Voronoi,bbox={xl:0,xr:lWidth,yt:0,yb:lHeight},vSites=[],i=0;i<fv.length;++i)vSites[fv[i].label]=fv[i];for(var diagram=voronoi.compute(fv,bbox),cells=diagram.cells,i=0;i<cells.length;++i){var cell=cells[i],site=cell.site,centroid=cellCentroid(cell),currv=vSites[site.label];currv.x=centroid.x,currv.y=centroid.y}0>lExpFact&&(lExpFact=Math.max(.05,Math.min(.1,lMinDist/Math.sqrt(lWidth*lHeight/fv.length)*.5)));for(var prevInfractions=checkMinDist(diagram.edges),bStop=0>=prevInfractions,voronoiIteration=0,expandIteration=0;!bStop;){++voronoiIteration;for(var it=0;4>=it;++it){voronoi.recycle(diagram),diagram=voronoi.compute(fv,bbox),cells=diagram.cells;for(var i=0;i<cells.length;++i){var cell=cells[i],site=cell.site,centroid=cellCentroid(cell),currv=vSites[site.label];currv.x=centroid.x,currv.y=centroid.y}}var currInfractions=checkMinDist(diagram.edges);0>=currInfractions?bStop=!0:(currInfractions>=prevInfractions||voronoiIteration>=4)&&(expandIteration>=lMaxExpIt?bStop=!0:(lWidth+=lWidth*lExpFact,lHeight+=lHeight*lExpFact,bbox={xl:0,xr:lWidth,yt:0,yb:lHeight},++expandIteration,voronoiIteration=0)),prevInfractions=currInfractions,savePositions(),messagePositions()}return savePositions(),pData}).then(function(pData){var dataVertices=pData.vertices;setPositions(pData);var startTime=pData.startTime,endTime=new Date;console.info("Layout on "+dataVertices.length+" nodes took "+(endTime-startTime)+" ms"),layout.one("layoutstop",options.stop),options.animate||layout.trigger("layoutready"),layout.trigger("layoutstop"),t1.stop()})}),this},SpreadLayout.prototype.stop=function(){},$$("layout","spread",SpreadLayout)}(cytoscape),function($$){"use strict";function SpringyLayout(options){this.options=$$.util.extend(!0,{},defaults,options)}var defaults={animate:!0,maxSimulationTime:4e3,ungrabifyWhileSimulating:!1,fit:!0,padding:30,boundingBox:void 0,random:!1,infinite:!1,ready:void 0,stop:void 0,stiffness:400,repulsion:400,damping:.5};SpringyLayout.prototype.run=function(){var layout=this,self=this,options=this.options;return $$.util.require("Springy",function(Springy){function setLayoutPositionForElement(element){var fdId=element.scratch("springy").model.id,fdP=fdRenderer.layout.nodePoints[fdId].p,pos=element.position(),positionInFd=null!=pos.x&&null!=pos.y?fromScreen(element.position()):{x:4*Math.random()-2,y:4*Math.random()-2};fdP.x=positionInFd.x,fdP.y=positionInFd.y}function start(){self.stopped=!1,options.ungrabifyWhileSimulating&&grabbableNodes.ungrabify(),fdRenderer.start()}var simUpdatingPos=!1,cy=options.cy;layout.trigger({type:"layoutstart",layout:layout});var eles=options.eles,nodes=eles.nodes().not(":parent"),edges=eles.edges(),bb=$$.util.makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()}),graph=new Springy.Graph;nodes.each(function(i,node){node.scratch("springy",{model:graph.newNode({element:node})})}),edges.each(function(i,edge){var fdSrc=edge.source().scratch("springy").model,fdTgt=edge.target().scratch("springy").model;edge.scratch("springy",{model:graph.newEdge(fdSrc,fdTgt,{element:edge})})});var sim=window.sim=new Springy.Layout.ForceDirected(graph,options.stiffness,options.repulsion,options.damping);options.infinite&&(sim.minEnergyThreshold=-(1/0));var currentBB=sim.getBoundingBox(),toScreen=function(p){currentBB=sim.getBoundingBox();var size=currentBB.topright.subtract(currentBB.bottomleft),sx=p.subtract(currentBB.bottomleft).divide(size.x).x*bb.w+bb.x1,sy=p.subtract(currentBB.bottomleft).divide(size.y).y*bb.h+bb.x1;return new Springy.Vector(sx,sy)},fromScreen=function(s){currentBB=sim.getBoundingBox();var size=currentBB.topright.subtract(currentBB.bottomleft),px=(s.x-bb.x1)/bb.w*size.x+currentBB.bottomleft.x,py=(s.y-bb.y1)/bb.h*size.y+currentBB.bottomleft.y;return new Springy.Vector(px,py)},movedNodes=cy.collection(),numNodes=cy.nodes().size(),drawnNodes=1,fdRenderer=new Springy.Renderer(sim,function(){self.stopped||movedNodes.length>0&&options.animate&&(simUpdatingPos=!0,movedNodes.rtrigger("position"),options.fit&&cy.fit(options.padding),movedNodes=cy.collection(),simUpdatingPos=!1)},function(edge,p1,p2){},function(node,p){if(!self.stopped){var v=toScreen(p),element=node.data.element;element.locked()||element.grabbed()||(element._private.position={x:v.x,y:v.y},movedNodes.merge(element)),drawnNodes==numNodes&&(layout.one("layoutready",options.ready),layout.trigger({type:"layoutready",layout:layout})),drawnNodes++}});nodes.each(function(i,ele){options.random||setLayoutPositionForElement(ele)});var dragHandler;nodes.on("position",dragHandler=function(){simUpdatingPos||setLayoutPositionForElement(this)});var grabbableNodes=nodes.filter(":grabbable");self.stopSystem=function(){self.stopped=!0,graph.filterNodes(function(){return!1}),options.ungrabifyWhileSimulating&&grabbableNodes.grabify(),options.fit&&cy.fit(options.padding),nodes.off("drag position",dragHandler),layout.one("layoutstop",options.stop),layout.trigger({type:"layoutstop",layout:layout}),self.stopSystem=null},start(),options.infinite||setTimeout(function(){self.stop()},options.maxSimulationTime)}),this},SpringyLayout.prototype.stop=function(){return null!=this.stopSystem&&this.stopSystem(),this},$$("layout","springy",SpringyLayout)}(cytoscape),function($$){"use strict";function NullRenderer(options){this.options=options}NullRenderer.prototype.recalculateRenderedStyle=function(){},NullRenderer.prototype.notify=function(){},$$("renderer","null",NullRenderer)}(cytoscape)}).call(this,require("_process"),"/node_modules/cytoscape/dist")},{_process:24,child_process:14,os:22,path:23}],56:[function(require,module,exports){(function(){exports.ACCEPT_HEADER={xml:"application/xml",json:"application/json",tsv:"text/tab-separated-values",tab:"text/tab-separated-values",csv:"text/comma-separated-values",fasta:"text/x-fasta",gff3:"text/x-gff3",bed:"text/x-bed",objects:"application/json;type=objects",jsonobjects:"application/json;type=objects",jsontable:"application/json;type=table",jsonrows:"application/json;type=rows",jsoncount:"application/json;type=count",jsonp:"application/javascript",jsonpobjects:"application/javascript;type=objects",jsonptable:"application/javascript;type=table",jsonprows:"application/javascript;type=rows",jsonpcount:"application/javascript;type=count"}}).call(this)},{}],57:[function(require,module,exports){(function(){var ACCEPT_HEADER,JSONStream,PESKY_COMMA,URL,URLENC,USER_AGENT,VERSION,blocking,defer,error,getMsg,http,invoke,merge,parseOptions,rejectAfter,streaming,utils,_ref;URL=require("url"),JSONStream=require("JSONStream"),http=require("http"),ACCEPT_HEADER=require("./constants").ACCEPT_HEADER,VERSION=require("./version").VERSION,_ref=utils=require("./util"),error=_ref.error,defer=_ref.defer,merge=_ref.merge,invoke=_ref.invoke,USER_AGENT="node-http/imjs-"+VERSION,PESKY_COMMA=/,\s*$/,URLENC="application/x-www-form-urlencoded",exports.supports=function(){return!0},streaming=function(opts,resolve,reject){return function(resp){var errors,results;return null==resp.pipe?reject(new Error("response is not a stream")):(resp.on("error",reject),null!=resp.statusCode&&200!==resp.statusCode?(errors=JSONStream.parse("error"),errors.pause(),resp.pipe(errors),reject([resp.statusCode,errors])):(results=JSONStream.parse("results.*"),results.pause(),resp.pipe(results),resolve(results)))}},getMsg=function(_arg,text,e,code){var type,url;return type=_arg.type,url=_arg.url,"Could not parse response to "+type+" "+url+': "'+text+'" ('+code+": "+e+")"},blocking=function(opts,resolve,reject){return function(resp){var containerBuffer;return containerBuffer="",resp.on("data",function(chunk){return containerBuffer+=chunk}),resp.on("error",reject),resp.on("end",function(){var ct,e,err,f,match,parsed,_ref1;if(ct=resp.headers["content-type"],"application/json"!==ct&&!/json/.test(opts.dataType)&&!/json/.test(opts.data.format))return(match=containerBuffer.match(/\[ERROR\] (\d+)([\s\S]*)/))?reject(new Error(match[2])):(f=200<=(_ref1=resp.statusCode)&&400>_ref1?resolve:reject)(containerBuffer);if(""===containerBuffer&&200===resp.statusCode)return resolve();try{return parsed=JSON.parse(containerBuffer),(err=parsed.error)?reject(new Error(err)):resolve(parsed)}catch(_error){return e=_error,reject(resp.statusCode>=400?new Error(resp.statusCode):new Error(getMsg(opts,containerBuffer,e,resp.statusCode)))}})}},exports.iterReq=function(method,path,format){return function(q,page,cb,eb,onEnd){var attach,promise,readErrors,req,_ref1;return null==page&&(page={}),null==cb&&(cb=function(){}),null==eb&&(eb=function(){}),null==onEnd&&(onEnd=function(){}),utils.isFunction(page)&&(_ref1=[{},page,cb,eb],page=_ref1[0],cb=_ref1[1],eb=_ref1[2],onEnd=_ref1[3]),req=merge({format:format},page,{query:q.toXML()}),attach=function(stream){return stream.on("data",cb),stream.on("error",eb),stream.on("end",onEnd),setTimeout(function(){return null!=stream.resume?stream.resume():void 0},3),stream},readErrors=function(_arg){var errors,sc;return sc=_arg[0],errors=_arg[1],errors.on("data",eb),errors.on("error",eb),errors.on("end",onEnd),null!=errors.resume&&errors.resume(),error(sc)},promise=this.makeRequest(method,path,req,null,!0),promise.then(attach,readErrors),promise}},rejectAfter=function(timeout,reject,promise){var to;return to=setTimeout(function(){return reject("Request timed out.")},timeout),promise.then(function(){return cancelTimeout(to)})},parseOptions=function(opts){var k,parsed,postdata,sep,v,_ref1,_ref2,_ref3;if(!opts.url)throw new Error("No url provided in "+JSON.stringify(opts));if("string"==typeof opts.data){if(postdata=opts.data,"GET"===(_ref1=opts.type)||"DELETE"===_ref1)throw new Error("Invalid request. "+opts.type+" requests must not have bodies")}else postdata=utils.querystring(opts.data);if(parsed=URL.parse(opts.url,!0),parsed.withCredentials=!1,parsed.method=opts.type||"GET",null!=opts.port&&(parsed.port=opts.port),parsed.headers={"User-Agent":USER_AGENT,Accept:ACCEPT_HEADER[opts.dataType]},("GET"===(_ref2=parsed.method)||"DELETE"===_ref2)&&(null!=postdata?postdata.length:void 0)?(sep=/\?/.test(parsed.path)?"&":"?",parsed.path+=sep+postdata,postdata=null):(parsed.headers["Content-Type"]=(opts.contentType||URLENC)+"; charset=UTF-8",parsed.headers["Content-Length"]=postdata.length),null!=opts.headers){_ref3=opts.headers;for(k in _ref3)v=_ref3[k],parsed.headers[k]=v}return null!=opts.auth&&(parsed.auth=opts.auth),[parsed,postdata]},exports.doReq=function(opts,iter){var e,handler,postdata,promise,reject,req,resolve,timeout,url,_ref1,_ref2;_ref1=defer(),promise=_ref1.promise,resolve=_ref1.resolve,reject=_ref1.reject,promise.then(null,opts.error);try{_ref2=parseOptions(opts),url=_ref2[0],postdata=_ref2[1],handler=(iter?streaming:blocking)(opts,resolve,reject),req=http.request(url,handler),req.on("error",function(err){return reject(new Error("Error: "+url.method+" "+opts.url+": "+err))}),null!=postdata&&req.write(postdata),req.end(),timeout=opts.timeout,timeout>0&&rejectAfter(timeout,reject,promise)}catch(_error){e=_error,reject(e)}return promise}}).call(this)},{"./constants":56,"./util":68,"./version":69,JSONStream:71,http:43,url:53}],58:[function(require,module,exports){(function(){var CategoryResults,IDResolutionJob,IdResults,ONE_MINUTE,concatMap,defer,difference,fold,funcutils,get,id,intermine,uniqBy,withCB,__hasProp={}.hasOwnProperty,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1},__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};funcutils=require("./util"),intermine=exports,uniqBy=funcutils.uniqBy,difference=funcutils.difference,defer=funcutils.defer,withCB=funcutils.withCB,id=funcutils.id,get=funcutils.get,fold=funcutils.fold,concatMap=funcutils.concatMap,ONE_MINUTE=6e4,CategoryResults=function(){function CategoryResults(results){var k,v;for(k in results)__hasProp.call(results,k)&&(v=results[k],this[k]=v)}var getIssueMatches;return CategoryResults.prototype.getStats=function(type){return null!=type?this.stats[type]:this.stats},getIssueMatches=concatMap(get("matches")),CategoryResults.prototype.getMatches=function(k){var _ref;return"MATCH"===k?this.matches[k]:null!=(_ref=getIssueMatches(this.matches[k]))?_ref:[]},CategoryResults.prototype.getMatchIds=function(k){return null!=k?this.getMatches(k).map(get("id")):this.allMatchIds()},CategoryResults.prototype.goodMatchIds=function(){return this.getMatchIds("MATCH")},CategoryResults.prototype.allMatchIds=function(){var combineIds;return(combineIds=fold(function(_this){return function(res,issueSet){return res.concat(_this.getMatchIds(issueSet))}}(this)))(this.goodMatchIds(),["DUPLICATE","WILDCARD","TYPE_CONVERTED","OTHER"])},CategoryResults}(),IdResults=function(){function IdResults(results){var k,v;for(k in results)__hasProp.call(results,k)&&(v=results[k],this[k]=v)}var flatten,getReasons,isGood,unique;return unique=uniqBy(id),flatten=concatMap(id),getReasons=function(match){var k,vals;return flatten(function(){var _ref,_results;_ref=match.identifiers,_results=[];for(k in _ref)vals=_ref[k],_results.push(vals);return _results}())},isGood=function(match,k){return null==k||__indexOf.call(getReasons(match),k)>=0},IdResults.prototype.getStats=function(type){switch(type){case"objects":return this.getObjectStats();case"identifiers":return this.getIdentifierStats();default:return{objects:this.getObjectStats(),identifiers:this.getIdentifierStats()}}},IdResults.prototype.getIdentifierStats=function(){var all,allIdents,issues,matchIdents,matches,toIdents;return toIdents=function(ms){var ident,match;return unique(flatten(function(){var _i,_len,_results;for(_results=[],_i=0,_len=ms.length;_len>_i;_i++)match=ms[_i],_results.push(function(){var _results1;_results1=[];for(ident in null!=match?match.identifiers:void 0)_results1.push(ident);return _results1}());return _results}()))},matchIdents=toIdents(this.getMatches("MATCH")),allIdents=toIdents(this.getMatches()),matches=matchIdents.length,all=allIdents.length,issues=difference(allIdents,matchIdents).length,{matches:matches,all:all,issues:issues}},IdResults.prototype.getObjectStats=function(){var all,issues,match,matches;return matches=this.goodMatchIds().length,all=this.allMatchIds().length,issues=function(){var _results;_results=[];for(id in this)__hasProp.call(this,id)&&(match=this[id],__indexOf.call(getReasons(match),"MATCH")<0&&_results.push(id));return _results}.call(this).length,{matches:matches,all:all,issues:issues}},IdResults.prototype.getMatches=function(k){var match,_results;_results=[];for(id in this)__hasProp.call(this,id)&&(match=this[id],isGood(match,k)&&_results.push(match));return _results},IdResults.prototype.getMatchIds=function(k){var match,_results;_results=[];for(id in this)__hasProp.call(this,id)&&(match=this[id],isGood(match,k)&&_results.push(id));return _results},IdResults.prototype.goodMatchIds=function(){return this.getMatchIds("MATCH")},IdResults.prototype.allMatchIds=function(){return this.getMatchIds()},IdResults}(),IDResolutionJob=function(){function IDResolutionJob(uid,service){this.uid=uid,this.service=service,this.del=__bind(this.del,this),this.fetchResults=__bind(this.fetchResults,this),this.fetchErrorMessage=__bind(this.fetchErrorMessage,this),this.fetchStatus=__bind(this.fetchStatus,this)}return IDResolutionJob.prototype.fetchStatus=function(cb){return withCB(cb,this.service.get("ids/"+this.uid+"/status").then(get("status")))},IDResolutionJob.prototype.fetchErrorMessage=function(cb){return withCB(cb,this.service.get("ids/"+this.uid+"/status").then(get("message")))},IDResolutionJob.prototype.fetchResults=function(cb){var gettingRes,gettingVer;return gettingRes=this.service.get("ids/"+this.uid+"/result").then(get("results")),gettingVer=this.service.fetchVersion(),gettingVer.then(function(v){return gettingRes.then(function(results){return v>=16?new CategoryResults(results):new IdResults(results)})})},IDResolutionJob.prototype.del=function(cb){return withCB(cb,this.service.makeRequest("DELETE","ids/"+this.uid))},IDResolutionJob.prototype.decay=50,IDResolutionJob.prototype.poll=function(onSuccess,onError,onProgress){var backOff,notify,promise,reject,resolve,resp,_ref;return _ref=defer(),promise=_ref.promise,resolve=_ref.resolve,reject=_ref.reject,promise.then(onSuccess,onError),notify=null!=onProgress?onProgress:function(){},resp=this.fetchStatus(),resp.then(null,reject),backOff=this.decay,this.decay=Math.min(ONE_MINUTE,1.25*backOff),resp.then(function(_this){return function(status){switch(notify(status),status){case"SUCCESS":return _this.fetchResults().then(resolve,reject);case"ERROR":return _this.fetchErrorMessage().then(reject,reject);default:return setTimeout(function(){return _this.poll(resolve,reject,notify)},backOff)}}}(this)),promise},IDResolutionJob}(),IDResolutionJob.prototype.wait=IDResolutionJob.prototype.poll,IDResolutionJob.create=function(service){return function(uid){return new IDResolutionJob(uid,service)}},intermine.IDResolutionJob=IDResolutionJob,intermine.CategoryResults=CategoryResults,intermine.IdResults=IdResults}).call(this)},{"./util":68}],59:[function(require,module,exports){(function(){var INVITES,List,REQUIRES_VERSION,SHARES,TAGS_PATH,dejoin,get,getFolderName,intermine,invoke,isFolder,merge,set,utils,withCB,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};utils=require("./util"),intermine=exports,merge=utils.merge,withCB=utils.withCB,get=utils.get,invoke=utils.invoke,REQUIRES_VERSION=utils.REQUIRES_VERSION,set=utils.set,dejoin=utils.dejoin,TAGS_PATH="list/tags",SHARES="lists/shares",INVITES="lists/invitations",isFolder=function(t){return"__folder__"===t.substr(0,t.indexOf(":"))},getFolderName=function(t){return t.substr(t.indexOf(":")+1)},List=function(){function List(properties,service){var k,v;this.service=service,this._updateTags=__bind(this._updateTags,this),this.hasTag=__bind(this.hasTag,this);for(k in properties)__hasProp.call(properties,k)&&(v=properties[k],this[k]=v);this.dateCreated=null!=this.dateCreated?new Date(this.dateCreated):null,this.folders=this.tags.filter(isFolder).map(getFolderName)}var getTags;return List.prototype.hasTag=function(t){return __indexOf.call(this.tags,t)>=0},List.prototype.query=function(view){return null==view&&(view=["*"]),this.service.query({select:view,from:this.type,where:[[this.type,"IN",this.name]]})},List.prototype.del=function(cb){return this.service.makeRequest("DELETE","lists",{name:this.name},cb)},getTags=function(_arg){var tags;return tags=_arg.tags},List.prototype._updateTags=function(err,tags){return null==err?(this.tags=tags.slice(),this.folders=this.tags.filter(isFolder).map(getFolderName)):void 0},List.prototype.fetchTags=function(cb){return withCB(this._updateTags,cb,this.service.makeRequest("GET","list/tags",{name:this.name}).then(getTags))},List.prototype.addTags=function(tags,cb){var req;return req={name:this.name,tags:tags},withCB(this._updateTags,cb,this.service.makeRequest("POST","list/tags",req).then(getTags))},List.prototype.removeTags=function(tags,cb){var req;return req={name:this.name,tags:tags},withCB(this._updateTags,cb,this.service.makeRequest("DELETE","list/tags",req).then(getTags))},List.prototype.contents=function(cb){return withCB(cb,this.query().then(dejoin).then(invoke("records")))},List.prototype.rename=function(newName,cb){var promise;return promise=this.service.post("lists/rename",{oldname:this.name,newname:newName}).then(get("listName")).then(function(_this){return function(n){return _this.name=n}}(this)).then(this.service.fetchList),withCB(cb,promise)},List.prototype.copy=function(opts,cb){var baseName,name,query,tags,_ref,_ref1,_ref2;return null==opts&&(opts={}),null==cb&&(cb=function(){}),1===arguments.length&&utils.isFunction(opts)&&(_ref=[{},opts],opts=_ref[0],cb=_ref[1]),"string"==typeof opts&&(opts={name:opts}),name=baseName=null!=(_ref1=opts.name)?_ref1:""+this.name+"_copy",tags=this.tags.concat(null!=(_ref2=opts.tags)?_ref2:[]),query=this.query(["id"]),withCB(cb,this.service.fetchLists().then(invoke("map",get("name"))).then(function(_this){return function(names){var c;for(c=1;__indexOf.call(names,name)>=0;)name=""+baseName+"-"+c++;return query.then(invoke("saveAsList",{name:name,tags:tags,description:_this.description}))}}(this)))},List.prototype.enrichment=function(opts,cb){return this.service.enrichment(merge({list:this.name},opts),cb)},List.prototype.shareWithUser=function(recipient,cb){return withCB(cb,this.service.post(SHARES,{list:this.name,"with":recipient}))},List.prototype.inviteUserToShare=function(recipient,notify,cb){return null==notify&&(notify=!0),null==cb&&(cb=function(){}),withCB(cb,this.service.post(INVITES,{list:this.name,to:recipient,notify:!!notify}))},List}(),intermine.List=List}).call(this)},{"./util":68}],60:[function(require,module,exports){(function(){var JAVA_LANG_OBJ,Model,PathInfo,Table,error,find,flatten,intermine,omap,_ref,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};Table=require("./table").Table,PathInfo=require("./path").PathInfo,_ref=require("./util"),flatten=_ref.flatten,find=_ref.find,error=_ref.error,omap=_ref.omap,intermine=exports,JAVA_LANG_OBJ=new Table({name:"Object",tags:[],displayName:"Object",attributes:{},references:{},collections:{}}),Model=function(){function Model(_arg){var classes,liftToTable;this.name=_arg.name,classes=_arg.classes,this.findCommonType=__bind(this.findCommonType,this),this.findSharedAncestor=__bind(this.findSharedAncestor,this),this.getAncestorsOf=__bind(this.getAncestorsOf,this),this.getSubclassesOf=__bind(this.getSubclassesOf,this),this.getPathInfo=__bind(this.getPathInfo,this),liftToTable=omap(function(_this){return function(k,v){return[k,new Table(v,_this)]}}(this)),this.classes=liftToTable(classes),this.classes["java.lang.Object"]=JAVA_LANG_OBJ}return Model.prototype.getPathInfo=function(path,subcls){return PathInfo.parse(this,path,subcls)},Model.prototype.getSubclassesOf=function(cls){var cd,clazz,ret,_,_ref1,_ref2;if(clazz=cls&&cls.name?cls:this.classes[cls],null==clazz)throw new Error(""+cls+" is not a table");ret=[clazz.name],_ref1=this.classes;for(_ in _ref1)cd=_ref1[_],_ref2=clazz.name,__indexOf.call(cd.parents(),_ref2)>=0&&(ret=ret.concat(this.getSubclassesOf(cd)));return ret},Model.prototype.getAncestorsOf=function(cls){var clazz,parents;if(clazz=cls&&cls.name?cls:this.classes[cls],null==clazz)throw new Error(""+cls+" is not a table");return parents=clazz.parents(),parents.filter(function(_this){return function(p){return _this.classes[p]}}(this)).reduce(function(_this){return function(as,p){return as.concat(_this.getAncestorsOf(p))}}(this),parents)},Model.prototype.findSharedAncestor=function(classA,classB){var a_ancestry,b_ancestry,firstCommon;return null===classB||null===classA?null:classA===classB?classA:(a_ancestry=this.getAncestorsOf(classA),__indexOf.call(a_ancestry,classB)>=0?classB:(b_ancestry=this.getAncestorsOf(classB),__indexOf.call(b_ancestry,classA)>=0?classA:firstCommon=find(a_ancestry,function(a){return __indexOf.call(b_ancestry,a)>=0})))},Model.prototype.findCommonType=function(xs){return null==xs&&(xs=[]),xs.reduce(this.findSharedAncestor)},Model}(),Model.prototype.makePath=Model.prototype.getPathInfo,Model.prototype.findCommonTypeOfMultipleClasses=Model.prototype.findCommonType,Model.load=function(data){var e;try{return new Model(data)}catch(_error){throw e=_error,new Error("Error loading model: "+e)}},Model.INTEGRAL_TYPES=["int","Integer","long","Long"],Model.FRACTIONAL_TYPES=["double","Double","float","Float"],Model.NUMERIC_TYPES=Model.INTEGRAL_TYPES.concat(Model.FRACTIONAL_TYPES),Model.BOOLEAN_TYPES=["boolean","Boolean"],intermine.Model=Model}).call(this)},{"./path":61,"./table":66,"./util":68}],61:[function(require,module,exports){(function(){var NAMES,PARSED,PathInfo,any,concatMap,copy,error,get,intermine,makeKey,set,success,utils,withCB,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__slice=[].slice,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};intermine=exports,utils=require("./util"),withCB=utils.withCB,concatMap=utils.concatMap,get=utils.get,any=utils.any,set=utils.set,copy=utils.copy,success=utils.success,error=utils.error,NAMES={},PARSED={},makeKey=function(model,path,subclasses){var k,v,_ref;return""+(null!=model?model.name:void 0)+"|"+(null!=model&&null!=(_ref=model.service)?_ref.root:void 0)+"|"+path+":"+function(){var _results;_results=[];for(k in subclasses)v=subclasses[k],_results.push(""+k+"="+v);return _results}()},PathInfo=function(){function PathInfo(_arg){var _i,_ref;this.root=_arg.root,this.model=_arg.model,this.descriptors=_arg.descriptors,this.subclasses=_arg.subclasses,this.displayName=_arg.displayName,this.ident=_arg.ident,this.allDescriptors=__bind(this.allDescriptors,this),this.getChildNodes=__bind(this.getChildNodes,this),this.getDisplayName=__bind(this.getDisplayName,this),this.isa=__bind(this.isa,this),this.append=__bind(this.append,this),this.getParent=__bind(this.getParent,this),this.getEndClass=__bind(this.getEndClass,this),this.containsCollection=__bind(this.containsCollection,this),this.isCollection=__bind(this.isCollection,this),this.isReverseReference=__bind(this.isReverseReference,this),this.isReference=__bind(this.isReference,this),this.isClass=__bind(this.isClass,this),this.isAttribute=__bind(this.isAttribute,this),this.isRoot=__bind(this.isRoot,this),_ref=this.descriptors,this.mid=2<=_ref.length?__slice.call(_ref,0,_i=_ref.length-1):(_i=0,[]),this.end=_ref[_i++],null==this.ident&&(this.ident=makeKey(this.model,this,this.subclasses))}return PathInfo.prototype.isRoot=function(){return 0===this.descriptors.length},PathInfo.prototype.isAttribute=function(){return null!=this.end&&!this.isReference()},PathInfo.prototype.isClass=function(){return this.isRoot()||this.isReference()},PathInfo.prototype.isReference=function(){var _ref;return null!=(null!=(_ref=this.end)?_ref.referencedType:void 0)},PathInfo.prototype.isReverseReference=function(){var gp,p,referencedType,reverseReference,_ref;return this.isReference()&&this.mid.length>0?(_ref=this.end,reverseReference=_ref.reverseReference,referencedType=_ref.referencedType,p=this.getParent(),gp=p.getParent(),null!=referencedType&&gp.isa(referencedType)&&p.end.name===reverseReference):!1},PathInfo.prototype.isCollection=function(){var _ref,_ref1;return null!=(_ref=null!=(_ref1=this.end)?_ref1.isCollection:void 0)?_ref:!1},PathInfo.prototype.containsCollection=function(){return any(this.descriptors,function(x){return x.isCollection})},PathInfo.prototype.getEndClass=function(){var _ref;return this.model.classes[this.subclasses[this.toString()]||(null!=(_ref=this.end)?_ref.referencedType:void 0)]||this.root},PathInfo.prototype.getParent=function(){var data;if(this.isRoot())throw new Error("Root paths do not have parents");return data={root:this.root,model:this.model,descriptors:this.mid.slice(),subclasses:this.subclasses},new PathInfo(data)},PathInfo.prototype.append=function(attr){var data,fld;if(this.isAttribute())throw new Error(""+this+" is an attribute.");if(fld="string"==typeof attr?this.getType().fields[attr]:attr,null==fld)throw new Error(""+attr+" is not a field of "+this.getType());return data={root:this.root,model:this.model,descriptors:this.descriptors.concat([fld]),subclasses:this.subclasses},new PathInfo(data)},PathInfo.prototype.isa=function(clazz){var name,type;return null==clazz?!1:this.isAttribute()?this.getType()===clazz:(name=clazz.name?clazz.name:""+clazz,type=this.getType(),name===type.name||__indexOf.call(this.model.getAncestorsOf(type),name)>=0)},PathInfo.prototype.getDisplayName=function(cb){var cached,custom,params,path;return(custom=this.displayName)?success(custom):(null==this.namePromise&&(this.namePromise=(cached=NAMES[this.ident])?success(cached):this.isRoot()&&this.root.displayName?success(this.root.displayName):null==this.model.service?error("No service"):(path="model"+concatMap(function(d){return"/"+d.name})(this.allDescriptors()),params=set({format:"json"})(copy(this.subclasses)),this.model.service.get(path,params).then(get("display")).then(function(_this){return function(n){var _name;return null!=NAMES[_name=_this.ident]?NAMES[_name]:NAMES[_name]=n}}(this)))),withCB(cb,this.namePromise))},PathInfo.prototype.getChildNodes=function(){var fld,name,_ref,_ref1,_results;_ref1=(null!=(_ref=this.getEndClass())?_ref.fields:void 0)||{},_results=[];for(name in _ref1)fld=_ref1[name],_results.push(this.append(fld));return _results},PathInfo.prototype.allDescriptors=function(){return[this.root].concat(this.descriptors)},PathInfo.prototype.toString=function(){return this.allDescriptors().map(get("name")).join(".")},PathInfo.prototype.equals=function(other){return this===other||this.ident&&(null!=other?other.ident:void 0)===this.ident},PathInfo.prototype.getType=function(){var _ref,_ref1;return(null!=(_ref=this.end)&&null!=(_ref1=_ref.type)?_ref1.replace(/java\.lang\./,""):void 0)||this.getEndClass()},PathInfo}(),PathInfo.prototype.toPathString=PathInfo.prototype.toString,PathInfo.parse=function(model,path,subclasses){var cached,cd,descriptors,fld,ident,keyPath,part,parts,root;return null==subclasses&&(subclasses={}),ident=makeKey(model,path,subclasses),(cached=PARSED[ident])?cached:(parts=(path+"").split("."),root=cd=model.classes[parts.shift()],keyPath=root.name,descriptors=function(){var _i,_len,_ref,_results;for(_results=[],_i=0,_len=parts.length;_len>_i;_i++){if(part=parts[_i],fld=(null!=cd?cd.fields[part]:void 0)||(null!=(_ref=cd=model.classes[subclasses[keyPath]])?_ref.fields[part]:void 0),!fld)throw new Error("Could not find "+part+" in "+cd+" when parsing "+path);keyPath+="."+part,cd=model.classes[fld.type||fld.referencedType],_results.push(fld)}return _results}(),PARSED[ident]=new PathInfo({root:root,model:model,descriptors:descriptors,subclasses:subclasses,ident:ident}))},PathInfo.flushCache=function(){return PARSED={},NAMES={}},intermine.PathInfo=PathInfo}).call(this)},{"./util":68}],62:[function(require,module,exports){(function(){var Promise;Promise=require("es6-promise").Promise,module.exports=Promise}).call(this)},{"es6-promise":76}],63:[function(require,module,exports){(function(){var BASIC_ATTRS,CODES,Events,LIST_PIPE,Query,REQUIRES_VERSION,RESULTS_METHODS,SIMPLE_ATTRS,bioUriArgs,conAttrs,conStr,conToJSON,conValStr,concatMap,copyCon,decapitate,didntRemove,f,filter,fold,get,get_canonical_op,headLess,id,idConStr,intermine,interpretConArray,interpretConstraint,invoke,merge,mth,multiConStr,noUndefVals,noValueConStr,partition,removeIrrelevantSortOrders,simpleConStr,stringToSortOrder,stringifySortOrder,toQueryString,typeConStr,union,utils,withCB,_fn,_get_data_fetcher,_i,_j,_len,_len1,_ref,__indexOf=[].indexOf||function(item){
for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1},__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__slice=[].slice,__hasProp={}.hasOwnProperty;Events=require("backbone-events-standalone"),intermine=exports,intermine.xml=require("./xml"),utils=require("./util"),REQUIRES_VERSION=utils.REQUIRES_VERSION,withCB=utils.withCB,merge=utils.merge,filter=utils.filter,partition=utils.partition,fold=utils.fold,concatMap=utils.concatMap,id=utils.id,get=utils.get,invoke=utils.invoke,toQueryString=utils.querystring,get_canonical_op=function(orig){var canonical;if(canonical=null!=(null!=orig?orig.toLowerCase:void 0)?Query.OP_DICT[orig.toLowerCase()]:null,!canonical)throw new Error("Illegal constraint operator: "+orig);return canonical},BASIC_ATTRS=["path","op","code"],SIMPLE_ATTRS=BASIC_ATTRS.concat(["value","extraValue"]),RESULTS_METHODS=["rowByRow","eachRow","recordByRecord","eachRecord","records","rows","table","tableRows","values"],LIST_PIPE=function(service){return utils.compose(service.fetchList,get("listName"))},CODES=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],decapitate=function(x){return null==x&&(x=""),x.substr(x.indexOf("."))},conValStr=function(v){return null!=v?"<value>"+utils.escape(v)+"</value>":"<nullValue/>"},conAttrs=function(c,names){var k,v;return function(){var _results;_results=[];for(k in c)v=c[k],__indexOf.call(names,k)>=0&&_results.push(""+k+'="'+utils.escape(v)+'" ');return _results}().join("")},noValueConStr=function(c){return"<constraint "+conAttrs(c,BASIC_ATTRS)+"/>"},typeConStr=function(c){return"<constraint "+conAttrs(c,["path","type"])+"/>"},simpleConStr=function(c){return"<constraint "+conAttrs(c,SIMPLE_ATTRS)+"/>"},multiConStr=function(c){return"<constraint "+conAttrs(c,BASIC_ATTRS)+">"+concatMap(conValStr)(c.values)+"</constraint>"},idConStr=function(c){return"<constraint "+conAttrs(c,BASIC_ATTRS)+'ids="'+c.ids.join(",")+'"/>'},conStr=function(c){var _ref;return null!=c.values?multiConStr(c):null!=c.ids?idConStr(c):null==c.op?typeConStr(c):(_ref=c.op,__indexOf.call(Query.NULL_OPS,_ref)>=0?noValueConStr(c):simpleConStr(c))},headLess=function(path){return path.replace(/^[^\.]+\./,"")},copyCon=function(con){var code,editable,extraValue,ids,op,path,switchable,switched,type,value,values;return path=con.path,type=con.type,op=con.op,value=con.value,values=con.values,extraValue=con.extraValue,ids=con.ids,code=con.code,editable=con.editable,switched=con.switched,switchable=con.switchable,ids=null!=ids?ids.slice():void 0,values=null!=values?values.slice():void 0,noUndefVals({path:path,type:type,op:op,value:value,values:values,extraValue:extraValue,ids:ids,code:code,editable:editable,switched:switched,switchable:switchable})},conToJSON=function(con){var copy;return copy=copyCon(con),copy.path=headLess(copy.path),copy},noUndefVals=function(x){var k,v;for(k in x)v=x[k],null==v&&delete x[k];return x},didntRemove=function(orig,reduced){return"Did not remove a single constraint. original = "+orig+", reduced = "+reduced},interpretConstraint=function(path,con){var constraint,k,keys,v,x,_ref,_ref1;if(constraint={path:path},null===con)constraint.op="IS NULL";else if(utils.isArray(con))constraint.op="ONE OF",constraint.values=con;else if("string"==(_ref=typeof con)||"number"===_ref||"boolean"===_ref)_ref1="function"==typeof con.toUpperCase?con.toUpperCase():void 0,__indexOf.call(Query.NULL_OPS,_ref1)>=0?constraint.op=con:(constraint.op="=",constraint.value=con);else if(keys=function(){var _results;_results=[];for(k in con)x=con[k],_results.push(k);return _results}(),__indexOf.call(keys,"isa")>=0)utils.isArray(con.isa)?(constraint.op=k,constraint.values=con.isa):constraint.type=con.isa;else{__indexOf.call(keys,"extraValue")>=0&&(constraint.extraValue=con.extraValue);for(k in con)v=con[k],"extraValue"!==k&&(constraint.op=k,utils.isArray(v)?constraint.values=v:constraint.value=v)}return constraint},interpretConArray=function(conArgs){var a0,constraint,v,_ref;return conArgs=conArgs.slice(),constraint={path:conArgs.shift()},1===conArgs.length?(a0=conArgs[0],_ref="function"==typeof a0.toUpperCase?a0.toUpperCase():void 0,__indexOf.call(Query.NULL_OPS,_ref)>=0?constraint.op=a0:constraint.type=a0):conArgs.length>=2&&(constraint.op=conArgs[0],v=conArgs[1],utils.isArray(v)?constraint.values=v:constraint.value=v,3===conArgs.length&&(constraint.extraValue=conArgs[2])),constraint},stringifySortOrder=function(sortOrder){var oe;return function(){var _i,_len,_results;for(_results=[],_i=0,_len=sortOrder.length;_len>_i;_i++)oe=sortOrder[_i],_results.push(""+oe.path+" "+oe.direction);return _results}().join(" ")},stringToSortOrder=function(str){var i,parts,pathIndices,x,_i,_len,_results;if(null==str)return[];for(parts=str.split(/\s+/),pathIndices=function(){var _i,_ref,_results;for(_results=[],x=_i=0,_ref=parts.length/2;_ref>=0?_ref>_i:_i>_ref;x=_ref>=0?++_i:--_i)_results.push(2*x);return _results}(),_results=[],_i=0,_len=pathIndices.length;_len>_i;_i++)i=pathIndices[_i],_results.push([parts[i],parts[i+1]]);return _results},removeIrrelevantSortOrders=function(){var oe,oldOrder;return oldOrder=this.sortOrder,this.sortOrder=function(){var _i,_len,_results;for(_results=[],_i=0,_len=oldOrder.length;_len>_i;_i++)oe=oldOrder[_i],this.isRelevant(oe.path)&&_results.push(oe);return _results}.call(this),oldOrder.length!==this.sortOrder.length?this.trigger("change:sortorder change:orderby",this.sortOrder.slice()):void 0},Query=function(){function Query(properties,service,_arg){var model,prop,summaryFields,_i,_len,_ref,_ref1,_ref10,_ref2,_ref3,_ref4,_ref5,_ref6,_ref7,_ref8,_ref9;for(_ref=null!=_arg?_arg:{},model=_ref.model,summaryFields=_ref.summaryFields,this.addConstraint=__bind(this.addConstraint,this),this.expandStar=__bind(this.expandStar,this),this.adjustPath=__bind(this.adjustPath,this),this.select=__bind(this.select,this),null==properties&&(properties={}),this.constraints=[],this.views=[],this.joins={},this.displayNames=utils.copy(null!=(_ref1=null!=(_ref2=properties.displayNames)?_ref2:properties.aliases)?_ref1:{}),_ref3=["name","title","comment","description","type"],_i=0,_len=_ref3.length;_len>_i;_i++)prop=_ref3[_i],null!=properties[prop]&&(this[prop]=properties[prop]);this.service=null!=service?service:{},this.model=null!=(_ref4=null!=model?model:properties.model)?_ref4:{},this.summaryFields=null!=(_ref5=null!=summaryFields?summaryFields:properties.summaryFields)?_ref5:{},this.root=null!=(_ref6=properties.root)?_ref6:properties.from,this.maxRows=null!=(_ref7=null!=(_ref8=properties.size)?_ref8:properties.limit)?_ref7:properties.maxRows,this.start=null!=(_ref9=null!=(_ref10=properties.start)?_ref10:properties.offset)?_ref9:0,this.select(properties.views||properties.view||properties.select||[]),this.addConstraints(properties.constraints||properties.where||[]),this.addJoins(properties.joins||properties.join||[]),this.orderBy(properties.sortOrder||properties.orderBy||[]),null!=properties.constraintLogic&&(this.constraintLogic=properties.constraintLogic),this.on("change:views",removeIrrelevantSortOrders,this)}var addPI,cAttrs,kids,parseSummary,qAttrs,scFold,toAttrPairs,toPathAndType,xmlAttr;return Query.JOIN_STYLES=["INNER","OUTER"],Query.BIO_FORMATS=["gff3","fasta","bed"],Query.NULL_OPS=["IS NULL","IS NOT NULL"],Query.ATTRIBUTE_VALUE_OPS=["=","!=",">",">=","<","<=","CONTAINS","LIKE","NOT LIKE"],Query.MULTIVALUE_OPS=["ONE OF","NONE OF"],Query.RANGE_OPS=["OVERLAPS","DOES NOT OVERLAP","OUTSIDE","WITHIN","CONTAINS","DOES NOT CONTAIN"],Query.TERNARY_OPS=["LOOKUP"],Query.LOOP_OPS=["=","!="],Query.LIST_OPS=["IN","NOT IN"],Query.OP_DICT={"=":"=","==":"==",eq:"=",eqq:"==","!=":"!=",ne:"!=",">":">",gt:">",">=":">=",ge:">=","<":"<",lt:"<","<=":"<=",le:"<=",contains:"CONTAINS",CONTAINS:"CONTAINS","does not contain":"DOES NOT CONTAIN","DOES NOT CONTAIN":"DOES NOT CONTAIN",like:"LIKE",LIKE:"LIKE","not like":"NOT LIKE","NOT LIKE":"NOT LIKE",lookup:"LOOKUP","IS NULL":"IS NULL","is null":"IS NULL","IS NOT NULL":"IS NOT NULL","is not null":"IS NOT NULL","ONE OF":"ONE OF","one of":"ONE OF","NONE OF":"NONE OF","none of":"NONE OF","in":"IN","not in":"NOT IN",IN:"IN","NOT IN":"NOT IN",WITHIN:"WITHIN",within:"WITHIN",OVERLAPS:"OVERLAPS",overlaps:"OVERLAPS","DOES NOT OVERLAP":"DOES NOT OVERLAP","does not overlap":"DOES NOT OVERLAP",OUTSIDE:"OUTSIDE",outside:"OUTSIDE",ISA:"ISA",isa:"ISA"},qAttrs=["name","view","sortOrder","constraintLogic","title","description","comment"],cAttrs=["path","type","op","code","value","ids"],toAttrPairs=function(el,attrs){var x,_i,_len,_results;for(_results=[],_i=0,_len=attrs.length;_len>_i;_i++)x=attrs[_i],el.hasAttribute(x)&&_results.push([x,el.getAttribute(x)]);return _results},kids=function(el,name){var kid,_i,_len,_ref,_results;for(_ref=el.getElementsByTagName(name),_results=[],_i=0,_len=_ref.length;_len>_i;_i++)kid=_ref[_i],_results.push(kid);return _results},xmlAttr=function(name){return function(el){return el.getAttribute(name)}},Query.fromXML=function(xml){var con,dom,j,pathOf,q,query,styleOf;if(dom=intermine.xml.parse(xml),query=kids(dom,"query")[0]||kids(dom,"template")[0],!query)throw new Error("no query in xml");return pathOf=xmlAttr("path"),styleOf=xmlAttr("style"),q=utils.pairsToObj(toAttrPairs(query,qAttrs)),q.view=q.view.split(/\s+/),q.sortOrder=stringToSortOrder(q.sortOrder),q.joins=function(){var _i,_len,_ref,_results;for(_ref=kids(query,"join"),_results=[],_i=0,_len=_ref.length;_len>_i;_i++)j=_ref[_i],"OUTER"===styleOf(j)&&_results.push(pathOf(j));return _results}(),q.constraints=function(){var _i,_len,_ref,_results;for(_ref=kids(query,"constraint"),_results=[],_i=0,_len=_ref.length;_len>_i;_i++)con=_ref[_i],_results.push(function(con){var c,tn,v,values,x;return c=utils.pairsToObj(toAttrPairs(con,cAttrs)),null!=c.ids&&(c.ids=function(){var _j,_len1,_ref1,_results1;for(_ref1=c.ids.split(","),_results1=[],_j=0,_len1=_ref1.length;_len1>_j;_j++)x=_ref1[_j],_results1.push(parseInt(x,10));return _results1}()),values=kids(con,"value"),values.length&&(c.values=function(){var _j,_len1,_results1;for(_results1=[],_j=0,_len1=values.length;_len1>_j;_j++)v=values[_j],_results1.push(function(){var _k,_len2,_ref1,_results2;for(_ref1=v.childNodes,_results2=[],_k=0,_len2=_ref1.length;_len2>_k;_k++)tn=_ref1[_k],_results2.push(tn.data);return _results2}().join(""));return _results1}()),c}(con));return _results}(),q},Query.prototype.constraints=[],Query.prototype.views=[],Query.prototype.joins={},Query.prototype.constraintLogic="",Query.prototype.sortOrder="",Query.prototype.name=null,Query.prototype.title=null,Query.prototype.comment=null,Query.prototype.description=null,Query.prototype.removeFromSelect=function(unwanted){var mapFn,so,uw,v;return null==unwanted&&(unwanted=[]),unwanted=utils.stringList(unwanted),mapFn=utils.compose(this.expandStar,this.adjustPath),unwanted=utils.flatten(function(){var _i,_len,_results;for(_results=[],_i=0,_len=unwanted.length;_len>_i;_i++)uw=unwanted[_i],_results.push(mapFn(uw));return _results}()),this.sortOrder=function(){var _i,_len,_ref,_ref1,_results;for(_ref=this.sortOrder,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)so=_ref[_i],_ref1=so.path,__indexOf.call(unwanted,_ref1)>=0||_results.push(so);return _results}.call(this),this.views=function(){var _i,_len,_ref,_results;for(_ref=this.views,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)v=_ref[_i],__indexOf.call(unwanted,v)>=0||_results.push(v);return _results}.call(this),this.trigger("remove:view",unwanted),this.trigger("change:views",this.views),this.trigger("change",this.views)},Query.prototype.removeConstraint=function(con,silent){var c,iscon,orig,reduced;if(null==silent&&(silent=!1),orig=this.constraints,iscon="string"==typeof con?function(c){return c.code===con}:function(c){var _ref,_ref1;return c.path===con.path&&c.op===con.op&&c.value===con.value&&c.extraValue===con.extraValue&&con.type===c.type&&(null!=(_ref=c.values)?_ref.join("%%"):void 0)===(null!=(_ref1=con.values)?_ref1.join("%%"):void 0)},reduced=function(){var _i,_len,_results;for(_results=[],_i=0,_len=orig.length;_len>_i;_i++)c=orig[_i],iscon(c)||_results.push(c);return _results}(),reduced.length!==orig.length-1)throw new Error(didntRemove(orig,reduced));return this.constraints=reduced,silent?void 0:(this.trigger("change:constraints"),this.trigger("change"),this.trigger("removed:constraint",utils.find(orig,iscon)))},Query.prototype.addToSelect=function(views,opts){var dups,mapFn,p,toAdd,v,x,_ref,_ref1;if(null==views&&(views=[]),null==opts&&(opts={}),views=utils.stringList(views),mapFn=utils.compose(this.expandStar,this.adjustPath),toAdd=utils.flatten(function(){var _i,_len,_results;for(_results=[],_i=0,_len=views.length;_len>_i;_i++)v=views[_i],_results.push(mapFn(v));return _results}()),dups=function(){var _i,_len,_results;for(_results=[],_i=0,_len=toAdd.length;_len>_i;_i++)p=toAdd[_i],__indexOf.call(this.views,p)>=0&&_results.push(p);return _results}.call(this),dups.length)throw new Error(""+dups+" already in the select list");if(dups=function(){var _i,_len,_results;for(_results=[],_i=0,_len=toAdd.length;_len>_i;_i++)p=toAdd[_i],function(){var _j,_len1,_results1;for(_results1=[],_j=0,_len1=toAdd.length;_len1>_j;_j++)x=toAdd[_j],x===p&&_results1.push(x);return _results1}().length>1&&_results.push(p);return _results}(),dups.length)throw new Error(""+dups+" specified multiple times as arguments to addToSelect");return(_ref=this.views).push.apply(_ref,toAdd),opts.silent?opts.events=(null!=(_ref1=opts.events)?_ref1:[]).concat(["change","add:view","change:views"]):(this.trigger("add:view change:views",toAdd),this.trigger("change")),this},Query.prototype.select=function(views,opts){var e,oldViews;oldViews=this.views.slice();try{this.views=[],this.addToSelect(views,opts)}catch(_error){e=_error,this.views=oldViews,utils.error(e)}return this},Query.prototype.adjustPath=function(path){return path=path&&path.name?path.name:""+path,null!=this.root?path.match("^"+this.root)||(path=this.root+"."+path):this.root=path.split(".")[0],path},Query.prototype.getPossiblePaths=function(depth,allowReverseReferences,predicate){var getPaths,key,ret,test,_base;return null==depth&&(depth=3),null==allowReverseReferences&&(allowReverseReferences=!0),null==predicate&&(predicate=null),test="string"==typeof predicate?function(p){return p[predicate]()}:predicate,getPaths=function(_this){return function(root,d){var cd,field,name,others,path,subPaths;return path=_this.getPathInfo(root),!allowReverseReferences&&path.isReverseReference()?[]:path.isAttribute()?[path]:(cd=path.getType(),subPaths=concatMap(function(ref){return getPaths(""+root+"."+ref.name,d-1)}),others=cd&&d>0?subPaths(function(){var _ref,_results;_ref=cd.fields,_results=[];for(name in _ref)field=_ref[name],_results.push(field);return _results}()):[],[path].concat(others))}}(this),key=""+depth+"-"+allowReverseReferences,null==this._possiblePaths&&(this._possiblePaths={}),ret=(null!=(_base=this._possiblePaths)[key]?_base[key]:_base[key]=getPaths(this.root,depth)).slice(),null!=test?ret.filter(test):ret},Query.prototype.getPathInfo=function(path){var adjusted,pi,_ref;return adjusted=this.adjustPath(path),pi=null!=(_ref=this.model)&&"function"==typeof _ref.getPathInfo?_ref.getPathInfo(adjusted,this.getSubclasses()):void 0,pi&&adjusted in this.displayNames&&(pi.displayName=this.displayNames[adjusted]),pi},Query.prototype.makePath=Query.prototype.getPathInfo,toPathAndType=function(c){return[c.path,c.type]},scFold=utils.compose(utils.pairsToObj,utils.map(toPathAndType),filter(get("type"))),Query.prototype.getSubclasses=function(){return scFold(this.constraints)},Query.prototype.getType=function(path){return this.getPathInfo(path).getType()},Query.prototype.getViewNodes=function(){var p,toParentNode;return toParentNode=function(_this){return function(v){return _this.getPathInfo(v).getParent()}}(this),utils.uniqBy(String,function(){var _i,_len,_ref,_results;for(_ref=this.views,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)p=_ref[_i],_results.push(toParentNode(p));return _results}.call(this))},Query.prototype.isInView=function(path){var pi,pstr,_ref;if(pi=this.getPathInfo(path),!pi)throw new Error("Invalid path: "+path);return pi.isAttribute()?(_ref=pi.toString(),__indexOf.call(this.views,_ref)>=0):(pstr=pi.toString(),utils.any(this.getViewNodes(),function(n){return n.toString()===pstr}))},Query.prototype.isConstrained=function(path,includeAttrs){var pi,test;if(null==includeAttrs&&(includeAttrs=!1),pi=this.getPathInfo(path),!pi)throw new Error("Invalid path: "+path);return test=function(c){return null!=c.op&&c.path===pi.toString()},!pi.isAttribute()&&includeAttrs&&(test=function(_this){return function(c){return null!=c.op&&(c.path===pi.toString()||pi.equals(_this.getPathInfo(c.path).getParent()))}}(this)),utils.any(this.constraints,test)},Query.prototype.canHaveMultipleValues=function(path){return this.getPathInfo(path).containsCollection()},Query.prototype.getQueryNodes=function(){var c,constrainedNodes,pi,viewNodes;return viewNodes=this.getViewNodes(),constrainedNodes=function(){var _i,_len,_ref,_results;for(_ref=this.constraints,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)c=_ref[_i],null==c.type&&(pi=this.getPathInfo(c.path),_results.push(pi.isAttribute()?pi.getParent():pi));return _results}.call(this),utils.uniqBy(String,viewNodes.concat(constrainedNodes))},Query.prototype.isInQuery=function(p){var c,pi,pstr,_i,_len,_ref;if(pi=this.getPathInfo(p)){for(pstr=pi.toPathString(),_ref=this.views.concat(function(){var _j,_len,_ref,_results;for(_ref=this.constraints,_results=[],_j=0,_len=_ref.length;_len>_j;_j++)c=_ref[_j],null==c.type&&_results.push(c.path);return _results}.call(this)),_i=0,_len=_ref.length;_len>_i;_i++)if(p=_ref[_i],0===p.indexOf(pstr))return!0;return!1}return!0},Query.prototype.isRelevant=function(path){var nodes,pi,sought;return pi=this.getPathInfo(path),pi.isAttribute()&&(pi=pi.getParent()),sought=pi.toString(),nodes=this.getViewNodes(),utils.any(nodes,function(n){return n.toPathString()===sought})},Query.prototype.expandStar=function(path){var attrViews,cd,expand,fn,n,name,pathStem,starViews;if(/\*$/.test(path))if(pathStem=path.substr(0,path.lastIndexOf(".")),expand=function(x){return pathStem+x},cd=this.getType(pathStem),/\.\*$/.test(path)){if(cd&&this.summaryFields[cd.name])return fn=utils.compose(expand,decapitate),function(){var _i,_len,_ref,_results;for(_ref=this.summaryFields[cd.name],_results=[],_i=0,_len=_ref.length;_len>_i;_i++)n=_ref[_i],this.hasView(n)||_results.push(fn(n));return _results}.call(this)}else if(/\.\*\*$/.test(path))return starViews=this.expandStar(pathStem+".*"),attrViews=function(){var _results;_results=[];for(name in cd.attributes)_results.push(expand("."+name));return _results}(),utils.uniqBy(id,starViews.concat(attrViews));return path},Query.prototype.isOuterJoin=function(p){return"OUTER"===this.joins[this.adjustPath(p)]},Query.prototype.hasView=function(v){var _ref;return this.views&&(_ref=this.adjustPath(v),__indexOf.call(this.views,_ref)>=0)},Query.prototype.count=function(cont){if(this.service.count)return this.service.count(this,cont);throw new Error("This query has no service with count functionality attached.")},Query.prototype.appendToList=function(target,cb){var name,processor,req,toRun,updateTarget;return(null!=target?target.name:void 0)?(name=target.name,updateTarget=function(err,list){return null==err?target.size=list.size:void 0}):(name=String(target),updateTarget=null),toRun=this.makeListQuery(),req={listName:name,query:toRun.toXML()},processor=LIST_PIPE(this.service),withCB(updateTarget,cb,this.service.post("query/append/tolist",req).then(processor))},Query.prototype.selectPreservingImpliedConstraints=function(paths){var n,toRun,_i,_len,_ref;for(null==paths&&(paths=[]),toRun=this.clone(),toRun.select(paths),_ref=this.getViewNodes(),_i=0,_len=_ref.length;_len>_i;_i++)n=_ref[_i],this.isOuterJoined(n)||toRun.isInView(n||toRun.isConstrained(n))||null==n.getEndClass().fields.id||toRun.addConstraint([n.append("id"),"IS NOT NULL"]);return toRun},Query.prototype.makeListQuery=function(){var paths,_ref;return paths=this.views.slice(),1===paths.length&&(null!=(_ref=paths[0])?_ref.match(/\.id$/):void 0)||(paths=["id"]),this.selectPreservingImpliedConstraints(paths)},Query.prototype.saveAsList=function(options,cb){var req,toRun;return toRun=this.makeListQuery(),req=utils.copy(options),req.listName=req.listName||req.name,req.query=toRun.toXML(),options.tags&&(req.tags=options.tags.join(";")),withCB(cb,this.service.post("query/tolist",req).then(LIST_PIPE(this.service)))},Query.prototype.summarise=function(path,limit,cont){return this.filterSummary(path,"",limit,cont)},Query.prototype.summarize=function(){var args;return args=1<=arguments.length?__slice.call(arguments,0):[],this.summarise.apply(this,args)},parseSummary=function(data){var isNumeric,r,stats,_i,_len,_ref,_ref1;for(isNumeric=null!=(null!=(_ref=data.results[0])?_ref.max:void 0),_ref1=data.results,_i=0,_len=_ref1.length;_len>_i;_i++)r=_ref1[_i],r.count=parseInt(r.count,10);return stats={uniqueValues:data.uniqueValues,filteredCount:data.filteredCount},isNumeric&&(stats=merge(stats,data.results[0])),data.stats=stats,data},Query.prototype.filterSummary=function(path,term,limit,cont){var req,toRun,_ref;return null==cont&&(cont=function(){}),utils.isFunction(limit)&&(_ref=[limit,null],cont=_ref[0],limit=_ref[1]),path=this.adjustPath(path),toRun=this.clone(),__indexOf.call(toRun.views,path)<0&&toRun.views.push(path),req={query:toRun.toXML(),summaryPath:path,format:"jsonrows"},limit&&(req.size=limit),term&&(req.filterTerm=term),withCB(cont,this.service.post("query/results",req).then(parseSummary))},Query.prototype.clone=function(cloneEvents){var cloned,k,v,_ref;if(cloned=new Query(this,this.service),null==cloned._callbacks&&(cloned._callbacks={}),cloneEvents){_ref=this._callbacks;for(k in _ref)__hasProp.call(_ref,k)&&(v=_ref[k],cloned._callbacks[k]=v);cloned.off("change:views",removeIrrelevantSortOrders,this)}return cloned},Query.prototype.next=function(){var clone;return clone=this.clone(),this.maxRows&&(clone.start=this.start+this.maxRows),clone},Query.prototype.previous=function(){var clone;return clone=this.clone(),clone.start=this.maxRows?this.start-this.maxRows:0,clone},Query.prototype.getSortDirection=function(sorted){var a,so;if(a=this.adjustPath(sorted),!this.isInQuery(a)&&!this.isRelevant(a))throw new Error(""+sorted+" is not in the query");return so=utils.find(this.sortOrder,function(_arg){var path;return path=_arg.path,a===path}),null!=so?so.direction:void 0},Query.prototype.isOuterJoined=function(path){var dir,jp,_ref;path=this.adjustPath(path),_ref=this.joins;for(jp in _ref)if(dir=_ref[jp],"OUTER"===dir&&0===path.indexOf(jp))return!0;return!1},Query.prototype.getOuterJoin=function(path){var joinPaths,k;return path=this.adjustPath(path),joinPaths=function(){var _results;_results=[];for(k in this.joins)_results.push(k);return _results}.call(this).sort(function(a,b){return b.length-a.length}),utils.find(joinPaths,function(_this){return function(p){return"OUTER"===_this.joins[p]&&0===path.indexOf(p)}}(this))},Query.prototype._parse_sort_order=function(input){var direction,k,path,so,v,_ref;if(null==input)throw new Error("No input");if("string"==typeof input)so={path:input,direction:"ASC"};else if(utils.isArray(input))path=input[0],direction=input[1],so={path:path,direction:direction};else if(null==input.path){for(k in input)v=input[k],_ref=[k,v],path=_ref[0],direction=_ref[1];so={path:path,direction:direction}}else path=input.path,direction=input.direction,so={path:path,direction:direction};return so.path=this.adjustPath(so.path),null==so.direction&&(so.direction="ASC"),so.direction=so.direction.toUpperCase(),so},Query.prototype.addOrSetSortOrder=function(so){var currentDirection,oe;return so=this._parse_sort_order(so),currentDirection=this.getSortDirection(so.path),null==currentDirection?this.addSortOrder(so):currentDirection!==so.direction&&(oe=utils.find(this.sortOrder,function(_arg){var path;return path=_arg.path,path===so.path}),oe.direction=so.direction,this.trigger("change:sortorder",this.sortOrder),this.trigger("change")),this},Query.prototype.addSortOrder=function(so,_arg){var silent;return silent=(null!=_arg?_arg:{}).silent,this.sortOrder.push(this._parse_sort_order(so)),silent?void 0:(this.trigger("add:sortorder",so),this.trigger("change:sortorder",this.sortOrder),this.trigger("change"))},Query.prototype.orderBy=function(oes,opts){var copy,direction,oe,oldSO,path,_i,_len,_ref;for(null==opts&&(opts={}),oldSO=this.sortOrder.slice(),this.sortOrder=[],_i=0,_len=oes.length;_len>_i;_i++)oe=oes[_i],this.addSortOrder(this._parse_sort_order(oe),{silent:!0});return copy=function(){var _j,_len1,_ref,_ref1,_results;for(_ref=this.sortOrder,_results=[],_j=0,_len1=_ref.length;_len1>_j;_j++)_ref1=_ref[_j],path=_ref1.path,direction=_ref1.direction,_results.push({path:path,direction:direction});return _results}.call(this),this.trigger("set:sortorder",copy),stringifySortOrder(oldSO)!==this.getSorting()&&(opts.silent?opts.events=(null!=(_ref=opts.events)?_ref:[]).concat(["change","change:sortorder"]):(this.trigger("change:sortorder",copy),this.trigger("change"))),this},Query.prototype.addJoins=function(joins){var j,k,v,_i,_len,_results,_results1;if(utils.isArray(joins)){for(_results=[],_i=0,_len=joins.length;_len>_i;_i++)j=joins[_i],_results.push(this.addJoin(j));return _results}_results1=[];for(k in joins)v=joins[k],_results1.push(this.addJoin({path:k,style:v}));return _results1},Query.prototype.addJoin=function(join){return"string"==typeof join&&(join={path:join,style:"OUTER"}),this.setJoinStyle(join.path,join.style)},Query.prototype.setJoinStyle=function(path,style){if(null==style&&(style="OUTER"),path=this.adjustPath(path),style=style.toUpperCase(),__indexOf.call(Query.JOIN_STYLES,style)<0)throw new Error("Invalid join style: "+style);return this.joins[path]!==style&&(this.joins[path]=style,this.trigger("change:joins",{path:path,style:style}),this.trigger("change")),this},Query.prototype.addConstraints=function(constraints,conj){var c,con,oldLogic,path,_fn,_i,_len;if(null==conj&&(conj="and"),this.__silent__=!0,oldLogic=this.constraintLogic,utils.isArray(constraints))for(_i=0,_len=constraints.length;_len>_i;_i++)c=constraints[_i],this.addConstraint(c,conj);else{_fn=function(_this){return function(path,con){return _this.addConstraint(interpretConstraint(path,con),conj)}}(this);for(path in constraints)con=constraints[path],_fn(path,con)}return this.__silent__=!1,this.trigger("add:constraint"),this.trigger("change:constraints"),oldLogic!==this.constraintLogic&&this.trigger("change:logic",this.constraintLogic),this.trigger("change")},Query.prototype.addConstraint=function(constraint,conj){var i,logic,needsLogicClause,newConLen,newLogic,oldLogic,_ref;if(null==conj&&(conj="and"),"and"!==conj&&"or"!==conj)throw new Error("Unknown logical conjunction: "+conj);return constraint=utils.isArray(constraint)?interpretConArray(constraint):copyCon(constraint),"OFF"===constraint.switched?this:(constraint.path=this.adjustPath(constraint.path),null==constraint.type&&(constraint.op=get_canonical_op(constraint.op)),this.constraints.push(constraint),needsLogicClause="or"===conj||(null!=(_ref=this.constraintLogic)?_ref.length:void 0)>0,newConLen=this.constraints.length,oldLogic=this.constraintLogic,needsLogicClause&&(newLogic=2===newConLen?""+CODES[0]+" "+conj+" "+CODES[1]:(logic=this.constraintLogic,logic||(logic=function(){var _i,_ref1,_results;for(_results=[],i=_i=0,_ref1=newConLen-2;_ref1>=0?_ref1>=_i:_i>=_ref1;i=_ref1>=0?++_i:--_i)_results.push(CODES[i]);return _results}().join(" and ")),"("+logic+") "+conj+" "+CODES[newConLen-1]),this.constraintLogic=newLogic),this.__silent__||(this.trigger("add:constraint",constraint),this.trigger("change:constraints"),oldLogic!==this.constraintLogic&&this.trigger("change:logic",this.constraintLogic),this.trigger("change")),this)},Query.prototype.getSorting=function(){return stringifySortOrder(this.sortOrder)},Query.prototype.getConstraintXML=function(){var c,toSerialise;return toSerialise=function(){var _i,_len,_ref,_results;for(_ref=this.constraints,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)c=_ref[_i],(null==c.type||this.isInQuery(c.path))&&_results.push(c);return _results}.call(this),toSerialise.length?concatMap(conStr)(concatMap(id)(partition(function(c){return null!=c.type})(toSerialise))):""},Query.prototype.getJoinXML=function(){var p,s,strs;return strs=function(){var _ref,_results;_ref=this.joins,_results=[];for(p in _ref)s=_ref[p],this.isInQuery(p)&&"OUTER"===s&&_results.push('<join path="'+p+'" style="OUTER"/>');return _results}.call(this),strs.join("")},Query.prototype.toXML=function(){var attrs,headAttrs,k,v;return attrs={model:this.model.name,view:this.views.join(" "),sortOrder:this.getSorting(),constraintLogic:this.constraintLogic},null!=this.name&&(attrs.name=this.name),headAttrs=function(){var _results;_results=[];for(k in attrs)v=attrs[k],v&&_results.push(k+'="'+v+'"');return _results}().join(" "),"<query "+headAttrs+" >"+this.getJoinXML()+this.getConstraintXML()+"</query>"},Query.prototype.toJSON=function(){var c,direction,path,style,v;return noUndefVals({name:this.name,title:this.title,comment:this.comment,description:this.description,constraintLogic:this.constraintLogic,from:this.root,select:function(){var _i,_len,_ref,_results;for(_ref=this.views,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)v=_ref[_i],_results.push(headLess(v));return _results}.call(this),orderBy:function(){var _i,_len,_ref,_ref1,_results;for(_ref=this.sortOrder,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)_ref1=_ref[_i],path=_ref1.path,direction=_ref1.direction,_results.push({path:headLess(path),direction:direction});return _results}.call(this),joins:function(){var _ref,_results;_ref=this.joins,_results=[];for(path in _ref)style=_ref[path],"OUTER"===style&&_results.push(headLess(path));return _results}.call(this),where:function(){var _i,_len,_ref,_results;for(_ref=this.constraints,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)c=_ref[_i],_results.push(conToJSON(c));return _results}.call(this)})},Query.prototype.fetchCode=function(lang,cb){var req;return req={query:this.toXML(),lang:lang},withCB(cb,this.service.post("query/code",req).then(this.service.VERIFIER).then(get("code")))},Query.prototype.setName=function(name){this.name=name},Query.prototype.save=function(name,cb){return REQUIRES_VERSION(this.service,16,function(_this){return function(){var req,_ref;return utils.isFunction(name)&&(_ref=[null,name],name=_ref[0],cb=_ref[1]),null!=name&&_this.setName(name),req={type:"PUT",path:"user/queries",data:_this.toXML(),contentType:"application/xml",dataType:"json"},withCB(cb,_this.service.authorise(req)).then(function(authed){return _this.service.doReq(authed)}).then(function(resp){return resp.queries})}}(this))},Query.prototype.store=function(name,cb){return REQUIRES_VERSION(this.service,16,function(_this){return function(){var getName,req,updateName,_ref;return utils.isFunction(name)&&(_ref=[null,name],name=_ref[0],cb=_ref[1]),null!=name&&_this.setName(name),updateName=function(err,name){return null==err?_this.setName(name):void 0},getName=utils.compose(get(_this.name),get("queries")),req={type:"POST",path:"user/queries",data:_this.toXML(),contentType:"application/xml",dataType:"json"},withCB(cb,updateName,_this.service.authorise(req)).then(function(authed){return _this.service.doReq(authed)}).then(getName)}}(this))},Query.prototype.saveAsTemplate=function(name,cb){return REQUIRES_VERSION(this.service,16,function(_this){return function(){var req,_ref;if(utils.isFunction(name)&&(_ref=[null,name],name=_ref[0],cb=_ref[1]),null!=name&&_this.setName(name),!_this.name)throw new Error("Templates must have a name");return req={type:"POST",path:"templates",data:"<template "+conAttrs(_this,["name","title","comment"])+">"+_this.toXML()+"</template>",contentType:"application/xml",dataType:"json"},withCB(cb,_this.service.authorise(req).then(function(authed){
return _this.service.doReq(authed)}))}}(this))},Query.prototype.getCodeURI=function(lang){var req,_ref;return req={query:this.toXML(),lang:lang,format:"text"},null!=(null!=(_ref=this.service)?_ref.token:void 0)&&(req.token=this.service.token),""+this.service.root+"query/code?"+toQueryString(req)},Query.prototype.getExportURI=function(format,options){var req,_ref;return null==format&&(format="tab"),null==options&&(options={}),__indexOf.call(Query.BIO_FORMATS,format)>=0?this["get"+format.toUpperCase()+"URI"](options):(req=merge(options,{query:this.toXML(),format:format}),null!=(null!=(_ref=this.service)?_ref.token:void 0)&&(req.token=this.service.token),""+this.service.root+"query/results?"+toQueryString(req))},Query.prototype.needsAuthentication=function(){return utils.any(this.constraints,function(c){var _ref;return"NOT IN"===(_ref=c.op)||"IN"===_ref})},Query.prototype.fetchQID=function(cb){return withCB(cb,this.service.post("queries",{query:this.toXML()}).then(get("id")))},addPI=function(p){return p.append("primaryIdentifier").toString()},Query.prototype.__bio_req=function(types,n){var isSuitable,toRun;return toRun=this.makeListQuery(),isSuitable=function(p){return utils.any(types,function(t){return p.isa(t)})},toRun.views=utils.take(n)(function(){var _i,_len,_ref,_results;for(_ref=this.getViewNodes(),_results=[],_i=0,_len=_ref.length;_len>_i;_i++)n=_ref[_i],isSuitable(n)&&_results.push(addPI(n));return _results}.call(this)),{query:toRun.toXML(),format:"text"}},Query.prototype._fasta_req=function(){return this.__bio_req(["SequenceFeature","Protein"],1)},Query.prototype._gff3_req=function(){return this.__bio_req(["SequenceFeature"])},Query.prototype._bed_req=Query.prototype._gff3_req,Query}(),union=fold(function(xs,ys){return xs.concat(ys)}),Query.prototype.toString=Query.prototype.toXML,Query.ATTRIBUTE_OPS=union([Query.ATTRIBUTE_VALUE_OPS,Query.MULTIVALUE_OPS,Query.NULL_OPS]),Query.REFERENCE_OPS=union([Query.TERNARY_OPS,Query.LOOP_OPS,Query.LIST_OPS]),bioUriArgs=function(reqMeth,f){return function(opts,cb){var ensureAttr,obj,req,v,_ref;return null==opts&&(opts={}),null==cb&&(cb=function(){}),utils.isFunction(opts)&&(_ref=[{},opts],opts=_ref[0],cb=_ref[1]),ensureAttr=function(_this){return function(p){var path;return path=_this.getPathInfo(p),path.isAttribute()?path:path.append("id")}}(this),null!=(null!=opts?opts.view:void 0)&&(opts.view=function(){var _i,_len,_ref1,_results;for(_ref1=opts.view,_results=[],_i=0,_len=_ref1.length;_len>_i;_i++)v=_ref1[_i],_results.push(this.getPathInfo(v).toString());return _results}.call(this)),obj=null!=opts["export"]?this.selectPreservingImpliedConstraints(opts["export"].map(ensureAttr)):this,req=merge(obj[reqMeth](),opts),f.call(obj,req,cb)}},_ref=Query.BIO_FORMATS,_fn=function(f){var getMeth,reqMeth,uriMeth;return reqMeth="_"+f+"_req",getMeth="get"+f.toUpperCase(),uriMeth=getMeth+"URI",Query.prototype[getMeth]=bioUriArgs(reqMeth,function(req,cb){return withCB(cb,this.service.post("query/results/"+f,req))}),Query.prototype[uriMeth]=bioUriArgs(reqMeth,function(req,cb){return null!=this.service.token&&(req.token=this.service.token),""+this.service.root+"query/results/"+f+"?"+toQueryString(req)})};for(_i=0,_len=_ref.length;_len>_i;_i++)f=_ref[_i],_fn(f);for(_get_data_fetcher=function(server_fn){return function(){var cbs,page,x,_ref1;if(page=arguments[0],cbs=2<=arguments.length?__slice.call(arguments,1):[],this.service[server_fn])return null==page?page={}:utils.isFunction(page)&&(page={},cbs=function(){var _j,_len1,_results;for(_results=[],_j=0,_len1=arguments.length;_len1>_j;_j++)x=arguments[_j],_results.push(x);return _results}.apply(this,arguments)),page=noUndefVals(merge({start:this.start,size:this.maxRows},page)),(_ref1=this.service)[server_fn].apply(_ref1,[this,page].concat(__slice.call(cbs)));throw new Error("Service does not provide '"+server_fn+"'.")}},_j=0,_len1=RESULTS_METHODS.length;_len1>_j;_j++)mth=RESULTS_METHODS[_j],Query.prototype[mth]=_get_data_fetcher(mth);Events.mixin(Query.prototype),Query.prototype.emit=Query.prototype.trigger,Query.prototype.bind=Query.prototype.on,intermine.Query=Query}).call(this)},{"./util":68,"./xml":70,"backbone-events-standalone":75}],64:[function(require,module,exports){(function(){var ALWAYS_AUTH,CLASSKEYS,CLASSKEY_PATH,DEFAULT_ERROR_HANDLER,DEFAULT_PROTOCOL,ENRICHMENT_PATH,HAS_PROTOCOL,HAS_SUFFIX,IDResolutionJob,ID_RESOLUTION_PATH,LISTS_PATH,LIST_OPERATION_PATHS,LIST_PIPE,List,MODELS,MODEL_PATH,Model,NEEDS_AUTH,NO_AUTH,PATH_VALUES_PATH,PREF_PATH,Promise,QUERY_RESULTS_PATH,QUICKSEARCH_PATH,Query,RELEASES,RELEASE_PATH,REQUIRES_VERSION,SUBTRACT_PATH,SUFFIX,SUMMARYFIELDS_PATH,SUMMARY_FIELDS,Service,TABLE_ROW_PATH,TEMPLATES_PATH,TO_NAMES,USER_TOKENS,User,VERSIONS,VERSION_PATH,WHOAMI_PATH,WIDGETS,WIDGETS_PATH,WITH_OBJ_PATH,dejoin,error,get,getListFinder,http,invoke,map,merge,p,set,success,to_query_string,utils,version,withCB,_get_or_fetch,_i,_j,_len,_len1,_ref,_ref1,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__slice=[].slice;for(Promise=require("./promise"),Model=require("./model").Model,Query=require("./query").Query,List=require("./lists").List,User=require("./user").User,IDResolutionJob=require("./id-resolution-job").IDResolutionJob,version=require("./version"),utils=require("./util"),http=require("./http"),to_query_string=utils.querystring,withCB=utils.withCB,map=utils.map,merge=utils.merge,get=utils.get,set=utils.set,invoke=utils.invoke,success=utils.success,error=utils.error,REQUIRES_VERSION=utils.REQUIRES_VERSION,dejoin=utils.dejoin,VERSIONS={},CLASSKEYS={},RELEASES={},MODELS={},SUMMARY_FIELDS={},WIDGETS={},DEFAULT_PROTOCOL="http://",VERSION_PATH="version",TEMPLATES_PATH="templates",RELEASE_PATH="version/release",CLASSKEY_PATH="classkeys",LISTS_PATH="lists",MODEL_PATH="model",SUMMARYFIELDS_PATH="summaryfields",QUERY_RESULTS_PATH="query/results",QUICKSEARCH_PATH="search",WIDGETS_PATH="widgets",ENRICHMENT_PATH="list/enrichment",WITH_OBJ_PATH="listswithobject",LIST_OPERATION_PATHS={union:"lists/union",intersection:"lists/intersect",difference:"lists/diff"},SUBTRACT_PATH="lists/subtract",WHOAMI_PATH="user/whoami",TABLE_ROW_PATH=QUERY_RESULTS_PATH+"/tablerows",PREF_PATH="user/preferences",PATH_VALUES_PATH="path/values",USER_TOKENS="user/tokens",ID_RESOLUTION_PATH="ids",NO_AUTH={},_ref=[VERSION_PATH,RELEASE_PATH,CLASSKEY_PATH,WIDGETS_PATH,MODEL_PATH,SUMMARYFIELDS_PATH,QUICKSEARCH_PATH,PATH_VALUES_PATH],_i=0,_len=_ref.length;_len>_i;_i++)p=_ref[_i],NO_AUTH[p]=!0;for(ALWAYS_AUTH={},_ref1=[WHOAMI_PATH,PREF_PATH,LIST_OPERATION_PATHS,SUBTRACT_PATH,WITH_OBJ_PATH,ENRICHMENT_PATH,TEMPLATES_PATH,USER_TOKENS],_j=0,_len1=_ref1.length;_len1>_j;_j++)p=_ref1[_j],ALWAYS_AUTH[p]=!0;NEEDS_AUTH=function(path,q){return NO_AUTH[path]?!1:ALWAYS_AUTH[path]?!0:(null!=q?q.needsAuthentication:void 0)?q.needsAuthentication():!0},HAS_PROTOCOL=/^https?:\/\//i,HAS_SUFFIX=/service\/?$/i,SUFFIX="/service/",DEFAULT_ERROR_HANDLER=function(e){var f,_ref2;return(f=null!=(_ref2=console.error)?_ref2:console.log)(e)},_get_or_fetch=function(propName,store,path,key,cb){var opts,promise,root,useCache,value;return root=this.root,useCache=this.useCache,promise=null!=this[propName]?this[propName]:this[propName]=useCache&&(value=store[root])?success(value):(opts={type:"GET",dataType:"json",data:{format:"json"}},this.doReq(merge(opts,{url:this.root+path})).then(function(x){return store[root]=x[key]})),withCB(cb,promise)},getListFinder=function(name){return function(lists){return new Promise(function(resolve,reject){var list;return(list=utils.find(lists,function(l){return l.name===name}))?resolve(list):reject('List "'+name+'" not found among: '+lists.map(get("name")))})}},LIST_PIPE=function(service,prop){return null==prop&&(prop="listName"),utils.compose(service.fetchList,get(prop))},TO_NAMES=function(xs){var x,_k,_len2,_ref2,_ref3,_results;for(null==xs&&(xs=[]),_ref2=utils.isArray(xs)?xs:[xs],_results=[],_k=0,_len2=_ref2.length;_len2>_k;_k++)x=_ref2[_k],_results.push(null!=(_ref3=x.name)?_ref3:x);return _results},Service=function(){function Service(_arg){var noCache;if(this.root=_arg.root,this.token=_arg.token,this.errorHandler=_arg.errorHandler,this.DEBUG=_arg.DEBUG,this.help=_arg.help,noCache=_arg.noCache,this.connectAs=__bind(this.connectAs,this),this.createList=__bind(this.createList,this),this.resolveIds=__bind(this.resolveIds,this),this.templateQuery=__bind(this.templateQuery,this),this.savedQuery=__bind(this.savedQuery,this),this.query=__bind(this.query,this),this.fetchRelease=__bind(this.fetchRelease,this),this.fetchClassKeys=__bind(this.fetchClassKeys,this),this.fetchVersion=__bind(this.fetchVersion,this),this.fetchSummaryFields=__bind(this.fetchSummaryFields,this),this.fetchModel=__bind(this.fetchModel,this),this.fetchWidgetMap=__bind(this.fetchWidgetMap,this),this.fetchWidgets=__bind(this.fetchWidgets,this),this.complement=__bind(this.complement,this),this.fetchListsContaining=__bind(this.fetchListsContaining,this),this.fetchList=__bind(this.fetchList,this),this.findLists=__bind(this.findLists,this),this.fetchLists=__bind(this.fetchLists,this),this.fetchTemplates=__bind(this.fetchTemplates,this),this.tableRows=__bind(this.tableRows,this),this.values=__bind(this.values,this),this.rows=__bind(this.rows,this),this.records=__bind(this.records,this),this.table=__bind(this.table,this),this.pathValues=__bind(this.pathValues,this),this.fetchUser=__bind(this.fetchUser,this),this.whoami=__bind(this.whoami,this),this.findById=__bind(this.findById,this),this.count=__bind(this.count,this),this.enrichment=__bind(this.enrichment,this),null==this.root)throw new Error("No service root provided. This is required");HAS_PROTOCOL.test(this.root)||(this.root=DEFAULT_PROTOCOL+this.root),HAS_SUFFIX.test(this.root)||(this.root=this.root+SUFFIX),this.root=this.root.replace(/ice$/,"ice/"),null==this.errorHandler&&(this.errorHandler=DEFAULT_ERROR_HANDLER),null==this.help&&(this.help="no.help.available@dev.null"),this.useCache=!noCache,this.getFormat=function(_this){return function(intended){return null==intended&&(intended="json"),intended}}(this)}var FIVE_MIN,checkNameParam,getNewUserToken,loadQ,pathValuesReq,toMapByName;return Service.prototype.doReq=http.doReq,Service.prototype.post=function(path,data){return this.makeRequest("POST",path,data)},Service.prototype.get=function(path,data){return this.makeRequest("GET",path,data)},Service.prototype.makeRequest=function(method,path,data,cb,indiv){var dataType,errBack,opts,timeout,_ref2,_ref3,_ref4;return null==method&&(method="GET"),null==path&&(path=""),null==data&&(data={}),null==cb&&(cb=function(){}),null==indiv&&(indiv=!1),utils.isArray(cb)&&(_ref2=cb,cb=_ref2[0],errBack=_ref2[1]),utils.isArray(data)&&(data=utils.pairsToObj(data)),null==errBack&&(errBack=this.errorHandler),data=utils.copy(data),dataType=this.getFormat(data.format),http.supports(method)||(_ref3=[method,http.getMethod(method)],data.method=_ref3[0],method=_ref3[1]),opts={data:data,dataType:dataType,success:cb,error:errBack,path:path,type:method},null!=data.auth&&(opts.auth=data.auth,delete opts.data.auth),null!=data.headers&&(opts.headers=utils.copy(data.headers),delete opts.data.headers),(timeout=null!=(_ref4=data.timeout)?_ref4:this.timeout)&&(opts.timeout=timeout,delete data.timeout),this.authorise(opts).then(function(_this){return function(authed){return _this.doReq(authed,indiv)}}(this))},Service.prototype.authorise=function(req){return this.fetchVersion().then(function(_this){return function(version){var opts,pathAdditions,_ref2;return opts=utils.copy(req),null==opts.headers&&(opts.headers={}),opts.url=_this.root+opts.path,pathAdditions=[],14>version&&("string"==typeof opts.data?pathAdditions.push(["format",opts.dataType]):opts.data.format=opts.dataType),null!=_this.token&&NEEDS_AUTH(req.path,null!=(_ref2=opts.data)?_ref2.query:void 0)&&(version>=14?opts.headers.Authorization="Token "+_this.token:"string"==typeof opts.data?pathAdditions.push(["token",_this.token]):opts.data.token=_this.token),pathAdditions.length&&(opts.url+="?"+to_query_string(pathAdditions)),opts}}(this))},Service.prototype.enrichment=function(opts,cb){return REQUIRES_VERSION(this,8,function(_this){return function(){var req;return req=merge({maxp:.05,correction:"Holm-Bonferroni"},opts),withCB(cb,_this.get(ENRICHMENT_PATH,req).then(get("results")))}}(this))},Service.prototype.search=function(options,cb){return null==options&&(options={}),null==cb&&(cb=function(){}),REQUIRES_VERSION(this,9,function(_this){return function(){var k,req,v,_ref2;if(utils.isFunction(options)&&(_ref2=[options,{}],cb=_ref2[0],options=_ref2[1]),"string"==typeof options)req={q:options};else{req={q:options.q};for(k in options)__hasProp.call(options,k)&&(v=options[k],"q"!==k&&(req["facet_"+k]=v))}return withCB(cb,_this.post(QUICKSEARCH_PATH,req))}}(this))},Service.prototype.makePath=function(path,subclasses,cb){return null==subclasses&&(subclasses={}),null==cb&&(cb=function(){}),withCB(cb,this.fetchModel().then(function(m){return m.makePath(path,subclasses)}))},Service.prototype.count=function(q,cb){var promise,req;return null==cb&&(cb=function(){}),promise=q?null!=q.toPathString?(p=q.isClass()?q.append("id"):q,this.pathValues(p,"count")):null!=q.toXML?(req={query:q,format:"jsoncount"},this.post(QUERY_RESULTS_PATH,req).then(get("count"))):"string"==typeof q?this.fetchModel().then(function(_this){return function(m){var e;try{return _this.count(m.makePath(q))}catch(_error){return e=_error,_this.query({select:[q]}).then(_this.count)}}}(this)):this.query(q).then(this.count):error("Not enough arguments"),withCB(cb,promise)},Service.prototype.findById=function(type,id,fields,cb){var promise,_ref2;return null==fields&&(fields=["**"]),null==cb&&(cb=function(){}),utils.isFunction(fields)&&(_ref2=[["**"],fields],fields=_ref2[0],cb=_ref2[1]),promise=this.query({from:type,select:fields,where:{id:id}}).then(dejoin).then(invoke("records")).then(get(0)),withCB(cb,promise)},Service.prototype.lookup=function(type,term,context,cb){var promise,_ref2;return utils.isFunction(context)&&(_ref2=[null,context],context=_ref2[0],cb=_ref2[1]),promise=this.query({from:type,select:["**"],where:[[type,"LOOKUP",term,context]]}).then(dejoin).then(invoke("records")),withCB(cb,promise)},Service.prototype.find=function(type,term,context,cb){var _ref2;return utils.isFunction(context)&&(_ref2=[null,context],context=_ref2[0],cb=_ref2[1]),withCB(cb,this.lookup(type,term,context).then(function(found){return null==found||0===found.length?error("Nothing found"):found.length>1?error("Multiple items found: "+found.slice(0,3)+"..."):success(found[0])}))},Service.prototype.whoami=function(cb){return REQUIRES_VERSION(this,9,function(_this){return function(){return withCB(cb,_this.get(WHOAMI_PATH).then(get("user")).then(function(x){return new User(_this,x)}))}}(this))},Service.prototype.fetchUser=function(){var args;return args=1<=arguments.length?__slice.call(arguments,0):[],this.whoami.apply(this,args)},pathValuesReq=function(format,path){return{format:format,path:String(path),typeConstraints:JSON.stringify(path.subclasses)}},Service.prototype.pathValues=function(path,typeConstraints,cb){return null==typeConstraints&&(typeConstraints={}),REQUIRES_VERSION(this,6,function(_this){return function(){var e,format,promise,wanted,_ref2;return"string"==typeof typeConstraints&&(wanted=typeConstraints,typeConstraints={}),utils.isFunction(typeConstraints)&&(_ref2=[cb,typeConstraints],typeConstraints=_ref2[0],cb=_ref2[1]),"count"!==wanted&&(wanted="results"),format="count"===wanted?"jsoncount":"json",promise=function(){var _ref3;try{return this.fetchModel().then(invoke("makePath",path,null!=(_ref3=path.subclasses)?_ref3:typeConstraints)).then(function(path){return pathValuesReq(format,path)}).then(function(_this){return function(req){return _this.post(PATH_VALUES_PATH,req)}}(this)).then(get(wanted))}catch(_error){return e=_error,error(e)}}.call(_this),withCB(cb,promise)}}(this))},Service.prototype.doPagedRequest=function(q,path,page,format,cb){var req,_ref2;return null==page&&(page={}),null==cb&&(cb=function(){}),null!=q.toXML?(utils.isFunction(page)&&(_ref2=[page,{}],cb=_ref2[0],page=_ref2[1]),req=merge(page,{query:q,format:format}),withCB(cb,this.post(path,req).then(get("results")))):this.query(q).then(function(_this){return function(query){return _this.doPagedRequest(query,path,page,format,cb)}}(this))},Service.prototype.table=function(q,page,cb){return this.doPagedRequest(q,QUERY_RESULTS_PATH,page,"jsontable",cb)},Service.prototype.records=function(q,page,cb){return this.doPagedRequest(q,QUERY_RESULTS_PATH,page,"jsonobjects",cb)},Service.prototype.rows=function(q,page,cb){return this.doPagedRequest(q,QUERY_RESULTS_PATH,page,"json",cb)},Service.prototype.values=function(q,opts,cb){var resp,_ref2;return utils.isFunction(opts)&&(_ref2=[opts,cb],cb=_ref2[0],opts=_ref2[1]),resp=null==q?error("No query term supplied"):null!=q.descriptors||"string"==typeof q?this.pathValues(q,opts).then(map(get("value"))):null!=q.toXML?1!==q.views.length?error("Expected one column, got "+q.views.length):this.rows(q,opts).then(map(get(0))):this.query(q).then(function(_this){return function(query){return _this.values(query,opts)}}(this)),withCB(cb,resp)},Service.prototype.tableRows=function(q,page,cb){return this.doPagedRequest(q,TABLE_ROW_PATH,page,"json",cb)},Service.prototype.fetchTemplates=function(cb){return withCB(cb,this.get(TEMPLATES_PATH).then(get("templates")))},Service.prototype.fetchLists=function(cb){return this.findLists("",cb)},Service.prototype.findLists=function(name,cb){return null==name&&(name=""),null==cb&&(cb=function(){}),this.fetchVersion().then(function(_this){return function(v){var fn;return withCB(cb,name&&13>v?error("Finding lists by name on the server requires version 13. This is only "+v):(fn=function(ls){var data,_k,_len2,_results;for(_results=[],_k=0,_len2=ls.length;_len2>_k;_k++)data=ls[_k],_results.push(new List(data,_this));return _results},_this.get(LISTS_PATH,{name:name}).then(get("lists")).then(fn)))}}(this))},Service.prototype.fetchList=function(name,cb){return this.fetchVersion().then(function(_this){return function(v){return withCB(cb,13>v?_this.findLists().then(getListFinder(name)):_this.findLists(name).then(get(0)))}}(this))},Service.prototype.fetchListsContaining=function(opts,cb){var fn;return fn=function(_this){return function(xs){var x,_k,_len2,_results;for(_results=[],_k=0,_len2=xs.length;_len2>_k;_k++)x=xs[_k],_results.push(new List(x,_this));return _results}}(this),withCB(cb,this.get(WITH_OBJ_PATH,opts).then(get("lists")).then(fn))},Service.prototype.combineLists=function(operation,options,cb){var description,lists,name,req,tags,_ref2;return _ref2=merge({lists:[],tags:[]},options),name=_ref2.name,lists=_ref2.lists,tags=_ref2.tags,description=_ref2.description,req={name:name,description:description},null==req.description&&(req.description=""+operation+" of "+lists.join(", ")),req.tags=tags.join(";"),req.lists=lists.join(";"),withCB(cb,this.get(LIST_OPERATION_PATHS[operation],req).then(LIST_PIPE(this)))},Service.prototype.merge=function(){return this.combineLists.apply(this,["union"].concat(__slice.call(arguments)))},Service.prototype.intersect=function(){return this.combineLists.apply(this,["intersection"].concat(__slice.call(arguments)))},Service.prototype.diff=function(){return this.combineLists.apply(this,["difference"].concat(__slice.call(arguments)))},Service.prototype.complement=function(options,cb){var defaultDesc,description,exclude,from,lists,name,references,req,tags;return null==options&&(options={}),null==cb&&(cb=function(){}),from=options.from,exclude=options.exclude,name=options.name,description=options.description,tags=options.tags,defaultDesc=function(){return"Relative complement of "+lists.join(" and ")+" in "+references.join(" and ")},references=TO_NAMES(from),lists=TO_NAMES(exclude),null==name&&(name=defaultDesc()),null==description&&(description=defaultDesc()),null==tags&&(tags=[]),req={name:name,description:description,tags:tags,lists:lists,references:references},withCB(cb,this.post(SUBTRACT_PATH,req).then(LIST_PIPE(this)))},Service.prototype.fetchWidgets=function(cb){return REQUIRES_VERSION(this,8,function(_this){return function(){return _get_or_fetch.call(_this,"widgets",WIDGETS,WIDGETS_PATH,"widgets",cb)}}(this))},toMapByName=utils.omap(function(w){return[w.name,w]}),Service.prototype.fetchWidgetMap=function(cb){return REQUIRES_VERSION(this,8,function(_this){return function(){return withCB(cb,null!=_this.__wmap__?_this.__wmap__:_this.__wmap__=_this.fetchWidgets().then(toMapByName))}}(this))},Service.prototype.fetchModel=function(cb){var ret;return ret=_get_or_fetch.call(this,"model",MODELS,MODEL_PATH,"model").then(Model.load).then(set({service:this})),withCB(cb,ret)},Service.prototype.fetchSummaryFields=function(cb){return _get_or_fetch.call(this,"summaryFields",SUMMARY_FIELDS,SUMMARYFIELDS_PATH,"classes",cb)},Service.prototype.fetchVersion=function(cb){return _get_or_fetch.call(this,"version",VERSIONS,VERSION_PATH,"version",cb)},Service.prototype.fetchClassKeys=function(cb){return _get_or_fetch.call(this,"classkeys",CLASSKEYS,CLASSKEY_PATH,"classes",cb)},Service.prototype.fetchRelease=function(cb){return _get_or_fetch.call(this,"release",RELEASES,RELEASE_PATH,"version",cb)},Service.prototype.query=function(options,cb){var buildQuery;return buildQuery=function(_this){return function(_arg){var model,summaryFields;return model=_arg[0],summaryFields=_arg[1],new Query(options,_this,{model:model,summaryFields:summaryFields})}}(this),withCB(cb,utils.parallel(this.fetchModel(),this.fetchSummaryFields()).then(buildQuery))},loadQ=function(service,name){return function(q){return q?service.query(q):error("No query found called "+name)}},checkNameParam=function(name){return name?"string"==typeof name?success():error("Name must be a string"):error("Name not provided")},Service.prototype.savedQuery=function(name,cb){return REQUIRES_VERSION(this,16,function(_this){return function(){return checkNameParam(name).then(function(){return withCB(cb,_this.get("user/queries",{filter:name}).then(function(r){return r.queries[name]}).then(loadQ(_this,name)))})}}(this))},Service.prototype.templateQuery=function(name,cb){return checkNameParam(name).then(function(_this){return function(){return withCB(cb,_this.fetchTemplates().then(get(name)).then(set("type","TEMPLATE")).then(loadQ(_this,name)))}}(this))},Service.prototype.manageUserPreferences=function(method,data,cb){return REQUIRES_VERSION(this,11,function(_this){return function(){return withCB(cb,_this.makeRequest(method,PREF_PATH,data).then(get("preferences")))}}(this))},Service.prototype.resolveIds=function(opts,cb){return REQUIRES_VERSION(this,10,function(_this){return function(){var req;return req={type:"POST",url:_this.root+ID_RESOLUTION_PATH,contentType:"application/json",data:JSON.stringify(opts),dataType:"json"},withCB(cb,_this.doReq(req).then(get("uid")).then(IDResolutionJob.create(_this)))}}(this))},Service.prototype.resolutionJob=function(id){return IDResolutionJob.create(this)(id)},Service.prototype.createList=function(opts,ids,cb){var adjust,req;return null==opts&&(opts={}),null==ids&&(ids=""),null==cb&&(cb=function(){}),adjust=function(_this){return function(x){return merge(x,{token:_this.token,tags:opts.tags||[]})}}(this),req={data:utils.isArray(ids)?ids.map(function(x){return'"'+x+'"'}).join("\n"):ids,dataType:"json",url:""+this.root+"lists?"+to_query_string(adjust(opts)),type:"POST",contentType:"text/plain"},withCB(cb,this.doReq(req).then(LIST_PIPE(this)))},getNewUserToken=function(resp){return resp.user.temporaryToken},Service.prototype.connectAs=function(token){return Service.connect(merge(this,{token:token,noCache:!this.useCache}))},Service.prototype.register=function(name,password,cb){return REQUIRES_VERSION(this,9,function(_this){return function(){return withCB(cb,_this.post("users",{name:name,password:password}).then(getNewUserToken).then(_this.connectAs))}}(this))},FIVE_MIN=300,Service.prototype.getDeregistrationToken=function(validity,cb){return null==validity&&(validity=FIVE_MIN),REQUIRES_VERSION(this,16,function(_this){return function(){var promise;return promise=null!=_this.token?_this.post("user/deregistration",{validity:validity}).then(get("token")):error("Not registered"),withCB(cb,promise)}}(this))},Service.prototype.deregister=function(token,cb){return REQUIRES_VERSION(this,16,function(_this){return function(){return withCB(cb,_this.makeRequest("DELETE","user",{deregistrationToken:token,format:"xml"}))}}(this))},Service.prototype.login=function(name,password,cb){return REQUIRES_VERSION(this,9,function(_this){return function(){var auth;return auth=""+name+":"+password,withCB(cb,_this.logout().then(function(service){return service.get("user/token",{auth:auth})})).then(get("token")).then(_this.connectAs)}}(this))},Service.prototype.logout=function(cb){return withCB(cb,success(this.connectAs()))},Service}(),Service.prototype.rowByRow=function(){var args,f,q;return q=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[],f=http.iterReq("POST",QUERY_RESULTS_PATH,"json"),null!=q.toXML?f.apply(this,arguments):this.query(q).then(function(_this){return function(query){return _this.rowByRow.apply(_this,[query].concat(__slice.call(args)))}}(this))},Service.prototype.eachRow=Service.prototype.rowByRow,Service.prototype.recordByRecord=function(){var args,f,q;return q=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[],f=http.iterReq("POST",QUERY_RESULTS_PATH,"jsonobjects"),null!=q.toXML?f.apply(this,arguments):this.query(q).then(function(_this){return function(query){return _this.recordByRecord.apply(_this,[query].concat(__slice.call(args)))}}(this))},Service.prototype.eachRecord=Service.prototype.recordByRecord,Service.prototype.union=Service.prototype.merge,Service.prototype.difference=Service.prototype.diff,Service.prototype.symmetricDifference=Service.prototype.diff,Service.prototype.relativeComplement=Service.prototype.complement,Service.prototype.subtract=Service.prototype.complement,Service.flushCaches=function(){return MODELS={},VERSIONS={},RELEASES={},CLASSKEYS={},SUMMARY_FIELDS={},WIDGETS={}},Service.connect=function(opts){if(null==(null!=opts?opts.root:void 0))throw new Error("Invalid options provided: "+JSON.stringify(opts));return new Service(opts)},exports.Service=Service,exports.Model=Model,exports.Query=Query,exports.utils=utils,exports.VERSION=version.VERSION,exports.imjs=version}).call(this)},{"./http":57,"./id-resolution-job":58,"./lists":59,"./model":60,"./promise":62,"./query":63,"./user":67,"./util":68,"./version":69}],65:[function(require,module,exports){(function(global){(function(){var FakeDomParser;exports.DOMParser=null!=global.DOMParser?global.DOMParser:FakeDomParser=function(){function FakeDomParser(){throw new Error("DOMParser is not available")}return FakeDomParser}()}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],66:[function(require,module,exports){(function(){var Promise,merge,properties,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};merge=function(src,dest){var k,v,_results;_results=[];for(k in src)v=src[k],_results.push(dest[k]=v);return _results},Promise=require("./promise"),properties=["attributes","references","collections"],exports.Table=function(){function Table(opts,model){var c,prop,_,_i,_len,_ref,_ref1;for(this.model=model,this.getDisplayName=__bind(this.getDisplayName,this),this.name=opts.name,this.tags=opts.tags,this.displayName=opts.displayName,this.attributes=opts.attributes,this.references=opts.references,this.collections=opts.collections,this.fields={},this.__parents__=null!=(_ref=opts["extends"])?_ref:[],_i=0,_len=properties.length;_len>_i;_i++){if(prop=properties[_i],null==this[prop])throw new Error("Bad model data: missing "+prop);merge(this[prop],this.fields)}_ref1=this.collections;for(_ in _ref1)c=_ref1[_],c.isCollection=!0}return Table.prototype.toString=function(){var n,_;return"[Table name="+this.name+", fields=["+function(){var _ref,_results;_ref=this.fields,_results=[];for(n in _ref)_=_ref[n],_results.push(n);return _results}.call(this)+"]]"},Table.prototype.parents=function(){var _ref;return(null!=(_ref=this.__parents__)?_ref:[]).slice()},Table.prototype.getDisplayName=function(){return new Promise(function(_this){return function(resolve,reject){return null!=_this.model?resolve(_this.model.makePath(_this.name).getDisplayName()):reject(new Error("model not set - cannot make path"))}}(this))},Table}()}).call(this)},{"./promise":62}],67:[function(require,module,exports){(function(){var any,do_pref_req,error,get,isFunction,withCB,_ref,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};_ref=require("./util"),withCB=_ref.withCB,get=_ref.get,isFunction=_ref.isFunction,any=_ref.any,error=_ref.error,do_pref_req=function(user,data,method,cb){return user.service.manageUserPreferences(method,data,cb).then(function(prefs){return user.preferences=prefs})},exports.User=function(){function User(service,_arg){this.service=service,this.username=_arg.username,this.preferences=_arg.preferences,this.refresh=__bind(this.refresh,this),this.clearPreferences=__bind(this.clearPreferences,this),this.clearPreference=__bind(this.clearPreference,this),this.setPreferences=__bind(this.setPreferences,this),this.setPreference=__bind(this.setPreference,this),this.hasPreferences=null!=this.preferences,null==this.preferences&&(this.preferences={})}return User.prototype.setPreference=function(key,value,cb){var data,_ref1;if(isFunction(value)&&(_ref1=[null,value],value=_ref1[0],cb=_ref1[1]),"string"==typeof key)data={},data[key]=value;else{if(null!=value)return withCB(cb,error("Incorrect arguments to setPreference"));data=key}return this.setPreferences(data,cb)},User.prototype.setPreferences=function(prefs,cb){return do_pref_req(this,prefs,"POST",cb)},User.prototype.clearPreference=function(key,cb){return do_pref_req(this,{key:key},"DELETE",cb)},User.prototype.clearPreferences=function(cb){return do_pref_req(this,{},"DELETE",cb)},User.prototype.refresh=function(cb){return do_pref_req(this,{},"GET",cb)},User.prototype.createToken=function(type,message,cb){var _ref1,_ref2;return null==type&&(type="day"),null==cb&&any([type,message],isFunction)&&(isFunction(type)?(_ref1=[null,null,type],type=_ref1[0],message=_ref1[1],cb=_ref1[2]):isFunction(message)&&(_ref2=[null,message],message=_ref2[0],cb=_ref2[1])),withCB(cb,this.service.post("user/tokens",{type:type,message:message}).then(get("token")))},User.prototype.fetchCurrentTokens=function(cb){return withCB(cb,this.service.get("user/tokens").then(get("tokens")))},User.prototype.revokeAllTokens=function(cb){return withCB(cb,this.service.makeRequest("DELETE","user/tokens"))},User.prototype.revokeToken=function(token,cb){return withCB(cb,this.service.makeRequest("DELETE","user/tokens/"+token))},User}()}).call(this)},{"./util":68}],68:[function(require,module,exports){(function(){var Promise,REQUIRES,comp,curry,encode,entities,error,flatten,fold,id,invoke,invokeWith,isArray,merge,pairFold,qsFromList,root,success,thenFold,_ref,__slice=[].slice,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1},__hasProp={}.hasOwnProperty;Promise=require("./promise"),root=exports,root.defer=function(){var deferred;return deferred={},deferred.promise=new Promise(function(resolve,reject){return deferred.resolve=resolve,deferred.reject=reject}),deferred},encode=function(x){return encodeURIComponent(String(x))},qsFromList=function(pairs){var pair;return function(){var _i,_len,_results;for(_results=[],_i=0,_len=pairs.length;_len>_i;_i++)pair=pairs[_i],_results.push(pair.map(encode).join("="));return _results}().join("&")},root.querystring=function(obj){var k,p,pairs,subList,sv,v;if(!obj)return"";if(isArray(obj))pairs=obj.slice();else{pairs=[];for(k in obj)v=obj[k],
isArray(v)?(subList=function(){var _i,_len,_results;for(_results=[],_i=0,_len=v.length;_len>_i;_i++)sv=v[_i],_results.push([k,sv]);return _results}(),pairs=pairs.concat(subList)):pairs.push([k,v])}return qsFromList(function(){var _i,_len,_results;for(_results=[],_i=0,_len=pairs.length;_len>_i;_i++)p=pairs[_i],null!=p[1]&&_results.push(p);return _results}())},root.curry=curry=function(){var args,f;return f=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[],function(){var rest;return rest=1<=arguments.length?__slice.call(arguments,0):[],f.apply(null,args.concat(rest))}},root.error=error=function(e){return new Promise(function(_,reject){return reject(new Error(e))})},root.success=success=function(x){return new Promise(function(resolve,_){return resolve(x)})},root.parallel=function(){var promises;return promises=1<=arguments.length?__slice.call(arguments,0):[],Promise.all(1===promises.length&&!promises[0].then&&promises[0].length?promises[0]:promises)},root.withCB=function(){var f,fs,onErr,onSucc,p,_i,_j,_len;for(fs=2<=arguments.length?__slice.call(arguments,0,_i=arguments.length-1):(_i=0,[]),p=arguments[_i++],_j=0,_len=fs.length;_len>_j;_j++)f=fs[_j],null!=f&&(onSucc=curry(f,null),onErr=f,p.then(onSucc,onErr));return p},root.fold=fold=function(f){return function(init,xs){var k,ret,v;if(1===arguments.length&&(xs=(null!=init?init.slice():void 0)||init,init=(null!=xs?xs.shift():void 0)||{}),null==xs)throw new Error("xs is null");if(null!=xs.reduce)return xs.reduce(f,init);ret=init;for(k in xs)v=xs[k],ret=null!=ret?f(ret,k,v):{k:v};return ret}},root.take=function(n){return function(xs){return null!=n?xs.slice(0,+(n-1)+1||9e9):xs.slice()}},root.filter=function(f){return function(xs){var x,_i,_len,_results;for(_results=[],_i=0,_len=xs.length;_len>_i;_i++)x=xs[_i],f(x)&&_results.push(x);return _results}},root.uniqBy=function(f,xs){var k,keys,values,x,_i,_len;if(1===arguments.length)return curry(root.uniqBy,f);if(keys=[],values=[],null==xs)return values;for(_i=0,_len=xs.length;_len>_i;_i++)x=xs[_i],k=f(x),__indexOf.call(keys,k)<0&&(keys.push(k),values.push(x));return values},root.find=function(xs,f){var x,_i,_len;if(1===arguments.length)return f=xs,function(xs){return root.find(xs,f)};for(_i=0,_len=xs.length;_len>_i;_i++)if(x=xs[_i],f(x))return x;return null},isArray=null!=(_ref=Array.isArray)?_ref:function(xs){return null!=(null!=xs?xs.splice:void 0)&&null!=(null!=xs?xs.push:void 0)&&null!=(null!=xs?xs.pop:void 0)&&null!=(null!=xs?xs.slice:void 0)},root.isArray=isArray,root.isFunction="function"!=typeof/./?function(f){return"function"==typeof f}:function(f){return null!=f&&null!=f.call&&null!=f.apply&&"[object Function]"===f.toString()},entities={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;"},root.escape=function(str){var code,i,ret,withEntities,_i,_ref1;if(null==str)return"";for(withEntities=String(str).replace(/[&<>"']/g,function(entity){return entities[entity]}),ret=[],i=_i=0,_ref1=withEntities.length;_ref1>=0?_ref1>=_i:_i>=_ref1;i=_ref1>=0?++_i:--_i)code=withEntities.charCodeAt(i),ret.push(code>256?"&#"+code+";":withEntities.charAt(i));return ret.join("")},root.omap=function(f){var merger;return merger=fold(function(a,oldk,oldv){var newk,newv,_ref1;return _ref1=f(oldk,oldv),newk=_ref1[0],newv=_ref1[1],isArray(newv)&&(newv=newv.slice()),a[newk]=newv,a}),function(xs){return merger({},xs)}},root.copy=root.omap(function(k,v){return[k,v]}),root.partition=function(f){return function(xs){var divide;return(divide=fold(function(_arg,x){var falses,trues;return trues=_arg[0],falses=_arg[1],f(x)?[trues.concat([x]),falses]:[trues,falses.concat([x])]}))([[],[]],xs)}},root.id=id=function(x){return x},root.concatMap=function(f){return function(xs){var fx,ret,x,_i,_len;for(ret=void 0,_i=0,_len=xs.length;_len>_i;_i++)x=xs[_i],fx=f(x),ret=void 0===ret?fx:"number"==typeof ret?ret+fx:null!=ret.concat?ret.concat(fx):merge(ret,fx);return ret}},root.map=function(f){return invoke("map",f)},comp=fold(function(f,g){return function(){var args;return args=1<=arguments.length?__slice.call(arguments,0):[],f(g.apply(null,args))}}),root.compose=function(){var fs;return fs=1<=arguments.length?__slice.call(arguments,0):[],comp(fs)},root.flatMap=root.concatMap,root.difference=function(xs,remove){var x,_i,_len,_results;for(_results=[],_i=0,_len=xs.length;_len>_i;_i++)x=xs[_i],__indexOf.call(remove,x)<0&&_results.push(x);return _results},root.stringList=function(x){return"string"==typeof x?[x]:x},root.flatten=flatten=function(){var ret,x,xs,xx,_i,_j,_len,_len1,_ref1;for(xs=1<=arguments.length?__slice.call(arguments,0):[],ret=[],_i=0,_len=xs.length;_len>_i;_i++)if(x=xs[_i],isArray(x))for(_ref1=flatten.apply(null,x),_j=0,_len1=_ref1.length;_len1>_j;_j++)xx=_ref1[_j],ret.push(xx);else ret.push(x);return ret},root.sum=root.concatMap(id),root.merge=merge=function(){var k,newObj,o,objs,v,_i,_len;for(objs=1<=arguments.length?__slice.call(arguments,0):[],newObj={},_i=0,_len=objs.length;_len>_i;_i++){o=objs[_i];for(k in o)__hasProp.call(o,k)&&(v=o[k],newObj[k]=v)}return newObj},root.any=function(xs,f){var x,_i,_len;for(null==f&&(f=id),_i=0,_len=xs.length;_len>_i;_i++)if(x=xs[_i],f(x))return!0;return!1},root.invoke=invoke=function(){var args,name;return name=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[],invokeWith(name,args)},root.invokeWith=invokeWith=function(name,args,ctx){return null==args&&(args=[]),null==ctx&&(ctx=null),function(o){if(null==o)throw new Error('Cannot call method "'+name+'" of null');if(o[name])return o[name].apply(ctx||o,args);throw new Error('Cannot call undefined method "'+name+" of "+o)}},root.get=function(name){return function(obj){return obj[name]}},root.set=function(name,value){return function(obj){var k,v;if(2===arguments.length)obj[name]=value;else for(k in name)__hasProp.call(name,k)&&(v=name[k],obj[k]=v);return obj}},REQUIRES=function(required,got){return"This service requires a service at version "+required+" or above. This one is at "+got},root.REQUIRES_VERSION=function(s,n,f){return s.fetchVersion().then(function(v){return v>=n?f():error(REQUIRES(n,v))})},root.dejoin=function(q){var parts,view,_i,_len,_ref1;for(_ref1=q.views,_i=0,_len=_ref1.length;_len>_i;_i++)view=_ref1[_i],parts=view.split("."),parts.length>2&&q.addJoin(parts.slice(1,-1).join("."));return q},thenFold=fold(function(p,f){return p.then(f)}),root.sequence=function(){var fns;return fns=1<=arguments.length?__slice.call(arguments,0):[],thenFold(success(),fns)},pairFold=fold(function(o,_arg){var k,v;if(k=_arg[0],v=_arg[1],null!=o[k])throw new Error("Duplicate key: "+k);return o[k]=v,o}),root.pairsToObj=function(pairs){return pairFold({},pairs)}}).call(this)},{"./promise":62}],69:[function(require,module,exports){(function(){exports.VERSION="3.14.0"}).call(this)},{}],70:[function(require,module,exports){(function(){var DOMParser,sanitize;DOMParser=require("xmldom").DOMParser,sanitize=function(xml){return xml=xml.replace(/^\s*/g,""),xml=xml.replace(/\s$/g,""),0===xml.length?xml:">"!==xml[xml.length-1]?xml+">":xml},exports.parse=function(xml){var dom,parser;if("string"!=typeof xml)throw new Error("Expected a string - got "+xml);if(xml=sanitize(xml),!xml)throw new Error("Expected content - got empty string");if(dom=function(){try{return parser=new DOMParser,parser.parseFromString(xml,"text/xml")}catch(_error){}}(),!dom||!dom.documentElement||dom.getElementsByTagName("parsererror").length)throw new Error("Invalid XML: "+xml);return dom}}).call(this)},{xmldom:65}],71:[function(require,module,exports){(function(process,Buffer){function check(x,y){return"string"==typeof x?y==x:x&&"function"==typeof x.exec?x.exec(y):"boolean"==typeof x?x:"function"==typeof x?x(y):!1}var Parser=require("jsonparse"),through=require("through");exports.parse=function(path,map){var parser=new Parser,stream=through(function(chunk){"string"==typeof chunk&&(chunk=new Buffer(chunk)),parser.write(chunk)},function(data){data&&stream.write(data),stream.queue(null)});"string"==typeof path&&(path=path.split(".").map(function(e){return"*"===e?!0:""===e?{recurse:!0}:e}));var count=0;return path&&path.length||(path=null),parser.onValue=function(value){if(this.root||(stream.root=value),path){for(var i=0,j=0;i<path.length;){var c,key=path[i];if(j++,key&&!key.recurse){if(c=j===this.stack.length?this:this.stack[j],!c)return;if(!check(key,c.key))return;i++}else{i++;var nextKey=path[i];if(!nextKey)return;for(;;){if(c=j===this.stack.length?this:this.stack[j],!c)return;if(check(nextKey,c.key)){i++;break}j++}}}if(j===this.stack.length){count++;var actualPath=this.stack.slice(1).map(function(element){return element.key}).concat([this.key]),data=this.value[this.key];null!=data&&null!=(data=map?map(data,actualPath):data)&&stream.queue(data),delete this.value[this.key]}}},parser._onToken=parser.onToken,parser.onToken=function(token,value){parser._onToken(token,value),0===this.stack.length&&stream.root&&(path||stream.queue(stream.root),stream.emit("root",stream.root,count),count=0,stream.root=null)},parser.onError=function(err){stream.emit("error",err)},stream},exports.stringify=function(op,sep,cl,indent){indent=indent||0,op===!1?(op="",sep="\n",cl=""):null==op&&(op="[\n",sep="\n,\n",cl="\n]\n");var stream,first=!0,anyData=!1;return stream=through(function(data){anyData=!0;var json=JSON.stringify(data,null,indent);first?(first=!1,stream.queue(op+json)):stream.queue(sep+json)},function(data){anyData||stream.queue(op),stream.queue(cl),stream.queue(null)})},exports.stringifyObject=function(op,sep,cl,indent){indent=indent||0,op===!1?(op="",sep="\n",cl=""):null==op&&(op="{\n",sep="\n,\n",cl="\n}\n");var first=!0,anyData=!1;return stream=through(function(data){anyData=!0;var json=JSON.stringify(data[0])+":"+JSON.stringify(data[1],null,indent);first?(first=!1,this.queue(op+json)):this.queue(sep+json)},function(data){anyData||this.queue(op),this.queue(cl),this.queue(null)}),stream},module.parent||"browser"===process.title||process.stdin.pipe(exports.parse(process.argv[2])).pipe(exports.stringify("[",",\n","]\n",2)).pipe(process.stdout)}).call(this,require("_process"),require("buffer").Buffer)},{_process:24,buffer:15,jsonparse:72,through:73}],72:[function(require,module,exports){(function(Buffer){function toknam(code){for(var keys=Object.keys(C),i=0,l=keys.length;l>i;i++){var key=keys[i];if(C[key]===code)return key}return code&&"0x"+code.toString(16)}function Parser(){this.tState=START,this.value=void 0,this.string=void 0,this.unicode=void 0,this.negative=void 0,this.magnatude=void 0,this.position=void 0,this.exponent=void 0,this.negativeExponent=void 0,this.key=void 0,this.mode=void 0,this.stack=[],this.state=VALUE,this.bytes_remaining=0,this.bytes_in_sequence=0,this.temp_buffs={2:new Buffer(2),3:new Buffer(3),4:new Buffer(4)}}var C={},LEFT_BRACE=C.LEFT_BRACE=1,RIGHT_BRACE=C.RIGHT_BRACE=2,LEFT_BRACKET=C.LEFT_BRACKET=3,RIGHT_BRACKET=C.RIGHT_BRACKET=4,COLON=C.COLON=5,COMMA=C.COMMA=6,TRUE=C.TRUE=7,FALSE=C.FALSE=8,NULL=C.NULL=9,STRING=C.STRING=10,NUMBER=C.NUMBER=11,START=C.START=17,TRUE1=C.TRUE1=33,TRUE2=C.TRUE2=34,TRUE3=C.TRUE3=35,FALSE1=C.FALSE1=49,FALSE2=C.FALSE2=50,FALSE3=C.FALSE3=51,FALSE4=C.FALSE4=52,NULL1=C.NULL1=65,NULL2=C.NULL3=66,NULL3=C.NULL2=67,NUMBER1=C.NUMBER1=81,NUMBER2=C.NUMBER2=82,NUMBER3=C.NUMBER3=83,NUMBER4=C.NUMBER4=84,NUMBER5=C.NUMBER5=85,NUMBER6=C.NUMBER6=86,NUMBER7=C.NUMBER7=87,NUMBER8=C.NUMBER8=88,STRING1=C.STRING1=97,STRING2=C.STRING2=98,STRING3=C.STRING3=99,STRING4=C.STRING4=100,STRING5=C.STRING5=101,STRING6=C.STRING6=102,VALUE=C.VALUE=113,KEY=C.KEY=114,OBJECT=C.OBJECT=129,ARRAY=C.ARRAY=130,proto=Parser.prototype;proto.charError=function(buffer,i){this.onError(new Error("Unexpected "+JSON.stringify(String.fromCharCode(buffer[i]))+" at position "+i+" in state "+toknam(this.tState)))},proto.onError=function(err){throw err},proto.write=function(buffer){"string"==typeof buffer&&(buffer=new Buffer(buffer));for(var n,i=0,l=buffer.length;l>i;i++)if(this.tState===START)n=buffer[i],123===n?this.onToken(LEFT_BRACE,"{"):125===n?this.onToken(RIGHT_BRACE,"}"):91===n?this.onToken(LEFT_BRACKET,"["):93===n?this.onToken(RIGHT_BRACKET,"]"):58===n?this.onToken(COLON,":"):44===n?this.onToken(COMMA,","):116===n?this.tState=TRUE1:102===n?this.tState=FALSE1:110===n?this.tState=NULL1:34===n?(this.string="",this.tState=STRING1):45===n?(this.negative=!0,this.tState=NUMBER1):48===n?(this.magnatude=0,this.tState=NUMBER2):n>48&&64>n?(this.magnatude=n-48,this.tState=NUMBER3):32===n||9===n||10===n||13===n||this.charError(buffer,i);else if(this.tState===STRING1)if(n=buffer[i],this.bytes_remaining>0){for(var j=0;j<this.bytes_remaining;j++)this.temp_buffs[this.bytes_in_sequence][this.bytes_in_sequence-this.bytes_remaining+j]=buffer[j];this.string+=this.temp_buffs[this.bytes_in_sequence].toString(),this.bytes_in_sequence=this.bytes_remaining=0,i=i+j-1}else if(0===this.bytes_remaining&&n>=128)if(n>=194&&223>=n&&(this.bytes_in_sequence=2),n>=224&&239>=n&&(this.bytes_in_sequence=3),n>=240&&244>=n&&(this.bytes_in_sequence=4),this.bytes_in_sequence+i>buffer.length){for(var k=0;k<=buffer.length-1-i;k++)this.temp_buffs[this.bytes_in_sequence][k]=buffer[i+k];this.bytes_remaining=i+this.bytes_in_sequence-buffer.length,i=buffer.length-1}else this.string+=buffer.slice(i,i+this.bytes_in_sequence).toString(),i=i+this.bytes_in_sequence-1;else 34===n?(this.tState=START,this.onToken(STRING,this.string),this.string=void 0):92===n?this.tState=STRING2:n>=32?this.string+=String.fromCharCode(n):this.charError(buffer,i);else this.tState===STRING2?(n=buffer[i],34===n?(this.string+='"',this.tState=STRING1):92===n?(this.string+="\\",this.tState=STRING1):47===n?(this.string+="/",this.tState=STRING1):98===n?(this.string+="\b",this.tState=STRING1):102===n?(this.string+="\f",this.tState=STRING1):110===n?(this.string+="\n",this.tState=STRING1):114===n?(this.string+="\r",this.tState=STRING1):116===n?(this.string+="	",this.tState=STRING1):117===n?(this.unicode="",this.tState=STRING3):this.charError(buffer,i)):this.tState===STRING3||this.tState===STRING4||this.tState===STRING5||this.tState===STRING6?(n=buffer[i],n>=48&&64>n||n>64&&70>=n||n>96&&102>=n?(this.unicode+=String.fromCharCode(n),this.tState++===STRING6&&(this.string+=String.fromCharCode(parseInt(this.unicode,16)),this.unicode=void 0,this.tState=STRING1)):this.charError(buffer,i)):this.tState===NUMBER1?(n=buffer[i],48===n?(this.magnatude=0,this.tState=NUMBER2):n>48&&64>n?(this.magnatude=n-48,this.tState=NUMBER3):this.charError(buffer,i)):this.tState===NUMBER2?(n=buffer[i],46===n?(this.position=.1,this.tState=NUMBER4):101===n||69===n?(this.exponent=0,this.tState=NUMBER6):(this.tState=START,this.onToken(NUMBER,0),this.magnatude=void 0,this.negative=void 0,i--)):this.tState===NUMBER3?(n=buffer[i],46===n?(this.position=.1,this.tState=NUMBER4):101===n||69===n?(this.exponent=0,this.tState=NUMBER6):n>=48&&64>n?this.magnatude=10*this.magnatude+n-48:(this.tState=START,this.negative&&(this.magnatude=-this.magnatude,this.negative=void 0),this.onToken(NUMBER,this.magnatude),this.magnatude=void 0,i--)):this.tState===NUMBER4?(n=buffer[i],n>=48&&64>n?(this.magnatude+=this.position*(n-48),this.position/=10,this.tState=NUMBER5):this.charError(buffer,i)):this.tState===NUMBER5?(n=buffer[i],n>=48&&64>n?(this.magnatude+=this.position*(n-48),this.position/=10):101===n||69===n?(this.exponent=0,this.tState=NUMBER6):(this.tState=START,this.negative&&(this.magnatude=-this.magnatude,this.negative=void 0),this.onToken(NUMBER,this.negative?-this.magnatude:this.magnatude),this.magnatude=void 0,this.position=void 0,i--)):this.tState===NUMBER6?(n=buffer[i],43===n||45===n?(45===n&&(this.negativeExponent=!0),this.tState=NUMBER7):n>=48&&64>n?(this.exponent=10*this.exponent+(n-48),this.tState=NUMBER8):this.charError(buffer,i)):this.tState===NUMBER7?(n=buffer[i],n>=48&&64>n?(this.exponent=10*this.exponent+(n-48),this.tState=NUMBER8):this.charError(buffer,i)):this.tState===NUMBER8?(n=buffer[i],n>=48&&64>n?this.exponent=10*this.exponent+(n-48):(this.negativeExponent&&(this.exponent=-this.exponent,this.negativeExponent=void 0),this.magnatude*=Math.pow(10,this.exponent),this.exponent=void 0,this.negative&&(this.magnatude=-this.magnatude,this.negative=void 0),this.tState=START,this.onToken(NUMBER,this.magnatude),this.magnatude=void 0,i--)):this.tState===TRUE1?114===buffer[i]?this.tState=TRUE2:this.charError(buffer,i):this.tState===TRUE2?117===buffer[i]?this.tState=TRUE3:this.charError(buffer,i):this.tState===TRUE3?101===buffer[i]?(this.tState=START,this.onToken(TRUE,!0)):this.charError(buffer,i):this.tState===FALSE1?97===buffer[i]?this.tState=FALSE2:this.charError(buffer,i):this.tState===FALSE2?108===buffer[i]?this.tState=FALSE3:this.charError(buffer,i):this.tState===FALSE3?115===buffer[i]?this.tState=FALSE4:this.charError(buffer,i):this.tState===FALSE4?101===buffer[i]?(this.tState=START,this.onToken(FALSE,!1)):this.charError(buffer,i):this.tState===NULL1?117===buffer[i]?this.tState=NULL2:this.charError(buffer,i):this.tState===NULL2?108===buffer[i]?this.tState=NULL3:this.charError(buffer,i):this.tState===NULL3&&(108===buffer[i]?(this.tState=START,this.onToken(NULL,null)):this.charError(buffer,i))},proto.onToken=function(token,value){},proto.parseError=function(token,value){this.onError(new Error("Unexpected "+toknam(token)+(value?"("+JSON.stringify(value)+")":"")+" in state "+toknam(this.state)))},proto.onError=function(err){throw err},proto.push=function(){this.stack.push({value:this.value,key:this.key,mode:this.mode})},proto.pop=function(){var value=this.value,parent=this.stack.pop();this.value=parent.value,this.key=parent.key,this.mode=parent.mode,this.emit(value),this.mode||(this.state=VALUE)},proto.emit=function(value){this.mode&&(this.state=COMMA),this.onValue(value)},proto.onValue=function(value){},proto.onToken=function(token,value){this.state===VALUE?token===STRING||token===NUMBER||token===TRUE||token===FALSE||token===NULL?(this.value&&(this.value[this.key]=value),this.emit(value)):token===LEFT_BRACE?(this.push(),this.value=this.value?this.value[this.key]={}:{},this.key=void 0,this.state=KEY,this.mode=OBJECT):token===LEFT_BRACKET?(this.push(),this.value=this.value?this.value[this.key]=[]:[],this.key=0,this.mode=ARRAY,this.state=VALUE):token===RIGHT_BRACE?this.mode===OBJECT?this.pop():this.parseError(token,value):token===RIGHT_BRACKET&&this.mode===ARRAY?this.pop():this.parseError(token,value):this.state===KEY?token===STRING?(this.key=value,this.state=COLON):token===RIGHT_BRACE?this.pop():this.parseError(token,value):this.state===COLON?token===COLON?this.state=VALUE:this.parseError(token,value):this.state===COMMA?token===COMMA?this.mode===ARRAY?(this.key++,this.state=VALUE):this.mode===OBJECT&&(this.state=KEY):token===RIGHT_BRACKET&&this.mode===ARRAY||token===RIGHT_BRACE&&this.mode===OBJECT?this.pop():this.parseError(token,value):this.parseError(token,value)},module.exports=Parser}).call(this,require("buffer").Buffer)},{buffer:15}],73:[function(require,module,exports){(function(process){function through(write,end,opts){function drain(){for(;buffer.length&&!stream.paused;){var data=buffer.shift();if(null===data)return stream.emit("end");stream.emit("data",data)}}function _end(){stream.writable=!1,end.call(stream),!stream.readable&&stream.autoDestroy&&stream.destroy()}write=write||function(data){this.queue(data)},end=end||function(){this.queue(null)};var ended=!1,destroyed=!1,buffer=[],_ended=!1,stream=new Stream;return stream.readable=stream.writable=!0,stream.paused=!1,stream.autoDestroy=!(opts&&opts.autoDestroy===!1),stream.write=function(data){return write.call(this,data),!stream.paused},stream.queue=stream.push=function(data){return _ended?stream:(null===data&&(_ended=!0),buffer.push(data),drain(),stream)},stream.on("end",function(){stream.readable=!1,!stream.writable&&stream.autoDestroy&&process.nextTick(function(){stream.destroy()})}),stream.end=function(data){return ended?void 0:(ended=!0,arguments.length&&stream.write(data),_end(),stream)},stream.destroy=function(){return destroyed?void 0:(destroyed=!0,ended=!0,buffer.length=0,stream.writable=stream.readable=!1,stream.emit("close"),stream)},stream.pause=function(){return stream.paused?void 0:(stream.paused=!0,stream)},stream.resume=function(){return stream.paused&&(stream.paused=!1,stream.emit("resume")),drain(),stream.paused||stream.emit("drain"),stream},stream}var Stream=require("stream");exports=module.exports=through,through.through=through}).call(this,require("_process"))},{_process:24,stream:42}],74:[function(require,module,exports){!function(){function miniscore(){return{keys:Object.keys||function(obj){if("object"!=typeof obj&&"function"!=typeof obj||null===obj)throw new TypeError("keys() called on a non-object");var key,keys=[];for(key in obj)obj.hasOwnProperty(key)&&(keys[keys.length]=key);return keys},uniqueId:function(prefix){var id=++idCounter+"";return prefix?prefix+id:id},has:function(obj,key){return hasOwnProperty.call(obj,key)},each:function(obj,iterator,context){if(null!=obj)if(nativeForEach&&obj.forEach===nativeForEach)obj.forEach(iterator,context);else if(obj.length===+obj.length)for(var i=0,l=obj.length;l>i;i++)iterator.call(context,obj[i],i,obj);else for(var key in obj)this.has(obj,key)&&iterator.call(context,obj[key],key,obj)},once:function(func){var memo,ran=!1;return function(){return ran?memo:(ran=!0,memo=func.apply(this,arguments),func=null,memo)}}}}var Events,root=this,nativeForEach=Array.prototype.forEach,hasOwnProperty=Object.prototype.hasOwnProperty,slice=Array.prototype.slice,idCounter=0,_=miniscore();Events={on:function(name,callback,context){if(!eventsApi(this,"on",name,[callback,context])||!callback)return this;this._events||(this._events={});var events=this._events[name]||(this._events[name]=[]);return events.push({callback:callback,context:context,ctx:context||this}),this},once:function(name,callback,context){if(!eventsApi(this,"once",name,[callback,context])||!callback)return this;var self=this,once=_.once(function(){self.off(name,once),callback.apply(this,arguments)});return once._callback=callback,this.on(name,once,context)},off:function(name,callback,context){var retain,ev,events,names,i,l,j,k;if(!this._events||!eventsApi(this,"off",name,[callback,context]))return this;if(!name&&!callback&&!context)return this._events={},this;for(names=name?[name]:_.keys(this._events),i=0,l=names.length;l>i;i++)if(name=names[i],events=this._events[name]){if(this._events[name]=retain=[],callback||context)for(j=0,k=events.length;k>j;j++)ev=events[j],(callback&&callback!==ev.callback&&callback!==ev.callback._callback||context&&context!==ev.context)&&retain.push(ev);retain.length||delete this._events[name]}return this},trigger:function(name){if(!this._events)return this;var args=slice.call(arguments,1);if(!eventsApi(this,"trigger",name,args))return this;var events=this._events[name],allEvents=this._events.all;return events&&triggerEvents(events,args),allEvents&&triggerEvents(allEvents,arguments),this},stopListening:function(obj,name,callback){var listeners=this._listeners;if(!listeners)return this;var deleteListener=!name&&!callback;"object"==typeof name&&(callback=this),obj&&((listeners={})[obj._listenerId]=obj);for(var id in listeners)listeners[id].off(name,callback,this),deleteListener&&delete this._listeners[id];return this}};var eventSplitter=/\s+/,eventsApi=function(obj,action,name,rest){if(!name)return!0;if("object"==typeof name){for(var key in name)obj[action].apply(obj,[key,name[key]].concat(rest));return!1}if(eventSplitter.test(name)){for(var names=name.split(eventSplitter),i=0,l=names.length;l>i;i++)obj[action].apply(obj,[names[i]].concat(rest));return!1}return!0},triggerEvents=function(events,args){var ev,i=-1,l=events.length,a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx);return;case 1:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1);return;case 2:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1,a2);return;case 3:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1,a2,a3);return;default:for(;++i<l;)(ev=events[i]).callback.apply(ev.ctx,args)}},listenMethods={listenTo:"on",listenToOnce:"once"};_.each(listenMethods,function(implementation,method){Events[method]=function(obj,name,callback){var listeners=this._listeners||(this._listeners={}),id=obj._listenerId||(obj._listenerId=_.uniqueId("l"));return listeners[id]=obj,"object"==typeof name&&(callback=this),obj[implementation](name,callback,this),this}}),Events.bind=Events.on,Events.unbind=Events.off,Events.mixin=function(proto){var exports=["on","once","off","trigger","stopListening","listenTo","listenToOnce","bind","unbind"];return _.each(exports,function(name){proto[name]=this[name]},this),proto},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=Events),exports.BackboneEvents=Events):"function"==typeof define&&"object"==typeof define.amd?define(function(){return Events}):root.BackboneEvents=Events}(this)},{}],75:[function(require,module,exports){module.exports=require("./backbone-events-standalone")},{"./backbone-events-standalone":74}],76:[function(require,module,exports){(function(process,global){(function(){"use strict";function lib$es6$promise$utils$$objectOrFunction(x){return"function"==typeof x||"object"==typeof x&&null!==x}function lib$es6$promise$utils$$isFunction(x){return"function"==typeof x}function lib$es6$promise$utils$$isMaybeThenable(x){return"object"==typeof x&&null!==x}function lib$es6$promise$asap$$setScheduler(scheduleFn){lib$es6$promise$asap$$customSchedulerFn=scheduleFn}function lib$es6$promise$asap$$setAsap(asapFn){lib$es6$promise$asap$$asap=asapFn}function lib$es6$promise$asap$$useNextTick(){var nextTick=process.nextTick,version=process.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);return Array.isArray(version)&&"0"===version[1]&&"10"===version[2]&&(nextTick=setImmediate),function(){nextTick(lib$es6$promise$asap$$flush)}}function lib$es6$promise$asap$$useVertxTimer(){return function(){lib$es6$promise$asap$$vertxNext(lib$es6$promise$asap$$flush)}}function lib$es6$promise$asap$$useMutationObserver(){var iterations=0,observer=new lib$es6$promise$asap$$BrowserMutationObserver(lib$es6$promise$asap$$flush),node=document.createTextNode("");return observer.observe(node,{characterData:!0}),function(){node.data=iterations=++iterations%2}}function lib$es6$promise$asap$$useMessageChannel(){var channel=new MessageChannel;return channel.port1.onmessage=lib$es6$promise$asap$$flush,function(){channel.port2.postMessage(0)}}function lib$es6$promise$asap$$useSetTimeout(){return function(){setTimeout(lib$es6$promise$asap$$flush,1)}}function lib$es6$promise$asap$$flush(){for(var i=0;lib$es6$promise$asap$$len>i;i+=2){var callback=lib$es6$promise$asap$$queue[i],arg=lib$es6$promise$asap$$queue[i+1];callback(arg),lib$es6$promise$asap$$queue[i]=void 0,lib$es6$promise$asap$$queue[i+1]=void 0}lib$es6$promise$asap$$len=0}function lib$es6$promise$asap$$attemptVertex(){try{var r=require,vertx=r("vertx");return lib$es6$promise$asap$$vertxNext=vertx.runOnLoop||vertx.runOnContext,lib$es6$promise$asap$$useVertxTimer()}catch(e){return lib$es6$promise$asap$$useSetTimeout()}}function lib$es6$promise$$internal$$noop(){}function lib$es6$promise$$internal$$selfFullfillment(){return new TypeError("You cannot resolve a promise with itself")}function lib$es6$promise$$internal$$cannotReturnOwn(){return new TypeError("A promises callback cannot return that same promise.")}function lib$es6$promise$$internal$$getThen(promise){try{return promise.then}catch(error){return lib$es6$promise$$internal$$GET_THEN_ERROR.error=error,lib$es6$promise$$internal$$GET_THEN_ERROR}}function lib$es6$promise$$internal$$tryThen(then,value,fulfillmentHandler,rejectionHandler){try{then.call(value,fulfillmentHandler,rejectionHandler)}catch(e){return e}}function lib$es6$promise$$internal$$handleForeignThenable(promise,thenable,then){lib$es6$promise$asap$$asap(function(promise){var sealed=!1,error=lib$es6$promise$$internal$$tryThen(then,thenable,function(value){sealed||(sealed=!0,thenable!==value?lib$es6$promise$$internal$$resolve(promise,value):lib$es6$promise$$internal$$fulfill(promise,value))},function(reason){sealed||(sealed=!0,lib$es6$promise$$internal$$reject(promise,reason))},"Settle: "+(promise._label||" unknown promise"));!sealed&&error&&(sealed=!0,lib$es6$promise$$internal$$reject(promise,error))},promise)}function lib$es6$promise$$internal$$handleOwnThenable(promise,thenable){thenable._state===lib$es6$promise$$internal$$FULFILLED?lib$es6$promise$$internal$$fulfill(promise,thenable._result):thenable._state===lib$es6$promise$$internal$$REJECTED?lib$es6$promise$$internal$$reject(promise,thenable._result):lib$es6$promise$$internal$$subscribe(thenable,void 0,function(value){lib$es6$promise$$internal$$resolve(promise,value)},function(reason){lib$es6$promise$$internal$$reject(promise,reason)})}function lib$es6$promise$$internal$$handleMaybeThenable(promise,maybeThenable){if(maybeThenable.constructor===promise.constructor)lib$es6$promise$$internal$$handleOwnThenable(promise,maybeThenable);else{var then=lib$es6$promise$$internal$$getThen(maybeThenable);then===lib$es6$promise$$internal$$GET_THEN_ERROR?lib$es6$promise$$internal$$reject(promise,lib$es6$promise$$internal$$GET_THEN_ERROR.error):void 0===then?lib$es6$promise$$internal$$fulfill(promise,maybeThenable):lib$es6$promise$utils$$isFunction(then)?lib$es6$promise$$internal$$handleForeignThenable(promise,maybeThenable,then):lib$es6$promise$$internal$$fulfill(promise,maybeThenable)}}function lib$es6$promise$$internal$$resolve(promise,value){promise===value?lib$es6$promise$$internal$$reject(promise,lib$es6$promise$$internal$$selfFullfillment()):lib$es6$promise$utils$$objectOrFunction(value)?lib$es6$promise$$internal$$handleMaybeThenable(promise,value):lib$es6$promise$$internal$$fulfill(promise,value)}function lib$es6$promise$$internal$$publishRejection(promise){promise._onerror&&promise._onerror(promise._result),lib$es6$promise$$internal$$publish(promise)}function lib$es6$promise$$internal$$fulfill(promise,value){promise._state===lib$es6$promise$$internal$$PENDING&&(promise._result=value,promise._state=lib$es6$promise$$internal$$FULFILLED,0!==promise._subscribers.length&&lib$es6$promise$asap$$asap(lib$es6$promise$$internal$$publish,promise))}function lib$es6$promise$$internal$$reject(promise,reason){promise._state===lib$es6$promise$$internal$$PENDING&&(promise._state=lib$es6$promise$$internal$$REJECTED,promise._result=reason,lib$es6$promise$asap$$asap(lib$es6$promise$$internal$$publishRejection,promise))}function lib$es6$promise$$internal$$subscribe(parent,child,onFulfillment,onRejection){var subscribers=parent._subscribers,length=subscribers.length;parent._onerror=null,subscribers[length]=child,subscribers[length+lib$es6$promise$$internal$$FULFILLED]=onFulfillment,subscribers[length+lib$es6$promise$$internal$$REJECTED]=onRejection,0===length&&parent._state&&lib$es6$promise$asap$$asap(lib$es6$promise$$internal$$publish,parent)}function lib$es6$promise$$internal$$publish(promise){var subscribers=promise._subscribers,settled=promise._state;if(0!==subscribers.length){for(var child,callback,detail=promise._result,i=0;i<subscribers.length;i+=3)child=subscribers[i],callback=subscribers[i+settled],child?lib$es6$promise$$internal$$invokeCallback(settled,child,callback,detail):callback(detail);promise._subscribers.length=0}}function lib$es6$promise$$internal$$ErrorObject(){this.error=null}function lib$es6$promise$$internal$$tryCatch(callback,detail){try{return callback(detail)}catch(e){return lib$es6$promise$$internal$$TRY_CATCH_ERROR.error=e,lib$es6$promise$$internal$$TRY_CATCH_ERROR}}function lib$es6$promise$$internal$$invokeCallback(settled,promise,callback,detail){var value,error,succeeded,failed,hasCallback=lib$es6$promise$utils$$isFunction(callback);if(hasCallback){if(value=lib$es6$promise$$internal$$tryCatch(callback,detail),value===lib$es6$promise$$internal$$TRY_CATCH_ERROR?(failed=!0,error=value.error,value=null):succeeded=!0,
promise===value)return void lib$es6$promise$$internal$$reject(promise,lib$es6$promise$$internal$$cannotReturnOwn())}else value=detail,succeeded=!0;promise._state!==lib$es6$promise$$internal$$PENDING||(hasCallback&&succeeded?lib$es6$promise$$internal$$resolve(promise,value):failed?lib$es6$promise$$internal$$reject(promise,error):settled===lib$es6$promise$$internal$$FULFILLED?lib$es6$promise$$internal$$fulfill(promise,value):settled===lib$es6$promise$$internal$$REJECTED&&lib$es6$promise$$internal$$reject(promise,value))}function lib$es6$promise$$internal$$initializePromise(promise,resolver){try{resolver(function(value){lib$es6$promise$$internal$$resolve(promise,value)},function(reason){lib$es6$promise$$internal$$reject(promise,reason)})}catch(e){lib$es6$promise$$internal$$reject(promise,e)}}function lib$es6$promise$enumerator$$Enumerator(Constructor,input){var enumerator=this;enumerator._instanceConstructor=Constructor,enumerator.promise=new Constructor(lib$es6$promise$$internal$$noop),enumerator._validateInput(input)?(enumerator._input=input,enumerator.length=input.length,enumerator._remaining=input.length,enumerator._init(),0===enumerator.length?lib$es6$promise$$internal$$fulfill(enumerator.promise,enumerator._result):(enumerator.length=enumerator.length||0,enumerator._enumerate(),0===enumerator._remaining&&lib$es6$promise$$internal$$fulfill(enumerator.promise,enumerator._result))):lib$es6$promise$$internal$$reject(enumerator.promise,enumerator._validationError())}function lib$es6$promise$promise$all$$all(entries){return new lib$es6$promise$enumerator$$default(this,entries).promise}function lib$es6$promise$promise$race$$race(entries){function onFulfillment(value){lib$es6$promise$$internal$$resolve(promise,value)}function onRejection(reason){lib$es6$promise$$internal$$reject(promise,reason)}var Constructor=this,promise=new Constructor(lib$es6$promise$$internal$$noop);if(!lib$es6$promise$utils$$isArray(entries))return lib$es6$promise$$internal$$reject(promise,new TypeError("You must pass an array to race.")),promise;for(var length=entries.length,i=0;promise._state===lib$es6$promise$$internal$$PENDING&&length>i;i++)lib$es6$promise$$internal$$subscribe(Constructor.resolve(entries[i]),void 0,onFulfillment,onRejection);return promise}function lib$es6$promise$promise$resolve$$resolve(object){var Constructor=this;if(object&&"object"==typeof object&&object.constructor===Constructor)return object;var promise=new Constructor(lib$es6$promise$$internal$$noop);return lib$es6$promise$$internal$$resolve(promise,object),promise}function lib$es6$promise$promise$reject$$reject(reason){var Constructor=this,promise=new Constructor(lib$es6$promise$$internal$$noop);return lib$es6$promise$$internal$$reject(promise,reason),promise}function lib$es6$promise$promise$$needsResolver(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function lib$es6$promise$promise$$needsNew(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function lib$es6$promise$promise$$Promise(resolver){this._id=lib$es6$promise$promise$$counter++,this._state=void 0,this._result=void 0,this._subscribers=[],lib$es6$promise$$internal$$noop!==resolver&&(lib$es6$promise$utils$$isFunction(resolver)||lib$es6$promise$promise$$needsResolver(),this instanceof lib$es6$promise$promise$$Promise||lib$es6$promise$promise$$needsNew(),lib$es6$promise$$internal$$initializePromise(this,resolver))}function lib$es6$promise$polyfill$$polyfill(){var local;if("undefined"!=typeof global)local=global;else if("undefined"!=typeof self)local=self;else try{local=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var P=local.Promise;(!P||"[object Promise]"!==Object.prototype.toString.call(P.resolve())||P.cast)&&(local.Promise=lib$es6$promise$promise$$default)}var lib$es6$promise$utils$$_isArray;lib$es6$promise$utils$$_isArray=Array.isArray?Array.isArray:function(x){return"[object Array]"===Object.prototype.toString.call(x)};var lib$es6$promise$asap$$vertxNext,lib$es6$promise$asap$$customSchedulerFn,lib$es6$promise$asap$$scheduleFlush,lib$es6$promise$utils$$isArray=lib$es6$promise$utils$$_isArray,lib$es6$promise$asap$$len=0,lib$es6$promise$asap$$asap=({}.toString,function(callback,arg){lib$es6$promise$asap$$queue[lib$es6$promise$asap$$len]=callback,lib$es6$promise$asap$$queue[lib$es6$promise$asap$$len+1]=arg,lib$es6$promise$asap$$len+=2,2===lib$es6$promise$asap$$len&&(lib$es6$promise$asap$$customSchedulerFn?lib$es6$promise$asap$$customSchedulerFn(lib$es6$promise$asap$$flush):lib$es6$promise$asap$$scheduleFlush())}),lib$es6$promise$asap$$browserWindow="undefined"!=typeof window?window:void 0,lib$es6$promise$asap$$browserGlobal=lib$es6$promise$asap$$browserWindow||{},lib$es6$promise$asap$$BrowserMutationObserver=lib$es6$promise$asap$$browserGlobal.MutationObserver||lib$es6$promise$asap$$browserGlobal.WebKitMutationObserver,lib$es6$promise$asap$$isNode="undefined"!=typeof process&&"[object process]"==={}.toString.call(process),lib$es6$promise$asap$$isWorker="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,lib$es6$promise$asap$$queue=new Array(1e3);lib$es6$promise$asap$$scheduleFlush=lib$es6$promise$asap$$isNode?lib$es6$promise$asap$$useNextTick():lib$es6$promise$asap$$BrowserMutationObserver?lib$es6$promise$asap$$useMutationObserver():lib$es6$promise$asap$$isWorker?lib$es6$promise$asap$$useMessageChannel():void 0===lib$es6$promise$asap$$browserWindow&&"function"==typeof require?lib$es6$promise$asap$$attemptVertex():lib$es6$promise$asap$$useSetTimeout();var lib$es6$promise$$internal$$PENDING=void 0,lib$es6$promise$$internal$$FULFILLED=1,lib$es6$promise$$internal$$REJECTED=2,lib$es6$promise$$internal$$GET_THEN_ERROR=new lib$es6$promise$$internal$$ErrorObject,lib$es6$promise$$internal$$TRY_CATCH_ERROR=new lib$es6$promise$$internal$$ErrorObject;lib$es6$promise$enumerator$$Enumerator.prototype._validateInput=function(input){return lib$es6$promise$utils$$isArray(input)},lib$es6$promise$enumerator$$Enumerator.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},lib$es6$promise$enumerator$$Enumerator.prototype._init=function(){this._result=new Array(this.length)};var lib$es6$promise$enumerator$$default=lib$es6$promise$enumerator$$Enumerator;lib$es6$promise$enumerator$$Enumerator.prototype._enumerate=function(){for(var enumerator=this,length=enumerator.length,promise=enumerator.promise,input=enumerator._input,i=0;promise._state===lib$es6$promise$$internal$$PENDING&&length>i;i++)enumerator._eachEntry(input[i],i)},lib$es6$promise$enumerator$$Enumerator.prototype._eachEntry=function(entry,i){var enumerator=this,c=enumerator._instanceConstructor;lib$es6$promise$utils$$isMaybeThenable(entry)?entry.constructor===c&&entry._state!==lib$es6$promise$$internal$$PENDING?(entry._onerror=null,enumerator._settledAt(entry._state,i,entry._result)):enumerator._willSettleAt(c.resolve(entry),i):(enumerator._remaining--,enumerator._result[i]=entry)},lib$es6$promise$enumerator$$Enumerator.prototype._settledAt=function(state,i,value){var enumerator=this,promise=enumerator.promise;promise._state===lib$es6$promise$$internal$$PENDING&&(enumerator._remaining--,state===lib$es6$promise$$internal$$REJECTED?lib$es6$promise$$internal$$reject(promise,value):enumerator._result[i]=value),0===enumerator._remaining&&lib$es6$promise$$internal$$fulfill(promise,enumerator._result)},lib$es6$promise$enumerator$$Enumerator.prototype._willSettleAt=function(promise,i){var enumerator=this;lib$es6$promise$$internal$$subscribe(promise,void 0,function(value){enumerator._settledAt(lib$es6$promise$$internal$$FULFILLED,i,value)},function(reason){enumerator._settledAt(lib$es6$promise$$internal$$REJECTED,i,reason)})};var lib$es6$promise$promise$all$$default=lib$es6$promise$promise$all$$all,lib$es6$promise$promise$race$$default=lib$es6$promise$promise$race$$race,lib$es6$promise$promise$resolve$$default=lib$es6$promise$promise$resolve$$resolve,lib$es6$promise$promise$reject$$default=lib$es6$promise$promise$reject$$reject,lib$es6$promise$promise$$counter=0,lib$es6$promise$promise$$default=lib$es6$promise$promise$$Promise;lib$es6$promise$promise$$Promise.all=lib$es6$promise$promise$all$$default,lib$es6$promise$promise$$Promise.race=lib$es6$promise$promise$race$$default,lib$es6$promise$promise$$Promise.resolve=lib$es6$promise$promise$resolve$$default,lib$es6$promise$promise$$Promise.reject=lib$es6$promise$promise$reject$$default,lib$es6$promise$promise$$Promise._setScheduler=lib$es6$promise$asap$$setScheduler,lib$es6$promise$promise$$Promise._setAsap=lib$es6$promise$asap$$setAsap,lib$es6$promise$promise$$Promise._asap=lib$es6$promise$asap$$asap,lib$es6$promise$promise$$Promise.prototype={constructor:lib$es6$promise$promise$$Promise,then:function(onFulfillment,onRejection){var parent=this,state=parent._state;if(state===lib$es6$promise$$internal$$FULFILLED&&!onFulfillment||state===lib$es6$promise$$internal$$REJECTED&&!onRejection)return this;var child=new this.constructor(lib$es6$promise$$internal$$noop),result=parent._result;if(state){var callback=arguments[state-1];lib$es6$promise$asap$$asap(function(){lib$es6$promise$$internal$$invokeCallback(state,child,callback,result)})}else lib$es6$promise$$internal$$subscribe(parent,child,onFulfillment,onRejection);return child},"catch":function(onRejection){return this.then(null,onRejection)}};var lib$es6$promise$polyfill$$default=lib$es6$promise$polyfill$$polyfill,lib$es6$promise$umd$$ES6Promise={Promise:lib$es6$promise$promise$$default,polyfill:lib$es6$promise$polyfill$$default};"function"==typeof define&&define.amd?define(function(){return lib$es6$promise$umd$$ES6Promise}):"undefined"!=typeof module&&module.exports?module.exports=lib$es6$promise$umd$$ES6Promise:"undefined"!=typeof this&&(this.ES6Promise=lib$es6$promise$umd$$ES6Promise),lib$es6$promise$polyfill$$default()}).call(this)}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:24}],77:[function(require,module,exports){(function(){function createReduce(dir){function iterator(obj,iteratee,memo,keys,index,length){for(;index>=0&&length>index;index+=dir){var currentKey=keys?keys[index]:index;memo=iteratee(memo,obj[currentKey],currentKey,obj)}return memo}return function(obj,iteratee,memo,context){iteratee=optimizeCb(iteratee,context,4);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=dir>0?0:length-1;return arguments.length<3&&(memo=obj[keys?keys[index]:index],index+=dir),iterator(obj,iteratee,memo,keys,index,length)}}function createPredicateIndexFinder(dir){return function(array,predicate,context){predicate=cb(predicate,context);for(var length=getLength(array),index=dir>0?0:length-1;index>=0&&length>index;index+=dir)if(predicate(array[index],index,array))return index;return-1}}function createIndexFinder(dir,predicateFind,sortedIndex){return function(array,item,idx){var i=0,length=getLength(array);if("number"==typeof idx)dir>0?i=idx>=0?idx:Math.max(idx+length,i):length=idx>=0?Math.min(idx+1,length):idx+length+1;else if(sortedIndex&&idx&&length)return idx=sortedIndex(array,item),array[idx]===item?idx:-1;if(item!==item)return idx=predicateFind(slice.call(array,i,length),_.isNaN),idx>=0?idx+i:-1;for(idx=dir>0?i:length-1;idx>=0&&length>idx;idx+=dir)if(array[idx]===item)return idx;return-1}}function collectNonEnumProps(obj,keys){var nonEnumIdx=nonEnumerableProps.length,constructor=obj.constructor,proto=_.isFunction(constructor)&&constructor.prototype||ObjProto,prop="constructor";for(_.has(obj,prop)&&!_.contains(keys,prop)&&keys.push(prop);nonEnumIdx--;)prop=nonEnumerableProps[nonEnumIdx],prop in obj&&obj[prop]!==proto[prop]&&!_.contains(keys,prop)&&keys.push(prop)}var root=this,previousUnderscore=root._,ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype,push=ArrayProto.push,slice=ArrayProto.slice,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind,nativeCreate=Object.create,Ctor=function(){},_=function(obj){return obj instanceof _?obj:this instanceof _?void(this._wrapped=obj):new _(obj)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=_),exports._=_):root._=_,_.VERSION="1.8.3";var optimizeCb=function(func,context,argCount){if(void 0===context)return func;switch(null==argCount?3:argCount){case 1:return function(value){return func.call(context,value)};case 2:return function(value,other){return func.call(context,value,other)};case 3:return function(value,index,collection){return func.call(context,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(context,accumulator,value,index,collection)}}return function(){return func.apply(context,arguments)}},cb=function(value,context,argCount){return null==value?_.identity:_.isFunction(value)?optimizeCb(value,context,argCount):_.isObject(value)?_.matcher(value):_.property(value)};_.iteratee=function(value,context){return cb(value,context,1/0)};var createAssigner=function(keysFunc,undefinedOnly){return function(obj){var length=arguments.length;if(2>length||null==obj)return obj;for(var index=1;length>index;index++)for(var source=arguments[index],keys=keysFunc(source),l=keys.length,i=0;l>i;i++){var key=keys[i];undefinedOnly&&void 0!==obj[key]||(obj[key]=source[key])}return obj}},baseCreate=function(prototype){if(!_.isObject(prototype))return{};if(nativeCreate)return nativeCreate(prototype);Ctor.prototype=prototype;var result=new Ctor;return Ctor.prototype=null,result},property=function(key){return function(obj){return null==obj?void 0:obj[key]}},MAX_ARRAY_INDEX=Math.pow(2,53)-1,getLength=property("length"),isArrayLike=function(collection){var length=getLength(collection);return"number"==typeof length&&length>=0&&MAX_ARRAY_INDEX>=length};_.each=_.forEach=function(obj,iteratee,context){iteratee=optimizeCb(iteratee,context);var i,length;if(isArrayLike(obj))for(i=0,length=obj.length;length>i;i++)iteratee(obj[i],i,obj);else{var keys=_.keys(obj);for(i=0,length=keys.length;length>i;i++)iteratee(obj[keys[i]],keys[i],obj)}return obj},_.map=_.collect=function(obj,iteratee,context){iteratee=cb(iteratee,context);for(var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,results=Array(length),index=0;length>index;index++){var currentKey=keys?keys[index]:index;results[index]=iteratee(obj[currentKey],currentKey,obj)}return results},_.reduce=_.foldl=_.inject=createReduce(1),_.reduceRight=_.foldr=createReduce(-1),_.find=_.detect=function(obj,predicate,context){var key;return key=isArrayLike(obj)?_.findIndex(obj,predicate,context):_.findKey(obj,predicate,context),void 0!==key&&-1!==key?obj[key]:void 0},_.filter=_.select=function(obj,predicate,context){var results=[];return predicate=cb(predicate,context),_.each(obj,function(value,index,list){predicate(value,index,list)&&results.push(value)}),results},_.reject=function(obj,predicate,context){return _.filter(obj,_.negate(cb(predicate)),context)},_.every=_.all=function(obj,predicate,context){predicate=cb(predicate,context);for(var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=0;length>index;index++){var currentKey=keys?keys[index]:index;if(!predicate(obj[currentKey],currentKey,obj))return!1}return!0},_.some=_.any=function(obj,predicate,context){predicate=cb(predicate,context);for(var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=0;length>index;index++){var currentKey=keys?keys[index]:index;if(predicate(obj[currentKey],currentKey,obj))return!0}return!1},_.contains=_.includes=_.include=function(obj,item,fromIndex,guard){return isArrayLike(obj)||(obj=_.values(obj)),("number"!=typeof fromIndex||guard)&&(fromIndex=0),_.indexOf(obj,item,fromIndex)>=0},_.invoke=function(obj,method){var args=slice.call(arguments,2),isFunc=_.isFunction(method);return _.map(obj,function(value){var func=isFunc?method:value[method];return null==func?func:func.apply(value,args)})},_.pluck=function(obj,key){return _.map(obj,_.property(key))},_.where=function(obj,attrs){return _.filter(obj,_.matcher(attrs))},_.findWhere=function(obj,attrs){return _.find(obj,_.matcher(attrs))},_.max=function(obj,iteratee,context){var value,computed,result=-(1/0),lastComputed=-(1/0);if(null==iteratee&&null!=obj){obj=isArrayLike(obj)?obj:_.values(obj);for(var i=0,length=obj.length;length>i;i++)value=obj[i],value>result&&(result=value)}else iteratee=cb(iteratee,context),_.each(obj,function(value,index,list){computed=iteratee(value,index,list),(computed>lastComputed||computed===-(1/0)&&result===-(1/0))&&(result=value,lastComputed=computed)});return result},_.min=function(obj,iteratee,context){var value,computed,result=1/0,lastComputed=1/0;if(null==iteratee&&null!=obj){obj=isArrayLike(obj)?obj:_.values(obj);for(var i=0,length=obj.length;length>i;i++)value=obj[i],result>value&&(result=value)}else iteratee=cb(iteratee,context),_.each(obj,function(value,index,list){computed=iteratee(value,index,list),(lastComputed>computed||computed===1/0&&result===1/0)&&(result=value,lastComputed=computed)});return result},_.shuffle=function(obj){for(var rand,set=isArrayLike(obj)?obj:_.values(obj),length=set.length,shuffled=Array(length),index=0;length>index;index++)rand=_.random(0,index),rand!==index&&(shuffled[index]=shuffled[rand]),shuffled[rand]=set[index];return shuffled},_.sample=function(obj,n,guard){return null==n||guard?(isArrayLike(obj)||(obj=_.values(obj)),obj[_.random(obj.length-1)]):_.shuffle(obj).slice(0,Math.max(0,n))},_.sortBy=function(obj,iteratee,context){return iteratee=cb(iteratee,context),_.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iteratee(value,index,list)}}).sort(function(left,right){var a=left.criteria,b=right.criteria;if(a!==b){if(a>b||void 0===a)return 1;if(b>a||void 0===b)return-1}return left.index-right.index}),"value")};var group=function(behavior){return function(obj,iteratee,context){var result={};return iteratee=cb(iteratee,context),_.each(obj,function(value,index){var key=iteratee(value,index,obj);behavior(result,value,key)}),result}};_.groupBy=group(function(result,value,key){_.has(result,key)?result[key].push(value):result[key]=[value]}),_.indexBy=group(function(result,value,key){result[key]=value}),_.countBy=group(function(result,value,key){_.has(result,key)?result[key]++:result[key]=1}),_.toArray=function(obj){return obj?_.isArray(obj)?slice.call(obj):isArrayLike(obj)?_.map(obj,_.identity):_.values(obj):[]},_.size=function(obj){return null==obj?0:isArrayLike(obj)?obj.length:_.keys(obj).length},_.partition=function(obj,predicate,context){predicate=cb(predicate,context);var pass=[],fail=[];return _.each(obj,function(value,key,obj){(predicate(value,key,obj)?pass:fail).push(value)}),[pass,fail]},_.first=_.head=_.take=function(array,n,guard){return null==array?void 0:null==n||guard?array[0]:_.initial(array,array.length-n)},_.initial=function(array,n,guard){return slice.call(array,0,Math.max(0,array.length-(null==n||guard?1:n)))},_.last=function(array,n,guard){return null==array?void 0:null==n||guard?array[array.length-1]:_.rest(array,Math.max(0,array.length-n))},_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,null==n||guard?1:n)},_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,strict,startIndex){for(var output=[],idx=0,i=startIndex||0,length=getLength(input);length>i;i++){var value=input[i];if(isArrayLike(value)&&(_.isArray(value)||_.isArguments(value))){shallow||(value=flatten(value,shallow,strict));var j=0,len=value.length;for(output.length+=len;len>j;)output[idx++]=value[j++]}else strict||(output[idx++]=value)}return output};_.flatten=function(array,shallow){return flatten(array,shallow,!1)},_.without=function(array){return _.difference(array,slice.call(arguments,1))},_.uniq=_.unique=function(array,isSorted,iteratee,context){_.isBoolean(isSorted)||(context=iteratee,iteratee=isSorted,isSorted=!1),null!=iteratee&&(iteratee=cb(iteratee,context));for(var result=[],seen=[],i=0,length=getLength(array);length>i;i++){var value=array[i],computed=iteratee?iteratee(value,i,array):value;isSorted?(i&&seen===computed||result.push(value),seen=computed):iteratee?_.contains(seen,computed)||(seen.push(computed),result.push(value)):_.contains(result,value)||result.push(value)}return result},_.union=function(){return _.uniq(flatten(arguments,!0,!0))},_.intersection=function(array){for(var result=[],argsLength=arguments.length,i=0,length=getLength(array);length>i;i++){var item=array[i];if(!_.contains(result,item)){for(var j=1;argsLength>j&&_.contains(arguments[j],item);j++);j===argsLength&&result.push(item)}}return result},_.difference=function(array){var rest=flatten(arguments,!0,!0,1);return _.filter(array,function(value){return!_.contains(rest,value)})},_.zip=function(){return _.unzip(arguments)},_.unzip=function(array){for(var length=array&&_.max(array,getLength).length||0,result=Array(length),index=0;length>index;index++)result[index]=_.pluck(array,index);return result},_.object=function(list,values){for(var result={},i=0,length=getLength(list);length>i;i++)values?result[list[i]]=values[i]:result[list[i][0]]=list[i][1];return result},_.findIndex=createPredicateIndexFinder(1),_.findLastIndex=createPredicateIndexFinder(-1),_.sortedIndex=function(array,obj,iteratee,context){iteratee=cb(iteratee,context,1);for(var value=iteratee(obj),low=0,high=getLength(array);high>low;){var mid=Math.floor((low+high)/2);iteratee(array[mid])<value?low=mid+1:high=mid}return low},_.indexOf=createIndexFinder(1,_.findIndex,_.sortedIndex),_.lastIndexOf=createIndexFinder(-1,_.findLastIndex),_.range=function(start,stop,step){null==stop&&(stop=start||0,start=0),step=step||1;for(var length=Math.max(Math.ceil((stop-start)/step),0),range=Array(length),idx=0;length>idx;idx++,start+=step)range[idx]=start;return range};var executeBound=function(sourceFunc,boundFunc,context,callingContext,args){if(!(callingContext instanceof boundFunc))return sourceFunc.apply(context,args);var self=baseCreate(sourceFunc.prototype),result=sourceFunc.apply(self,args);return _.isObject(result)?result:self};_.bind=function(func,context){if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError("Bind must be called on a function");var args=slice.call(arguments,2),bound=function(){return executeBound(func,bound,context,this,args.concat(slice.call(arguments)))};return bound},_.partial=function(func){var boundArgs=slice.call(arguments,1),bound=function(){for(var position=0,length=boundArgs.length,args=Array(length),i=0;length>i;i++)args[i]=boundArgs[i]===_?arguments[position++]:boundArgs[i];for(;position<arguments.length;)args.push(arguments[position++]);return executeBound(func,bound,this,this,args)};return bound},_.bindAll=function(obj){var i,key,length=arguments.length;if(1>=length)throw new Error("bindAll must be passed function names");for(i=1;length>i;i++)key=arguments[i],obj[key]=_.bind(obj[key],obj);return obj},_.memoize=function(func,hasher){var memoize=function(key){var cache=memoize.cache,address=""+(hasher?hasher.apply(this,arguments):key);return _.has(cache,address)||(cache[address]=func.apply(this,arguments)),cache[address]};return memoize.cache={},memoize},_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)},_.defer=_.partial(_.delay,_,1),_.throttle=function(func,wait,options){var context,args,result,timeout=null,previous=0;options||(options={});var later=function(){previous=options.leading===!1?0:_.now(),timeout=null,result=func.apply(context,args),timeout||(context=args=null)};return function(){var now=_.now();previous||options.leading!==!1||(previous=now);var remaining=wait-(now-previous);return context=this,args=arguments,0>=remaining||remaining>wait?(timeout&&(clearTimeout(timeout),timeout=null),previous=now,result=func.apply(context,args),timeout||(context=args=null)):timeout||options.trailing===!1||(timeout=setTimeout(later,remaining)),result}},_.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result,later=function(){var last=_.now()-timestamp;wait>last&&last>=0?timeout=setTimeout(later,wait-last):(timeout=null,immediate||(result=func.apply(context,args),timeout||(context=args=null)))};return function(){context=this,args=arguments,timestamp=_.now();var callNow=immediate&&!timeout;return timeout||(timeout=setTimeout(later,wait)),callNow&&(result=func.apply(context,args),context=args=null),result}},_.wrap=function(func,wrapper){return _.partial(wrapper,func)},_.negate=function(predicate){return function(){return!predicate.apply(this,arguments)}},_.compose=function(){var args=arguments,start=args.length-1;return function(){for(var i=start,result=args[start].apply(this,arguments);i--;)result=args[i].call(this,result);return result}},_.after=function(times,func){return function(){return--times<1?func.apply(this,arguments):void 0}},_.before=function(times,func){var memo;return function(){return--times>0&&(memo=func.apply(this,arguments)),1>=times&&(func=null),memo}},_.once=_.partial(_.before,2);var hasEnumBug=!{toString:null}.propertyIsEnumerable("toString"),nonEnumerableProps=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];_.keys=function(obj){if(!_.isObject(obj))return[];if(nativeKeys)return nativeKeys(obj);var keys=[];for(var key in obj)_.has(obj,key)&&keys.push(key);return hasEnumBug&&collectNonEnumProps(obj,keys),keys},_.allKeys=function(obj){if(!_.isObject(obj))return[];var keys=[];for(var key in obj)keys.push(key);return hasEnumBug&&collectNonEnumProps(obj,keys),keys},_.values=function(obj){for(var keys=_.keys(obj),length=keys.length,values=Array(length),i=0;length>i;i++)values[i]=obj[keys[i]];return values},_.mapObject=function(obj,iteratee,context){iteratee=cb(iteratee,context);for(var currentKey,keys=_.keys(obj),length=keys.length,results={},index=0;length>index;index++)currentKey=keys[index],results[currentKey]=iteratee(obj[currentKey],currentKey,obj);return results},_.pairs=function(obj){for(var keys=_.keys(obj),length=keys.length,pairs=Array(length),i=0;length>i;i++)pairs[i]=[keys[i],obj[keys[i]]];return pairs},_.invert=function(obj){for(var result={},keys=_.keys(obj),i=0,length=keys.length;length>i;i++)result[obj[keys[i]]]=keys[i];return result},_.functions=_.methods=function(obj){var names=[];for(var key in obj)_.isFunction(obj[key])&&names.push(key);return names.sort()},_.extend=createAssigner(_.allKeys),_.extendOwn=_.assign=createAssigner(_.keys),_.findKey=function(obj,predicate,context){predicate=cb(predicate,context);for(var key,keys=_.keys(obj),i=0,length=keys.length;length>i;i++)if(key=keys[i],predicate(obj[key],key,obj))return key},_.pick=function(object,oiteratee,context){var iteratee,keys,result={},obj=object;if(null==obj)return result;_.isFunction(oiteratee)?(keys=_.allKeys(obj),iteratee=optimizeCb(oiteratee,context)):(keys=flatten(arguments,!1,!1,1),iteratee=function(value,key,obj){return key in obj},obj=Object(obj));for(var i=0,length=keys.length;length>i;i++){var key=keys[i],value=obj[key];iteratee(value,key,obj)&&(result[key]=value)}return result},_.omit=function(obj,iteratee,context){if(_.isFunction(iteratee))iteratee=_.negate(iteratee);else{var keys=_.map(flatten(arguments,!1,!1,1),String);iteratee=function(value,key){return!_.contains(keys,key)}}return _.pick(obj,iteratee,context)},_.defaults=createAssigner(_.allKeys,!0),_.create=function(prototype,props){var result=baseCreate(prototype);return props&&_.extendOwn(result,props),result},_.clone=function(obj){return _.isObject(obj)?_.isArray(obj)?obj.slice():_.extend({},obj):obj},_.tap=function(obj,interceptor){return interceptor(obj),obj},_.isMatch=function(object,attrs){var keys=_.keys(attrs),length=keys.length;if(null==object)return!length;for(var obj=Object(object),i=0;length>i;i++){var key=keys[i];if(attrs[key]!==obj[key]||!(key in obj))return!1}return!0};var eq=function(a,b,aStack,bStack){if(a===b)return 0!==a||1/a===1/b;if(null==a||null==b)return a===b;a instanceof _&&(a=a._wrapped),b instanceof _&&(b=b._wrapped);var className=toString.call(a);if(className!==toString.call(b))return!1;switch(className){case"[object RegExp]":case"[object String]":return""+a==""+b;case"[object Number]":return+a!==+a?+b!==+b:0===+a?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}var areArrays="[object Array]"===className;if(!areArrays){if("object"!=typeof a||"object"!=typeof b)return!1;var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)&&"constructor"in a&&"constructor"in b)return!1}aStack=aStack||[],bStack=bStack||[];for(var length=aStack.length;length--;)if(aStack[length]===a)return bStack[length]===b;if(aStack.push(a),bStack.push(b),areArrays){if(length=a.length,length!==b.length)return!1;for(;length--;)if(!eq(a[length],b[length],aStack,bStack))return!1}else{var key,keys=_.keys(a);if(length=keys.length,_.keys(b).length!==length)return!1;for(;length--;)if(key=keys[length],!_.has(b,key)||!eq(a[key],b[key],aStack,bStack))return!1}return aStack.pop(),bStack.pop(),!0};_.isEqual=function(a,b){return eq(a,b)},_.isEmpty=function(obj){return null==obj?!0:isArrayLike(obj)&&(_.isArray(obj)||_.isString(obj)||_.isArguments(obj))?0===obj.length:0===_.keys(obj).length},_.isElement=function(obj){return!(!obj||1!==obj.nodeType)},_.isArray=nativeIsArray||function(obj){return"[object Array]"===toString.call(obj)},_.isObject=function(obj){var type=typeof obj;return"function"===type||"object"===type&&!!obj},_.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(name){_["is"+name]=function(obj){return toString.call(obj)==="[object "+name+"]"}}),_.isArguments(arguments)||(_.isArguments=function(obj){return _.has(obj,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(_.isFunction=function(obj){return"function"==typeof obj||!1}),_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))},_.isNaN=function(obj){return _.isNumber(obj)&&obj!==+obj},_.isBoolean=function(obj){return obj===!0||obj===!1||"[object Boolean]"===toString.call(obj)},_.isNull=function(obj){return null===obj},_.isUndefined=function(obj){return void 0===obj},_.has=function(obj,key){return null!=obj&&hasOwnProperty.call(obj,key)},_.noConflict=function(){return root._=previousUnderscore,this},_.identity=function(value){return value},_.constant=function(value){return function(){return value}},_.noop=function(){},_.property=property,_.propertyOf=function(obj){return null==obj?function(){}:function(key){return obj[key]}},_.matcher=_.matches=function(attrs){return attrs=_.extendOwn({},attrs),function(obj){return _.isMatch(obj,attrs)}},_.times=function(n,iteratee,context){var accum=Array(Math.max(0,n));iteratee=optimizeCb(iteratee,context,1);for(var i=0;n>i;i++)accum[i]=iteratee(i);return accum},_.random=function(min,max){return null==max&&(max=min,min=0),min+Math.floor(Math.random()*(max-min+1))},_.now=Date.now||function(){return(new Date).getTime()};var escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},unescapeMap=_.invert(escapeMap),createEscaper=function(map){var escaper=function(match){return map[match]},source="(?:"+_.keys(map).join("|")+")",testRegexp=RegExp(source),replaceRegexp=RegExp(source,"g");return function(string){return string=null==string?"":""+string,testRegexp.test(string)?string.replace(replaceRegexp,escaper):string}};_.escape=createEscaper(escapeMap),_.unescape=createEscaper(unescapeMap),_.result=function(object,property,fallback){
var value=null==object?void 0:object[property];return void 0===value&&(value=fallback),_.isFunction(value)?value.call(object):value};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id},_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/,escapes={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},escaper=/\\|'|\r|\n|\u2028|\u2029/g,escapeChar=function(match){return"\\"+escapes[match]};_.template=function(text,settings,oldSettings){!settings&&oldSettings&&(settings=oldSettings),settings=_.defaults({},settings,_.templateSettings);var matcher=RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g"),index=0,source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){return source+=text.slice(index,offset).replace(escaper,escapeChar),index=offset+match.length,escape?source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'":interpolate?source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'":evaluate&&(source+="';\n"+evaluate+"\n__p+='"),match}),source+="';\n",settings.variable||(source="with(obj||{}){\n"+source+"}\n"),source="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{var render=new Function(settings.variable||"obj","_",source)}catch(e){throw e.source=source,e}var template=function(data){return render.call(this,data,_)},argument=settings.variable||"obj";return template.source="function("+argument+"){\n"+source+"}",template},_.chain=function(obj){var instance=_(obj);return instance._chain=!0,instance};var result=function(instance,obj){return instance._chain?_(obj).chain():obj};_.mixin=function(obj){_.each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];return push.apply(args,arguments),result(this,func.apply(_,args))}})},_.mixin(_),_.each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;return method.apply(obj,arguments),"shift"!==name&&"splice"!==name||0!==obj.length||delete obj[0],result(this,obj)}}),_.each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result(this,method.apply(this._wrapped,arguments))}}),_.prototype.value=function(){return this._wrapped},_.prototype.valueOf=_.prototype.toJSON=_.prototype.value,_.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return _})}).call(this)},{}],78:[function(require,module,exports){module.exports='<body>\n  <div class="graph">\n    <div class="cy">\n      <div class="status loader"></div>\n    </div>\n    <div class="controls">\n      <div class="interactionFilter">\n        <div>Show the following interaction types:</div>\n        <div>\n          <button class="genetic">Genetic</button><button class="default selected">All</button><button class="physical">Physical</button>\n        </div>\n      </div>\n      <div class="secondaryControls">\n        <div class="reset">Reset&nbsp;view</div>\n        <div class="showTable">Show in table format</div>\n        <div class="export">Export&nbsp;graph\n          <div class="exportValues">\n            <select>\n              <option value="png">PNG</option>\n              <option value="jpg">JPG</option>\n              <option value="tsv">TSV</option>\n              <option value="csv" selected>CSV</option>\n            </select>\n            <button>Go!</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="nodeDetails">\n    <h2 class="nodeTitle"></h2>\n    <dl class="nodeInfo intro">\n      <dt class="intro">Click on a gene to get more info about it.</dt>\n    </dl>\n  </div>\n  <div class="tableView firstRun disabled"></div>\n</body>\n'},{}],79:[function(require,module,exports){module.exports='<dl class="child">\n  <dt>Type</dt>\n  <dd class="cym-type">{{=type}}</dd>\n  {{if (roles.length > 0) { }}\n    <dt>Roles</dt>\n    <dd class="roles">\n      <dl>\n        <dt>{{=roles[0]}}</dt>\n        <dd>{{=role1}}</dd>\n        <dt>{{=roles[1]}}</dt>\n        <dd>{{=role2}}</dd>\n      </dl>\n    </dd>\n  {{ } else { }}\n    <dt>Role</dt> <dd> {{=role1}} </dd>\n  {{ } }}\n  {{ if(dataSets.name) { }}\n    <dt>Data set</dt>\n    <dd class="dataSets child">{{=dataSets.name}}</dd>\n  {{ } else if (dataSets.length > 1) { }}\n    <dt>Data sets</dt>\n    <dd>\n      <ul class="dataSets">\n        {{for (var i=0; i <dataSets.length; i++) { }}\n          <li> {{= dataSets[i].name }} </li>\n        {{ } }}\n      </ul>\n    </dd>\n  {{ } }}\n</dl>\n'},{}]},{},[6])(6)});