!function t(e,n,r){function i(s,a){if(!n[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var c=n[s]={exports:{}};e[s][0].call(c.exports,function(t){var n=e[s][1][t];return i(n?n:t)},c,c.exports,t,e,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e,n){(function(r){!function(i){!function(t){if("object"==typeof n&&"undefined"!=typeof e)e.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var i;"undefined"!=typeof window?i=window:"undefined"!=typeof r?i=r:"undefined"!=typeof self&&(i=self),i.imjs=t()}}(function(){var e;return function n(e,r,i){function o(a,u){if(!r[a]){if(!e[a]){var h="function"==typeof t&&t;if(!u&&h)return h(a,!0);if(s)return s(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[a]={exports:{}};e[a][0].call(l.exports,function(t){var n=e[a][1][t];return o(n?n:t)},l,l.exports,n,e,r,i)}return r[a].exports}for(var s="function"==typeof t&&t,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(t,e,n){(function(){n.ACCEPT_HEADER={xml:"application/xml",json:"application/json",tsv:"text/tab-separated-values",tab:"text/tab-separated-values",csv:"text/comma-separated-values",fasta:"text/x-fasta",gff3:"text/x-gff3",bed:"text/x-bed",objects:"application/json;type=objects",jsonobjects:"application/json;type=objects",jsontable:"application/json;type=table",jsonrows:"application/json;type=rows",jsoncount:"application/json;type=count",jsonp:"application/javascript",jsonpobjects:"application/javascript;type=objects",jsonptable:"application/javascript;type=table",jsonprows:"application/javascript;type=rows",jsonpcount:"application/javascript;type=count"}}).call(this)},{}],2:[function(t,n,o){(function(r){(function(){var o,s,a;t("./shiv"),n.exports=s=t("./service"),a=s.utils.merge,o=function(t,n){return"function"==typeof e&&e.amd?e(t,[],n):r[t]=n},o("imjs",s),"undefined"==typeof i?o("intermine",s):o("intermine",a(i,s))}).call(this)}).call(this,"undefined"!=typeof r?r:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./service":10,"./shiv":12}],3:[function(t,e,n){(function(){var e,r,i,o,s,a,u,h,c,l,f,p,d,g,m,y,v,w,b;o=t("url"),r=t("JSONStream"),p=t("http"),e=t("./constants").ACCEPT_HEADER,u=t("./version").VERSION,b=w=t("./util"),l=b.error,c=b.defer,g=b.merge,d=b.invoke,a="node-http/imjs-"+u,i=/,\s*$/,s="application/x-www-form-urlencoded",n.supports=function(){return!0},v=function(t,e,n){return function(t){var i,o;return null==t.pipe?n(new Error("response is not a stream")):(t.on("error",n),null!=t.statusCode&&200!==t.statusCode?(i=r.parse("error"),i.pause(),t.pipe(i),n([t.statusCode,i])):(o=r.parse("results.*"),o.pause(),t.pipe(o),e(o)))}},f=function(t,e,n,r){var i,o;return i=t.type,o=t.url,"Could not parse response to "+i+" "+o+': "'+e+'" ('+r+": "+n+")"},h=function(t,e,n){return function(r){var i;return i="",r.on("data",function(t){return i+=t}),r.on("error",n),r.on("end",function(){var o,s,a,u,h,c,l;if(o=r.headers["content-type"],"application/json"!==o&&!/json/.test(t.dataType)&&!/json/.test(t.data.format))return(h=i.match(/\[ERROR\] (\d+)([\s\S]*)/))?n(new Error(h[2])):(u=200<=(l=r.statusCode)&&400>l?e:n)(i);if(""===i&&200===r.statusCode)return e();try{return c=JSON.parse(i),(a=c.error)?n(new Error(a)):e(c)}catch(p){return s=p,n(r.statusCode>=400?new Error(r.statusCode):new Error(f(t,i,s,r.statusCode)))}})}},n.iterReq=function(t,e,n){return function(r,i,o,s,a){var u,h,c,f,p;return null==i&&(i={}),null==o&&(o=function(){}),null==s&&(s=function(){}),null==a&&(a=function(){}),w.isFunction(i)&&(p=[{},i,o,s],i=p[0],o=p[1],s=p[2],a=p[3]),f=g({format:n},i,{query:r.toXML()}),u=function(t){return t.on("data",o),t.on("error",s),t.on("end",a),setTimeout(function(){return null!=t.resume?t.resume():void 0},3),t},c=function(t){var e,n;return n=t[0],e=t[1],e.on("data",s),e.on("error",s),e.on("end",a),null!=e.resume&&e.resume(),l(n)},h=this.makeRequest(t,e,f,null,!0),h.then(u,c),h}},y=function(t,e,n){var r;return r=setTimeout(function(){return e("Request timed out.")},t),n.then(function(){return cancelTimeout(r)})},m=function(t){var n,r,i,u,h,c,l,f;if(!t.url)throw new Error("No url provided in "+JSON.stringify(t));if("string"==typeof t.data){if(i=t.data,"GET"===(c=t.type)||"DELETE"===c)throw new Error("Invalid request. "+t.type+" requests must not have bodies")}else i=w.querystring(t.data);if(r=o.parse(t.url,!0),r.withCredentials=!1,r.method=t.type||"GET",null!=t.port&&(r.port=t.port),r.headers={"User-Agent":a,Accept:e[t.dataType]},("GET"===(l=r.method)||"DELETE"===l)&&(null!=i?i.length:void 0)?(u=/\?/.test(r.path)?"&":"?",r.path+=u+i,i=null):(r.headers["Content-Type"]=(t.contentType||s)+"; charset=UTF-8",r.headers["Content-Length"]=i.length),null!=t.headers){f=t.headers;for(n in f)h=f[n],r.headers[n]=h}return null!=t.auth&&(r.auth=t.auth),[r,i]},n.doReq=function(t,e){var n,r,i,o,s,a,u,l,f,d,g;d=c(),o=d.promise,u=d.resolve,s=d.reject,o.then(null,t.error);try{g=m(t),f=g[0],i=g[1],r=(e?v:h)(t,u,s),a=p.request(f,r),a.on("error",function(e){return s(new Error("Error: "+f.method+" "+t.url+": "+e))}),null!=i&&a.write(i),a.end(),l=t.timeout,l>0&&y(l,s,o)}catch(w){n=w,s(n)}return o}}).call(this)},{"./constants":1,"./util":15,"./version":16,JSONStream:18,http:50,url:47}],4:[function(t,e,n){(function(){var e,r,i,o,s,a,u,h,c,l,f,p,d,g,m={}.hasOwnProperty,y=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},v=function(t,e){return function(){return t.apply(e,arguments)}};c=t("./util"),p=n,d=c.uniqBy,u=c.difference,a=c.defer,g=c.withCB,f=c.id,l=c.get,h=c.fold,s=c.concatMap,o=6e4,e=function(){function t(t){var e,n;for(e in t)m.call(t,e)&&(n=t[e],this[e]=n)}var e;return t.prototype.getStats=function(t){return null!=t?this.stats[t]:this.stats},e=s(l("matches")),t.prototype.getMatches=function(t){var n;return"MATCH"===t?this.matches[t]:null!=(n=e(this.matches[t]))?n:[]},t.prototype.getMatchIds=function(t){return null!=t?this.getMatches(t).map(l("id")):this.allMatchIds()},t.prototype.goodMatchIds=function(){return this.getMatchIds("MATCH")},t.prototype.allMatchIds=function(){var t;return(t=h(function(t){return function(e,n){return e.concat(t.getMatchIds(n))}}(this)))(this.goodMatchIds(),["DUPLICATE","WILDCARD","TYPE_CONVERTED","OTHER"])},t}(),i=function(){function t(t){var e,n;for(e in t)m.call(t,e)&&(n=t[e],this[e]=n)}var e,n,r,i;return i=d(f),e=s(f),n=function(t){var n,r;return e(function(){var e,i;e=t.identifiers,i=[];for(n in e)r=e[n],i.push(r);return i}())},r=function(t,e){return null==e||y.call(n(t),e)>=0},t.prototype.getStats=function(t){switch(t){case"objects":return this.getObjectStats();case"identifiers":return this.getIdentifierStats();default:return{objects:this.getObjectStats(),identifiers:this.getIdentifierStats()}}},t.prototype.getIdentifierStats=function(){var t,n,r,o,s,a;return a=function(t){var n,r;return i(e(function(){var e,i,o;for(o=[],e=0,i=t.length;i>e;e++)r=t[e],o.push(function(){var t;t=[];for(n in null!=r?r.identifiers:void 0)t.push(n);return t}());return o}()))},o=a(this.getMatches("MATCH")),n=a(this.getMatches()),s=o.length,t=n.length,r=u(n,o).length,{matches:s,all:t,issues:r}},t.prototype.getObjectStats=function(){var t,e,r,i;return i=this.goodMatchIds().length,t=this.allMatchIds().length,e=function(){var t;t=[];for(f in this)m.call(this,f)&&(r=this[f],y.call(n(r),"MATCH")<0&&t.push(f));return t}.call(this).length,{matches:i,all:t,issues:e}},t.prototype.getMatches=function(t){var e,n;n=[];for(f in this)m.call(this,f)&&(e=this[f],r(e,t)&&n.push(e));return n},t.prototype.getMatchIds=function(t){var e,n;n=[];for(f in this)m.call(this,f)&&(e=this[f],r(e,t)&&n.push(f));return n},t.prototype.goodMatchIds=function(){return this.getMatchIds("MATCH")},t.prototype.allMatchIds=function(){return this.getMatchIds()},t}(),r=function(){function t(t,e){this.uid=t,this.service=e,this.del=v(this.del,this),this.fetchResults=v(this.fetchResults,this),this.fetchErrorMessage=v(this.fetchErrorMessage,this),this.fetchStatus=v(this.fetchStatus,this)}return t.prototype.fetchStatus=function(t){return g(t,this.service.get("ids/"+this.uid+"/status").then(l("status")))},t.prototype.fetchErrorMessage=function(t){return g(t,this.service.get("ids/"+this.uid+"/status").then(l("message")))},t.prototype.fetchResults=function(t){var n,r;return n=this.service.get("ids/"+this.uid+"/result").then(l("results")),r=this.service.fetchVersion(),r.then(function(t){return n.then(function(n){return t>=16?new e(n):new i(n)})})},t.prototype.del=function(t){return g(t,this.service.makeRequest("DELETE","ids/"+this.uid))},t.prototype.decay=50,t.prototype.poll=function(t,e,n){var r,i,s,u,h,c,l;return l=a(),s=l.promise,h=l.resolve,u=l.reject,s.then(t,e),i=null!=n?n:function(){},c=this.fetchStatus(),c.then(null,u),r=this.decay,this.decay=Math.min(o,1.25*r),c.then(function(t){return function(e){switch(i(e),e){case"SUCCESS":return t.fetchResults().then(h,u);case"ERROR":return t.fetchErrorMessage().then(u,u);default:return setTimeout(function(){return t.poll(h,u,i)},r)}}}(this)),s},t}(),r.prototype.wait=r.prototype.poll,r.create=function(t){return function(e){return new r(e,t)}},p.IDResolutionJob=r,p.CategoryResults=e,p.IdResults=i}).call(this)},{"./util":15}],5:[function(t,e,n){(function(){var e,r,i,o,s,a,u,h,c,l,f,p,d,g,m,y=function(t,e){return function(){return t.apply(e,arguments)}},v={}.hasOwnProperty,w=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};g=t("./util"),c=n,p=g.merge,m=g.withCB,u=g.get,l=g.invoke,i=g.REQUIRES_VERSION,d=g.set,a=g.dejoin,s="list/tags",o="lists/shares",e="lists/invitations",f=function(t){return"__folder__"===t.substr(0,t.indexOf(":"))},h=function(t){return t.substr(t.indexOf(":")+1)},r=function(){function t(t,e){var n,r;this.service=e,this._updateTags=y(this._updateTags,this),this.hasTag=y(this.hasTag,this);for(n in t)v.call(t,n)&&(r=t[n],this[n]=r);this.dateCreated=null!=this.dateCreated?new Date(this.dateCreated):null,this.folders=this.tags.filter(f).map(h)}var n;return t.prototype.hasTag=function(t){return w.call(this.tags,t)>=0},t.prototype.query=function(t){return null==t&&(t=["*"]),this.service.query({select:t,from:this.type,where:[[this.type,"IN",this.name]]})},t.prototype.del=function(t){return this.service.makeRequest("DELETE","lists",{name:this.name},t)},n=function(t){var e;return e=t.tags},t.prototype._updateTags=function(t,e){return null==t?(this.tags=e.slice(),this.folders=this.tags.filter(f).map(h)):void 0},t.prototype.fetchTags=function(t){return m(this._updateTags,t,this.service.makeRequest("GET","list/tags",{name:this.name}).then(n))},t.prototype.addTags=function(t,e){var r;return r={name:this.name,tags:t},m(this._updateTags,e,this.service.makeRequest("POST","list/tags",r).then(n))},t.prototype.removeTags=function(t,e){var r;return r={name:this.name,tags:t},m(this._updateTags,e,this.service.makeRequest("DELETE","list/tags",r).then(n))},t.prototype.contents=function(t){return m(t,this.query().then(a).then(l("records")))},t.prototype.rename=function(t,e){var n;return n=this.service.post("lists/rename",{oldname:this.name,newname:t}).then(u("listName")).then(function(t){return function(e){return t.name=e}}(this)).then(this.service.fetchList),m(e,n)},t.prototype.copy=function(t,e){var n,r,i,o,s,a,h;return null==t&&(t={}),null==e&&(e=function(){}),1===arguments.length&&g.isFunction(t)&&(s=[{},t],t=s[0],e=s[1]),"string"==typeof t&&(t={name:t}),r=n=null!=(a=t.name)?a:""+this.name+"_copy",o=this.tags.concat(null!=(h=t.tags)?h:[]),i=this.query(["id"]),m(e,this.service.fetchLists().then(l("map",u("name"))).then(function(t){return function(e){var s;for(s=1;w.call(e,r)>=0;)r=""+n+"-"+s++;return i.then(l("saveAsList",{name:r,tags:o,description:t.description}))}}(this)))},t.prototype.enrichment=function(t,e){return this.service.enrichment(p({list:this.name},t),e)},t.prototype.shareWithUser=function(t,e){return m(e,this.service.post(o,{list:this.name,"with":t}))},t.prototype.inviteUserToShare=function(t,n,r){return null==n&&(n=!0),null==r&&(r=function(){}),m(r,this.service.post(e,{list:this.name,to:t,notify:!!n}))},t}(),c.List=r}).call(this)},{"./util":15}],6:[function(t,e,n){(function(){var e,r,i,o,s,a,u,h,c,l,f=function(t,e){return function(){return t.apply(e,arguments)}},p=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};o=t("./table").Table,i=t("./path").PathInfo,l=t("./util"),u=l.flatten,a=l.find,s=l.error,c=l.omap,h=n,e=new o({name:"Object",tags:[],displayName:"Object",attributes:{},references:{},collections:{}}),r=function(){function t(t){var n,r;this.name=t.name,n=t.classes,this.findCommonType=f(this.findCommonType,this),this.findSharedAncestor=f(this.findSharedAncestor,this),this.getAncestorsOf=f(this.getAncestorsOf,this),this.getSubclassesOf=f(this.getSubclassesOf,this),this.getPathInfo=f(this.getPathInfo,this),r=c(function(t){return function(e,n){return[e,new o(n,t)]}}(this)),this.classes=r(n),this.classes["java.lang.Object"]=e}return t.prototype.getPathInfo=function(t,e){return i.parse(this,t,e)},t.prototype.getSubclassesOf=function(t){var e,n,r,i,o,s;if(n=t&&t.name?t:this.classes[t],null==n)throw new Error(""+t+" is not a table");r=[n.name],o=this.classes;for(i in o)e=o[i],s=n.name,p.call(e.parents(),s)>=0&&(r=r.concat(this.getSubclassesOf(e)));return r},t.prototype.getAncestorsOf=function(t){var e,n;if(e=t&&t.name?t:this.classes[t],null==e)throw new Error(""+t+" is not a table");return n=e.parents(),n.filter(function(t){return function(e){return t.classes[e]}}(this)).reduce(function(t){return function(e,n){return e.concat(t.getAncestorsOf(n))}}(this),n)},t.prototype.findSharedAncestor=function(t,e){var n,r,i;return null===e||null===t?null:t===e?t:(n=this.getAncestorsOf(t),p.call(n,e)>=0?e:(r=this.getAncestorsOf(e),p.call(r,t)>=0?t:i=a(n,function(t){return p.call(r,t)>=0})))},t.prototype.findCommonType=function(t){return null==t&&(t=[]),t.reduce(this.findSharedAncestor)},t}(),r.prototype.makePath=r.prototype.getPathInfo,r.prototype.findCommonTypeOfMultipleClasses=r.prototype.findCommonType,r.load=function(t){var e;try{return new r(t)}catch(n){throw e=n,new Error("Error loading model: "+e)}},r.INTEGRAL_TYPES=["int","Integer","long","Long"],r.FRACTIONAL_TYPES=["double","Double","float","Float"],r.NUMERIC_TYPES=r.INTEGRAL_TYPES.concat(r.FRACTIONAL_TYPES),r.BOOLEAN_TYPES=["boolean","Boolean"],h.Model=r}).call(this)},{"./path":7,"./table":13,"./util":15}],7:[function(t,e,n){(function(){var e,r,i,o,s,a,u,h,c,l,f,p,d,g,m=function(t,e){return function(){return t.apply(e,arguments)}},y=[].slice,v=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};c=n,d=t("./util"),g=d.withCB,s=d.concatMap,h=d.get,o=d.any,f=d.set,a=d.copy,p=d.success,u=d.error,e={},r={},l=function(t,e,n){var r,i,o;return""+(null!=t?t.name:void 0)+"|"+(null!=t&&null!=(o=t.service)?o.root:void 0)+"|"+e+":"+function(){var t;t=[];for(r in n)i=n[r],t.push(""+r+"="+i);return t}()},i=function(){function t(t){var e,n;this.root=t.root,this.model=t.model,this.descriptors=t.descriptors,this.subclasses=t.subclasses,this.displayName=t.displayName,this.ident=t.ident,this.allDescriptors=m(this.allDescriptors,this),this.getChildNodes=m(this.getChildNodes,this),this.getDisplayName=m(this.getDisplayName,this),this.isa=m(this.isa,this),this.append=m(this.append,this),this.getParent=m(this.getParent,this),this.getEndClass=m(this.getEndClass,this),this.containsCollection=m(this.containsCollection,this),this.isCollection=m(this.isCollection,this),this.isReverseReference=m(this.isReverseReference,this),this.isReference=m(this.isReference,this),this.isClass=m(this.isClass,this),this.isAttribute=m(this.isAttribute,this),this.isRoot=m(this.isRoot,this),n=this.descriptors,this.mid=2<=n.length?y.call(n,0,e=n.length-1):(e=0,[]),this.end=n[e++],null==this.ident&&(this.ident=l(this.model,this,this.subclasses))}return t.prototype.isRoot=function(){return 0===this.descriptors.length},t.prototype.isAttribute=function(){return null!=this.end&&!this.isReference()},t.prototype.isClass=function(){return this.isRoot()||this.isReference()},t.prototype.isReference=function(){var t;return null!=(null!=(t=this.end)?t.referencedType:void 0)},t.prototype.isReverseReference=function(){var t,e,n,r,i;return this.isReference()&&this.mid.length>0?(i=this.end,r=i.reverseReference,n=i.referencedType,e=this.getParent(),t=e.getParent(),null!=n&&t.isa(n)&&e.end.name===r):!1},t.prototype.isCollection=function(){var t,e;return null!=(t=null!=(e=this.end)?e.isCollection:void 0)?t:!1},t.prototype.containsCollection=function(){return o(this.descriptors,function(t){return t.isCollection})},t.prototype.getEndClass=function(){var t;return this.model.classes[this.subclasses[this.toString()]||(null!=(t=this.end)?t.referencedType:void 0)]||this.root},t.prototype.getParent=function(){var e;if(this.isRoot())throw new Error("Root paths do not have parents");return e={root:this.root,model:this.model,descriptors:this.mid.slice(),subclasses:this.subclasses},new t(e)},t.prototype.append=function(e){var n,r;if(this.isAttribute())throw new Error(""+this+" is an attribute.");if(r="string"==typeof e?this.getType().fields[e]:e,null==r)throw new Error(""+e+" is not a field of "+this.getType());return n={root:this.root,model:this.model,descriptors:this.descriptors.concat([r]),subclasses:this.subclasses},new t(n)},t.prototype.isa=function(t){var e,n;return null==t?!1:this.isAttribute()?this.getType()===t:(e=t.name?t.name:""+t,n=this.getType(),e===n.name||v.call(this.model.getAncestorsOf(n),e)>=0)},t.prototype.getDisplayName=function(t){var n,r,i,o;return(r=this.displayName)?p(r):(null==this.namePromise&&(this.namePromise=(n=e[this.ident])?p(n):this.isRoot()&&this.root.displayName?p(this.root.displayName):null==this.model.service?u("No service"):(o="model"+s(function(t){return"/"+t.name})(this.allDescriptors()),i=f({format:"json"})(a(this.subclasses)),this.model.service.get(o,i).then(h("display")).then(function(t){return function(n){var r;return null!=e[r=t.ident]?e[r]:e[r]=n}}(this)))),g(t,this.namePromise))},t.prototype.getChildNodes=function(){var t,e,n,r,i;r=(null!=(n=this.getEndClass())?n.fields:void 0)||{},i=[];for(e in r)t=r[e],i.push(this.append(t));return i},t.prototype.allDescriptors=function(){return[this.root].concat(this.descriptors)},t.prototype.toString=function(){return this.allDescriptors().map(h("name")).join(".")},t.prototype.equals=function(t){return this===t||this.ident&&(null!=t?t.ident:void 0)===this.ident},t.prototype.getType=function(){var t,e;return(null!=(t=this.end)&&null!=(e=t.type)?e.replace(/java\.lang\./,""):void 0)||this.getEndClass()},t}(),i.prototype.toPathString=i.prototype.toString,i.parse=function(t,e,n){var o,s,a,u,h,c,f,p,d;return null==n&&(n={}),h=l(t,e,n),(o=r[h])?o:(p=(e+"").split("."),d=s=t.classes[p.shift()],c=d.name,a=function(){var r,i,o,a;for(a=[],r=0,i=p.length;i>r;r++){if(f=p[r],u=(null!=s?s.fields[f]:void 0)||(null!=(o=s=t.classes[n[c]])?o.fields[f]:void 0),!u)throw new Error("Could not find "+f+" in "+s+" when parsing "+e);c+="."+f,s=t.classes[u.type||u.referencedType],a.push(u)}return a}(),r[h]=new i({root:d,model:t,descriptors:a,subclasses:n,ident:h}))},i.flushCache=function(){return r={},e={}},c.PathInfo=i}).call(this)},{"./util":15}],8:[function(t,e,n){(function(){var n;n=t("es6-promise").Promise,e.exports=n}).call(this)},{"es6-promise":22}],9:[function(t,e,n){(function(){var e,r,i,o,s,a,u,h,c,l,f,p,d,g,m,y,v,w,b,_,E,S,T,j,O,R,L,A,I,x,k,C,P,N,q,M,U,B,D,F,V,H,Y,J,z,W,X,G,K,Q,$,Z=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},tt=function(t,e){return function(){return t.apply(e,arguments)}},et=[].slice,nt={}.hasOwnProperty;i=t("backbone-events-standalone"),R=n,R.xml=t("./xml"),Y=t("./util"),a=Y.REQUIRES_VERSION,J=Y.withCB,x=Y.merge,b=Y.filter,q=Y.partition,_=Y.fold,g=Y.concatMap,j=Y.id,E=Y.get,I=Y.invoke,F=Y.querystring,S=function(t){var e;if(e=null!=(null!=t?t.toLowerCase:void 0)?s.OP_DICT[t.toLowerCase()]:null,!e)throw new Error("Illegal constraint operator: "+t);return e},e=["path","op","code"],h=e.concat(["value","extraValue"]),u=["rowByRow","eachRow","recordByRecord","eachRecord","records","rows","table","tableRows","values"],o=function(t){return Y.compose(t.fetchList,E("listName"))},r=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],y=function(t){return null==t&&(t=""),t.substr(t.indexOf("."))},d=function(t){return null!=t?"<value>"+Y.escape(t)+"</value>":"<nullValue/>"},l=function(t,e){var n,r;return function(){var i;i=[];for(n in t)r=t[n],Z.call(e,n)>=0&&i.push(""+n+'="'+Y.escape(r)+'" ');return i}().join("")},N=function(t){return"<constraint "+l(t,e)+"/>"},V=function(t){return"<constraint "+l(t,["path","type"])+"/>"},U=function(t){return"<constraint "+l(t,h)+"/>"},C=function(t){return"<constraint "+l(t,e)+">"+g(d)(t.values)+"</constraint>"},O=function(t){return"<constraint "+l(t,e)+'ids="'+t.ids.join(",")+'"/>'},f=function(t){var e;return null!=t.values?C(t):null!=t.ids?O(t):null==t.op?V(t):(e=t.op,Z.call(s.NULL_OPS,e)>=0?N(t):U(t))},T=function(t){return t.replace(/^[^\.]+\./,"")},m=function(t){var e,n,r,i,o,s,a,u,h,c,l;return s=t.path,h=t.type,o=t.op,c=t.value,l=t.values,r=t.extraValue,i=t.ids,e=t.code,n=t.editable,u=t.switched,a=t.switchable,i=null!=i?i.slice():void 0,l=null!=l?l.slice():void 0,P({path:s,type:h,op:o,value:c,values:l,extraValue:r,ids:i,code:e,editable:n,switched:u,switchable:a})},p=function(t){var e;return e=m(t),e.path=T(e.path),e},P=function(t){var e,n;for(e in t)n=t[e],null==n&&delete t[e];return t},v=function(t,e){return"Did not remove a single constraint. original = "+t+", reduced = "+e},A=function(t,e){var n,r,i,o,a,u,h;if(n={path:t},null===e)n.op="IS NULL";else if(Y.isArray(e))n.op="ONE OF",n.values=e;else if("string"==(u=typeof e)||"number"===u||"boolean"===u)h="function"==typeof e.toUpperCase?e.toUpperCase():void 0,Z.call(s.NULL_OPS,h)>=0?n.op=e:(n.op="=",n.value=e);else if(i=function(){var t;t=[];for(r in e)a=e[r],t.push(r);return t}(),Z.call(i,"isa")>=0)Y.isArray(e.isa)?(n.op=r,n.values=e.isa):n.type=e.isa;else{Z.call(i,"extraValue")>=0&&(n.extraValue=e.extraValue);for(r in e)o=e[r],"extraValue"!==r&&(n.op=r,Y.isArray(o)?n.values=o:n.value=o)}return n},L=function(t){var e,n,r,i;return t=t.slice(),n={path:t.shift()},1===t.length?(e=t[0],i="function"==typeof e.toUpperCase?e.toUpperCase():void 0,Z.call(s.NULL_OPS,i)>=0?n.op=e:n.type=e):t.length>=2&&(n.op=t[0],r=t[1],Y.isArray(r)?n.values=r:n.value=r,3===t.length&&(n.extraValue=t[2])),n},D=function(t){var e;return function(){var n,r,i;for(i=[],n=0,r=t.length;r>n;n++)e=t[n],i.push(""+e.path+" "+e.direction);return i}().join(" ")},B=function(t){var e,n,r,i,o,s,a;if(null==t)return[];for(n=t.split(/\s+/),r=function(){var t,e,r;for(r=[],i=t=0,e=n.length/2;e>=0?e>t:t>e;i=e>=0?++t:--t)r.push(2*i);return r}(),a=[],o=0,s=r.length;s>o;o++)e=r[o],a.push([n[e],n[e+1]]);return a},M=function(){var t,e;return e=this.sortOrder,this.sortOrder=function(){var n,r,i;for(i=[],n=0,r=e.length;r>n;n++)t=e[n],this.isRelevant(t.path)&&i.push(t);return i}.call(this),e.length!==this.sortOrder.length?this.trigger("change:sortorder change:orderby",this.sortOrder.slice()):void 0},s=function(){function t(t,e,n){var r,i,o,s,a,u,h,c,l,f,p,d,g,m,y,v;for(u=null!=n?n:{},r=u.model,o=u.summaryFields,this.addConstraint=tt(this.addConstraint,this),this.expandStar=tt(this.expandStar,this),this.adjustPath=tt(this.adjustPath,this),this.select=tt(this.select,this),null==t&&(t={}),this.constraints=[],this.views=[],this.joins={},this.displayNames=Y.copy(null!=(h=null!=(l=t.displayNames)?l:t.aliases)?h:{}),f=["name","title","comment","description","type"],s=0,a=f.length;a>s;s++)i=f[s],null!=t[i]&&(this[i]=t[i]);this.service=null!=e?e:{},this.model=null!=(p=null!=r?r:t.model)?p:{},this.summaryFields=null!=(d=null!=o?o:t.summaryFields)?d:{},this.root=null!=(g=t.root)?g:t.from,this.maxRows=null!=(m=null!=(y=t.size)?y:t.limit)?m:t.maxRows,this.start=null!=(v=null!=(c=t.start)?c:t.offset)?v:0,this.select(t.views||t.view||t.select||[]),this.addConstraints(t.constraints||t.where||[]),this.addJoins(t.joins||t.join||[]),this.orderBy(t.sortOrder||t.orderBy||[]),null!=t.constraintLogic&&(this.constraintLogic=t.constraintLogic),this.on("change:views",M,this)}var e,n,i,s,u,h,c,d,w;return t.JOIN_STYLES=["INNER","OUTER"],t.BIO_FORMATS=["gff3","fasta","bed"],t.NULL_OPS=["IS NULL","IS NOT NULL"],t.ATTRIBUTE_VALUE_OPS=["=","!=",">",">=","<","<=","CONTAINS","LIKE","NOT LIKE"],t.MULTIVALUE_OPS=["ONE OF","NONE OF"],t.RANGE_OPS=["OVERLAPS","DOES NOT OVERLAP","OUTSIDE","WITHIN","CONTAINS","DOES NOT CONTAIN"],t.TERNARY_OPS=["LOOKUP"],t.LOOP_OPS=["=","!="],t.LIST_OPS=["IN","NOT IN"],t.OP_DICT={"=":"=","==":"==",eq:"=",eqq:"==","!=":"!=",ne:"!=",">":">",gt:">",">=":">=",ge:">=","<":"<",lt:"<","<=":"<=",le:"<=",contains:"CONTAINS",CONTAINS:"CONTAINS","does not contain":"DOES NOT CONTAIN","DOES NOT CONTAIN":"DOES NOT CONTAIN",like:"LIKE",LIKE:"LIKE","not like":"NOT LIKE","NOT LIKE":"NOT LIKE",lookup:"LOOKUP","IS NULL":"IS NULL","is null":"IS NULL","IS NOT NULL":"IS NOT NULL","is not null":"IS NOT NULL","ONE OF":"ONE OF","one of":"ONE OF","NONE OF":"NONE OF","none of":"NONE OF","in":"IN","not in":"NOT IN",IN:"IN","NOT IN":"NOT IN",WITHIN:"WITHIN",within:"WITHIN",OVERLAPS:"OVERLAPS",overlaps:"OVERLAPS","DOES NOT OVERLAP":"DOES NOT OVERLAP","does not overlap":"DOES NOT OVERLAP",OUTSIDE:"OUTSIDE",outside:"OUTSIDE",ISA:"ISA",isa:"ISA"},u=["name","view","sortOrder","constraintLogic","title","description","comment"],n=["path","type","op","code","value","ids"],c=function(t,e){var n,r,i,o;for(o=[],r=0,i=e.length;i>r;r++)n=e[r],t.hasAttribute(n)&&o.push([n,t.getAttribute(n)]);return o},i=function(t,e){var n,r,i,o,s;for(o=t.getElementsByTagName(e),s=[],r=0,i=o.length;i>r;r++)n=o[r],s.push(n);return s},w=function(t){return function(e){return e.getAttribute(t)}},t.fromXML=function(t){var e,r,o,s,a,h,l;if(r=R.xml.parse(t),h=i(r,"query")[0]||i(r,"template")[0],!h)throw new Error("no query in xml");return s=w("path"),l=w("style"),a=Y.pairsToObj(c(h,u)),a.view=a.view.split(/\s+/),a.sortOrder=B(a.sortOrder),a.joins=function(){var t,e,n,r;for(n=i(h,"join"),r=[],t=0,e=n.length;e>t;t++)o=n[t],"OUTER"===l(o)&&r.push(s(o));return r}(),a.constraints=function(){var t,r,o,s;for(o=i(h,"constraint"),s=[],t=0,r=o.length;r>t;t++)e=o[t],s.push(function(t){var e,r,o,s,a;return e=Y.pairsToObj(c(t,n)),null!=e.ids&&(e.ids=function(){var t,n,r,i;for(r=e.ids.split(","),i=[],t=0,n=r.length;n>t;t++)a=r[t],i.push(parseInt(a,10));return i}()),s=i(t,"value"),s.length&&(e.values=function(){var t,e,n;for(n=[],t=0,e=s.length;e>t;t++)o=s[t],n.push(function(){var t,e,n,i;for(n=o.childNodes,i=[],t=0,e=n.length;e>t;t++)r=n[t],i.push(r.data);return i}().join(""));return n}()),e}(e));return s}(),a},t.prototype.constraints=[],t.prototype.views=[],t.prototype.joins={},t.prototype.constraintLogic="",t.prototype.sortOrder="",t.prototype.name=null,t.prototype.title=null,t.prototype.comment=null,t.prototype.description=null,t.prototype.removeFromSelect=function(t){var e,n,r,i;return null==t&&(t=[]),t=Y.stringList(t),e=Y.compose(this.expandStar,this.adjustPath),t=Y.flatten(function(){var n,i,o;for(o=[],n=0,i=t.length;i>n;n++)r=t[n],o.push(e(r));return o}()),this.sortOrder=function(){var e,r,i,o,s;for(i=this.sortOrder,s=[],e=0,r=i.length;r>e;e++)n=i[e],o=n.path,Z.call(t,o)>=0||s.push(n);return s}.call(this),this.views=function(){var e,n,r,o;for(r=this.views,o=[],e=0,n=r.length;n>e;e++)i=r[e],Z.call(t,i)>=0||o.push(i);return o}.call(this),this.trigger("remove:view",t),this.trigger("change:views",this.views),this.trigger("change",this.views)},t.prototype.removeConstraint=function(t,e){var n,r,i,o;if(null==e&&(e=!1),i=this.constraints,r="string"==typeof t?function(e){return e.code===t}:function(e){var n,r;return e.path===t.path&&e.op===t.op&&e.value===t.value&&e.extraValue===t.extraValue&&t.type===e.type&&(null!=(n=e.values)?n.join("%%"):void 0)===(null!=(r=t.values)?r.join("%%"):void 0)},o=function(){var t,e,o;for(o=[],t=0,e=i.length;e>t;t++)n=i[t],r(n)||o.push(n);return o}(),o.length!==i.length-1)throw new Error(v(i,o));return this.constraints=o,e?void 0:(this.trigger("change:constraints"),this.trigger("change"),this.trigger("removed:constraint",Y.find(i,r)))},t.prototype.addToSelect=function(t,e){var n,r,i,o,s,a,u,h;if(null==t&&(t=[]),null==e&&(e={}),t=Y.stringList(t),r=Y.compose(this.expandStar,this.adjustPath),o=Y.flatten(function(){var e,n,i;for(i=[],e=0,n=t.length;n>e;e++)s=t[e],i.push(r(s));return i}()),n=function(){var t,e,n;for(n=[],t=0,e=o.length;e>t;t++)i=o[t],Z.call(this.views,i)>=0&&n.push(i);return n}.call(this),n.length)throw new Error(""+n+" already in the select list");if(n=function(){var t,e,n;for(n=[],t=0,e=o.length;e>t;t++)i=o[t],function(){var t,e,n;for(n=[],t=0,e=o.length;e>t;t++)a=o[t],a===i&&n.push(a);return n}().length>1&&n.push(i);return n}(),n.length)throw new Error(""+n+" specified multiple times as arguments to addToSelect");return(u=this.views).push.apply(u,o),e.silent?e.events=(null!=(h=e.events)?h:[]).concat(["change","add:view","change:views"]):(this.trigger("add:view change:views",o),this.trigger("change")),this},t.prototype.select=function(t,e){var n,r;r=this.views.slice();try{this.views=[],this.addToSelect(t,e)}catch(i){n=i,this.views=r,Y.error(n)}return this},t.prototype.adjustPath=function(t){return t=t&&t.name?t.name:""+t,null!=this.root?t.match("^"+this.root)||(t=this.root+"."+t):this.root=t.split(".")[0],t},t.prototype.getPossiblePaths=function(t,e,n){var r,i,o,s,a;return null==t&&(t=3),null==e&&(e=!0),null==n&&(n=null),s="string"==typeof n?function(t){return t[n]()}:n,r=function(t){return function(n,i){var o,s,a,u,h,c;return h=t.getPathInfo(n),!e&&h.isReverseReference()?[]:h.isAttribute()?[h]:(o=h.getType(),c=g(function(t){return r(""+n+"."+t.name,i-1)}),u=o&&i>0?c(function(){var t,e;t=o.fields,e=[];for(a in t)s=t[a],e.push(s);return e}()):[],[h].concat(u))}}(this),i=""+t+"-"+e,null==this._possiblePaths&&(this._possiblePaths={}),o=(null!=(a=this._possiblePaths)[i]?a[i]:a[i]=r(this.root,t)).slice(),null!=s?o.filter(s):o},t.prototype.getPathInfo=function(t){var e,n,r;return e=this.adjustPath(t),n=null!=(r=this.model)&&"function"==typeof r.getPathInfo?r.getPathInfo(e,this.getSubclasses()):void 0,n&&e in this.displayNames&&(n.displayName=this.displayNames[e]),n},t.prototype.makePath=t.prototype.getPathInfo,d=function(t){return[t.path,t.type]},h=Y.compose(Y.pairsToObj,Y.map(d),b(E("type"))),t.prototype.getSubclasses=function(){return h(this.constraints)},t.prototype.getType=function(t){return this.getPathInfo(t).getType()},t.prototype.getViewNodes=function(){var t,e;return e=function(t){return function(e){return t.getPathInfo(e).getParent()}}(this),Y.uniqBy(String,function(){var n,r,i,o;for(i=this.views,o=[],n=0,r=i.length;r>n;n++)t=i[n],o.push(e(t));return o}.call(this))},t.prototype.isInView=function(t){var e,n,r;if(e=this.getPathInfo(t),!e)throw new Error("Invalid path: "+t);return e.isAttribute()?(r=e.toString(),Z.call(this.views,r)>=0):(n=e.toString(),Y.any(this.getViewNodes(),function(t){return t.toString()===n}))},t.prototype.isConstrained=function(t,e){var n,r;if(null==e&&(e=!1),n=this.getPathInfo(t),!n)throw new Error("Invalid path: "+t);return r=function(t){return null!=t.op&&t.path===n.toString()},!n.isAttribute()&&e&&(r=function(t){return function(e){return null!=e.op&&(e.path===n.toString()||n.equals(t.getPathInfo(e.path).getParent()))}}(this)),Y.any(this.constraints,r)},t.prototype.canHaveMultipleValues=function(t){return this.getPathInfo(t).containsCollection()},t.prototype.getQueryNodes=function(){var t,e,n,r;return r=this.getViewNodes(),e=function(){var e,r,i,o;for(i=this.constraints,
o=[],e=0,r=i.length;r>e;e++)t=i[e],null==t.type&&(n=this.getPathInfo(t.path),o.push(n.isAttribute()?n.getParent():n));return o}.call(this),Y.uniqBy(String,r.concat(e))},t.prototype.isInQuery=function(t){var e,n,r,i,o,s;if(n=this.getPathInfo(t)){for(r=n.toPathString(),s=this.views.concat(function(){var t,n,r,i;for(r=this.constraints,i=[],t=0,n=r.length;n>t;t++)e=r[t],null==e.type&&i.push(e.path);return i}.call(this)),i=0,o=s.length;o>i;i++)if(t=s[i],0===t.indexOf(r))return!0;return!1}return!0},t.prototype.isRelevant=function(t){var e,n,r;return n=this.getPathInfo(t),n.isAttribute()&&(n=n.getParent()),r=n.toString(),e=this.getViewNodes(),Y.any(e,function(t){return t.toPathString()===r})},t.prototype.expandStar=function(t){var e,n,r,i,o,s,a,u;if(/\*$/.test(t))if(a=t.substr(0,t.lastIndexOf(".")),r=function(t){return a+t},n=this.getType(a),/\.\*$/.test(t)){if(n&&this.summaryFields[n.name])return i=Y.compose(r,y),function(){var t,e,r,s;for(r=this.summaryFields[n.name],s=[],t=0,e=r.length;e>t;t++)o=r[t],this.hasView(o)||s.push(i(o));return s}.call(this)}else if(/\.\*\*$/.test(t))return u=this.expandStar(a+".*"),e=function(){var t;t=[];for(s in n.attributes)t.push(r("."+s));return t}(),Y.uniqBy(j,u.concat(e));return t},t.prototype.isOuterJoin=function(t){return"OUTER"===this.joins[this.adjustPath(t)]},t.prototype.hasView=function(t){var e;return this.views&&(e=this.adjustPath(t),Z.call(this.views,e)>=0)},t.prototype.count=function(t){if(this.service.count)return this.service.count(this,t);throw new Error("This query has no service with count functionality attached.")},t.prototype.appendToList=function(t,e){var n,r,i,s,a;return(null!=t?t.name:void 0)?(n=t.name,a=function(e,n){return null==e?t.size=n.size:void 0}):(n=String(t),a=null),s=this.makeListQuery(),i={listName:n,query:s.toXML()},r=o(this.service),J(a,e,this.service.post("query/append/tolist",i).then(r))},t.prototype.selectPreservingImpliedConstraints=function(t){var e,n,r,i,o;for(null==t&&(t=[]),n=this.clone(),n.select(t),o=this.getViewNodes(),r=0,i=o.length;i>r;r++)e=o[r],this.isOuterJoined(e)||n.isInView(e||n.isConstrained(e))||null==e.getEndClass().fields.id||n.addConstraint([e.append("id"),"IS NOT NULL"]);return n},t.prototype.makeListQuery=function(){var t,e;return t=this.views.slice(),1===t.length&&(null!=(e=t[0])?e.match(/\.id$/):void 0)||(t=["id"]),this.selectPreservingImpliedConstraints(t)},t.prototype.saveAsList=function(t,e){var n,r;return r=this.makeListQuery(),n=Y.copy(t),n.listName=n.listName||n.name,n.query=r.toXML(),t.tags&&(n.tags=t.tags.join(";")),J(e,this.service.post("query/tolist",n).then(o(this.service)))},t.prototype.summarise=function(t,e,n){return this.filterSummary(t,"",e,n)},t.prototype.summarize=function(){var t;return t=1<=arguments.length?et.call(arguments,0):[],this.summarise.apply(this,t)},s=function(t){var e,n,r,i,o,s,a;for(e=null!=(null!=(s=t.results[0])?s.max:void 0),a=t.results,i=0,o=a.length;o>i;i++)n=a[i],n.count=parseInt(n.count,10);return r={uniqueValues:t.uniqueValues,filteredCount:t.filteredCount},e&&(r=x(r,t.results[0])),t.stats=r,t},t.prototype.filterSummary=function(t,e,n,r){var i,o,a;return null==r&&(r=function(){}),Y.isFunction(n)&&(a=[n,null],r=a[0],n=a[1]),t=this.adjustPath(t),o=this.clone(),Z.call(o.views,t)<0&&o.views.push(t),i={query:o.toXML(),summaryPath:t,format:"jsonrows"},n&&(i.size=n),e&&(i.filterTerm=e),J(r,this.service.post("query/results",i).then(s))},t.prototype.clone=function(e){var n,r,i,o;if(n=new t(this,this.service),null==n._callbacks&&(n._callbacks={}),e){o=this._callbacks;for(r in o)nt.call(o,r)&&(i=o[r],n._callbacks[r]=i);n.off("change:views",M,this)}return n},t.prototype.next=function(){var t;return t=this.clone(),this.maxRows&&(t.start=this.start+this.maxRows),t},t.prototype.previous=function(){var t;return t=this.clone(),t.start=this.maxRows?this.start-this.maxRows:0,t},t.prototype.getSortDirection=function(t){var e,n;if(e=this.adjustPath(t),!this.isInQuery(e)&&!this.isRelevant(e))throw new Error(""+t+" is not in the query");return n=Y.find(this.sortOrder,function(t){var n;return n=t.path,e===n}),null!=n?n.direction:void 0},t.prototype.isOuterJoined=function(t){var e,n,r;t=this.adjustPath(t),r=this.joins;for(n in r)if(e=r[n],"OUTER"===e&&0===t.indexOf(n))return!0;return!1},t.prototype.getOuterJoin=function(t){var e,n;return t=this.adjustPath(t),e=function(){var t;t=[];for(n in this.joins)t.push(n);return t}.call(this).sort(function(t,e){return e.length-t.length}),Y.find(e,function(e){return function(n){return"OUTER"===e.joins[n]&&0===t.indexOf(n)}}(this))},t.prototype._parse_sort_order=function(t){var e,n,r,i,o,s;if(null==t)throw new Error("No input");if("string"==typeof t)i={path:t,direction:"ASC"};else if(Y.isArray(t))r=t[0],e=t[1],i={path:r,direction:e};else if(null==t.path){for(n in t)o=t[n],s=[n,o],r=s[0],e=s[1];i={path:r,direction:e}}else r=t.path,e=t.direction,i={path:r,direction:e};return i.path=this.adjustPath(i.path),null==i.direction&&(i.direction="ASC"),i.direction=i.direction.toUpperCase(),i},t.prototype.addOrSetSortOrder=function(t){var e,n;return t=this._parse_sort_order(t),e=this.getSortDirection(t.path),null==e?this.addSortOrder(t):e!==t.direction&&(n=Y.find(this.sortOrder,function(e){var n;return n=e.path,n===t.path}),n.direction=t.direction,this.trigger("change:sortorder",this.sortOrder),this.trigger("change")),this},t.prototype.addSortOrder=function(t,e){var n;return n=(null!=e?e:{}).silent,this.sortOrder.push(this._parse_sort_order(t)),n?void 0:(this.trigger("add:sortorder",t),this.trigger("change:sortorder",this.sortOrder),this.trigger("change"))},t.prototype.orderBy=function(t,e){var n,r,i,o,s,a,u,h;for(null==e&&(e={}),o=this.sortOrder.slice(),this.sortOrder=[],a=0,u=t.length;u>a;a++)i=t[a],this.addSortOrder(this._parse_sort_order(i),{silent:!0});return n=function(){var t,e,n,i,o;for(n=this.sortOrder,o=[],t=0,e=n.length;e>t;t++)i=n[t],s=i.path,r=i.direction,o.push({path:s,direction:r});return o}.call(this),this.trigger("set:sortorder",n),D(o)!==this.getSorting()&&(e.silent?e.events=(null!=(h=e.events)?h:[]).concat(["change","change:sortorder"]):(this.trigger("change:sortorder",n),this.trigger("change"))),this},t.prototype.addJoins=function(t){var e,n,r,i,o,s,a;if(Y.isArray(t)){for(s=[],i=0,o=t.length;o>i;i++)e=t[i],s.push(this.addJoin(e));return s}a=[];for(n in t)r=t[n],a.push(this.addJoin({path:n,style:r}));return a},t.prototype.addJoin=function(t){return"string"==typeof t&&(t={path:t,style:"OUTER"}),this.setJoinStyle(t.path,t.style)},t.prototype.setJoinStyle=function(e,n){if(null==n&&(n="OUTER"),e=this.adjustPath(e),n=n.toUpperCase(),Z.call(t.JOIN_STYLES,n)<0)throw new Error("Invalid join style: "+n);return this.joins[e]!==n&&(this.joins[e]=n,this.trigger("change:joins",{path:e,style:n}),this.trigger("change")),this},t.prototype.addConstraints=function(t,e){var n,r,i,o,s,a,u;if(null==e&&(e="and"),this.__silent__=!0,i=this.constraintLogic,Y.isArray(t))for(a=0,u=t.length;u>a;a++)n=t[a],this.addConstraint(n,e);else{s=function(t){return function(n,r){return t.addConstraint(A(n,r),e)}}(this);for(o in t)r=t[o],s(o,r)}return this.__silent__=!1,this.trigger("add:constraint"),this.trigger("change:constraints"),i!==this.constraintLogic&&this.trigger("change:logic",this.constraintLogic),this.trigger("change")},t.prototype.addConstraint=function(t,e){var n,i,o,s,a,u,h;if(null==e&&(e="and"),"and"!==e&&"or"!==e)throw new Error("Unknown logical conjunction: "+e);return t=Y.isArray(t)?L(t):m(t),"OFF"===t.switched?this:(t.path=this.adjustPath(t.path),null==t.type&&(t.op=S(t.op)),this.constraints.push(t),o="or"===e||(null!=(h=this.constraintLogic)?h.length:void 0)>0,s=this.constraints.length,u=this.constraintLogic,o&&(a=2===s?""+r[0]+" "+e+" "+r[1]:(i=this.constraintLogic,i||(i=function(){var t,e,i;for(i=[],n=t=0,e=s-2;e>=0?e>=t:t>=e;n=e>=0?++t:--t)i.push(r[n]);return i}().join(" and ")),"("+i+") "+e+" "+r[s-1]),this.constraintLogic=a),this.__silent__||(this.trigger("add:constraint",t),this.trigger("change:constraints"),u!==this.constraintLogic&&this.trigger("change:logic",this.constraintLogic),this.trigger("change")),this)},t.prototype.getSorting=function(){return D(this.sortOrder)},t.prototype.getConstraintXML=function(){var t,e;return e=function(){var e,n,r,i;for(r=this.constraints,i=[],e=0,n=r.length;n>e;e++)t=r[e],(null==t.type||this.isInQuery(t.path))&&i.push(t);return i}.call(this),e.length?g(f)(g(j)(q(function(t){return null!=t.type})(e))):""},t.prototype.getJoinXML=function(){var t,e,n;return n=function(){var n,r;n=this.joins,r=[];for(t in n)e=n[t],this.isInQuery(t)&&"OUTER"===e&&r.push('<join path="'+t+'" style="OUTER"/>');return r}.call(this),n.join("")},t.prototype.toXML=function(){var t,e,n,r;return t={model:this.model.name,view:this.views.join(" "),sortOrder:this.getSorting(),constraintLogic:this.constraintLogic},null!=this.name&&(t.name=this.name),e=function(){var e;e=[];for(n in t)r=t[n],r&&e.push(n+'="'+r+'"');return e}().join(" "),"<query "+e+" >"+this.getJoinXML()+this.getConstraintXML()+"</query>"},t.prototype.toJSON=function(){var t,e,n,r,i;return P({name:this.name,title:this.title,comment:this.comment,description:this.description,constraintLogic:this.constraintLogic,from:this.root,select:function(){var t,e,n,r;for(n=this.views,r=[],t=0,e=n.length;e>t;t++)i=n[t],r.push(T(i));return r}.call(this),orderBy:function(){var t,r,i,o,s;for(i=this.sortOrder,s=[],t=0,r=i.length;r>t;t++)o=i[t],n=o.path,e=o.direction,s.push({path:T(n),direction:e});return s}.call(this),joins:function(){var t,e;t=this.joins,e=[];for(n in t)r=t[n],"OUTER"===r&&e.push(T(n));return e}.call(this),where:function(){var e,n,r,i;for(r=this.constraints,i=[],e=0,n=r.length;n>e;e++)t=r[e],i.push(p(t));return i}.call(this)})},t.prototype.fetchCode=function(t,e){var n;return n={query:this.toXML(),lang:t},J(e,this.service.post("query/code",n).then(this.service.VERIFIER).then(E("code")))},t.prototype.setName=function(t){this.name=t},t.prototype.save=function(t,e){return a(this.service,16,function(n){return function(){var r,i;return Y.isFunction(t)&&(i=[null,t],t=i[0],e=i[1]),null!=t&&n.setName(t),r={type:"PUT",path:"user/queries",data:n.toXML(),contentType:"application/xml",dataType:"json"},J(e,n.service.authorise(r)).then(function(t){return n.service.doReq(t)}).then(function(t){return t.queries})}}(this))},t.prototype.store=function(t,e){return a(this.service,16,function(n){return function(){var r,i,o,s;return Y.isFunction(t)&&(s=[null,t],t=s[0],e=s[1]),null!=t&&n.setName(t),o=function(t,e){return null==t?n.setName(e):void 0},r=Y.compose(E(n.name),E("queries")),i={type:"POST",path:"user/queries",data:n.toXML(),contentType:"application/xml",dataType:"json"},J(e,o,n.service.authorise(i)).then(function(t){return n.service.doReq(t)}).then(r)}}(this))},t.prototype.saveAsTemplate=function(t,e){return a(this.service,16,function(n){return function(){var r,i;if(Y.isFunction(t)&&(i=[null,t],t=i[0],e=i[1]),null!=t&&n.setName(t),!n.name)throw new Error("Templates must have a name");return r={type:"POST",path:"templates",data:"<template "+l(n,["name","title","comment"])+">"+n.toXML()+"</template>",contentType:"application/xml",dataType:"json"},J(e,n.service.authorise(r).then(function(t){return n.service.doReq(t)}))}}(this))},t.prototype.getCodeURI=function(t){var e,n;return e={query:this.toXML(),lang:t,format:"text"},null!=(null!=(n=this.service)?n.token:void 0)&&(e.token=this.service.token),""+this.service.root+"query/code?"+F(e)},t.prototype.getExportURI=function(e,n){var r,i;return null==e&&(e="tab"),null==n&&(n={}),Z.call(t.BIO_FORMATS,e)>=0?this["get"+e.toUpperCase()+"URI"](n):(r=x(n,{query:this.toXML(),format:e}),null!=(null!=(i=this.service)?i.token:void 0)&&(r.token=this.service.token),""+this.service.root+"query/results?"+F(r))},t.prototype.needsAuthentication=function(){return Y.any(this.constraints,function(t){var e;return"NOT IN"===(e=t.op)||"IN"===e})},t.prototype.fetchQID=function(t){return J(t,this.service.post("queries",{query:this.toXML()}).then(E("id")))},e=function(t){return t.append("primaryIdentifier").toString()},t.prototype.__bio_req=function(t,n){var r,i;return i=this.makeListQuery(),r=function(e){return Y.any(t,function(t){return e.isa(t)})},i.views=Y.take(n)(function(){var t,i,o,s;for(o=this.getViewNodes(),s=[],t=0,i=o.length;i>t;t++)n=o[t],r(n)&&s.push(e(n));return s}.call(this)),{query:i.toXML(),format:"text"}},t.prototype._fasta_req=function(){return this.__bio_req(["SequenceFeature","Protein"],1)},t.prototype._gff3_req=function(){return this.__bio_req(["SequenceFeature"])},t.prototype._bed_req=t.prototype._gff3_req,t}(),H=_(function(t,e){return t.concat(e)}),s.prototype.toString=s.prototype.toXML,s.ATTRIBUTE_OPS=H([s.ATTRIBUTE_VALUE_OPS,s.MULTIVALUE_OPS,s.NULL_OPS]),s.REFERENCE_OPS=H([s.TERNARY_OPS,s.LOOP_OPS,s.LIST_OPS]),c=function(t,e){return function(n,r){var i,o,s,a,u;return null==n&&(n={}),null==r&&(r=function(){}),Y.isFunction(n)&&(u=[{},n],n=u[0],r=u[1]),i=function(t){return function(e){var n;return n=t.getPathInfo(e),n.isAttribute()?n:n.append("id")}}(this),null!=(null!=n?n.view:void 0)&&(n.view=function(){var t,e,r,i;for(r=n.view,i=[],t=0,e=r.length;e>t;t++)a=r[t],i.push(this.getPathInfo(a).toString());return i}.call(this)),o=null!=n["export"]?this.selectPreservingImpliedConstraints(n["export"].map(i)):this,s=x(o[t](),n),e.call(o,s,r)}},$=s.BIO_FORMATS,z=function(t){var e,n,r;return n="_"+t+"_req",e="get"+t.toUpperCase(),r=e+"URI",s.prototype[e]=c(n,function(e,n){return J(n,this.service.post("query/results/"+t,e))}),s.prototype[r]=c(n,function(e,n){return null!=this.service.token&&(e.token=this.service.token),""+this.service.root+"query/results/"+t+"?"+F(e)})};for(X=0,K=$.length;K>X;X++)w=$[X],z(w);for(W=function(t){return function(){var e,n,r,i;if(n=arguments[0],e=2<=arguments.length?et.call(arguments,1):[],this.service[t])return null==n?n={}:Y.isFunction(n)&&(n={},e=function(){var t,e,n;for(n=[],t=0,e=arguments.length;e>t;t++)r=arguments[t],n.push(r);return n}.apply(this,arguments)),n=P(x({start:this.start,size:this.maxRows},n)),(i=this.service)[t].apply(i,[this,n].concat(et.call(e)));throw new Error("Service does not provide '"+t+"'.")}},G=0,Q=u.length;Q>G;G++)k=u[G],s.prototype[k]=W(k);i.mixin(s.prototype),s.prototype.emit=s.prototype.trigger,s.prototype.bind=s.prototype.on,R.Query=s}).call(this)},{"./util":15,"./xml":17,"backbone-events-standalone":21}],10:[function(t,e,n){(function(){var e,r,i,o,s,a,u,h,c,l,f,p,d,g,m,y,v,w,b,_,E,S,T,j,O,R,L,A,I,x,k,C,P,N,q,M,U,B,D,F,V,H,Y,J,z,W,X,G,K,Q,$,Z,tt,et,nt,rt,it,ot,st,at,ut,ht,ct,lt,ft,pt,dt=function(t,e){return function(){return t.apply(e,arguments)}},gt={}.hasOwnProperty,mt=[].slice;for(S=t("./promise"),v=t("./model").Model,O=t("./query").Query,g=t("./lists").List,B=t("./user").User,c=t("./id-resolution-job").IDResolutionJob,ot=t("./version"),it=t("./util"),K=t("./http"),rt=it.querystring,st=it.withCB,$=it.map,Z=it.merge,X=it.get,et=it.set,Q=it.invoke,nt=it.success,W=it.error,A=it.REQUIRES_VERSION,z=it.dejoin,D={},r={},R={},m={},C={},H={},s="http://",F="version",q="templates",L="version/release",i="classkeys",f="lists",y="model",k="summaryfields",T="query/results",j="search",Y="widgets",a="list/enrichment",J="listswithobject",p={union:"lists/union",intersection:"lists/intersect",difference:"lists/diff"},I="lists/subtract",V="user/whoami",N=T+"/tablerows",E="user/preferences",_="path/values",U="user/tokens",l="ids",b={},ft=[F,L,i,Y,y,k,j,_],ut=0,ct=ft.length;ct>ut;ut++)tt=ft[ut],b[tt]=!0;for(e={},pt=[V,E,p,I,J,a,q,U],ht=0,lt=pt.length;lt>ht;ht++)tt=pt[ht],e[tt]=!0;w=function(t,n){return b[t]?!1:e[t]?!0:(null!=n?n.needsAuthentication:void 0)?n.needsAuthentication():!0},u=/^https?:\/\//i,h=/service\/?$/i,x="/service/",o=function(t){var e,n;return(e=null!=(n=console.error)?n:console.log)(t)},at=function(t,e,n,r,i){var o,s,a,u,h;return a=this.root,u=this.useCache,s=null!=this[t]?this[t]:this[t]=u&&(h=e[a])?nt(h):(o={type:"GET",dataType:"json",data:{format:"json"}},this.doReq(Z(o,{url:this.root+n})).then(function(t){return e[a]=t[r]})),st(i,s)},G=function(t){return function(e){return new S(function(n,r){var i;return(i=it.find(e,function(e){return e.name===t}))?n(i):r('List "'+t+'" not found among: '+e.map(X("name")))})}},d=function(t,e){return null==e&&(e="listName"),it.compose(t.fetchList,X(e))},M=function(t){var e,n,r,i,o,s;for(null==t&&(t=[]),i=it.isArray(t)?t:[t],s=[],n=0,r=i.length;r>n;n++)e=i[n],s.push(null!=(o=e.name)?o:e);return s},P=function(){function t(t){var e;if(this.root=t.root,this.token=t.token,this.errorHandler=t.errorHandler,this.DEBUG=t.DEBUG,this.help=t.help,e=t.noCache,this.connectAs=dt(this.connectAs,this),this.createList=dt(this.createList,this),this.resolveIds=dt(this.resolveIds,this),this.templateQuery=dt(this.templateQuery,this),this.savedQuery=dt(this.savedQuery,this),this.query=dt(this.query,this),this.fetchRelease=dt(this.fetchRelease,this),this.fetchClassKeys=dt(this.fetchClassKeys,this),this.fetchVersion=dt(this.fetchVersion,this),this.fetchSummaryFields=dt(this.fetchSummaryFields,this),this.fetchModel=dt(this.fetchModel,this),this.fetchWidgetMap=dt(this.fetchWidgetMap,this),this.fetchWidgets=dt(this.fetchWidgets,this),this.complement=dt(this.complement,this),this.fetchListsContaining=dt(this.fetchListsContaining,this),this.fetchList=dt(this.fetchList,this),this.findLists=dt(this.findLists,this),this.fetchLists=dt(this.fetchLists,this),this.fetchTemplates=dt(this.fetchTemplates,this),this.tableRows=dt(this.tableRows,this),this.values=dt(this.values,this),this.rows=dt(this.rows,this),this.records=dt(this.records,this),this.table=dt(this.table,this),this.pathValues=dt(this.pathValues,this),this.fetchUser=dt(this.fetchUser,this),this.whoami=dt(this.whoami,this),this.findById=dt(this.findById,this),this.count=dt(this.count,this),this.enrichment=dt(this.enrichment,this),null==this.root)throw new Error("No service root provided. This is required");u.test(this.root)||(this.root=s+this.root),h.test(this.root)||(this.root=this.root+x),this.root=this.root.replace(/ice$/,"ice/"),null==this.errorHandler&&(this.errorHandler=o),null==this.help&&(this.help="no.help.available@dev.null"),this.useCache=!e,this.getFormat=function(t){return function(t){return null==t&&(t="json"),t}}(this)}var e,n,b,S,P,U;return t.prototype.doReq=K.doReq,t.prototype.post=function(t,e){return this.makeRequest("POST",t,e)},t.prototype.get=function(t,e){return this.makeRequest("GET",t,e)},t.prototype.makeRequest=function(t,e,n,r,i){var o,s,a,u,h,c,l;return null==t&&(t="GET"),null==e&&(e=""),null==n&&(n={}),null==r&&(r=function(){}),null==i&&(i=!1),it.isArray(r)&&(h=r,r=h[0],s=h[1]),it.isArray(n)&&(n=it.pairsToObj(n)),null==s&&(s=this.errorHandler),n=it.copy(n),o=this.getFormat(n.format),K.supports(t)||(c=[t,K.getMethod(t)],n.method=c[0],t=c[1]),a={data:n,dataType:o,success:r,error:s,path:e,type:t},null!=n.auth&&(a.auth=n.auth,delete a.data.auth),null!=n.headers&&(a.headers=it.copy(n.headers),delete a.data.headers),(u=null!=(l=n.timeout)?l:this.timeout)&&(a.timeout=u,delete n.timeout),this.authorise(a).then(function(t){return function(e){return t.doReq(e,i)}}(this))},t.prototype.authorise=function(t){return this.fetchVersion().then(function(e){return function(n){var r,i,o;return r=it.copy(t),null==r.headers&&(r.headers={}),r.url=e.root+r.path,i=[],14>n&&("string"==typeof r.data?i.push(["format",r.dataType]):r.data.format=r.dataType),null!=e.token&&w(t.path,null!=(o=r.data)?o.query:void 0)&&(n>=14?r.headers.Authorization="Token "+e.token:"string"==typeof r.data?i.push(["token",e.token]):r.data.token=e.token),i.length&&(r.url+="?"+rt(i)),r}}(this))},t.prototype.enrichment=function(t,e){return A(this,8,function(n){return function(){var r;return r=Z({maxp:.05,correction:"Holm-Bonferroni"},t),st(e,n.get(a,r).then(X("results")))}}(this))},t.prototype.search=function(t,e){return null==t&&(t={}),null==e&&(e=function(){}),A(this,9,function(n){return function(){var r,i,o,s;if(it.isFunction(t)&&(s=[t,{}],e=s[0],t=s[1]),"string"==typeof t)i={q:t};else{i={q:t.q};for(r in t)gt.call(t,r)&&(o=t[r],"q"!==r&&(i["facet_"+r]=o))}return st(e,n.post(j,i))}}(this))},t.prototype.makePath=function(t,e,n){return null==e&&(e={}),null==n&&(n=function(){}),st(n,this.fetchModel().then(function(n){return n.makePath(t,e)}))},t.prototype.count=function(t,e){var n,r;return null==e&&(e=function(){}),n=t?null!=t.toPathString?(tt=t.isClass()?t.append("id"):t,this.pathValues(tt,"count")):null!=t.toXML?(r={query:t,format:"jsoncount"},this.post(T,r).then(X("count"))):"string"==typeof t?this.fetchModel().then(function(e){return function(n){var r;try{return e.count(n.makePath(t))}catch(i){return r=i,e.query({select:[t]}).then(e.count)}}}(this)):this.query(t).then(this.count):W("Not enough arguments"),st(e,n)},t.prototype.findById=function(t,e,n,r){var i,o;return null==n&&(n=["**"]),null==r&&(r=function(){}),it.isFunction(n)&&(o=[["**"],n],n=o[0],r=o[1]),i=this.query({from:t,select:n,where:{id:e}}).then(z).then(Q("records")).then(X(0)),st(r,i)},t.prototype.lookup=function(t,e,n,r){var i,o;return it.isFunction(n)&&(o=[null,n],n=o[0],r=o[1]),i=this.query({from:t,select:["**"],where:[[t,"LOOKUP",e,n]]}).then(z).then(Q("records")),st(r,i)},t.prototype.find=function(t,e,n,r){var i;return it.isFunction(n)&&(i=[null,n],n=i[0],r=i[1]),st(r,this.lookup(t,e,n).then(function(t){return null==t||0===t.length?W("Nothing found"):t.length>1?W("Multiple items found: "+t.slice(0,3)+"..."):nt(t[0])}))},t.prototype.whoami=function(t){return A(this,9,function(e){return function(){return st(t,e.get(V).then(X("user")).then(function(t){return new B(e,t)}))}}(this))},t.prototype.fetchUser=function(){var t;return t=1<=arguments.length?mt.call(arguments,0):[],this.whoami.apply(this,t)},P=function(t,e){return{format:t,path:String(e),typeConstraints:JSON.stringify(e.subclasses)}},t.prototype.pathValues=function(t,e,n){return null==e&&(e={}),A(this,6,function(r){return function(){var i,o,s,a,u;return"string"==typeof e&&(a=e,e={}),it.isFunction(e)&&(u=[n,e],e=u[0],n=u[1]),"count"!==a&&(a="results"),o="count"===a?"jsoncount":"json",s=function(){var n;try{return this.fetchModel().then(Q("makePath",t,null!=(n=t.subclasses)?n:e)).then(function(t){return P(o,t)}).then(function(t){return function(e){return t.post(_,e)}}(this)).then(X(a))}catch(r){return i=r,W(i)}}.call(r),st(n,s)}}(this))},t.prototype.doPagedRequest=function(t,e,n,r,i){var o,s;return null==n&&(n={}),null==i&&(i=function(){}),null!=t.toXML?(it.isFunction(n)&&(s=[n,{}],i=s[0],n=s[1]),o=Z(n,{query:t,format:r}),st(i,this.post(e,o).then(X("results")))):this.query(t).then(function(t){return function(o){return t.doPagedRequest(o,e,n,r,i)}}(this))},t.prototype.table=function(t,e,n){return this.doPagedRequest(t,T,e,"jsontable",n)},t.prototype.records=function(t,e,n){return this.doPagedRequest(t,T,e,"jsonobjects",n)},t.prototype.rows=function(t,e,n){return this.doPagedRequest(t,T,e,"json",n)},t.prototype.values=function(t,e,n){var r,i;return it.isFunction(e)&&(i=[e,n],n=i[0],e=i[1]),r=null==t?W("No query term supplied"):null!=t.descriptors||"string"==typeof t?this.pathValues(t,e).then($(X("value"))):null!=t.toXML?1!==t.views.length?W("Expected one column, got "+t.views.length):this.rows(t,e).then($(X(0))):this.query(t).then(function(t){return function(n){return t.values(n,e)}}(this)),st(n,r)},t.prototype.tableRows=function(t,e,n){return this.doPagedRequest(t,N,e,"json",n)},t.prototype.fetchTemplates=function(t){return st(t,this.get(q).then(X("templates")))},t.prototype.fetchLists=function(t){return this.findLists("",t)},t.prototype.findLists=function(t,e){return null==t&&(t=""),null==e&&(e=function(){}),this.fetchVersion().then(function(n){return function(r){var i;return st(e,t&&13>r?W("Finding lists by name on the server requires version 13. This is only "+r):(i=function(t){var e,r,i,o;for(o=[],r=0,i=t.length;i>r;r++)e=t[r],o.push(new g(e,n));return o},n.get(f,{name:t}).then(X("lists")).then(i)))}}(this))},t.prototype.fetchList=function(t,e){return this.fetchVersion().then(function(n){return function(r){return st(e,13>r?n.findLists().then(G(t)):n.findLists(t).then(X(0)))}}(this))},t.prototype.fetchListsContaining=function(t,e){var n;return n=function(t){return function(e){var n,r,i,o;for(o=[],r=0,i=e.length;i>r;r++)n=e[r],o.push(new g(n,t));return o}}(this),st(e,this.get(J,t).then(X("lists")).then(n))},t.prototype.combineLists=function(t,e,n){var r,i,o,s,a,u;return u=Z({lists:[],tags:[]},e),o=u.name,i=u.lists,a=u.tags,r=u.description,s={name:o,description:r},null==s.description&&(s.description=""+t+" of "+i.join(", ")),s.tags=a.join(";"),s.lists=i.join(";"),st(n,this.get(p[t],s).then(d(this)))},t.prototype.merge=function(){return this.combineLists.apply(this,["union"].concat(mt.call(arguments)))},t.prototype.intersect=function(){return this.combineLists.apply(this,["intersection"].concat(mt.call(arguments)))},t.prototype.diff=function(){return this.combineLists.apply(this,["difference"].concat(mt.call(arguments)))},t.prototype.complement=function(t,e){var n,r,i,o,s,a,u,h,c;return null==t&&(t={}),null==e&&(e=function(){}),o=t.from,i=t.exclude,a=t.name,r=t.description,c=t.tags,n=function(){return"Relative complement of "+s.join(" and ")+" in "+u.join(" and ")},u=M(o),s=M(i),null==a&&(a=n()),null==r&&(r=n()),null==c&&(c=[]),h={name:a,description:r,tags:c,lists:s,references:u},st(e,this.post(I,h).then(d(this)))},t.prototype.fetchWidgets=function(t){return A(this,8,function(e){return function(){return at.call(e,"widgets",H,Y,"widgets",t)}}(this))},U=it.omap(function(t){return[t.name,t]}),t.prototype.fetchWidgetMap=function(t){return A(this,8,function(e){return function(){return st(t,null!=e.__wmap__?e.__wmap__:e.__wmap__=e.fetchWidgets().then(U))}}(this))},t.prototype.fetchModel=function(t){var e;return e=at.call(this,"model",m,y,"model").then(v.load).then(et({service:this})),st(t,e)},t.prototype.fetchSummaryFields=function(t){return at.call(this,"summaryFields",C,k,"classes",t)},t.prototype.fetchVersion=function(t){return at.call(this,"version",D,F,"version",t)},t.prototype.fetchClassKeys=function(t){return at.call(this,"classkeys",r,i,"classes",t)},t.prototype.fetchRelease=function(t){return at.call(this,"release",R,L,"version",t)},t.prototype.query=function(t,e){var n;return n=function(e){return function(n){var r,i;return r=n[0],i=n[1],new O(t,e,{model:r,summaryFields:i})}}(this),st(e,it.parallel(this.fetchModel(),this.fetchSummaryFields()).then(n))},S=function(t,e){return function(n){return n?t.query(n):W("No query found called "+e)}},n=function(t){return t?"string"==typeof t?nt():W("Name must be a string"):W("Name not provided")},t.prototype.savedQuery=function(t,e){return A(this,16,function(r){return function(){return n(t).then(function(){return st(e,r.get("user/queries",{filter:t}).then(function(e){return e.queries[t]}).then(S(r,t)))})}}(this))},t.prototype.templateQuery=function(t,e){return n(t).then(function(n){return function(){return st(e,n.fetchTemplates().then(X(t)).then(et("type","TEMPLATE")).then(S(n,t)))}}(this))},t.prototype.manageUserPreferences=function(t,e,n){return A(this,11,function(r){return function(){return st(n,r.makeRequest(t,E,e).then(X("preferences")))}}(this))},t.prototype.resolveIds=function(t,e){return A(this,10,function(n){return function(){var r;return r={type:"POST",url:n.root+l,contentType:"application/json",data:JSON.stringify(t),dataType:"json"},st(e,n.doReq(r).then(X("uid")).then(c.create(n)))}}(this))},t.prototype.resolutionJob=function(t){return c.create(this)(t)},t.prototype.createList=function(t,e,n){var r,i;return null==t&&(t={}),null==e&&(e=""),null==n&&(n=function(){}),r=function(e){return function(n){return Z(n,{token:e.token,tags:t.tags||[]})}}(this),i={data:it.isArray(e)?e.map(function(t){return'"'+t+'"'}).join("\n"):e,dataType:"json",url:""+this.root+"lists?"+rt(r(t)),type:"POST",contentType:"text/plain"},st(n,this.doReq(i).then(d(this)))},b=function(t){return t.user.temporaryToken},t.prototype.connectAs=function(e){return t.connect(Z(this,{token:e,noCache:!this.useCache}))},t.prototype.register=function(t,e,n){return A(this,9,function(r){return function(){return st(n,r.post("users",{name:t,password:e}).then(b).then(r.connectAs))}}(this))},e=300,t.prototype.getDeregistrationToken=function(t,n){return null==t&&(t=e),A(this,16,function(e){return function(){var r;return r=null!=e.token?e.post("user/deregistration",{validity:t}).then(X("token")):W("Not registered"),st(n,r)}}(this))},t.prototype.deregister=function(t,e){return A(this,16,function(n){return function(){return st(e,n.makeRequest("DELETE","user",{deregistrationToken:t,format:"xml"}))}}(this))},t.prototype.login=function(t,e,n){return A(this,9,function(r){return function(){var i;return i=""+t+":"+e,st(n,r.logout().then(function(t){return t.get("user/token",{auth:i})})).then(X("token")).then(r.connectAs)}}(this))},t.prototype.logout=function(t){return st(t,nt(this.connectAs()))},t}(),P.prototype.rowByRow=function(){var t,e,n;return n=arguments[0],t=2<=arguments.length?mt.call(arguments,1):[],e=K.iterReq("POST",T,"json"),null!=n.toXML?e.apply(this,arguments):this.query(n).then(function(e){return function(n){return e.rowByRow.apply(e,[n].concat(mt.call(t)))}}(this))},P.prototype.eachRow=P.prototype.rowByRow,P.prototype.recordByRecord=function(){var t,e,n;return n=arguments[0],t=2<=arguments.length?mt.call(arguments,1):[],e=K.iterReq("POST",T,"jsonobjects"),null!=n.toXML?e.apply(this,arguments):this.query(n).then(function(e){return function(n){return e.recordByRecord.apply(e,[n].concat(mt.call(t)))}}(this))},P.prototype.eachRecord=P.prototype.recordByRecord,P.prototype.union=P.prototype.merge,P.prototype.difference=P.prototype.diff,P.prototype.symmetricDifference=P.prototype.diff,P.prototype.relativeComplement=P.prototype.complement,P.prototype.subtract=P.prototype.complement,P.flushCaches=function(){return m={},D={},R={},r={},C={},H={}},P.connect=function(t){if(null==(null!=t?t.root:void 0))throw new Error("Invalid options provided: "+JSON.stringify(t));return new P(t)},n.Service=P,n.Model=v,n.Query=O,n.utils=it,n.VERSION=ot.VERSION,n.imjs=ot}).call(this)},{"./http":3,"./id-resolution-job":4,"./lists":5,"./model":6,"./promise":8,"./query":9,"./user":14,"./util":15,"./version":16}],11:[function(t,e,n){(function(t){(function(){var e;n.DOMParser=null!=t.DOMParser?t.DOMParser:e=function(){function t(){throw new Error("DOMParser is not available")}return t}()}).call(this)}).call(this,"undefined"!=typeof r?r:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],12:[function(t,e,n){(function(){var t,e,n,r,i,o,s,a,u,h,c,l;if(t="undefined"!=typeof console,e="undefined"!=typeof JSON,n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],e||(a=document.createElement("script"),a.src="http://cdn.intermine.org/js/json3/3.2.2/json3.min.js",a.type="text/javascript",o=document.getElementsByTagName("head")[0],o.appendChild(a)),null==Object.keys&&(i=Object.prototype.hasOwnProperty,r=!{toString:null}.propertyIsEnumerable("toString"),Object.keys=function(t){var e,o,s,a,u;if("object"!=typeof t&&""!=typeof t||null===t)throw new TypeError("Object.keys called on a non-object");if(e=function(){var e;e=[];for(o in t)i.call(t,o)&&e.push(o);return e}(),r)for(a=0,u=n.length;u>a;a++)s=n[a],i.call(t,s)&&e.push(s);return e}),null==Array.prototype.map&&(Array.prototype.map=function(t){var e,n,r,i;for(i=[],n=0,r=this.length;r>n;n++)e=this[n],i.push(t(e));return i}),null==Array.prototype.filter&&(Array.prototype.filter=function(t){var e,n,r,i;for(i=[],n=0,r=this.length;r>n;n++)e=this[n],t(e)&&i.push(e);return i}),null==Array.prototype.reduce&&(Array.prototype.reduce=function(t,e){var n,r,i,o,s;for(i=this.slice(),n=arguments.length<2?i.pop():e,o=0,s=i.length;s>o;o++)r=i[o],n=t(n,r);return n}),null==Array.prototype.forEach&&(Array.prototype.forEach=function(t,e){var n,r,i,o,s;if(!t)throw new Error("No function provided");for(s=[],n=i=0,o=this.length;o>i;n=++i)r=this[n],s.push(t.call(null!=e?e:this,r,n,this));

return s}),t||(this.console={log:function(){},error:function(){},debug:function(){}},"undefined"!=typeof window&&null!==window&&(window.console=this.console)),null==console.log&&(console.log=function(){}),null==console.error&&(console.error=function(){}),null==console.debug&&(console.debug=function(){}),null==console.log.apply)for(console.log("Your console needs patching."),l=["log","error","debug"],u=function(t){var e;return e=console[t],console[t]=function(t){return e(t)}},h=0,c=l.length;c>h;h++)s=l[h],u(s)}).call(this)},{}],13:[function(t,e,n){(function(){var e,r,i,o=function(t,e){return function(){return t.apply(e,arguments)}};r=function(t,e){var n,r,i;i=[];for(n in t)r=t[n],i.push(e[n]=r);return i},e=t("./promise"),i=["attributes","references","collections"],n.Table=function(){function t(t,e){var n,s,a,u,h,c,l;for(this.model=e,this.getDisplayName=o(this.getDisplayName,this),this.name=t.name,this.tags=t.tags,this.displayName=t.displayName,this.attributes=t.attributes,this.references=t.references,this.collections=t.collections,this.fields={},this.__parents__=null!=(c=t["extends"])?c:[],u=0,h=i.length;h>u;u++){if(s=i[u],null==this[s])throw new Error("Bad model data: missing "+s);r(this[s],this.fields)}l=this.collections;for(a in l)n=l[a],n.isCollection=!0}return t.prototype.toString=function(){var t,e;return"[Table name="+this.name+", fields=["+function(){var n,r;n=this.fields,r=[];for(t in n)e=n[t],r.push(t);return r}.call(this)+"]]"},t.prototype.parents=function(){var t;return(null!=(t=this.__parents__)?t:[]).slice()},t.prototype.getDisplayName=function(){return new e(function(t){return function(e,n){return null!=t.model?e(t.model.makePath(t.name).getDisplayName()):n(new Error("model not set - cannot make path"))}}(this))},t}()}).call(this)},{"./promise":8}],14:[function(t,e,n){(function(){var e,r,i,o,s,a,u,h=function(t,e){return function(){return t.apply(e,arguments)}};u=t("./util"),a=u.withCB,o=u.get,s=u.isFunction,e=u.any,i=u.error,r=function(t,e,n,r){return t.service.manageUserPreferences(n,e,r).then(function(e){return t.preferences=e})},n.User=function(){function t(t,e){this.service=t,this.username=e.username,this.preferences=e.preferences,this.refresh=h(this.refresh,this),this.clearPreferences=h(this.clearPreferences,this),this.clearPreference=h(this.clearPreference,this),this.setPreferences=h(this.setPreferences,this),this.setPreference=h(this.setPreference,this),this.hasPreferences=null!=this.preferences,null==this.preferences&&(this.preferences={})}return t.prototype.setPreference=function(t,e,n){var r,o;if(s(e)&&(o=[null,e],e=o[0],n=o[1]),"string"==typeof t)r={},r[t]=e;else{if(null!=e)return a(n,i("Incorrect arguments to setPreference"));r=t}return this.setPreferences(r,n)},t.prototype.setPreferences=function(t,e){return r(this,t,"POST",e)},t.prototype.clearPreference=function(t,e){return r(this,{key:t},"DELETE",e)},t.prototype.clearPreferences=function(t){return r(this,{},"DELETE",t)},t.prototype.refresh=function(t){return r(this,{},"GET",t)},t.prototype.createToken=function(t,n,r){var i,u;return null==t&&(t="day"),null==r&&e([t,n],s)&&(s(t)?(i=[null,null,t],t=i[0],n=i[1],r=i[2]):s(n)&&(u=[null,n],n=u[0],r=u[1])),a(r,this.service.post("user/tokens",{type:t,message:n}).then(o("token")))},t.prototype.fetchCurrentTokens=function(t){return a(t,this.service.get("user/tokens").then(o("tokens")))},t.prototype.revokeAllTokens=function(t){return a(t,this.service.makeRequest("DELETE","user/tokens"))},t.prototype.revokeToken=function(t,e){return a(e,this.service.makeRequest("DELETE","user/tokens/"+t))},t}()}).call(this)},{"./util":15}],15:[function(t,e,n){(function(){var e,r,i,o,s,a,u,h,c,l,f,p,d,g,m,y,v,w,b,_,E=[].slice,S=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},T={}.hasOwnProperty;e=t("./promise"),v=n,v.defer=function(){var t;return t={},t.promise=new e(function(e,n){return t.resolve=e,t.reject=n}),t},s=function(t){return encodeURIComponent(String(t))},y=function(t){var e;return function(){var n,r,i;for(i=[],n=0,r=t.length;r>n;n++)e=t[n],i.push(e.map(s).join("="));return i}().join("&")},v.querystring=function(t){var e,n,r,i,o,s;if(!t)return"";if(d(t))r=t.slice();else{r=[];for(e in t)s=t[e],d(s)?(i=function(){var t,n,r;for(r=[],t=0,n=s.length;n>t;t++)o=s[t],r.push([e,o]);return r}(),r=r.concat(i)):r.push([e,s])}return y(function(){var t,e,i;for(i=[],t=0,e=r.length;e>t;t++)n=r[t],null!=n[1]&&i.push(n);return i}())},v.curry=o=function(){var t,e;return e=arguments[0],t=2<=arguments.length?E.call(arguments,1):[],function(){var n;return n=1<=arguments.length?E.call(arguments,0):[],e.apply(null,t.concat(n))}},v.error=u=function(t){return new e(function(e,n){return n(new Error(t))})},v.success=w=function(t){return new e(function(e,n){return e(t)})},v.parallel=function(){var t;return t=1<=arguments.length?E.call(arguments,0):[],e.all(1===t.length&&!t[0].then&&t[0].length?t[0]:t)},v.withCB=function(){var t,e,n,r,i,s,a,u;for(e=2<=arguments.length?E.call(arguments,0,s=arguments.length-1):(s=0,[]),i=arguments[s++],a=0,u=e.length;u>a;a++)t=e[a],null!=t&&(r=o(t,null),n=t,i.then(r,n));return i},v.fold=c=function(t){return function(e,n){var r,i,o;if(1===arguments.length&&(n=(null!=e?e.slice():void 0)||e,e=(null!=n?n.shift():void 0)||{}),null==n)throw new Error("xs is null");if(null!=n.reduce)return n.reduce(t,e);i=e;for(r in n)o=n[r],i=null!=i?t(i,r,o):{k:o};return i}},v.take=function(t){return function(e){return null!=t?e.slice(0,+(t-1)+1||9e9):e.slice()}},v.filter=function(t){return function(e){var n,r,i,o;for(o=[],r=0,i=e.length;i>r;r++)n=e[r],t(n)&&o.push(n);return o}},v.uniqBy=function(t,e){var n,r,i,s,a,u;if(1===arguments.length)return o(v.uniqBy,t);if(r=[],i=[],null==e)return i;for(a=0,u=e.length;u>a;a++)s=e[a],n=t(s),S.call(r,n)<0&&(r.push(n),i.push(s));return i},v.find=function(t,e){var n,r,i;if(1===arguments.length)return e=t,function(t){return v.find(t,e)};for(r=0,i=t.length;i>r;r++)if(n=t[r],e(n))return n;return null},d=null!=(_=Array.isArray)?_:function(t){return null!=(null!=t?t.splice:void 0)&&null!=(null!=t?t.push:void 0)&&null!=(null!=t?t.pop:void 0)&&null!=(null!=t?t.slice:void 0)},v.isArray=d,v.isFunction="function"!=typeof/./?function(t){return"function"==typeof t}:function(t){return null!=t&&null!=t.call&&null!=t.apply&&"[object Function]"===t.toString()},a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;"},v.escape=function(t){var e,n,r,i,o,s;if(null==t)return"";for(i=String(t).replace(/[&<>"']/g,function(t){return a[t]}),r=[],n=o=0,s=i.length;s>=0?s>=o:o>=s;n=s>=0?++o:--o)e=i.charCodeAt(n),r.push(e>256?"&#"+e+";":i.charAt(n));return r.join("")},v.omap=function(t){var e;return e=c(function(e,n,r){var i,o,s;return s=t(n,r),i=s[0],o=s[1],d(o)&&(o=o.slice()),e[i]=o,e}),function(t){return e({},t)}},v.copy=v.omap(function(t,e){return[t,e]}),v.partition=function(t){return function(e){var n;return(n=c(function(e,n){var r,i;return i=e[0],r=e[1],t(n)?[i.concat([n]),r]:[i,r.concat([n])]}))([[],[]],e)}},v.id=l=function(t){return t},v.concatMap=function(t){return function(e){var n,r,i,o,s;for(r=void 0,o=0,s=e.length;s>o;o++)i=e[o],n=t(i),r=void 0===r?n:"number"==typeof r?r+n:null!=r.concat?r.concat(n):g(r,n);return r}},v.map=function(t){return f("map",t)},i=c(function(t,e){return function(){var n;return n=1<=arguments.length?E.call(arguments,0):[],t(e.apply(null,n))}}),v.compose=function(){var t;return t=1<=arguments.length?E.call(arguments,0):[],i(t)},v.flatMap=v.concatMap,v.difference=function(t,e){var n,r,i,o;for(o=[],r=0,i=t.length;i>r;r++)n=t[r],S.call(e,n)<0&&o.push(n);return o},v.stringList=function(t){return"string"==typeof t?[t]:t},v.flatten=h=function(){var t,e,n,r,i,o,s,a,u;for(n=1<=arguments.length?E.call(arguments,0):[],t=[],i=0,s=n.length;s>i;i++)if(e=n[i],d(e))for(u=h.apply(null,e),o=0,a=u.length;a>o;o++)r=u[o],t.push(r);else t.push(e);return t},v.sum=v.concatMap(l),v.merge=g=function(){var t,e,n,r,i,o,s;for(r=1<=arguments.length?E.call(arguments,0):[],e={},o=0,s=r.length;s>o;o++){n=r[o];for(t in n)T.call(n,t)&&(i=n[t],e[t]=i)}return e},v.any=function(t,e){var n,r,i;for(null==e&&(e=l),r=0,i=t.length;i>r;r++)if(n=t[r],e(n))return!0;return!1},v.invoke=f=function(){var t,e;return e=arguments[0],t=2<=arguments.length?E.call(arguments,1):[],p(e,t)},v.invokeWith=p=function(t,e,n){return null==e&&(e=[]),null==n&&(n=null),function(r){if(null==r)throw new Error('Cannot call method "'+t+'" of null');if(r[t])return r[t].apply(n||r,e);throw new Error('Cannot call undefined method "'+t+" of "+r)}},v.get=function(t){return function(e){return e[t]}},v.set=function(t,e){return function(n){var r,i;if(2===arguments.length)n[t]=e;else for(r in t)T.call(t,r)&&(i=t[r],n[r]=i);return n}},r=function(t,e){return"This service requires a service at version "+t+" or above. This one is at "+e},v.REQUIRES_VERSION=function(t,e,n){return t.fetchVersion().then(function(t){return t>=e?n():u(r(e,t))})},v.dejoin=function(t){var e,n,r,i,o;for(o=t.views,r=0,i=o.length;i>r;r++)n=o[r],e=n.split("."),e.length>2&&t.addJoin(e.slice(1,-1).join("."));return t},b=c(function(t,e){return t.then(e)}),v.sequence=function(){var t;return t=1<=arguments.length?E.call(arguments,0):[],b(w(),t)},m=c(function(t,e){var n,r;if(n=e[0],r=e[1],null!=t[n])throw new Error("Duplicate key: "+n);return t[n]=r,t}),v.pairsToObj=function(t){return m({},t)}}).call(this)},{"./promise":8}],16:[function(t,e,n){(function(){n.VERSION="3.13.0"}).call(this)},{}],17:[function(t,e,n){(function(){var e,r;e=t("xmldom").DOMParser,r=function(t){return t=t.replace(/^\s*/g,""),t=t.replace(/\s$/g,""),0===t.length?t:">"!==t[t.length-1]?t+">":t},n.parse=function(t){var n,i;if("string"!=typeof t)throw new Error("Expected a string - got "+t);if(t=r(t),!t)throw new Error("Expected content - got empty string");if(n=function(){try{return i=new e,i.parseFromString(t,"text/xml")}catch(n){}}(),!n||!n.documentElement||n.getElementsByTagName("parsererror").length)throw new Error("Invalid XML: "+t);return n}}).call(this)},{xmldom:11}],18:[function(t,e,n){(function(r,i){function o(t,e){return"string"==typeof t?e==t:t&&"function"==typeof t.exec?t.exec(e):"boolean"==typeof t?t:"function"==typeof t?t(e):!1}var s=t("jsonparse"),a=t("through");n.parse=function(t,e){var n=new s,r=a(function(t){"string"==typeof t&&(t=new i(t)),n.write(t)},function(t){t&&r.write(t),r.queue(null)});"string"==typeof t&&(t=t.split(".").map(function(t){return"*"===t?!0:""===t?{recurse:!0}:t}));var u=0;return t&&t.length||(t=null),n.onValue=function(n){if(this.root||(r.root=n),t){for(var i=0,s=0;i<t.length;){var a,h=t[i];if(s++,h&&!h.recurse){if(a=s===this.stack.length?this:this.stack[s],!a)return;if(!o(h,a.key))return;i++}else{i++;var c=t[i];if(!c)return;for(;;){if(a=s===this.stack.length?this:this.stack[s],!a)return;if(o(c,a.key)){i++;break}s++}}}if(s===this.stack.length){u++;var l=this.stack.slice(1).map(function(t){return t.key}).concat([this.key]),f=this.value[this.key];null!=f&&null!=(f=e?e(f,l):f)&&r.queue(f),delete this.value[this.key]}}},n._onToken=n.onToken,n.onToken=function(e,i){n._onToken(e,i),0===this.stack.length&&r.root&&(t||r.queue(r.root),r.emit("root",r.root,u),u=0,r.root=null)},n.onError=function(t){r.emit("error",t)},r},n.stringify=function(t,e,n,r){r=r||0,t===!1?(t="",e="\n",n=""):null==t&&(t="[\n",e="\n,\n",n="\n]\n");var i,o=!0,s=!1;return i=a(function(n){s=!0;var a=JSON.stringify(n,null,r);o?(o=!1,i.queue(t+a)):i.queue(e+a)},function(e){s||i.queue(t),i.queue(n),i.queue(null)})},n.stringifyObject=function(t,e,n,r){r=r||0,t===!1?(t="",e="\n",n=""):null==t&&(t="{\n",e="\n,\n",n="\n}\n");var i=!0,o=!1;return stream=a(function(n){o=!0;var s=JSON.stringify(n[0])+":"+JSON.stringify(n[1],null,r);i?(i=!1,this.queue(t+s)):this.queue(e+s)},function(e){o||this.queue(t),this.queue(n),this.queue(null)}),stream},e.parent||"browser"===r.title||r.stdin.pipe(n.parse(r.argv[2])).pipe(n.stringify("[",",\n","]\n",2)).pipe(r.stdout)}).call(this,t("/home/alex/projects/javascript/imjs/node_modules/insert-module-globals/node_modules/process/browser.js"),t("buffer").Buffer)},{"/home/alex/projects/javascript/imjs/node_modules/insert-module-globals/node_modules/process/browser.js":55,buffer:23,jsonparse:19,through:56}],19:[function(t,e,n){(function(t){function n(t){for(var e=Object.keys(i),n=0,r=e.length;r>n;n++){var o=e[n];if(i[o]===t)return o}return t&&"0x"+t.toString(16)}function r(){this.tState=m,this.value=void 0,this.string=void 0,this.unicode=void 0,this.negative=void 0,this.magnatude=void 0,this.position=void 0,this.exponent=void 0,this.negativeExponent=void 0,this.key=void 0,this.mode=void 0,this.stack=[],this.state=F,this.bytes_remaining=0,this.bytes_in_sequence=0,this.temp_buffs={2:new t(2),3:new t(3),4:new t(4)}}var i={},o=i.LEFT_BRACE=1,s=i.RIGHT_BRACE=2,a=i.LEFT_BRACKET=3,u=i.RIGHT_BRACKET=4,h=i.COLON=5,c=i.COMMA=6,l=i.TRUE=7,f=i.FALSE=8,p=i.NULL=9,d=i.STRING=10,g=i.NUMBER=11,m=i.START=17,y=i.TRUE1=33,v=i.TRUE2=34,w=i.TRUE3=35,b=i.FALSE1=49,_=i.FALSE2=50,E=i.FALSE3=51,S=i.FALSE4=52,T=i.NULL1=65,j=i.NULL3=66,O=i.NULL2=67,R=i.NUMBER1=81,L=i.NUMBER2=82,A=i.NUMBER3=83,I=i.NUMBER4=84,x=i.NUMBER5=85,k=i.NUMBER6=86,C=i.NUMBER7=87,P=i.NUMBER8=88,N=i.STRING1=97,q=i.STRING2=98,M=i.STRING3=99,U=i.STRING4=100,B=i.STRING5=101,D=i.STRING6=102,F=i.VALUE=113,V=i.KEY=114,H=i.OBJECT=129,Y=i.ARRAY=130,J=r.prototype;J.charError=function(t,e){this.onError(new Error("Unexpected "+JSON.stringify(String.fromCharCode(t[e]))+" at position "+e+" in state "+n(this.tState)))},J.onError=function(t){throw t},J.write=function(e){"string"==typeof e&&(e=new t(e));for(var n,r=0,i=e.length;i>r;r++)if(this.tState===m)n=e[r],123===n?this.onToken(o,"{"):125===n?this.onToken(s,"}"):91===n?this.onToken(a,"["):93===n?this.onToken(u,"]"):58===n?this.onToken(h,":"):44===n?this.onToken(c,","):116===n?this.tState=y:102===n?this.tState=b:110===n?this.tState=T:34===n?(this.string="",this.tState=N):45===n?(this.negative=!0,this.tState=R):48===n?(this.magnatude=0,this.tState=L):n>48&&64>n?(this.magnatude=n-48,this.tState=A):32===n||9===n||10===n||13===n||this.charError(e,r);else if(this.tState===N)if(n=e[r],this.bytes_remaining>0){for(var F=0;F<this.bytes_remaining;F++)this.temp_buffs[this.bytes_in_sequence][this.bytes_in_sequence-this.bytes_remaining+F]=e[F];this.string+=this.temp_buffs[this.bytes_in_sequence].toString(),this.bytes_in_sequence=this.bytes_remaining=0,r=r+F-1}else if(0===this.bytes_remaining&&n>=128)if(n>=194&&223>=n&&(this.bytes_in_sequence=2),n>=224&&239>=n&&(this.bytes_in_sequence=3),n>=240&&244>=n&&(this.bytes_in_sequence=4),this.bytes_in_sequence+r>e.length){for(var V=0;V<=e.length-1-r;V++)this.temp_buffs[this.bytes_in_sequence][V]=e[r+V];this.bytes_remaining=r+this.bytes_in_sequence-e.length,r=e.length-1}else this.string+=e.slice(r,r+this.bytes_in_sequence).toString(),r=r+this.bytes_in_sequence-1;else 34===n?(this.tState=m,this.onToken(d,this.string),this.string=void 0):92===n?this.tState=q:n>=32?this.string+=String.fromCharCode(n):this.charError(e,r);else this.tState===q?(n=e[r],34===n?(this.string+='"',this.tState=N):92===n?(this.string+="\\",this.tState=N):47===n?(this.string+="/",this.tState=N):98===n?(this.string+="\b",this.tState=N):102===n?(this.string+="\f",this.tState=N):110===n?(this.string+="\n",this.tState=N):114===n?(this.string+="\r",this.tState=N):116===n?(this.string+="	",this.tState=N):117===n?(this.unicode="",this.tState=M):this.charError(e,r)):this.tState===M||this.tState===U||this.tState===B||this.tState===D?(n=e[r],n>=48&&64>n||n>64&&70>=n||n>96&&102>=n?(this.unicode+=String.fromCharCode(n),this.tState++===D&&(this.string+=String.fromCharCode(parseInt(this.unicode,16)),this.unicode=void 0,this.tState=N)):this.charError(e,r)):this.tState===R?(n=e[r],48===n?(this.magnatude=0,this.tState=L):n>48&&64>n?(this.magnatude=n-48,this.tState=A):this.charError(e,r)):this.tState===L?(n=e[r],46===n?(this.position=.1,this.tState=I):101===n||69===n?(this.exponent=0,this.tState=k):(this.tState=m,this.onToken(g,0),this.magnatude=void 0,this.negative=void 0,r--)):this.tState===A?(n=e[r],46===n?(this.position=.1,this.tState=I):101===n||69===n?(this.exponent=0,this.tState=k):n>=48&&64>n?this.magnatude=10*this.magnatude+n-48:(this.tState=m,this.negative&&(this.magnatude=-this.magnatude,this.negative=void 0),this.onToken(g,this.magnatude),this.magnatude=void 0,r--)):this.tState===I?(n=e[r],n>=48&&64>n?(this.magnatude+=this.position*(n-48),this.position/=10,this.tState=x):this.charError(e,r)):this.tState===x?(n=e[r],n>=48&&64>n?(this.magnatude+=this.position*(n-48),this.position/=10):101===n||69===n?(this.exponent=0,this.tState=k):(this.tState=m,this.negative&&(this.magnatude=-this.magnatude,this.negative=void 0),this.onToken(g,this.negative?-this.magnatude:this.magnatude),this.magnatude=void 0,this.position=void 0,r--)):this.tState===k?(n=e[r],43===n||45===n?(45===n&&(this.negativeExponent=!0),this.tState=C):n>=48&&64>n?(this.exponent=10*this.exponent+(n-48),this.tState=P):this.charError(e,r)):this.tState===C?(n=e[r],n>=48&&64>n?(this.exponent=10*this.exponent+(n-48),this.tState=P):this.charError(e,r)):this.tState===P?(n=e[r],n>=48&&64>n?this.exponent=10*this.exponent+(n-48):(this.negativeExponent&&(this.exponent=-this.exponent,this.negativeExponent=void 0),this.magnatude*=Math.pow(10,this.exponent),this.exponent=void 0,this.negative&&(this.magnatude=-this.magnatude,this.negative=void 0),this.tState=m,this.onToken(g,this.magnatude),this.magnatude=void 0,r--)):this.tState===y?114===e[r]?this.tState=v:this.charError(e,r):this.tState===v?117===e[r]?this.tState=w:this.charError(e,r):this.tState===w?101===e[r]?(this.tState=m,this.onToken(l,!0)):this.charError(e,r):this.tState===b?97===e[r]?this.tState=_:this.charError(e,r):this.tState===_?108===e[r]?this.tState=E:this.charError(e,r):this.tState===E?115===e[r]?this.tState=S:this.charError(e,r):this.tState===S?101===e[r]?(this.tState=m,this.onToken(f,!1)):this.charError(e,r):this.tState===T?117===e[r]?this.tState=j:this.charError(e,r):this.tState===j?108===e[r]?this.tState=O:this.charError(e,r):this.tState===O&&(108===e[r]?(this.tState=m,this.onToken(p,null)):this.charError(e,r))},J.onToken=function(t,e){},J.parseError=function(t,e){this.onError(new Error("Unexpected "+n(t)+(e?"("+JSON.stringify(e)+")":"")+" in state "+n(this.state)))},J.onError=function(t){throw t},J.push=function(){this.stack.push({value:this.value,key:this.key,mode:this.mode})},J.pop=function(){var t=this.value,e=this.stack.pop();this.value=e.value,this.key=e.key,this.mode=e.mode,this.emit(t),this.mode||(this.state=F)},J.emit=function(t){this.mode&&(this.state=c),this.onValue(t)},J.onValue=function(t){},J.onToken=function(t,e){this.state===F?t===d||t===g||t===l||t===f||t===p?(this.value&&(this.value[this.key]=e),this.emit(e)):t===o?(this.push(),this.value=this.value?this.value[this.key]={}:{},this.key=void 0,this.state=V,this.mode=H):t===a?(this.push(),this.value=this.value?this.value[this.key]=[]:[],this.key=0,this.mode=Y,this.state=F):t===s?this.mode===H?this.pop():this.parseError(t,e):t===u&&this.mode===Y?this.pop():this.parseError(t,e):this.state===V?t===d?(this.key=e,this.state=h):t===s?this.pop():this.parseError(t,e):this.state===h?t===h?this.state=F:this.parseError(t,e):this.state===c?t===c?this.mode===Y?(this.key++,this.state=F):this.mode===H&&(this.state=V):t===u&&this.mode===Y||t===s&&this.mode===H?this.pop():this.parseError(t,e):this.parseError(t,e)},e.exports=r}).call(this,t("buffer").Buffer)},{buffer:23}],20:[function(t,n,r){!function(){function t(){return{keys:Object.keys||function(t){if("object"!=typeof t&&"function"!=typeof t||null===t)throw new TypeError("keys() called on a non-object");var e,n=[];for(e in t)t.hasOwnProperty(e)&&(n[n.length]=e);return n},uniqueId:function(t){var e=++c+"";return t?t+e:e},has:function(t,e){return u.call(t,e)},each:function(t,e,n){if(null!=t)if(a&&t.forEach===a)t.forEach(e,n);else if(t.length===+t.length){for(var r=0,i=t.length;i>r;r++)if(e.call(n,t[r],r,t)===s)return}else for(var o in t)if(this.has(t,o)&&e.call(n,t[o],o,t)===s)return},once:function(t){var e,n=!1;return function(){return n?e:(n=!0,e=t.apply(this,arguments),t=null,e)}}}}var i,o=this,s={},a=Array.prototype.forEach,u=Object.prototype.hasOwnProperty,h=Array.prototype.slice,c=0,l=t();i={on:function(t,e,n){if(!p(this,"on",t,[e,n])||!e)return this;this._events||(this._events={});var r=this._events[t]||(this._events[t]=[]);return r.push({callback:e,context:n,ctx:n||this}),this},once:function(t,e,n){if(!p(this,"once",t,[e,n])||!e)return this;var r=this,i=l.once(function(){r.off(t,i),e.apply(this,arguments)});return i._callback=e,this.on(t,i,n)},off:function(t,e,n){var r,i,o,s,a,u,h,c;if(!this._events||!p(this,"off",t,[e,n]))return this;if(!t&&!e&&!n)return this._events={},this;for(s=t?[t]:l.keys(this._events),a=0,u=s.length;u>a;a++)if(t=s[a],o=this._events[t]){if(this._events[t]=r=[],e||n)for(h=0,c=o.length;c>h;h++)i=o[h],(e&&e!==i.callback&&e!==i.callback._callback||n&&n!==i.context)&&r.push(i);r.length||delete this._events[t]}return this},trigger:function(t){if(!this._events)return this;var e=h.call(arguments,1);if(!p(this,"trigger",t,e))return this;var n=this._events[t],r=this._events.all;return n&&d(n,e),r&&d(r,arguments),this},stopListening:function(t,e,n){var r=this._listeners;if(!r)return this;var i=!e&&!n;"object"==typeof e&&(n=this),t&&((r={})[t._listenerId]=t);for(var o in r)r[o].off(e,n,this),i&&delete this._listeners[o];return this}};var f=/\s+/,p=function(t,e,n,r){if(!n)return!0;if("object"==typeof n){for(var i in n)t[e].apply(t,[i,n[i]].concat(r));return!1}if(f.test(n)){for(var o=n.split(f),s=0,a=o.length;a>s;s++)t[e].apply(t,[o[s]].concat(r));return!1}return!0},d=function(t,e){var n,r=-1,i=t.length,o=e[0],s=e[1],a=e[2];switch(e.length){case 0:for(;++r<i;)(n=t[r]).callback.call(n.ctx);return;case 1:for(;++r<i;)(n=t[r]).callback.call(n.ctx,o);return;case 2:for(;++r<i;)(n=t[r]).callback.call(n.ctx,o,s);return;case 3:for(;++r<i;)(n=t[r]).callback.call(n.ctx,o,s,a);return;default:for(;++r<i;)(n=t[r]).callback.apply(n.ctx,e)}},g={listenTo:"on",listenToOnce:"once"};l.each(g,function(t,e){i[e]=function(e,n,r){var i=this._listeners||(this._listeners={}),o=e._listenerId||(e._listenerId=l.uniqueId("l"));return i[o]=e,"object"==typeof n&&(r=this),e[t](n,r,this),this}}),i.bind=i.on,i.unbind=i.off,i.mixin=function(t){var e=["on","once","off","trigger","stopListening","listenTo","listenToOnce","bind","unbind"];return l.each(e,function(e){t[e]=this[e]},this),t},"function"==typeof e?e(function(){return i}):"undefined"!=typeof r?("undefined"!=typeof n&&n.exports&&(r=n.exports=i),r.BackboneEvents=i):o.BackboneEvents=i}(this)},{}],21:[function(t,e,n){e.exports=t("./backbone-events-standalone")},{"./backbone-events-standalone":20}],22:[function(t,n,i){(function(t,r){(function(){"use strict";function i(t){return"function"==typeof t||"object"==typeof t&&null!==t}function o(t){return"function"==typeof t}function s(t){return"object"==typeof t&&null!==t}function a(){}function u(){return function(){t.nextTick(f)}}function h(){var t=0,e=new F(f),n=document.createTextNode("");return e.observe(n,{characterData:!0}),function(){n.data=t=++t%2}}function c(){var t=new MessageChannel;return t.port1.onmessage=f,function(){t.port2.postMessage(0)}}function l(){return function(){setTimeout(f,1)}}function f(){for(var t=0;U>t;t+=2){var e=H[t],n=H[t+1];e(n),H[t]=void 0,H[t+1]=void 0}U=0}function p(){}function d(){return new TypeError("You cannot resolve a promise with itself")}function g(){return new TypeError("A promises callback cannot return that same promise.")}function m(t){try{return t.then}catch(e){return W.error=e,W}}function y(t,e,n,r){try{t.call(e,n,r)}catch(i){return i}}function v(t,e,n){B(function(t){var r=!1,i=y(n,e,function(n){r||(r=!0,e!==n?_(t,n):S(t,n))},function(e){r||(r=!0,T(t,e))},"Settle: "+(t._label||" unknown promise"));!r&&i&&(r=!0,T(t,i))},t)}function w(t,e){e._state===J?S(t,e._result):t._state===z?T(t,e._result):j(e,void 0,function(e){_(t,e)},function(e){T(t,e)})}function b(t,e){if(e.constructor===t.constructor)w(t,e);else{var n=m(e);n===W?T(t,W.error):void 0===n?S(t,e):o(n)?v(t,e,n):S(t,e)}}function _(t,e){t===e?T(t,d()):i(e)?b(t,e):S(t,e)}function E(t){t._onerror&&t._onerror(t._result),O(t)}function S(t,e){t._state===Y&&(t._result=e,t._state=J,0===t._subscribers.length||B(O,t))}function T(t,e){t._state===Y&&(t._state=z,t._result=e,B(E,t))}function j(t,e,n,r){var i=t._subscribers,o=i.length;t._onerror=null,i[o]=e,i[o+J]=n,i[o+z]=r,0===o&&t._state&&B(O,t)}function O(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r,i,o=t._result,s=0;s<e.length;s+=3)r=e[s],i=e[s+n],r?A(n,r,i,o):i(o);t._subscribers.length=0}}function R(){this.error=null}function L(t,e){try{return t(e)}catch(n){return X.error=n,X}}function A(t,e,n,r){var i,s,a,u,h=o(n);if(h){if(i=L(n,r),i===X?(u=!0,s=i.error,i=null):a=!0,e===i)return void T(e,g())}else i=r,a=!0;e._state!==Y||(h&&a?_(e,i):u?T(e,s):t===J?S(e,i):t===z&&T(e,i))}function I(t,e){try{e(function(e){_(t,e)},function(e){T(t,e)})}catch(n){T(t,n)}}function x(t,e,n,r){this._instanceConstructor=t,this.promise=new t(p,r),this._abortOnReject=n,this._validateInput(e)?(this._input=e,this.length=e.length,this._remaining=e.length,this._init(),0===this.length?S(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&S(this.promise,this._result))):T(this.promise,this._validationError())}function k(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function C(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function P(t){this._id=tt++,this._state=void 0,this._result=void 0,this._subscribers=[],p!==t&&(o(t)||k(),this instanceof P||C(),I(this,t))}var N;N=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var q,M=N,U=(Date.now||function(){return(new Date).getTime()},Object.create||function(t){if(arguments.length>1)throw new Error("Second argument not supported");if("object"!=typeof t)throw new TypeError("Argument must be an object");return a.prototype=t,new a},0),B=function(t,e){H[U]=t,H[U+1]=e,U+=2,2===U&&q()},D="undefined"!=typeof window?window:{},F=D.MutationObserver||D.WebKitMutationObserver,V="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,H=new Array(1e3);q="undefined"!=typeof t&&"[object process]"==={}.toString.call(t)?u():F?h():V?c():l();var Y=void 0,J=1,z=2,W=new R,X=new R;x.prototype._validateInput=function(t){return M(t)},x.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},x.prototype._init=function(){this._result=new Array(this.length)};var G=x;x.prototype._enumerate=function(){for(var t=this.length,e=this.promise,n=this._input,r=0;e._state===Y&&t>r;r++)this._eachEntry(n[r],r)},x.prototype._eachEntry=function(t,e){var n=this._instanceConstructor;s(t)?t.constructor===n&&t._state!==Y?(t._onerror=null,this._settledAt(t._state,e,t._result)):this._willSettleAt(n.resolve(t),e):(this._remaining--,this._result[e]=this._makeResult(J,e,t))},x.prototype._settledAt=function(t,e,n){var r=this.promise;r._state===Y&&(this._remaining--,this._abortOnReject&&t===z?T(r,n):this._result[e]=this._makeResult(t,e,n)),0===this._remaining&&S(r,this._result)},x.prototype._makeResult=function(t,e,n){return n},x.prototype._willSettleAt=function(t,e){var n=this;j(t,void 0,function(t){n._settledAt(J,e,t)},function(t){n._settledAt(z,e,t)})};var K=function(t,e){return new G(this,t,!0,e).promise},Q=function(t,e){function n(t){_(o,t)}function r(t){T(o,t)}var i=this,o=new i(p,e);if(!M(t))return T(o,new TypeError("You must pass an array to race.")),o;for(var s=t.length,a=0;o._state===Y&&s>a;a++)j(i.resolve(t[a]),void 0,n,r);return o},$=function(t,e){var n=this;if(t&&"object"==typeof t&&t.constructor===n)return t;var r=new n(p,e);return _(r,t),r},Z=function(t,e){var n=this,r=new n(p,e);return T(r,t),r},tt=0,et=P;P.all=K,P.race=Q,P.resolve=$,P.reject=Z,P.prototype={constructor:P,then:function(t,e){var n=this,r=n._state;if(r===J&&!t||r===z&&!e)return this;var i=new this.constructor(p),o=n._result;if(r){var s=arguments[r-1];B(function(){A(r,i,s,o)})}else j(n,i,t,e);return i},"catch":function(t){return this.then(null,t)}};var nt=function(){var t;t="undefined"!=typeof r?r:"undefined"!=typeof window&&window.document?window:self;var e="Promise"in t&&"resolve"in t.Promise&&"reject"in t.Promise&&"all"in t.Promise&&"race"in t.Promise&&function(){var e;return new t.Promise(function(t){e=t}),o(e)}();e||(t.Promise=et)},rt={Promise:et,polyfill:nt};"function"==typeof e&&e.amd?e(function(){return rt}):"undefined"!=typeof n&&n.exports?n.exports=rt:"undefined"!=typeof this&&(this.ES6Promise=rt)}).call(this)}).call(this,t("/home/alex/projects/javascript/imjs/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof r?r:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"/home/alex/projects/javascript/imjs/node_modules/insert-module-globals/node_modules/process/browser.js":55}],23:[function(t,e,n){function r(t,e,n){if(!(this instanceof r))return new r(t,e,n);var i,o=typeof t;if("number"===o)i=t>0?t>>>0:0;else if("string"===o)"base64"===e&&(t=S(t)),i=r.byteLength(t,e);else{if("object"!==o||null===t)throw new TypeError("must start with number, buffer, array or string");"Buffer"===t.type&&N(t.data)&&(t=t.data),i=+t.length>0?Math.floor(+t.length):0}if(this.length>q)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+q.toString(16)+" bytes");var s;r.TYPED_ARRAY_SUPPORT?s=r._augment(new Uint8Array(i)):(s=this,s.length=i,s._isBuffer=!0);var a;if(r.TYPED_ARRAY_SUPPORT&&"number"==typeof t.byteLength)s._set(t);else if(j(t))if(r.isBuffer(t))for(a=0;i>a;a++)s[a]=t.readUInt8(a);else for(a=0;i>a;a++)s[a]=(t[a]%256+256)%256;else if("string"===o)s.write(t,0,e);else if("number"===o&&!r.TYPED_ARRAY_SUPPORT&&!n)for(a=0;i>a;a++)s[a]=0;return s}function i(t,e,n,r){n=Number(n)||0;var i=t.length-n;r?(r=Number(r),r>i&&(r=i)):r=i;var o=e.length;if(o%2!==0)throw new Error("Invalid hex string");r>o/2&&(r=o/2);for(var s=0;r>s;s++){var a=parseInt(e.substr(2*s,2),16);if(isNaN(a))throw new Error("Invalid hex string");t[n+s]=a}return s}function o(t,e,n,r){var i=x(R(e),t,n,r);return i}function s(t,e,n,r){var i=x(L(e),t,n,r);return i}function a(t,e,n,r){return s(t,e,n,r)}function u(t,e,n,r){var i=x(I(e),t,n,r);return i}function h(t,e,n,r){var i=x(A(e),t,n,r,2);return i}function c(t,e,n){return C.fromByteArray(0===e&&n===t.length?t:t.slice(e,n))}function l(t,e,n){var r="",i="";n=Math.min(t.length,n);for(var o=e;n>o;o++)t[o]<=127?(r+=k(i)+String.fromCharCode(t[o]),i=""):i+="%"+t[o].toString(16);return r+k(i)}function f(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;n>i;i++)r+=String.fromCharCode(t[i]);return r}function p(t,e,n){return f(t,e,n)}function d(t,e,n){var r=t.length;(!e||0>e)&&(e=0),(!n||0>n||n>r)&&(n=r);for(var i="",o=e;n>o;o++)i+=O(t[o]);return i}function g(t,e,n){for(var r=t.slice(e,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function m(t,e,n){if(t%1!==0||0>t)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function y(t,e,n,i,o,s){if(!r.isBuffer(t))throw new TypeError("buffer must be a Buffer instance");if(e>o||s>e)throw new TypeError("value is out of bounds");if(n+i>t.length)throw new TypeError("index out of range")}function v(t,e,n,r){0>e&&(e=65535+e+1);for(var i=0,o=Math.min(t.length-n,2);o>i;i++)t[n+i]=(e&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function w(t,e,n,r){0>e&&(e=4294967295+e+1);for(var i=0,o=Math.min(t.length-n,4);o>i;i++)t[n+i]=e>>>8*(r?i:3-i)&255}function b(t,e,n,r,i,o){if(e>i||o>e)throw new TypeError("value is out of bounds");if(n+r>t.length)throw new TypeError("index out of range")}function _(t,e,n,r,i){return i||b(t,e,n,4,3.4028234663852886e38,-3.4028234663852886e38),
P.write(t,e,n,r,23,4),n+4}function E(t,e,n,r,i){return i||b(t,e,n,8,1.7976931348623157e308,-1.7976931348623157e308),P.write(t,e,n,r,52,8),n+8}function S(t){for(t=T(t).replace(U,"");t.length%4!==0;)t+="=";return t}function T(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function j(t){return N(t)||r.isBuffer(t)||t&&"object"==typeof t&&"number"==typeof t.length}function O(t){return 16>t?"0"+t.toString(16):t.toString(16)}function R(t){for(var e=[],n=0;n<t.length;n++){var r=t.charCodeAt(n);if(127>=r)e.push(r);else{var i=n;r>=55296&&57343>=r&&n++;for(var o=encodeURIComponent(t.slice(i,n+1)).substr(1).split("%"),s=0;s<o.length;s++)e.push(parseInt(o[s],16))}}return e}function L(t){for(var e=[],n=0;n<t.length;n++)e.push(255&t.charCodeAt(n));return e}function A(t){for(var e,n,r,i=[],o=0;o<t.length;o++)e=t.charCodeAt(o),n=e>>8,r=e%256,i.push(r),i.push(n);return i}function I(t){return C.toByteArray(t)}function x(t,e,n,r,i){i&&(r-=r%i);for(var o=0;r>o&&!(o+n>=e.length||o>=t.length);o++)e[o+n]=t[o];return o}function k(t){try{return decodeURIComponent(t)}catch(e){return String.fromCharCode(65533)}}var C=t("base64-js"),P=t("ieee754"),N=t("is-array");n.Buffer=r,n.SlowBuffer=r,n.INSPECT_MAX_BYTES=50,r.poolSize=8192;var q=1073741823;r.TYPED_ARRAY_SUPPORT=function(){try{var t=new ArrayBuffer(0),e=new Uint8Array(t);return e.foo=function(){return 42},42===e.foo()&&"function"==typeof e.subarray&&0===new Uint8Array(1).subarray(1,1).byteLength}catch(n){return!1}}(),r.isBuffer=function(t){return!(null==t||!t._isBuffer)},r.compare=function(t,e){if(!r.isBuffer(t)||!r.isBuffer(e))throw new TypeError("Arguments must be Buffers");for(var n=t.length,i=e.length,o=0,s=Math.min(n,i);s>o&&t[o]===e[o];o++);return o!==s&&(n=t[o],i=e[o]),i>n?-1:n>i?1:0},r.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},r.concat=function(t,e){if(!N(t))throw new TypeError("Usage: Buffer.concat(list[, length])");if(0===t.length)return new r(0);if(1===t.length)return t[0];var n;if(void 0===e)for(e=0,n=0;n<t.length;n++)e+=t[n].length;var i=new r(e),o=0;for(n=0;n<t.length;n++){var s=t[n];s.copy(i,o),o+=s.length}return i},r.byteLength=function(t,e){var n;switch(t+="",e||"utf8"){case"ascii":case"binary":case"raw":n=t.length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":n=2*t.length;break;case"hex":n=t.length>>>1;break;case"utf8":case"utf-8":n=R(t).length;break;case"base64":n=I(t).length;break;default:n=t.length}return n},r.prototype.length=void 0,r.prototype.parent=void 0,r.prototype.toString=function(t,e,n){var r=!1;if(e>>>=0,n=void 0===n||n===1/0?this.length:n>>>0,t||(t="utf8"),0>e&&(e=0),n>this.length&&(n=this.length),e>=n)return"";for(;;)switch(t){case"hex":return d(this,e,n);case"utf8":case"utf-8":return l(this,e,n);case"ascii":return f(this,e,n);case"binary":return p(this,e,n);case"base64":return c(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return g(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}},r.prototype.equals=function(t){if(!r.isBuffer(t))throw new TypeError("Argument must be a Buffer");return 0===r.compare(this,t)},r.prototype.inspect=function(){var t="",e=n.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,e).match(/.{2}/g).join(" "),this.length>e&&(t+=" ... ")),"<Buffer "+t+">"},r.prototype.compare=function(t){if(!r.isBuffer(t))throw new TypeError("Argument must be a Buffer");return r.compare(this,t)},r.prototype.get=function(t){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(t)},r.prototype.set=function(t,e){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(t,e)},r.prototype.write=function(t,e,n,r){if(isFinite(e))isFinite(n)||(r=n,n=void 0);else{var c=r;r=e,e=n,n=c}e=Number(e)||0;var l=this.length-e;n?(n=Number(n),n>l&&(n=l)):n=l,r=String(r||"utf8").toLowerCase();var f;switch(r){case"hex":f=i(this,t,e,n);break;case"utf8":case"utf-8":f=o(this,t,e,n);break;case"ascii":f=s(this,t,e,n);break;case"binary":f=a(this,t,e,n);break;case"base64":f=u(this,t,e,n);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":f=h(this,t,e,n);break;default:throw new TypeError("Unknown encoding: "+r)}return f},r.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},r.prototype.slice=function(t,e){var n=this.length;if(t=~~t,e=void 0===e?n:~~e,0>t?(t+=n,0>t&&(t=0)):t>n&&(t=n),0>e?(e+=n,0>e&&(e=0)):e>n&&(e=n),t>e&&(e=t),r.TYPED_ARRAY_SUPPORT)return r._augment(this.subarray(t,e));for(var i=e-t,o=new r(i,void 0,!0),s=0;i>s;s++)o[s]=this[s+t];return o},r.prototype.readUInt8=function(t,e){return e||m(t,1,this.length),this[t]},r.prototype.readUInt16LE=function(t,e){return e||m(t,2,this.length),this[t]|this[t+1]<<8},r.prototype.readUInt16BE=function(t,e){return e||m(t,2,this.length),this[t]<<8|this[t+1]},r.prototype.readUInt32LE=function(t,e){return e||m(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},r.prototype.readUInt32BE=function(t,e){return e||m(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},r.prototype.readInt8=function(t,e){return e||m(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},r.prototype.readInt16LE=function(t,e){e||m(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},r.prototype.readInt16BE=function(t,e){e||m(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},r.prototype.readInt32LE=function(t,e){return e||m(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},r.prototype.readInt32BE=function(t,e){return e||m(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},r.prototype.readFloatLE=function(t,e){return e||m(t,4,this.length),P.read(this,t,!0,23,4)},r.prototype.readFloatBE=function(t,e){return e||m(t,4,this.length),P.read(this,t,!1,23,4)},r.prototype.readDoubleLE=function(t,e){return e||m(t,8,this.length),P.read(this,t,!0,52,8)},r.prototype.readDoubleBE=function(t,e){return e||m(t,8,this.length),P.read(this,t,!1,52,8)},r.prototype.writeUInt8=function(t,e,n){return t=+t,e>>>=0,n||y(this,t,e,1,255,0),r.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=t,e+1},r.prototype.writeUInt16LE=function(t,e,n){return t=+t,e>>>=0,n||y(this,t,e,2,65535,0),r.TYPED_ARRAY_SUPPORT?(this[e]=t,this[e+1]=t>>>8):v(this,t,e,!0),e+2},r.prototype.writeUInt16BE=function(t,e,n){return t=+t,e>>>=0,n||y(this,t,e,2,65535,0),r.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=t):v(this,t,e,!1),e+2},r.prototype.writeUInt32LE=function(t,e,n){return t=+t,e>>>=0,n||y(this,t,e,4,4294967295,0),r.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=t):w(this,t,e,!0),e+4},r.prototype.writeUInt32BE=function(t,e,n){return t=+t,e>>>=0,n||y(this,t,e,4,4294967295,0),r.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=t):w(this,t,e,!1),e+4},r.prototype.writeInt8=function(t,e,n){return t=+t,e>>>=0,n||y(this,t,e,1,127,-128),r.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),0>t&&(t=255+t+1),this[e]=t,e+1},r.prototype.writeInt16LE=function(t,e,n){return t=+t,e>>>=0,n||y(this,t,e,2,32767,-32768),r.TYPED_ARRAY_SUPPORT?(this[e]=t,this[e+1]=t>>>8):v(this,t,e,!0),e+2},r.prototype.writeInt16BE=function(t,e,n){return t=+t,e>>>=0,n||y(this,t,e,2,32767,-32768),r.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=t):v(this,t,e,!1),e+2},r.prototype.writeInt32LE=function(t,e,n){return t=+t,e>>>=0,n||y(this,t,e,4,2147483647,-2147483648),r.TYPED_ARRAY_SUPPORT?(this[e]=t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):w(this,t,e,!0),e+4},r.prototype.writeInt32BE=function(t,e,n){return t=+t,e>>>=0,n||y(this,t,e,4,2147483647,-2147483648),0>t&&(t=4294967295+t+1),r.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=t):w(this,t,e,!1),e+4},r.prototype.writeFloatLE=function(t,e,n){return _(this,t,e,!0,n)},r.prototype.writeFloatBE=function(t,e,n){return _(this,t,e,!1,n)},r.prototype.writeDoubleLE=function(t,e,n){return E(this,t,e,!0,n)},r.prototype.writeDoubleBE=function(t,e,n){return E(this,t,e,!1,n)},r.prototype.copy=function(t,e,n,i){var o=this;if(n||(n=0),i||0===i||(i=this.length),e||(e=0),i!==n&&0!==t.length&&0!==o.length){if(n>i)throw new TypeError("sourceEnd < sourceStart");if(0>e||e>=t.length)throw new TypeError("targetStart out of bounds");if(0>n||n>=o.length)throw new TypeError("sourceStart out of bounds");if(0>i||i>o.length)throw new TypeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-e<i-n&&(i=t.length-e+n);var s=i-n;if(1e3>s||!r.TYPED_ARRAY_SUPPORT)for(var a=0;s>a;a++)t[a+e]=this[a+n];else t._set(this.subarray(n,n+s),e)}},r.prototype.fill=function(t,e,n){if(t||(t=0),e||(e=0),n||(n=this.length),e>n)throw new TypeError("end < start");if(n!==e&&0!==this.length){if(0>e||e>=this.length)throw new TypeError("start out of bounds");if(0>n||n>this.length)throw new TypeError("end out of bounds");var r;if("number"==typeof t)for(r=e;n>r;r++)this[r]=t;else{var i=R(t.toString()),o=i.length;for(r=e;n>r;r++)this[r]=i[r%o]}return this}},r.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(r.TYPED_ARRAY_SUPPORT)return new r(this).buffer;for(var t=new Uint8Array(this.length),e=0,n=t.length;n>e;e+=1)t[e]=this[e];return t.buffer}throw new TypeError("Buffer.toArrayBuffer not supported in this browser")};var M=r.prototype;r._augment=function(t){return t.constructor=r,t._isBuffer=!0,t._get=t.get,t._set=t.set,t.get=M.get,t.set=M.set,t.write=M.write,t.toString=M.toString,t.toLocaleString=M.toString,t.toJSON=M.toJSON,t.equals=M.equals,t.compare=M.compare,t.copy=M.copy,t.slice=M.slice,t.readUInt8=M.readUInt8,t.readUInt16LE=M.readUInt16LE,t.readUInt16BE=M.readUInt16BE,t.readUInt32LE=M.readUInt32LE,t.readUInt32BE=M.readUInt32BE,t.readInt8=M.readInt8,t.readInt16LE=M.readInt16LE,t.readInt16BE=M.readInt16BE,t.readInt32LE=M.readInt32LE,t.readInt32BE=M.readInt32BE,t.readFloatLE=M.readFloatLE,t.readFloatBE=M.readFloatBE,t.readDoubleLE=M.readDoubleLE,t.readDoubleBE=M.readDoubleBE,t.writeUInt8=M.writeUInt8,t.writeUInt16LE=M.writeUInt16LE,t.writeUInt16BE=M.writeUInt16BE,t.writeUInt32LE=M.writeUInt32LE,t.writeUInt32BE=M.writeUInt32BE,t.writeInt8=M.writeInt8,t.writeInt16LE=M.writeInt16LE,t.writeInt16BE=M.writeInt16BE,t.writeInt32LE=M.writeInt32LE,t.writeInt32BE=M.writeInt32BE,t.writeFloatLE=M.writeFloatLE,t.writeFloatBE=M.writeFloatBE,t.writeDoubleLE=M.writeDoubleLE,t.writeDoubleBE=M.writeDoubleBE,t.fill=M.fill,t.inspect=M.inspect,t.toArrayBuffer=M.toArrayBuffer,t};var U=/[^+\/0-9A-z]/g},{"base64-js":24,ieee754:25,"is-array":26}],24:[function(t,e,n){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(t){"use strict";function e(t){var e=t.charCodeAt(0);return e===s?62:e===a?63:u>e?-1:u+10>e?e-u+26+26:c+26>e?e-c:h+26>e?e-h+26:void 0}function n(t){function n(t){h[l++]=t}var r,i,s,a,u,h;if(t.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var c=t.length;u="="===t.charAt(c-2)?2:"="===t.charAt(c-1)?1:0,h=new o(3*t.length/4-u),s=u>0?t.length-4:t.length;var l=0;for(r=0,i=0;s>r;r+=4,i+=3)a=e(t.charAt(r))<<18|e(t.charAt(r+1))<<12|e(t.charAt(r+2))<<6|e(t.charAt(r+3)),n((16711680&a)>>16),n((65280&a)>>8),n(255&a);return 2===u?(a=e(t.charAt(r))<<2|e(t.charAt(r+1))>>4,n(255&a)):1===u&&(a=e(t.charAt(r))<<10|e(t.charAt(r+1))<<4|e(t.charAt(r+2))>>2,n(a>>8&255),n(255&a)),h}function i(t){function e(t){return r.charAt(t)}function n(t){return e(t>>18&63)+e(t>>12&63)+e(t>>6&63)+e(63&t)}var i,o,s,a=t.length%3,u="";for(i=0,s=t.length-a;s>i;i+=3)o=(t[i]<<16)+(t[i+1]<<8)+t[i+2],u+=n(o);switch(a){case 1:o=t[t.length-1],u+=e(o>>2),u+=e(o<<4&63),u+="==";break;case 2:o=(t[t.length-2]<<8)+t[t.length-1],u+=e(o>>10),u+=e(o>>4&63),u+=e(o<<2&63),u+="="}return u}var o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="+".charCodeAt(0),a="/".charCodeAt(0),u="0".charCodeAt(0),h="a".charCodeAt(0),c="A".charCodeAt(0);t.toByteArray=n,t.fromByteArray=i}("undefined"==typeof n?this.base64js={}:n)},{}],25:[function(t,e,n){n.read=function(t,e,n,r,i){var o,s,a=8*i-r-1,u=(1<<a)-1,h=u>>1,c=-7,l=n?i-1:0,f=n?-1:1,p=t[e+l];for(l+=f,o=p&(1<<-c)-1,p>>=-c,c+=a;c>0;o=256*o+t[e+l],l+=f,c-=8);for(s=o&(1<<-c)-1,o>>=-c,c+=r;c>0;s=256*s+t[e+l],l+=f,c-=8);if(0===o)o=1-h;else{if(o===u)return s?0/0:(p?-1:1)*(1/0);s+=Math.pow(2,r),o-=h}return(p?-1:1)*s*Math.pow(2,o-r)},n.write=function(t,e,n,r,i,o){var s,a,u,h=8*o-i-1,c=(1<<h)-1,l=c>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,d=r?1:-1,g=0>e||0===e&&0>1/e?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=c):(s=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-s))<1&&(s--,u*=2),e+=s+l>=1?f/u:f*Math.pow(2,1-l),e*u>=2&&(s++,u/=2),s+l>=c?(a=0,s=c):s+l>=1?(a=(e*u-1)*Math.pow(2,i),s+=l):(a=e*Math.pow(2,l-1)*Math.pow(2,i),s=0));i>=8;t[n+p]=255&a,p+=d,a/=256,i-=8);for(s=s<<i|a,h+=i;h>0;t[n+p]=255&s,p+=d,s/=256,h-=8);t[n+p-d]|=128*g}},{}],26:[function(t,e,n){var r=Array.isArray,i=Object.prototype.toString;e.exports=r||function(t){return!!t&&"[object Array]"==i.call(t)}},{}],27:[function(t,e,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(t){return"function"==typeof t}function o(t){return"number"==typeof t}function s(t){return"object"==typeof t&&null!==t}function a(t){return void 0===t}e.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(t){if(!o(t)||0>t||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},r.prototype.emit=function(t){var e,n,r,o,u,h;if(this._events||(this._events={}),"error"===t&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[t],a(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(r=arguments.length,o=new Array(r-1),u=1;r>u;u++)o[u-1]=arguments[u];n.apply(this,o)}else if(s(n)){for(r=arguments.length,o=new Array(r-1),u=1;r>u;u++)o[u-1]=arguments[u];for(h=n.slice(),r=h.length,u=0;r>u;u++)h[u].apply(this,o)}return!0},r.prototype.addListener=function(t,e){var n;if(!i(e))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,i(e.listener)?e.listener:e),this._events[t]?s(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,s(this._events[t])&&!this._events[t].warned){var n;n=a(this._maxListeners)?r.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[t].length>n&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace())}return this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(t,e){function n(){this.removeListener(t,n),r||(r=!0,e.apply(this,arguments))}if(!i(e))throw TypeError("listener must be a function");var r=!1;return n.listener=e,this.on(t,n),this},r.prototype.removeListener=function(t,e){var n,r,o,a;if(!i(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],o=n.length,r=-1,n===e||i(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(s(n)){for(a=o;a-->0;)if(n[a]===e||n[a].listener&&n[a].listener===e){r=a;break}if(0>r)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},r.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],i(n))this.removeListener(t,n);else for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},r.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?i(this._events[t])?[this._events[t]]:this._events[t].slice():[]},r.listenerCount=function(t,e){var n;return n=t._events&&t._events[e]?i(t._events[e])?1:t._events[e].length:0}},{}],28:[function(t,e,n){e.exports="function"==typeof Object.create?function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},{}],29:[function(t,e,n){e.exports=Array.isArray||function(t){return"[object Array]"==Object.prototype.toString.call(t)}},{}],30:[function(t,n,i){(function(t){!function(r){function o(t){throw RangeError(P[t])}function s(t,e){for(var n=t.length;n--;)t[n]=e(t[n]);return t}function a(t,e){return s(t.split(C),e).join(".")}function u(t){for(var e,n,r=[],i=0,o=t.length;o>i;)e=t.charCodeAt(i++),e>=55296&&56319>=e&&o>i?(n=t.charCodeAt(i++),56320==(64512&n)?r.push(((1023&e)<<10)+(1023&n)+65536):(r.push(e),i--)):r.push(e);return r}function h(t){return s(t,function(t){var e="";return t>65535&&(t-=65536,e+=M(t>>>10&1023|55296),t=56320|1023&t),e+=M(t)}).join("")}function c(t){return 10>t-48?t-22:26>t-65?t-65:26>t-97?t-97:S}function l(t,e){return t+22+75*(26>t)-((0!=e)<<5)}function f(t,e,n){var r=0;for(t=n?q(t/R):t>>1,t+=q(t/e);t>N*j>>1;r+=S)t=q(t/N);return q(r+(N+1)*t/(t+O))}function p(t){var e,n,r,i,s,a,u,l,p,d,g=[],m=t.length,y=0,v=A,w=L;for(n=t.lastIndexOf(I),0>n&&(n=0),r=0;n>r;++r)t.charCodeAt(r)>=128&&o("not-basic"),g.push(t.charCodeAt(r));for(i=n>0?n+1:0;m>i;){for(s=y,a=1,u=S;i>=m&&o("invalid-input"),l=c(t.charCodeAt(i++)),(l>=S||l>q((E-y)/a))&&o("overflow"),y+=l*a,p=w>=u?T:u>=w+j?j:u-w,!(p>l);u+=S)d=S-p,a>q(E/d)&&o("overflow"),a*=d;e=g.length+1,w=f(y-s,e,0==s),q(y/e)>E-v&&o("overflow"),v+=q(y/e),y%=e,g.splice(y++,0,v)}return h(g)}function d(t){var e,n,r,i,s,a,h,c,p,d,g,m,y,v,w,b=[];for(t=u(t),m=t.length,e=A,n=0,s=L,a=0;m>a;++a)g=t[a],128>g&&b.push(M(g));for(r=i=b.length,i&&b.push(I);m>r;){for(h=E,a=0;m>a;++a)g=t[a],g>=e&&h>g&&(h=g);for(y=r+1,h-e>q((E-n)/y)&&o("overflow"),n+=(h-e)*y,e=h,a=0;m>a;++a)if(g=t[a],e>g&&++n>E&&o("overflow"),g==e){for(c=n,p=S;d=s>=p?T:p>=s+j?j:p-s,!(d>c);p+=S)w=c-d,v=S-d,b.push(M(l(d+w%v,0))),c=q(w/v);b.push(M(l(c,0))),s=f(n,y,r==i),n=0,++r}++n,++e}return b.join("")}function g(t){return a(t,function(t){return x.test(t)?p(t.slice(4).toLowerCase()):t})}function m(t){return a(t,function(t){return k.test(t)?"xn--"+d(t):t})}var y="object"==typeof i&&i,v="object"==typeof n&&n&&n.exports==y&&n,w="object"==typeof t&&t;(w.global===w||w.window===w)&&(r=w);var b,_,E=2147483647,S=36,T=1,j=26,O=38,R=700,L=72,A=128,I="-",x=/^xn--/,k=/[^ -~]/,C=/\x2E|\u3002|\uFF0E|\uFF61/g,P={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},N=S-T,q=Math.floor,M=String.fromCharCode;if(b={version:"1.2.4",ucs2:{decode:u,encode:h},decode:p,encode:d,toASCII:m,toUnicode:g},"function"==typeof e&&"object"==typeof e.amd&&e.amd)e("punycode",function(){return b});else if(y&&!y.nodeType)if(v)v.exports=b;else for(_ in b)b.hasOwnProperty(_)&&(y[_]=b[_]);else r.punycode=b}(this)}).call(this,"undefined"!=typeof r?r:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],31:[function(t,e,n){"use strict";function r(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.exports=function(t,e,n,o){e=e||"&",n=n||"=";var s={};if("string"!=typeof t||0===t.length)return s;var a=/\+/g;t=t.split(e);var u=1e3;o&&"number"==typeof o.maxKeys&&(u=o.maxKeys);var h=t.length;u>0&&h>u&&(h=u);for(var c=0;h>c;++c){var l,f,p,d,g=t[c].replace(a,"%20"),m=g.indexOf(n);m>=0?(l=g.substr(0,m),f=g.substr(m+1)):(l=g,f=""),p=decodeURIComponent(l),d=decodeURIComponent(f),r(s,p)?i(s[p])?s[p].push(d):s[p]=[s[p],d]:s[p]=d}return s};var i=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},{}],32:[function(t,e,n){"use strict";function r(t,e){if(t.map)return t.map(e);for(var n=[],r=0;r<t.length;r++)n.push(e(t[r],r));return n}var i=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};e.exports=function(t,e,n,a){return e=e||"&",n=n||"=",null===t&&(t=void 0),"object"==typeof t?r(s(t),function(s){var a=encodeURIComponent(i(s))+n;return o(t[s])?r(t[s],function(t){return a+encodeURIComponent(i(t))}).join(e):a+encodeURIComponent(i(t[s]))}).join(e):a?encodeURIComponent(i(a))+n+encodeURIComponent(i(t)):""};var o=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},s=Object.keys||function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(n);return e}},{}],33:[function(t,e,n){"use strict";n.decode=n.parse=t("./decode"),n.encode=n.stringify=t("./encode")},{"./decode":31,"./encode":32}],34:[function(t,e,n){e.exports=t("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":35}],35:[function(t,e,n){(function(n){function r(t){return this instanceof r?(u.call(this,t),h.call(this,t),t&&t.readable===!1&&(this.readable=!1),t&&t.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,t&&t.allowHalfOpen===!1&&(this.allowHalfOpen=!1),void this.once("end",i)):new r(t)}function i(){this.allowHalfOpen||this._writableState.ended||n.nextTick(this.end.bind(this))}function o(t,e){for(var n=0,r=t.length;r>n;n++)e(t[n],n)}e.exports=r;var s=Object.keys||function(t){var e=[];for(var n in t)e.push(n);return e},a=t("core-util-is");a.inherits=t("inherits");var u=t("./_stream_readable"),h=t("./_stream_writable");a.inherits(r,u),o(s(h.prototype),function(t){r.prototype[t]||(r.prototype[t]=h.prototype[t])})}).call(this,t("/home/alex/projects/javascript/imjs/node_modules/insert-module-globals/node_modules/process/browser.js"))},{"./_stream_readable":37,"./_stream_writable":39,"/home/alex/projects/javascript/imjs/node_modules/insert-module-globals/node_modules/process/browser.js":55,"core-util-is":40,inherits:28}],36:[function(t,e,n){function r(t){return this instanceof r?void i.call(this,t):new r(t)}e.exports=r;var i=t("./_stream_transform"),o=t("core-util-is");o.inherits=t("inherits"),o.inherits(r,i),r.prototype._transform=function(t,e,n){n(null,t)}},{"./_stream_transform":38,"core-util-is":40,inherits:28}],37:[function(t,e,n){(function(n){function r(e,n){e=e||{};var r=e.highWaterMark;this.highWaterMark=r||0===r?r:16384,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=!1,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.calledRead=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!e.objectMode,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(L||(L=t("string_decoder/").StringDecoder),this.decoder=new L(e.encoding),this.encoding=e.encoding)}function i(t){return this instanceof i?(this._readableState=new r(t,this),this.readable=!0,void O.call(this)):new i(t)}function o(t,e,n,r,i){var o=h(e,n);if(o)t.emit("error",o);else if(null===n||void 0===n)e.reading=!1,e.ended||c(t,e);else if(e.objectMode||n&&n.length>0)if(e.ended&&!i){var a=new Error("stream.push() after EOF");t.emit("error",a)}else if(e.endEmitted&&i){var a=new Error("stream.unshift() after end event");t.emit("error",a)}else!e.decoder||i||r||(n=e.decoder.write(n)),e.length+=e.objectMode?1:n.length,i?e.buffer.unshift(n):(e.reading=!1,e.buffer.push(n)),e.needReadable&&l(t),p(t,e);else i||(e.reading=!1);return s(e)}function s(t){return!t.ended&&(t.needReadable||t.length<t.highWaterMark||0===t.length)}function a(t){if(t>=A)t=A;else{t--;for(var e=1;32>e;e<<=1)t|=t>>e;t++}return t}function u(t,e){return 0===e.length&&e.ended?0:e.objectMode?0===t?0:1:null===t||isNaN(t)?e.flowing&&e.buffer.length?e.buffer[0].length:e.length:0>=t?0:(t>e.highWaterMark&&(e.highWaterMark=a(t)),t>e.length?e.ended?e.length:(e.needReadable=!0,0):t)}function h(t,e){var n=null;return T.isBuffer(e)||"string"==typeof e||null===e||void 0===e||t.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}function c(t,e){if(e.decoder&&!e.ended){var n=e.decoder.end();n&&n.length&&(e.buffer.push(n),e.length+=e.objectMode?1:n.length)}e.ended=!0,e.length>0?l(t):b(t)}function l(t){var e=t._readableState;e.needReadable=!1,e.emittedReadable||(e.emittedReadable=!0,e.sync?n.nextTick(function(){f(t)}):f(t))}function f(t){t.emit("readable")}function p(t,e){e.readingMore||(e.readingMore=!0,n.nextTick(function(){d(t,e)}))}function d(t,e){for(var n=e.length;!e.reading&&!e.flowing&&!e.ended&&e.length<e.highWaterMark&&(t.read(0),n!==e.length);)n=e.length;e.readingMore=!1}function g(t){return function(){var e=t._readableState;e.awaitDrain--,0===e.awaitDrain&&m(t)}}function m(t){function e(t,e,i){var o=t.write(n);!1===o&&r.awaitDrain++}var n,r=t._readableState;for(r.awaitDrain=0;r.pipesCount&&null!==(n=t.read());)if(1===r.pipesCount?e(r.pipes,0,null):_(r.pipes,e),t.emit("data",n),r.awaitDrain>0)return;return 0===r.pipesCount?(r.flowing=!1,void(j.listenerCount(t,"data")>0&&v(t))):void(r.ranOut=!0)}function y(){this._readableState.ranOut&&(this._readableState.ranOut=!1,m(this))}function v(t,e){var r=t._readableState;if(r.flowing)throw new Error("Cannot switch to old mode now.");var i=e||!1,o=!1;t.readable=!0,t.pipe=O.prototype.pipe,t.on=t.addListener=O.prototype.on,t.on("readable",function(){o=!0;for(var e;!i&&null!==(e=t.read());)t.emit("data",e);null===e&&(o=!1,t._readableState.needReadable=!0)}),t.pause=function(){i=!0,this.emit("pause")},t.resume=function(){i=!1,o?n.nextTick(function(){t.emit("readable")}):this.read(0),this.emit("resume")},t.emit("readable")}function w(t,e){var n,r=e.buffer,i=e.length,o=!!e.decoder,s=!!e.objectMode;if(0===r.length)return null;if(0===i)n=null;else if(s)n=r.shift();else if(!t||t>=i)n=o?r.join(""):T.concat(r,i),r.length=0;else if(t<r[0].length){var a=r[0];n=a.slice(0,t),r[0]=a.slice(t)}else if(t===r[0].length)n=r.shift();else{n=o?"":new T(t);for(var u=0,h=0,c=r.length;c>h&&t>u;h++){var a=r[0],l=Math.min(t-u,a.length);o?n+=a.slice(0,l):a.copy(n,u,0,l),l<a.length?r[0]=a.slice(l):r.shift(),u+=l}}return n}function b(t){var e=t._readableState;if(e.length>0)throw new Error("endReadable called on non-empty stream");!e.endEmitted&&e.calledRead&&(e.ended=!0,n.nextTick(function(){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}))}function _(t,e){for(var n=0,r=t.length;r>n;n++)e(t[n],n)}function E(t,e){for(var n=0,r=t.length;r>n;n++)if(t[n]===e)return n;return-1}e.exports=i;var S=t("isarray"),T=t("buffer").Buffer;i.ReadableState=r;var j=t("events").EventEmitter;j.listenerCount||(j.listenerCount=function(t,e){return t.listeners(e).length});var O=t("stream"),R=t("core-util-is");R.inherits=t("inherits");var L;R.inherits(i,O),i.prototype.push=function(t,e){var n=this._readableState;return"string"!=typeof t||n.objectMode||(e=e||n.defaultEncoding,e!==n.encoding&&(t=new T(t,e),e="")),o(this,n,t,e,!1)},i.prototype.unshift=function(t){var e=this._readableState;return o(this,e,t,"",!0)},i.prototype.setEncoding=function(e){L||(L=t("string_decoder/").StringDecoder),this._readableState.decoder=new L(e),this._readableState.encoding=e};var A=8388608;i.prototype.read=function(t){var e=this._readableState;e.calledRead=!0;var n,r=t;if(("number"!=typeof t||t>0)&&(e.emittedReadable=!1),0===t&&e.needReadable&&(e.length>=e.highWaterMark||e.ended))return l(this),null;if(t=u(t,e),0===t&&e.ended)return n=null,e.length>0&&e.decoder&&(n=w(t,e),e.length-=n.length),0===e.length&&b(this),n;var i=e.needReadable;return e.length-t<=e.highWaterMark&&(i=!0),(e.ended||e.reading)&&(i=!1),i&&(e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1),i&&!e.reading&&(t=u(r,e)),n=t>0?w(t,e):null,null===n&&(e.needReadable=!0,t=0),e.length-=t,0!==e.length||e.ended||(e.needReadable=!0),e.ended&&!e.endEmitted&&0===e.length&&b(this),n},i.prototype._read=function(t){this.emit("error",new Error("not implemented"))},i.prototype.pipe=function(t,e){function r(t){t===c&&o()}function i(){t.end()}function o(){t.removeListener("close",a),t.removeListener("finish",u),t.removeListener("drain",d),t.removeListener("error",s),t.removeListener("unpipe",r),c.removeListener("end",i),c.removeListener("end",o),(!t._writableState||t._writableState.needDrain)&&d()}function s(e){h(),t.removeListener("error",s),0===j.listenerCount(t,"error")&&t.emit("error",e)}function a(){t.removeListener("finish",u),h()}function u(){t.removeListener("close",a),h()}function h(){c.unpipe(t)}var c=this,l=this._readableState;switch(l.pipesCount){case 0:l.pipes=t;break;case 1:l.pipes=[l.pipes,t];break;default:l.pipes.push(t)}l.pipesCount+=1;var f=(!e||e.end!==!1)&&t!==n.stdout&&t!==n.stderr,p=f?i:o;l.endEmitted?n.nextTick(p):c.once("end",p),t.on("unpipe",r);var d=g(c);return t.on("drain",d),t._events&&t._events.error?S(t._events.error)?t._events.error.unshift(s):t._events.error=[s,t._events.error]:t.on("error",s),t.once("close",a),t.once("finish",u),t.emit("pipe",c),l.flowing||(this.on("readable",y),l.flowing=!0,n.nextTick(function(){m(c)})),t},i.prototype.unpipe=function(t){var e=this._readableState;if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes?this:(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,this.removeListener("readable",y),e.flowing=!1,t&&t.emit("unpipe",this),this);if(!t){var n=e.pipes,r=e.pipesCount;e.pipes=null,e.pipesCount=0,this.removeListener("readable",y),e.flowing=!1;for(var i=0;r>i;i++)n[i].emit("unpipe",this);return this}var i=E(e.pipes,t);return-1===i?this:(e.pipes.splice(i,1),e.pipesCount-=1,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit("unpipe",this),this)},i.prototype.on=function(t,e){var n=O.prototype.on.call(this,t,e);if("data"!==t||this._readableState.flowing||v(this),"readable"===t&&this.readable){var r=this._readableState;r.readableListening||(r.readableListening=!0,r.emittedReadable=!1,r.needReadable=!0,r.reading?r.length&&l(this,r):this.read(0))}return n},i.prototype.addListener=i.prototype.on,i.prototype.resume=function(){v(this),this.read(0),this.emit("resume")},i.prototype.pause=function(){v(this,!0),this.emit("pause")},i.prototype.wrap=function(t){var e=this._readableState,n=!1,r=this;t.on("end",function(){if(e.decoder&&!e.ended){var t=e.decoder.end();t&&t.length&&r.push(t)}r.push(null)}),t.on("data",function(i){if(e.decoder&&(i=e.decoder.write(i)),(!e.objectMode||null!==i&&void 0!==i)&&(e.objectMode||i&&i.length)){var o=r.push(i);o||(n=!0,t.pause())}});for(var i in t)"function"==typeof t[i]&&"undefined"==typeof this[i]&&(this[i]=function(e){return function(){return t[e].apply(t,arguments)}}(i));var o=["error","close","destroy","pause","resume"];return _(o,function(e){t.on(e,r.emit.bind(r,e))}),r._read=function(e){n&&(n=!1,t.resume())},r},i._fromList=w}).call(this,t("/home/alex/projects/javascript/imjs/node_modules/insert-module-globals/node_modules/process/browser.js"))},{"/home/alex/projects/javascript/imjs/node_modules/insert-module-globals/node_modules/process/browser.js":55,buffer:23,"core-util-is":40,events:27,inherits:28,isarray:29,stream:45,"string_decoder/":46}],38:[function(t,e,n){function r(t,e){this.afterTransform=function(t,n){return i(e,t,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}function i(t,e,n){var r=t._transformState;r.transforming=!1;var i=r.writecb;if(!i)return t.emit("error",new Error("no writecb in Transform class"));

r.writechunk=null,r.writecb=null,null!==n&&void 0!==n&&t.push(n),i&&i(e);var o=t._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&t._read(o.highWaterMark)}function o(t){if(!(this instanceof o))return new o(t);a.call(this,t);var e=(this._transformState=new r(t,this),this);this._readableState.needReadable=!0,this._readableState.sync=!1,this.once("finish",function(){"function"==typeof this._flush?this._flush(function(t){s(e,t)}):s(e)})}function s(t,e){if(e)return t.emit("error",e);var n=t._writableState,r=(t._readableState,t._transformState);if(n.length)throw new Error("calling transform done when ws.length != 0");if(r.transforming)throw new Error("calling transform done when still transforming");return t.push(null)}e.exports=o;var a=t("./_stream_duplex"),u=t("core-util-is");u.inherits=t("inherits"),u.inherits(o,a),o.prototype.push=function(t,e){return this._transformState.needTransform=!1,a.prototype.push.call(this,t,e)},o.prototype._transform=function(t,e,n){throw new Error("not implemented")},o.prototype._write=function(t,e,n){var r=this._transformState;if(r.writecb=n,r.writechunk=t,r.writeencoding=e,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},o.prototype._read=function(t){var e=this._transformState;null!==e.writechunk&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0}},{"./_stream_duplex":35,"core-util-is":40,inherits:28}],39:[function(t,e,n){(function(n){function r(t,e,n){this.chunk=t,this.encoding=e,this.callback=n}function i(t,e){t=t||{};var n=t.highWaterMark;this.highWaterMark=n||0===n?n:16384,this.objectMode=!!t.objectMode,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var r=t.decodeStrings===!1;this.decodeStrings=!r,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){p(e,t)},this.writecb=null,this.writelen=0,this.buffer=[],this.errorEmitted=!1}function o(e){var n=t("./_stream_duplex");return this instanceof o||this instanceof n?(this._writableState=new i(e,this),this.writable=!0,void E.call(this)):new o(e)}function s(t,e,r){var i=new Error("write after end");t.emit("error",i),n.nextTick(function(){r(i)})}function a(t,e,r,i){var o=!0;if(!b.isBuffer(r)&&"string"!=typeof r&&null!==r&&void 0!==r&&!e.objectMode){var s=new TypeError("Invalid non-string/buffer chunk");t.emit("error",s),n.nextTick(function(){i(s)}),o=!1}return o}function u(t,e,n){return t.objectMode||t.decodeStrings===!1||"string"!=typeof e||(e=new b(e,n)),e}function h(t,e,n,i,o){n=u(e,n,i),b.isBuffer(n)&&(i="buffer");var s=e.objectMode?1:n.length;e.length+=s;var a=e.length<e.highWaterMark;return a||(e.needDrain=!0),e.writing?e.buffer.push(new r(n,i,o)):c(t,e,s,n,i,o),a}function c(t,e,n,r,i,o){e.writelen=n,e.writecb=o,e.writing=!0,e.sync=!0,t._write(r,i,e.onwrite),e.sync=!1}function l(t,e,r,i,o){r?n.nextTick(function(){o(i)}):o(i),t._writableState.errorEmitted=!0,t.emit("error",i)}function f(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}function p(t,e){var r=t._writableState,i=r.sync,o=r.writecb;if(f(r),e)l(t,r,i,e,o);else{var s=y(t,r);s||r.bufferProcessing||!r.buffer.length||m(t,r),i?n.nextTick(function(){d(t,r,s,o)}):d(t,r,s,o)}}function d(t,e,n,r){n||g(t,e),r(),n&&v(t,e)}function g(t,e){0===e.length&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}function m(t,e){e.bufferProcessing=!0;for(var n=0;n<e.buffer.length;n++){var r=e.buffer[n],i=r.chunk,o=r.encoding,s=r.callback,a=e.objectMode?1:i.length;if(c(t,e,a,i,o,s),e.writing){n++;break}}e.bufferProcessing=!1,n<e.buffer.length?e.buffer=e.buffer.slice(n):e.buffer.length=0}function y(t,e){return e.ending&&0===e.length&&!e.finished&&!e.writing}function v(t,e){var n=y(t,e);return n&&(e.finished=!0,t.emit("finish")),n}function w(t,e,r){e.ending=!0,v(t,e),r&&(e.finished?n.nextTick(r):t.once("finish",r)),e.ended=!0}e.exports=o;var b=t("buffer").Buffer;o.WritableState=i;var _=t("core-util-is");_.inherits=t("inherits");var E=t("stream");_.inherits(o,E),o.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},o.prototype.write=function(t,e,n){var r=this._writableState,i=!1;return"function"==typeof e&&(n=e,e=null),b.isBuffer(t)?e="buffer":e||(e=r.defaultEncoding),"function"!=typeof n&&(n=function(){}),r.ended?s(this,r,n):a(this,r,t,n)&&(i=h(this,r,t,e,n)),i},o.prototype._write=function(t,e,n){n(new Error("not implemented"))},o.prototype.end=function(t,e,n){var r=this._writableState;"function"==typeof t?(n=t,t=null,e=null):"function"==typeof e&&(n=e,e=null),"undefined"!=typeof t&&null!==t&&this.write(t,e),r.ending||r.finished||w(this,r,n)}}).call(this,t("/home/alex/projects/javascript/imjs/node_modules/insert-module-globals/node_modules/process/browser.js"))},{"./_stream_duplex":35,"/home/alex/projects/javascript/imjs/node_modules/insert-module-globals/node_modules/process/browser.js":55,buffer:23,"core-util-is":40,inherits:28,stream:45}],40:[function(t,e,n){(function(t){function e(t){return Array.isArray(t)}function r(t){return"boolean"==typeof t}function i(t){return null===t}function o(t){return null==t}function s(t){return"number"==typeof t}function a(t){return"string"==typeof t}function u(t){return"symbol"==typeof t}function h(t){return void 0===t}function c(t){return l(t)&&"[object RegExp]"===y(t)}function l(t){return"object"==typeof t&&null!==t}function f(t){return l(t)&&"[object Date]"===y(t)}function p(t){return l(t)&&("[object Error]"===y(t)||t instanceof Error)}function d(t){return"function"==typeof t}function g(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||"undefined"==typeof t}function m(e){return t.isBuffer(e)}function y(t){return Object.prototype.toString.call(t)}n.isArray=e,n.isBoolean=r,n.isNull=i,n.isNullOrUndefined=o,n.isNumber=s,n.isString=a,n.isSymbol=u,n.isUndefined=h,n.isRegExp=c,n.isObject=l,n.isDate=f,n.isError=p,n.isFunction=d,n.isPrimitive=g,n.isBuffer=m}).call(this,t("buffer").Buffer)},{buffer:23}],41:[function(t,e,n){e.exports=t("./lib/_stream_passthrough.js")},{"./lib/_stream_passthrough.js":36}],42:[function(t,e,n){var r=t("stream");n=e.exports=t("./lib/_stream_readable.js"),n.Stream=r,n.Readable=n,n.Writable=t("./lib/_stream_writable.js"),n.Duplex=t("./lib/_stream_duplex.js"),n.Transform=t("./lib/_stream_transform.js"),n.PassThrough=t("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":35,"./lib/_stream_passthrough.js":36,"./lib/_stream_readable.js":37,"./lib/_stream_transform.js":38,"./lib/_stream_writable.js":39,stream:45}],43:[function(t,e,n){e.exports=t("./lib/_stream_transform.js")},{"./lib/_stream_transform.js":38}],44:[function(t,e,n){e.exports=t("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":39}],45:[function(t,e,n){function r(){i.call(this)}e.exports=r;var i=t("events").EventEmitter,o=t("inherits");o(r,i),r.Readable=t("readable-stream/readable.js"),r.Writable=t("readable-stream/writable.js"),r.Duplex=t("readable-stream/duplex.js"),r.Transform=t("readable-stream/transform.js"),r.PassThrough=t("readable-stream/passthrough.js"),r.Stream=r,r.prototype.pipe=function(t,e){function n(e){t.writable&&!1===t.write(e)&&h.pause&&h.pause()}function r(){h.readable&&h.resume&&h.resume()}function o(){c||(c=!0,t.end())}function s(){c||(c=!0,"function"==typeof t.destroy&&t.destroy())}function a(t){if(u(),0===i.listenerCount(this,"error"))throw t}function u(){h.removeListener("data",n),t.removeListener("drain",r),h.removeListener("end",o),h.removeListener("close",s),h.removeListener("error",a),t.removeListener("error",a),h.removeListener("end",u),h.removeListener("close",u),t.removeListener("close",u)}var h=this;h.on("data",n),t.on("drain",r),t._isStdio||e&&e.end===!1||(h.on("end",o),h.on("close",s));var c=!1;return h.on("error",a),t.on("error",a),h.on("end",u),h.on("close",u),t.on("close",u),t.emit("pipe",h),t}},{events:27,inherits:28,"readable-stream/duplex.js":34,"readable-stream/passthrough.js":41,"readable-stream/readable.js":42,"readable-stream/transform.js":43,"readable-stream/writable.js":44}],46:[function(t,e,n){function r(t){if(t&&!u(t))throw new Error("Unknown encoding: "+t)}function i(t){return t.toString(this.encoding)}function o(t){this.charReceived=t.length%2,this.charLength=this.charReceived?2:0}function s(t){this.charReceived=t.length%3,this.charLength=this.charReceived?3:0}var a=t("buffer").Buffer,u=a.isEncoding||function(t){switch(t&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},h=n.StringDecoder=function(t){switch(this.encoding=(t||"utf8").toLowerCase().replace(/[-_]/,""),r(t),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=o;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=s;break;default:return void(this.write=i)}this.charBuffer=new a(6),this.charReceived=0,this.charLength=0};h.prototype.write=function(t){for(var e="";this.charLength;){var n=t.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:t.length;if(t.copy(this.charBuffer,this.charReceived,0,n),this.charReceived+=n,this.charReceived<this.charLength)return"";t=t.slice(n,t.length),e=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var r=e.charCodeAt(e.length-1);if(!(r>=55296&&56319>=r)){if(this.charReceived=this.charLength=0,0===t.length)return e;break}this.charLength+=this.surrogateSize,e=""}this.detectIncompleteChar(t);var i=t.length;this.charLength&&(t.copy(this.charBuffer,0,t.length-this.charReceived,i),i-=this.charReceived),e+=t.toString(this.encoding,0,i);var i=e.length-1,r=e.charCodeAt(i);if(r>=55296&&56319>=r){var o=this.surrogateSize;return this.charLength+=o,this.charReceived+=o,this.charBuffer.copy(this.charBuffer,o,0,o),t.copy(this.charBuffer,0,0,o),e.substring(0,i)}return e},h.prototype.detectIncompleteChar=function(t){for(var e=t.length>=3?3:t.length;e>0;e--){var n=t[t.length-e];if(1==e&&n>>5==6){this.charLength=2;break}if(2>=e&&n>>4==14){this.charLength=3;break}if(3>=e&&n>>3==30){this.charLength=4;break}}this.charReceived=e},h.prototype.end=function(t){var e="";if(t&&t.length&&(e=this.write(t)),this.charReceived){var n=this.charReceived,r=this.charBuffer,i=this.encoding;e+=r.slice(0,n).toString(i)}return e}},{buffer:23}],47:[function(t,e,n){function r(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function i(t,e,n){if(t&&h(t)&&t instanceof r)return t;var i=new r;return i.parse(t,e,n),i}function o(t){return u(t)&&(t=i(t)),t instanceof r?t.format():r.prototype.format.call(t)}function s(t,e){return i(t,!1,!0).resolve(e)}function a(t,e){return t?i(t,!1,!0).resolveObject(e):e}function u(t){return"string"==typeof t}function h(t){return"object"==typeof t&&null!==t}function c(t){return null===t}function l(t){return null==t}var f=t("punycode");n.parse=i,n.resolve=s,n.resolveObject=a,n.format=o,n.Url=r;var p=/^([a-z0-9.+-]+:)/i,d=/:[0-9]*$/,g=["<",">",'"',"`"," ","\r","\n","	"],m=["{","}","|","\\","^","`"].concat(g),y=["'"].concat(m),v=["%","/","?",";","#"].concat(y),w=["/","?","#"],b=255,_=/^[a-z0-9A-Z_-]{0,63}$/,E=/^([a-z0-9A-Z_-]{0,63})(.*)$/,S={javascript:!0,"javascript:":!0},T={javascript:!0,"javascript:":!0},j={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},O=t("querystring");r.prototype.parse=function(t,e,n){if(!u(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var r=t;r=r.trim();var i=p.exec(r);if(i){i=i[0];var o=i.toLowerCase();this.protocol=o,r=r.substr(i.length)}if(n||i||r.match(/^\/\/[^@\/]+@[^@\/]+/)){var s="//"===r.substr(0,2);!s||i&&T[i]||(r=r.substr(2),this.slashes=!0)}if(!T[i]&&(s||i&&!j[i])){for(var a=-1,h=0;h<w.length;h++){var c=r.indexOf(w[h]);-1!==c&&(-1===a||a>c)&&(a=c)}var l,d;d=-1===a?r.lastIndexOf("@"):r.lastIndexOf("@",a),-1!==d&&(l=r.slice(0,d),r=r.slice(d+1),this.auth=decodeURIComponent(l)),a=-1;for(var h=0;h<v.length;h++){var c=r.indexOf(v[h]);-1!==c&&(-1===a||a>c)&&(a=c)}-1===a&&(a=r.length),this.host=r.slice(0,a),r=r.slice(a),this.parseHost(),this.hostname=this.hostname||"";var g="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!g)for(var m=this.hostname.split(/\./),h=0,R=m.length;R>h;h++){var L=m[h];if(L&&!L.match(_)){for(var A="",I=0,x=L.length;x>I;I++)A+=L.charCodeAt(I)>127?"x":L[I];if(!A.match(_)){var k=m.slice(0,h),C=m.slice(h+1),P=L.match(E);P&&(k.push(P[1]),C.unshift(P[2])),C.length&&(r="/"+C.join(".")+r),this.hostname=k.join(".");break}}}if(this.hostname=this.hostname.length>b?"":this.hostname.toLowerCase(),!g){for(var N=this.hostname.split("."),q=[],h=0;h<N.length;++h){var M=N[h];q.push(M.match(/[^A-Za-z0-9_-]/)?"xn--"+f.encode(M):M)}this.hostname=q.join(".")}var U=this.port?":"+this.port:"",B=this.hostname||"";this.host=B+U,this.href+=this.host,g&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==r[0]&&(r="/"+r))}if(!S[o])for(var h=0,R=y.length;R>h;h++){var D=y[h],F=encodeURIComponent(D);F===D&&(F=escape(D)),r=r.split(D).join(F)}var V=r.indexOf("#");-1!==V&&(this.hash=r.substr(V),r=r.slice(0,V));var H=r.indexOf("?");if(-1!==H?(this.search=r.substr(H),this.query=r.substr(H+1),e&&(this.query=O.parse(this.query)),r=r.slice(0,H)):e&&(this.search="",this.query={}),r&&(this.pathname=r),j[o]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var U=this.pathname||"",M=this.search||"";this.path=U+M}return this.href=this.format(),this},r.prototype.format=function(){var t=this.auth||"";t&&(t=encodeURIComponent(t),t=t.replace(/%3A/i,":"),t+="@");var e=this.protocol||"",n=this.pathname||"",r=this.hash||"",i=!1,o="";this.host?i=t+this.host:this.hostname&&(i=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&h(this.query)&&Object.keys(this.query).length&&(o=O.stringify(this.query));var s=this.search||o&&"?"+o||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||j[e])&&i!==!1?(i="//"+(i||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):i||(i=""),r&&"#"!==r.charAt(0)&&(r="#"+r),s&&"?"!==s.charAt(0)&&(s="?"+s),n=n.replace(/[?#]/g,function(t){return encodeURIComponent(t)}),s=s.replace("#","%23"),e+i+n+s+r},r.prototype.resolve=function(t){return this.resolveObject(i(t,!1,!0)).format()},r.prototype.resolveObject=function(t){if(u(t)){var e=new r;e.parse(t,!1,!0),t=e}var n=new r;if(Object.keys(this).forEach(function(t){n[t]=this[t]},this),n.hash=t.hash,""===t.href)return n.href=n.format(),n;if(t.slashes&&!t.protocol)return Object.keys(t).forEach(function(e){"protocol"!==e&&(n[e]=t[e])}),j[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n;if(t.protocol&&t.protocol!==n.protocol){if(!j[t.protocol])return Object.keys(t).forEach(function(e){n[e]=t[e]}),n.href=n.format(),n;if(n.protocol=t.protocol,t.host||T[t.protocol])n.pathname=t.pathname;else{for(var i=(t.pathname||"").split("/");i.length&&!(t.host=i.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==i[0]&&i.unshift(""),i.length<2&&i.unshift(""),n.pathname=i.join("/")}if(n.search=t.search,n.query=t.query,n.host=t.host||"",n.auth=t.auth,n.hostname=t.hostname||t.host,n.port=t.port,n.pathname||n.search){var o=n.pathname||"",s=n.search||"";n.path=o+s}return n.slashes=n.slashes||t.slashes,n.href=n.format(),n}var a=n.pathname&&"/"===n.pathname.charAt(0),h=t.host||t.pathname&&"/"===t.pathname.charAt(0),f=h||a||n.host&&t.pathname,p=f,d=n.pathname&&n.pathname.split("/")||[],i=t.pathname&&t.pathname.split("/")||[],g=n.protocol&&!j[n.protocol];if(g&&(n.hostname="",n.port=null,n.host&&(""===d[0]?d[0]=n.host:d.unshift(n.host)),n.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===i[0]?i[0]=t.host:i.unshift(t.host)),t.host=null),f=f&&(""===i[0]||""===d[0])),h)n.host=t.host||""===t.host?t.host:n.host,n.hostname=t.hostname||""===t.hostname?t.hostname:n.hostname,n.search=t.search,n.query=t.query,d=i;else if(i.length)d||(d=[]),d.pop(),d=d.concat(i),n.search=t.search,n.query=t.query;else if(!l(t.search)){if(g){n.hostname=n.host=d.shift();var m=n.host&&n.host.indexOf("@")>0?n.host.split("@"):!1;m&&(n.auth=m.shift(),n.host=n.hostname=m.shift())}return n.search=t.search,n.query=t.query,c(n.pathname)&&c(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!d.length)return n.pathname=null,n.path=n.search?"/"+n.search:null,n.href=n.format(),n;for(var y=d.slice(-1)[0],v=(n.host||t.host)&&("."===y||".."===y)||""===y,w=0,b=d.length;b>=0;b--)y=d[b],"."==y?d.splice(b,1):".."===y?(d.splice(b,1),w++):w&&(d.splice(b,1),w--);if(!f&&!p)for(;w--;w)d.unshift("..");!f||""===d[0]||d[0]&&"/"===d[0].charAt(0)||d.unshift(""),v&&"/"!==d.join("/").substr(-1)&&d.push("");var _=""===d[0]||d[0]&&"/"===d[0].charAt(0);if(g){n.hostname=n.host=_?"":d.length?d.shift():"";var m=n.host&&n.host.indexOf("@")>0?n.host.split("@"):!1;m&&(n.auth=m.shift(),n.host=n.hostname=m.shift())}return f=f||n.host&&d.length,f&&!_&&d.unshift(""),d.length?n.pathname=d.join("/"):(n.pathname=null,n.path=null),c(n.pathname)&&c(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=t.auth||n.auth,n.slashes=n.slashes||t.slashes,n.href=n.format(),n},r.prototype.parseHost=function(){var t=this.host,e=d.exec(t);e&&(e=e[0],":"!==e&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}},{punycode:30,querystring:33}],48:[function(t,e,n){e.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},{}],49:[function(t,e,n){(function(e,r){function i(t,e){var r={seen:[],stylize:s};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),g(e)?r.showHidden=e:e&&n._extend(r,e),_(r.showHidden)&&(r.showHidden=!1),_(r.depth)&&(r.depth=2),_(r.colors)&&(r.colors=!1),_(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=o),u(r,t,r.depth)}function o(t,e){var n=i.styles[e];return n?"["+i.colors[n][0]+"m"+t+"["+i.colors[n][1]+"m":t}function s(t,e){return t}function a(t){var e={};return t.forEach(function(t,n){e[t]=!0}),e}function u(t,e,r){if(t.customInspect&&e&&O(e.inspect)&&e.inspect!==n.inspect&&(!e.constructor||e.constructor.prototype!==e)){var i=e.inspect(r,t);return w(i)||(i=u(t,i,r)),i}var o=h(t,e);if(o)return o;var s=Object.keys(e),g=a(s);if(t.showHidden&&(s=Object.getOwnPropertyNames(e)),j(e)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return c(e);if(0===s.length){if(O(e)){var m=e.name?": "+e.name:"";return t.stylize("[Function"+m+"]","special")}if(E(e))return t.stylize(RegExp.prototype.toString.call(e),"regexp");if(T(e))return t.stylize(Date.prototype.toString.call(e),"date");if(j(e))return c(e)}var y="",v=!1,b=["{","}"];if(d(e)&&(v=!0,b=["[","]"]),O(e)){var _=e.name?": "+e.name:"";y=" [Function"+_+"]"}if(E(e)&&(y=" "+RegExp.prototype.toString.call(e)),T(e)&&(y=" "+Date.prototype.toUTCString.call(e)),j(e)&&(y=" "+c(e)),0===s.length&&(!v||0==e.length))return b[0]+y+b[1];if(0>r)return E(e)?t.stylize(RegExp.prototype.toString.call(e),"regexp"):t.stylize("[Object]","special");t.seen.push(e);var S;return S=v?l(t,e,r,g,s):s.map(function(n){return f(t,e,r,g,n,v)}),t.seen.pop(),p(S,y,b)}function h(t,e){if(_(e))return t.stylize("undefined","undefined");if(w(e)){var n="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(n,"string")}return v(e)?t.stylize(""+e,"number"):g(e)?t.stylize(""+e,"boolean"):m(e)?t.stylize("null","null"):void 0}function c(t){return"["+Error.prototype.toString.call(t)+"]"}function l(t,e,n,r,i){for(var o=[],s=0,a=e.length;a>s;++s)o.push(x(e,String(s))?f(t,e,n,r,String(s),!0):"");return i.forEach(function(i){i.match(/^\d+$/)||o.push(f(t,e,n,r,i,!0))}),o}function f(t,e,n,r,i,o){var s,a,h;if(h=Object.getOwnPropertyDescriptor(e,i)||{value:e[i]},h.get?a=h.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):h.set&&(a=t.stylize("[Setter]","special")),x(r,i)||(s="["+i+"]"),a||(t.seen.indexOf(h.value)<0?(a=m(n)?u(t,h.value,null):u(t,h.value,n-1),a.indexOf("\n")>-1&&(a=o?a.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+a.split("\n").map(function(t){return"   "+t}).join("\n"))):a=t.stylize("[Circular]","special")),_(s)){if(o&&i.match(/^\d+$/))return a;s=JSON.stringify(""+i),s.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=t.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=t.stylize(s,"string"))}return s+": "+a}function p(t,e,n){var r=0,i=t.reduce(function(t,e){return r++,e.indexOf("\n")>=0&&r++,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0);return i>60?n[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+n[1]:n[0]+e+" "+t.join(", ")+" "+n[1]}function d(t){return Array.isArray(t)}function g(t){return"boolean"==typeof t}function m(t){return null===t}function y(t){return null==t}function v(t){return"number"==typeof t}function w(t){return"string"==typeof t}function b(t){return"symbol"==typeof t}function _(t){return void 0===t}function E(t){return S(t)&&"[object RegExp]"===L(t)}function S(t){return"object"==typeof t&&null!==t}function T(t){return S(t)&&"[object Date]"===L(t)}function j(t){return S(t)&&("[object Error]"===L(t)||t instanceof Error)}function O(t){return"function"==typeof t}function R(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||"undefined"==typeof t}function L(t){return Object.prototype.toString.call(t)}function A(t){return 10>t?"0"+t.toString(10):t.toString(10)}function I(){var t=new Date,e=[A(t.getHours()),A(t.getMinutes()),A(t.getSeconds())].join(":");return[t.getDate(),N[t.getMonth()],e].join(" ")}function x(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var k=/%[sdj%]/g;n.format=function(t){if(!w(t)){for(var e=[],n=0;n<arguments.length;n++)e.push(i(arguments[n]));return e.join(" ")}for(var n=1,r=arguments,o=r.length,s=String(t).replace(k,function(t){if("%%"===t)return"%";if(n>=o)return t;switch(t){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return t}}),a=r[n];o>n;a=r[++n])s+=m(a)||!S(a)?" "+a:" "+i(a);return s},n.deprecate=function(t,i){function o(){if(!s){if(e.throwDeprecation)throw new Error(i);e.traceDeprecation?console.trace(i):console.error(i),s=!0}return t.apply(this,arguments)}if(_(r.process))return function(){return n.deprecate(t,i).apply(this,arguments)};if(e.noDeprecation===!0)return t;var s=!1;return o};var C,P={};n.debuglog=function(t){if(_(C)&&(C=e.env.NODE_DEBUG||""),t=t.toUpperCase(),!P[t])if(new RegExp("\\b"+t+"\\b","i").test(C)){var r=e.pid;P[t]=function(){var e=n.format.apply(n,arguments);console.error("%s %d: %s",t,r,e)}}else P[t]=function(){};return P[t]},n.inspect=i,i.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},i.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=d,n.isBoolean=g,n.isNull=m,n.isNullOrUndefined=y,n.isNumber=v,n.isString=w,n.isSymbol=b,n.isUndefined=_,n.isRegExp=E,n.isObject=S,n.isDate=T,n.isError=j,n.isFunction=O,n.isPrimitive=R,n.isBuffer=t("./support/isBuffer");var N=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];n.log=function(){console.log("%s - %s",I(),n.format.apply(n,arguments))},n.inherits=t("inherits"),n._extend=function(t,e){if(!e||!S(e))return t;for(var n=Object.keys(e),r=n.length;r--;)t[n[r]]=e[n[r]];return t}}).call(this,t("/home/alex/projects/javascript/imjs/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof r?r:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":48,"/home/alex/projects/javascript/imjs/node_modules/insert-module-globals/node_modules/process/browser.js":55,inherits:28}],50:[function(t,e,n){var r=e.exports,i=(t("events").EventEmitter,t("./lib/request")),o=t("url");r.request=function(t,e){"string"==typeof t&&(t=o.parse(t)),t||(t={}),t.host||t.port||(t.port=parseInt(window.location.port,10)),!t.host&&t.hostname&&(t.host=t.hostname),t.protocol||(t.protocol=t.scheme?t.scheme+":":window.location.protocol),t.host||(t.host=window.location.hostname||window.location.host),/:/.test(t.host)&&(t.port||(t.port=t.host.split(":")[1]),t.host=t.host.split(":")[0]),t.port||(t.port="https:"==t.protocol?443:80);var n=new i(new s,t);return e&&n.on("response",e),n},r.get=function(t,e){t.method="GET";var n=r.request(t,e);return n.end(),n},r.Agent=function(){},r.Agent.defaultMaxSockets=4;var s=function(){if("undefined"==typeof window)throw new Error("no window object present");if(window.XMLHttpRequest)return window.XMLHttpRequest;if(window.ActiveXObject){for(var t=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"],e=0;e<t.length;e++)try{var n=new window.ActiveXObject(t[e]);return function(){if(n){var r=n;return n=null,r}return new window.ActiveXObject(t[e])}}catch(r){}throw new Error("ajax not supported in this browser")}throw new Error("ajax not supported in this browser")}();r.STATUS_CODES={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Time-out",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Large",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Time-out",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"}},{"./lib/request":51,events:27,url:47}],51:[function(t,e,n){var r=t("stream"),i=t("./response"),o=t("Base64"),s=t("inherits"),a=e.exports=function(t,e){var n=this;n.writable=!0,n.xhr=t,n.body=[],n.uri=(e.protocol||"http:")+"//"+e.host+(e.port?":"+e.port:"")+(e.path||"/"),"undefined"==typeof e.withCredentials&&(e.withCredentials=!0);try{t.withCredentials=e.withCredentials}catch(r){}if(e.responseType)try{t.responseType=e.responseType}catch(r){}if(t.open(e.method||"GET",n.uri,!0),t.onerror=function(t){n.emit("error",new Error("Network error"))},n._headers={},e.headers)for(var s=u(e.headers),a=0;a<s.length;a++){var h=s[a];if(n.isSafeRequestHeader(h)){var c=e.headers[h];n.setHeader(h,c)}}e.auth&&this.setHeader("Authorization","Basic "+o.btoa(e.auth));var l=new i;l.on("close",function(){n.emit("close")}),l.on("ready",function(){n.emit("response",l)}),l.on("error",function(t){n.emit("error",t)}),t.onreadystatechange=function(){t.__aborted||l.handle(t)}};s(a,r),a.prototype.setHeader=function(t,e){this._headers[t.toLowerCase()]=e},a.prototype.getHeader=function(t){return this._headers[t.toLowerCase()]},a.prototype.removeHeader=function(t){delete this._headers[t.toLowerCase()]},a.prototype.write=function(t){this.body.push(t)},a.prototype.destroy=function(t){this.xhr.__aborted=!0,this.xhr.abort(),this.emit("close")},a.prototype.end=function(t){void 0!==t&&this.body.push(t);for(var e=u(this._headers),n=0;n<e.length;n++){var r=e[n],i=this._headers[r];if(h(i))for(var o=0;o<i.length;o++)this.xhr.setRequestHeader(r,i[o]);else this.xhr.setRequestHeader(r,i)}if(0===this.body.length)this.xhr.send("");else if("string"==typeof this.body[0])this.xhr.send(this.body.join(""));else if(h(this.body[0])){for(var s=[],n=0;n<this.body.length;n++)s.push.apply(s,this.body[n]);this.xhr.send(s)}else if(/Array/.test(Object.prototype.toString.call(this.body[0]))){for(var a=0,n=0;n<this.body.length;n++)a+=this.body[n].length;for(var s=new this.body[0].constructor(a),c=0,n=0;n<this.body.length;n++)for(var f=this.body[n],o=0;o<f.length;o++)s[c++]=f[o];this.xhr.send(s)}else if(l(this.body[0]))this.xhr.send(this.body[0]);else{for(var s="",n=0;n<this.body.length;n++)s+=this.body[n].toString();this.xhr.send(s)}},a.unsafeHeaders=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"],a.prototype.isSafeRequestHeader=function(t){return t?-1===c(a.unsafeHeaders,t.toLowerCase()):!1};var u=Object.keys||function(t){var e=[];for(var n in t)e.push(n);return e},h=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},c=function(t,e){if(t.indexOf)return t.indexOf(e);for(var n=0;n<t.length;n++)if(t[n]===e)return n;return-1},l=function(t){return"undefined"!=typeof Blob&&t instanceof Blob?!0:"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?!0:"undefined"!=typeof FormData&&t instanceof FormData?!0:void 0}},{"./response":52,Base64:53,inherits:54,stream:45}],52:[function(t,e,n){function r(t){for(var e=t.getAllResponseHeaders().split(/\r?\n/),n={},r=0;r<e.length;r++){var i=e[r];if(""!==i){var o=i.match(/^([^:]+):\s*(.*)/);if(o){var s=o[1].toLowerCase(),a=o[2];void 0!==n[s]?u(n[s])?n[s].push(a):n[s]=[n[s],a]:n[s]=a}else n[i]=!0}}return n}var i=t("stream"),o=t("util"),s=e.exports=function(t){this.offset=0,this.readable=!0};o.inherits(s,i);var a={streaming:!0,status2:!0};s.prototype.getResponse=function(t){var e=String(t.responseType).toLowerCase();return"blob"===e?t.responseBlob||t.response:"arraybuffer"===e?t.response:t.responseText},s.prototype.getHeader=function(t){return this.headers[t.toLowerCase()]},s.prototype.handle=function(t){if(2===t.readyState&&a.status2){try{this.statusCode=t.status,this.headers=r(t)}catch(e){a.status2=!1}a.status2&&this.emit("ready")}else if(a.streaming&&3===t.readyState){try{this.statusCode||(this.statusCode=t.status,this.headers=r(t),this.emit("ready"))}catch(e){}try{this._emitData(t)}catch(e){a.streaming=!1}}else 4===t.readyState&&(this.statusCode||(this.statusCode=t.status,this.emit("ready")),this._emitData(t),t.error?this.emit("error",this.getResponse(t)):this.emit("end"),this.emit("close"))},s.prototype._emitData=function(t){var e=this.getResponse(t);return e.toString().match(/ArrayBuffer/)?(this.emit("data",new Uint8Array(e,this.offset)),void(this.offset=e.byteLength)):void(e.length>this.offset&&(this.emit("data",e.slice(this.offset)),this.offset=e.length))};var u=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},{stream:45,util:49}],53:[function(t,e,n){!function(){function t(t){this.message=t}var e="undefined"!=typeof n?n:this,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";t.prototype=new Error,t.prototype.name="InvalidCharacterError",e.btoa||(e.btoa=function(e){for(var n,i,o=0,s=r,a="";e.charAt(0|o)||(s="=",o%1);a+=s.charAt(63&n>>8-o%1*8)){if(i=e.charCodeAt(o+=.75),i>255)throw new t("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");

n=n<<8|i}return a}),e.atob||(e.atob=function(e){if(e=e.replace(/=+$/,""),e.length%4==1)throw new t("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,i,o=0,s=0,a="";i=e.charAt(s++);~i&&(n=o%4?64*n+i:i,o++%4)?a+=String.fromCharCode(255&n>>(-2*o&6)):0)i=r.indexOf(i);return a})}()},{}],54:[function(t,e,n){e.exports=t(28)},{"/home/alex/projects/javascript/imjs/node_modules/grunt-browserify/node_modules/browserify/node_modules/inherits/inherits_browser.js":28}],55:[function(t,e,n){function r(){}var i=e.exports={};i.nextTick=function(){var t="undefined"!=typeof window&&window.setImmediate,e="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(t)return function(t){return window.setImmediate(t)};if(e){var n=[];return window.addEventListener("message",function(t){var e=t.source;if((e===window||null===e)&&"process-tick"===t.data&&(t.stopPropagation(),n.length>0)){var r=n.shift();r()}},!0),function(t){n.push(t),window.postMessage("process-tick","*")}}return function(t){setTimeout(t,0)}}(),i.title="browser",i.browser=!0,i.env={},i.argv=[],i.on=r,i.once=r,i.off=r,i.emit=r,i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")}},{}],56:[function(t,e,n){(function(r){function i(t,e,n){function i(){for(;h.length&&!l.paused;){var t=h.shift();if(null===t)return l.emit("end");l.emit("data",t)}}function s(){l.writable=!1,e.call(l),!l.readable&&l.autoDestroy&&l.destroy()}t=t||function(t){this.queue(t)},e=e||function(){this.queue(null)};var a=!1,u=!1,h=[],c=!1,l=new o;return l.readable=l.writable=!0,l.paused=!1,l.autoDestroy=!(n&&n.autoDestroy===!1),l.write=function(e){return t.call(this,e),!l.paused},l.queue=l.push=function(t){return c?l:(null==t&&(c=!0),h.push(t),i(),l)},l.on("end",function(){l.readable=!1,!l.writable&&l.autoDestroy&&r.nextTick(function(){l.destroy()})}),l.end=function(t){return a?void 0:(a=!0,arguments.length&&l.write(t),s(),l)},l.destroy=function(){return u?void 0:(u=!0,a=!0,h.length=0,l.writable=l.readable=!1,l.emit("close"),l)},l.pause=function(){return l.paused?void 0:(l.paused=!0,l)},l.resume=function(){return l.paused&&(l.paused=!1,l.emit("resume")),i(),l.paused||l.emit("drain"),l},l}var o=t("stream");n=e.exports=i,i.through=i}).call(this,t("/home/alex/projects/javascript/imjs/node_modules/insert-module-globals/node_modules/process/browser.js"))},{"/home/alex/projects/javascript/imjs/node_modules/insert-module-globals/node_modules/process/browser.js":55,stream:45}]},{},[2])(2)})}(window.intermine)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(t,e,n){var r={toNodesAndEdges:function(t,e){var n={nodes:[],edges:[]};for(var r in t){var i,o=t[r];i=this.recordToNode(o),o.interactions?n=this.mergeObjects(n,this.toNodesAndEdges(o.interactions,i)):n.edges.push(this.interactionToEdge(e,i)),n.nodes.push(i)}return n},recordToNode:function(t){var e;return e=t.gene2?t.gene2:t,console.log(e,e.primaryIdentifier),{data:{details:this.addDetails(t),label:this.nameNode(t),"class":e["class"],symbol:e.symbol,id:e.primaryIdentifier}}},addDetails:function(t){return t.details?t.details[0]:{}},nameNode:function(t){return t.gene2&&t.gene2.symbol?t.gene2.symbol:t.symbol?t.symbol:t.details?t.details[0].name:"NAME MISSING"},interactionToEdge:function(t,e){return{data:{source:t.data.id,target:e.data.id}}},mergeObjects:function(t,e){var n={};for(var r in t)n[r]=t[r];for(var r in e)n[r]=e[r];return n}};e.exports=r},{}],3:[function(t,e,n){var r,i=t("./cymine"),o=t("./../bower_components/imjs/js/im.js"),s=t("./nodeDataDisplay"),a=new o.Service({root:"www.humanmine.org/humanmine"}),u={name:"Gene_Interactions",title:"Gene --> Interactions",description:"Show all interactions for a given gene.",constraintLogic:"A and B",from:"Gene",select:["primaryIdentifier","symbol","interactions.gene2.symbol","interactions.gene2.primaryIdentifier","interactions.details.name","interactions.details.role1","interactions.details.role2","interactions.details.type","interactions.details.experiment.interactionDetectionMethods.name","interactions.details.experiment.publication.pubMedId","interactions.details.relationshipType.name","interactions.details.dataSets.name"],orderBy:[{path:"symbol",direction:"ASC"}],where:[{path:"Gene",op:"LOOKUP",value:"ZYX",extraValue:"H. sapiens",code:"A",editable:!0,switched:"LOCKED",switchable:!1}]};a.records(u).then(function(t){if(t)try{var e={};e.data=i.toNodesAndEdges(t),e.targetElem=document.getElementById("cy"),e.statusBar=e.targetElem.querySelector(".status"),console.debug("response:",t,"graph data",e.data),r=cytoscape({container:e.targetElem,layout:{name:"cose"},style:cytoscape.stylesheet().selector("node").css({content:"data(label)"}).selector(":selected").css({"background-color":"black","line-color":"black","target-arrow-color":"black","source-arrow-color":"black","text-outline-color":"black"}),elements:e.data,ready:function(){window.cy=this,e.statusBar.remove()}}),r.on("tap","node",function(){s.display(this.data())})}catch(n){console.error(n)}else e.statusBar["class"]="status no-results"})},{"./../bower_components/imjs/js/im.js":1,"./cymine":2,"./nodeDataDisplay":4}],4:[function(t,e,n){var r={display:function(t){this.targetElem=document.getElementById("nodeDetails"),console.log(t),this.node=t,this.setTitle(),this.listProperties()},setTitle:function(){var t=r.targetElem.querySelector(".nodeTitle");t.innerHTML=this.node.label},listProperties:function(){var t=this.expandPropertyVals(this.node);r.targetElem.querySelector(".nodeInfo").innerHTML=t},addProperty:function(t,e){return"<dt> "+e+"</dt><dd>"+t[e]+"</dd>"},expandPropertyVals:function(t){var e="";for(var n in t)e="object"==typeof t[n]?"<dt>"+n+"</dt><dd class='child'><dl>"+this.expandPropertyVals(t[n])+"</dl></dd>"+e:this.addProperty(t,n)+e;return e}};e.exports=r},{}]},{},[3]);
//# sourceMappingURL=bundle.js.map